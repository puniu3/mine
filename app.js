(()=>{var ca=Object.defineProperty;var N=(t,o)=>()=>(t&&(o=t(t=0)),o);var fa=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports),da=(t,o)=>{for(var i in o)ca(t,i,{get:o[i],enumerable:!0})};function Rt(t,o,i){return Math.max(o,Math.min(i,t))}function me(t,o,i){return t+(o-t)*i}function ha(t,o){return Math.floor(Math.random()*(o-t+1))+t}function ua(t,o,i,r){return Math.hypot(i-t,r-o)}function Jt(t,o,i){return{tx:Math.floor(t/i),ty:Math.floor(o/i)}}function Lo(t,o,i,r){let e=(t%i+i)%i;return(o%r+r)%r*i+e}function qt(t,o,i,r,e=1){return{x:t/e+i,y:o/e+r}}function pe(t,o){return t.x<o.x+o.w&&t.x+t.w>o.x&&t.y<o.y+o.h&&t.y+t.h>o.y}function _e(t,o,i,r,e){return ua(t,o,i,r)<=e}function dt(t,o){let i=o[t];return i&&i.solid===!0}function ge(t,o){let i=o[t];return i&&i.transparent===!0}function yt(t,o){let i=o[t];return i&&!i.unbreakable}function xo(t,o){let i=o[t];return i&&i.drop!==void 0?i.drop:t}function be(t,o){let i=o[t];return i?i.type:void 0}function Bo(t,o){return o.has(t)}function ma(t,o,i={}){let r=i.largeAmplitude??12,e=i.smallAmplitude??3,n=i.largeFrequency??30,a=i.smallFrequency??8,l=Math.sin(t/n)*r+Math.sin(t/a)*e;return Math.floor(o+l)}function Do(t,o,i,r){let e=[],n=[],a=Object.keys(o),l=0,c=[...a];for(let _=c.length-1;_>0;_--){let E=Math.floor(Math.random()*(_+1));[c[_],c[E]]=[c[E],c[_]]}let f=0,d=a.map(_=>{let E=o[_].weight!==void 0?o[_].weight:1;return f+=E,{key:_,threshold:f}}),h=0;for(;h<t;){let _;if(c.length>0)_=c.pop();else{let b=Math.random()*f,S=d.find(C=>b<C.threshold);_=S?S.key:a[0]}let E=Math.min(t-h,ha(i,r)),A=o[_],M=[];for(let b=0;b<E;b++){let S=h+b;M[b]=ma(S,A.baseHeight,A.terrain)}if(h>0){let b=e[h-1],S=M[0];if(S!==b){let C=Math.abs(S-b),P=Math.ceil(C*1.5),Y=Math.max(8,P);if(S>b){let O=Math.min(Y,E);for(let L=0;L<O;L++){let x=(L+1)/O;M[L]=Math.round(me(b,M[L],x))}}else{let O=Math.min(Y,h-l),L=e.slice(h-O,h);for(let x=0;x<O;x++){let V=(x+1)/O,K=h-O+x;e[K]=Math.round(me(L[x],S,V))}}}}for(let b=0;b<E;b++){let S=h+b;e[S]=M[b],n[S]=_}h+=E,l=h-E}let u=e[0],m=e[t-1];if(u!==m){let _=Math.abs(u-m),E=Math.ceil(_*1.5),A=Math.max(8,E),M=Math.min(A,Math.floor(t/2));if(m>u)for(let b=0;b<M;b++){let S=t-M+b,C=(b+1)/M;e[S]=Math.round(me(e[S],u,C))}else for(let b=0;b<M;b++){let S=(b+1)/M;e[b]=Math.round(me(m,e[b],S))}}return{heights:e,biomeByColumn:n}}function je(t,o,i){return t+(o-t)*i}function Ae(t,o,i,r,e,n=1){let a=Math.floor(t/e),l=a+Math.ceil(i/n/e)+1,c=Math.floor(o/e),f=c+Math.ceil(r/n/e)+1;return{startX:a,endX:l,startY:c,endY:f}}function No(t,o,i,r){for(let[e,n]of pa)if(i(t+e,o+n)!==r)return!0;return!1}function Te(t){if(t.length===0)return new Uint8Array(0);let o=[],i=0;for(;i<t.length;){let r=t[i++],e=t[i++];if(e===0){let n=t[i++],a=t[i++];e=n<<8|a}for(let n=0;n<e;n++)o.push(r)}return new Uint8Array(o)}var pa,rt=N(()=>{pa=[[0,1],[0,-1],[1,0],[-1,0]]});var Je,Z,Bt=N(()=>{Je=class{constructor(){this.ctx=null,this.ready=!1,this.reverbNode=null,this.isMusicPlaying=!1,this.nextNoteTimeout=null,this.musicGainNode=null,this.sfxGainNode=null,this.musicVolume=.5,this.sfxVolume=.5,this.MAX_MUSIC_GAIN=.2,this.MAX_SFX_GAIN=1,this.scale=[196,220,246.94,261.63,293.66,329.63,392,440,523.25,587.33,659.25,783.99,880]}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{this.startMusic()})),this.ctx.state==="suspended"&&this.ctx.resume()}setMusicVolume(o){this.musicVolume=Math.max(0,Math.min(1,o)),this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN)}setSfxVolume(o){this.sfxVolume=Math.max(0,Math.min(1,o)),this.ready&&(this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}updateVolumes(){this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN,this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}resume(){if(!this.ctx)return;let o=this.ctx.state;(o==="suspended"||o==="interrupted")&&this.ctx.resume().catch(()=>{}),o==="closed"&&this._recreateContext()}_recreateContext(){let o=this.isMusicPlaying;this.nextNoteTimeout&&(clearTimeout(this.nextNoteTimeout),this.nextNoteTimeout=null),this.ctx=null,this.ready=!1,this.reverbNode=null,this.musicGainNode=null,this.sfxGainNode=null,this.isMusicPlaying=!1,this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{o&&this.startMusic()})}async setupReverb(){if(!this.ctx)return;let o=this.ctx.sampleRate,i=o*3,r=this.ctx.createBuffer(2,i,o),e=r.getChannelData(0),n=r.getChannelData(1);for(let a=0;a<i;a++){let l=Math.pow(1-a/i,2);e[a]=(Math.random()*2-1)*l,n[a]=(Math.random()*2-1)*l}this.reverbNode=this.ctx.createConvolver(),this.reverbNode.buffer=r,this.reverbNode.connect(this.musicGainNode)}startMusic(){this.isMusicPlaying||!this.ready||(this.isMusicPlaying=!0,this.scheduleNextNote())}stopMusic(){this.isMusicPlaying=!1,this.nextNoteTimeout&&clearTimeout(this.nextNoteTimeout)}toggleMusic(){this.isMusicPlaying?this.stopMusic():this.startMusic()}scheduleNextNote(){if(!this.isMusicPlaying)return;this.ctx&&this.ctx.state==="running"&&this.playAmbientNote();let o=2e3+Math.random()*5e3;this.nextNoteTimeout=setTimeout(()=>this.scheduleNextNote(),o)}playAmbientNote(){if(!this.ready||!this.reverbNode)return;let o=this.scale[Math.floor(Math.random()*this.scale.length)],i=this.ctx.createOscillator(),r=this.ctx.createGain(),e=this.ctx.createStereoPanner();i.type=Math.random()>.5?"sine":"triangle",i.frequency.value=o,e.pan.value=Math.random()*2-1,i.connect(r),r.connect(e),e.connect(this.musicGainNode),e.connect(this.reverbNode);let n=this.ctx.currentTime,a=.5+Math.random()*1.5,l=2+Math.random()*2,c=3+Math.random()*2;r.gain.setValueAtTime(0,n),r.gain.linearRampToValueAtTime(.1+Math.random()*.1,n+a),r.gain.exponentialRampToValueAtTime(.001,n+a+l+c),i.start(n),i.stop(n+a+l+c+1)}playJump(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.type="square",o.frequency.setValueAtTime(150,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+.1),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),o.start(),o.stop(this.ctx.currentTime+.1)}playBigJump(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.type="square",o.frequency.setValueAtTime(100,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(500,this.ctx.currentTime+.3),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.3),o.start(),o.stop(this.ctx.currentTime+.3)}playDig(o){if(!this.ready)return;let i=this.ctx.createBuffer(1,this.ctx.sampleRate*.1,this.ctx.sampleRate),r=i.getChannelData(0);for(let l=0;l<r.length;l++)r[l]=Math.random()*2-1;let e=this.ctx.createBufferSource();e.buffer=i;let n=this.ctx.createGain(),a=this.ctx.createBiquadFilter();o==="stone"?(a.type="highpass",a.frequency.value=800):o==="wood"?(a.type="lowpass",a.frequency.value=600):(a.type="lowpass",a.frequency.value=300),e.connect(a),a.connect(n),n.connect(this.sfxGainNode),n.gain.setValueAtTime(.2,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.start()}playPop(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.frequency.setValueAtTime(600,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(1200,this.ctx.currentTime+.05),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.05),o.start(),o.stop(this.ctx.currentTime+.05)}playExplosion(){if(!this.ready)return;let o=this.ctx.sampleRate*.5,i=this.ctx.createBuffer(1,o,this.ctx.sampleRate),r=i.getChannelData(0);for(let l=0;l<o;l++)r[l]=Math.random()*2-1;let e=this.ctx.createBufferSource();e.buffer=i;let n=this.ctx.createGain(),a=this.ctx.createBiquadFilter();e.connect(a),a.connect(n),n.connect(this.sfxGainNode),a.type="lowpass",a.frequency.setValueAtTime(1200,this.ctx.currentTime),a.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.4),n.gain.setValueAtTime(.5,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.4),e.start()}playCoin(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createOscillator(),r=this.ctx.createGain();o.type="square",i.type="square",o.frequency.setValueAtTime(880,this.ctx.currentTime),i.frequency.setValueAtTime(1320,this.ctx.currentTime),o.connect(r),i.connect(r),r.connect(this.sfxGainNode),r.gain.setValueAtTime(.12,this.ctx.currentTime),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.25),o.frequency.exponentialRampToValueAtTime(1760,this.ctx.currentTime+.2),i.frequency.exponentialRampToValueAtTime(1980,this.ctx.currentTime+.2),o.start(),i.start(),o.stop(this.ctx.currentTime+.25),i.stop(this.ctx.currentTime+.25)}},Z=new Je});var Zt,mt,Me,p,it,at,$t,Fo,qe,Ze,Go,Wo,Ko,$e,Vo,Yo,Uo,Ho,Ee,ze,Xo,jo,Jo,qo,Zo,$o,zo,Qo,tn,en,Se,on,nn,rn,an,Qe,to,s,Q,gt,j=N(()=>{Zt=1.3888888888888888,mt=60/720,Me=36e4,p=32,it=512*8,at=256,$t=5*p,Fo=p/2,qe=.1,Ze=15,Go=.015,Wo=.6,Ko=60,$e=720,Vo=90,Yo=.5*mt,Uo=.25,Ho=20,Ee=10,ze=18,Xo=.1,jo=8,Jo=0,qo=-20,Zo=new Set([0,1,2,3,4,5,6,7,8,9,10,11,12,20]),$o=2160,zo=8,Qo=15,tn=2,en=360,Se=15,on=3,nn=4320,rn=720,an=576,Qe=648,to=288,s={AIR:0,DIRT:1,GRASS:2,STONE:3,WOOD:4,LEAVES:5,BEDROCK:6,COAL:7,GOLD:8,WORKBENCH:9,SAND:10,SNOW:11,CLOUD:12,FIREWORK:13,JUMP_PAD:14,TNT:15,SAPLING:16,JACKPOT:17,ACCELERATOR_LEFT:18,ACCELERATOR_RIGHT:19,WATER:20},Q={[s.AIR]:{name:"Air",solid:!1,transparent:!0},[s.DIRT]:{name:"Dirt",solid:!0,color:"#5d4037",type:"soil"},[s.GRASS]:{name:"Grass",solid:!0,color:"#388e3c",type:"soil",drop:s.DIRT},[s.STONE]:{name:"Stone",solid:!0,color:"#757575",type:"stone"},[s.WOOD]:{name:"Wood",solid:!0,color:"#5d4037",type:"wood"},[s.LEAVES]:{name:"Leaves",solid:!0,transparent:!1,color:"#2e7d32",type:"plant",drop:s.LEAVES},[s.BEDROCK]:{name:"Bedrock",solid:!0,unbreakable:!0,color:"#000000",type:"stone"},[s.COAL]:{name:"Coal Ore",solid:!0,color:"#212121",type:"stone",drop:s.COAL},[s.GOLD]:{name:"Gold Ore",solid:!0,color:"#ffb300",type:"stone",drop:s.GOLD},[s.WORKBENCH]:{name:"Workbench",solid:!1,unbreakable:!0,transparent:!0,color:"#8d6e63",type:"wood"},[s.SAND]:{name:"Sand",solid:!0,color:"#d7c27a",type:"sand",drop:s.SAND},[s.SNOW]:{name:"Snow",solid:!0,color:"#e0f7fa",type:"snow",drop:s.SNOW},[s.CLOUD]:{name:"Cloud",solid:!0,color:"#ffffff",type:"cloud",drop:s.CLOUD},[s.FIREWORK]:{name:"Firework",solid:!0,color:"#ef5350",type:"wood",drop:s.FIREWORK},[s.JUMP_PAD]:{name:"Jump Pad",solid:!0,color:"#ab47bc",type:"stone",drop:s.JUMP_PAD},[s.TNT]:{name:"TNT",solid:!0,color:"#d32f2f",type:"wood",drop:s.TNT},[s.SAPLING]:{name:"Sapling",solid:!1,transparent:!0,color:"#6fa85b",type:"plant",drop:s.SAPLING},[s.JACKPOT]:{name:"Jackpot",solid:!1,transparent:!0,color:"#ffd54f",type:"stone",drop:s.JACKPOT},[s.ACCELERATOR_LEFT]:{name:"Accelerator Left",solid:!1,transparent:!0,color:"#42a5f5",type:"stone",drop:s.ACCELERATOR_LEFT},[s.ACCELERATOR_RIGHT]:{name:"Accelerator Right",solid:!1,transparent:!0,color:"#66bb6a",type:"stone",drop:s.ACCELERATOR_RIGHT},[s.WATER]:{name:"Water",solid:!1,transparent:!0,color:"#2196f3",type:"water",drop:s.WATER}},gt=[s.DIRT,s.STONE,s.WOOD,s.LEAVES,s.COAL,s.GOLD,s.SAND,s.SNOW,s.CLOUD,s.WATER,s.FIREWORK,s.JUMP_PAD,s.TNT,s.SAPLING,s.JACKPOT,s.ACCELERATOR_LEFT,s.ACCELERATOR_RIGHT]});function sn(){let t={},o=(e,n)=>{let a=document.createElement("canvas");a.width=p,a.height=p;let l=a.getContext("2d");n(l,p),t[e]=a},i=(e,n=.1)=>{let a=e.getImageData(0,0,p,p),l=a.data;for(let c=0;c<l.length;c+=4){let f=(Math.random()-.5)*n*255;l[c]+=f,l[c+1]+=f,l[c+2]+=f}e.putImageData(a,0,0)};o(s.DIRT,(e,n)=>{e.fillStyle="#5d4037",e.fillRect(0,0,n,n),i(e,.15)}),o(s.GRASS,(e,n)=>{e.fillStyle="#5d4037",e.fillRect(0,0,n,n),i(e,.15),e.fillStyle="#4caf50",e.fillRect(0,0,n,n/3),i(e,.1);for(let a=0;a<n;a+=4)Math.random()>.5&&e.fillRect(a,n/3,4,4)}),o(s.STONE,(e,n)=>{e.fillStyle="#757575",e.fillRect(0,0,n,n),i(e,.2)}),o(s.SAND,(e,n)=>{e.fillStyle="#d7c27a",e.fillRect(0,0,n,n),e.fillStyle="#c2aa63";for(let a=0;a<12;a++)e.fillRect(Math.random()*n,Math.random()*n,3,3);i(e,.12)}),o(s.SNOW,(e,n)=>{let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,"#ffffff"),a.addColorStop(1,"#d7e4f2"),e.fillStyle=a,e.fillRect(0,0,n,n),e.fillStyle="#b0c4de";for(let l=0;l<8;l++)e.fillRect(Math.random()*n,Math.random()*n,2,2);i(e,.06)}),o(s.WOOD,(e,n)=>{e.fillStyle="#6d4c41",e.fillRect(0,0,n,n),e.fillStyle="#4e342e";for(let a=4;a<n;a+=8)e.fillRect(a,0,2,n);i(e,.1)}),o(s.LEAVES,(e,n)=>{e.fillStyle="#2e7d32",e.fillRect(0,0,n,n),i(e,.2),e.fillStyle="#1b5e20";for(let a=0;a<10;a++)e.fillRect(Math.random()*n,Math.random()*n,4,4)}),o(s.SAPLING,(e,n)=>{e.clearRect(0,0,n,n),e.strokeStyle="#43a047",e.lineWidth=n*.1,e.lineCap="round",e.beginPath(),e.moveTo(n*.5,n*.95),e.quadraticCurveTo(n*.5,n*.7,n*.5,n*.5),e.stroke(),e.fillStyle="#76ff03",e.beginPath(),e.ellipse(n*.35,n*.45,n*.16,n*.08,-.6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n*.65,n*.35,n*.18,n*.09,.5,0,Math.PI*2),e.fill(),i(e,.05)}),o(s.WATER,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(33, 150, 243, 0.5)",e.fillRect(0,0,n,n),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.beginPath();for(let a=0;a<3;a++){let l=n*(.3+a*.25);e.moveTo(0,l),e.bezierCurveTo(n*.3,l-4,n*.7,l+4,n,l)}e.stroke(),i(e,.05)}),o(s.BEDROCK,(e,n)=>{e.fillStyle="#212121",e.fillRect(0,0,n,n),i(e,.4)});let r=(e,n)=>(a,l)=>{a.fillStyle=e,a.fillRect(0,0,l,l),i(a,.2),a.fillStyle=n;for(let c=0;c<6;c++)a.fillRect(Math.random()*(l-6),Math.random()*(l-6),6,6)};return o(s.COAL,r("#757575","#000")),o(s.GOLD,r("#757575","#FFD700")),o(s.JACKPOT,(e,n)=>{e.fillStyle="#4e342e",e.fillRect(0,0,n,n),e.fillStyle="#ffd54f",e.fillRect(2,2,n-4,n-4),e.fillStyle="#f9a825";for(let a=0;a<6;a++){let l=6+Math.random()*4,c=6+Math.random()*4;e.fillRect(4+Math.random()*(n-8-l),4+Math.random()*(n-8-c),l,c)}e.strokeStyle="#fff9c4",e.lineWidth=2,e.strokeRect(3,3,n-6,n-6),i(e,.06)}),o(s.WORKBENCH,(e,n)=>{e.fillStyle="#8d6e63",e.fillRect(0,0,n,n),e.fillStyle="#5d4037",e.fillRect(0,0,n,n/3),e.fillStyle="#3e2723",e.fillRect(4,n/3,4,n-n/3),e.fillRect(n-8,n/3,4,n-n/3),e.fillStyle="#bcaaa4",e.fillRect(8,4,16,4),i(e,.1)}),o(s.FIREWORK,(e,n)=>{e.fillStyle="#ef5350",e.fillRect(4,8,n-8,n-8),e.fillStyle="#ffffff",e.fillRect(4,12,n-8,4),e.fillRect(4,20,n-8,4),e.fillStyle="#795548",e.fillRect(n/2-1,0,2,8),i(e,.1)}),o(s.JUMP_PAD,(e,n)=>{let l=n-8;e.fillStyle="#212121",e.fillRect(4,n-4,l,4),e.fillStyle="#616161",e.fillRect(6,10,l-4,n-14),e.fillStyle="#bdbdbd";for(let c=10;c<n-6;c+=4)e.fillRect(6,c,l-4,2);e.fillStyle="#d32f2f",e.fillRect(3,4,l+2,6),e.fillStyle="#ef9a9a",e.fillRect(6,5,l-4,2),i(e,.1)}),o(s.TNT,(e,n)=>{e.fillStyle="#d32f2f",e.fillRect(0,0,n,n),e.fillStyle="#ffffff",e.fillRect(0,n/3,n,n/3),e.fillStyle="#000000",e.fillRect(4,n/3+2,6,2),e.fillRect(6,n/3+2,2,6),e.fillRect(12,n/3+2,2,6),e.fillRect(16,n/3+2,2,6),e.fillRect(12,n/3+2,4,2),e.fillRect(13,n/3+3,2,2),e.fillRect(20,n/3+2,6,2),e.fillRect(22,n/3+2,2,6),e.fillStyle="#757575",e.fillRect(0,0,n,4),e.fillRect(0,n-4,n,4),i(e,.1)}),o(s.CLOUD,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n*.25,n*.3,n*.22,0,Math.PI*2),e.arc(n*.5,n*.2,n*.25,0,Math.PI*2),e.arc(n*.75,n*.3,n*.22,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.85)",e.fillRect(0,n*.25,n,n*.5),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n*.2,n*.7,n*.2,0,Math.PI*2),e.arc(n*.5,n*.75,n*.22,0,Math.PI*2),e.arc(n*.8,n*.7,n*.2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(200, 220, 240, 0.3)",e.fillRect(0,n*.7,n,n*.3),i(e,.04)}),o(s.ACCELERATOR_LEFT,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(66, 165, 245, 0.7)",e.fillRect(0,0,n,n),e.strokeStyle="#1976d2",e.lineWidth=2,e.strokeRect(1,1,n-2,n-2),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(n*.25,n*.5),e.lineTo(n*.65,n*.2),e.lineTo(n*.65,n*.4),e.lineTo(n*.75,n*.4),e.lineTo(n*.75,n*.6),e.lineTo(n*.65,n*.6),e.lineTo(n*.65,n*.8),e.closePath(),e.fill(),i(e,.05)}),o(s.ACCELERATOR_RIGHT,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(102, 187, 106, 0.7)",e.fillRect(0,0,n,n),e.strokeStyle="#388e3c",e.lineWidth=2,e.strokeRect(1,1,n-2,n-2),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(n*.75,n*.5),e.lineTo(n*.35,n*.2),e.lineTo(n*.35,n*.4),e.lineTo(n*.25,n*.4),e.lineTo(n*.25,n*.6),e.lineTo(n*.35,n*.6),e.lineTo(n*.35,n*.8),e.closePath(),e.fill(),i(e,.05)}),t}var ln=N(()=>{j()});function fn(t,{onHotbarSelect:o,onTouch:i,onClimb:r}){let e={keys:{left:!1,right:!1,jump:!1},mouse:{x:0,y:0,leftDown:!1,active:!1},gamepad:{connected:!1,cursorX:0,cursorY:0,cursorActive:!1,breakAction:!1,placeAction:!1,prevButtons:{}}},n=0,a=null,l=()=>{let A=document.getElementById("mobile-controls");A&&(A.style.display="none"),window.removeEventListener("keydown",l)};window.addEventListener("keydown",l),window.addEventListener("keydown",A=>{switch(A.code){case"KeyA":case"ArrowLeft":e.keys.left=!0,A.preventDefault();break;case"KeyD":case"ArrowRight":e.keys.right=!0,A.preventDefault();break;case"KeyW":case"ArrowUp":case"Space":e.keys.jump=!0,A.preventDefault();break;case"Digit1":o&&o(0);break;case"Digit2":o&&o(1);break;case"Digit3":o&&o(2);break;case"Digit4":o&&o(3);break;case"Digit5":o&&o(4);break;case"Digit6":o&&o(5);break;case"Digit7":o&&o(6);break;case"Digit8":o&&o(7);break;case"Digit9":o&&o(8);break;case"KeyS":case"ArrowDown":r&&r();break}}),window.addEventListener("keyup",A=>{switch(A.code){case"KeyA":case"ArrowLeft":e.keys.left=!1;break;case"KeyD":case"ArrowRight":e.keys.right=!1;break;case"KeyW":case"ArrowUp":case"Space":e.keys.jump=!1;break}}),window.addEventListener("mousemove",A=>{let M=t.getBoundingClientRect();e.mouse.x=A.clientX-M.left,e.mouse.y=A.clientY-M.top,Date.now()-n>500&&(e.mouse.active=!0)}),window.addEventListener("mousedown",A=>{A.target===t&&(e.mouse.leftDown=!0)}),window.addEventListener("mouseup",()=>{e.mouse.leftDown=!1}),window.addEventListener("touchstart",()=>{e.mouse.active=!1,n=Date.now()},{passive:!0});let c=(A,M)=>{let b=document.getElementById(A);b&&(b.addEventListener("touchstart",S=>{S.preventDefault(),e.keys[M]=!0,e.mouse.active=!1,n=Date.now()}),b.addEventListener("touchend",S=>{S.preventDefault(),e.keys[M]=!1}))};c("btn-left","left"),c("btn-right","right"),c("btn-jump","jump"),t.addEventListener("touchstart",A=>{let M=A.touches[0],b=t.getBoundingClientRect();e.mouse.active=!1,n=Date.now(),i&&i(M.clientX-b.left,M.clientY-b.top)},{passive:!1});function f(A){return Math.abs(A)<oo?0:Math.sign(A)*(Math.abs(A)-oo)/(1-oo)}function d(A,M){let b=A[M]&&A[M].pressed,S=e.gamepad.prevButtons[M];return b&&!S}window.addEventListener("gamepadconnected",A=>{if(A.gamepad.mapping!=="standard")return;a=A.gamepad.index,e.gamepad.connected=!0,e.gamepad.cursorActive=!0;let M=t.getBoundingClientRect();e.gamepad.cursorX=M.width/2,e.gamepad.cursorY=M.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none")}),window.addEventListener("gamepaddisconnected",A=>{A.gamepad.index===a&&(a=null,e.gamepad.connected=!1,e.gamepad.cursorActive=!1)});let h=navigator.getGamepads();for(let A of h)if(A&&A.connected&&A.mapping==="standard"){a=A.index,e.gamepad.connected=!0,e.gamepad.cursorActive=!0;let M=t.getBoundingClientRect();e.gamepad.cursorX=M.width/2,e.gamepad.cursorY=M.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none");break}let u=0,m=null,_=null;function E({screenWidth:A,screenHeight:M,playerScreenX:b,playerScreenY:S,reach:C,skipJump:P}){if(a===null)return;let O=navigator.getGamepads()[a];if(!O)return;let{axes:L,buttons:x}=O,V=f(L[eo.LEFT_X]||0);if(e.keys.left=V<-.3,e.keys.right=V>.3,e.gamepad.axisLeftX=V,!P&&x[bt.A]&&(e.keys.jump=x[bt.A].pressed),d(x,bt.X)&&r&&r(),m!==null&&_!==null){let B=b-m,T=S-_;e.gamepad.cursorX+=B,e.gamepad.cursorY+=T}m=b,_=S;let K=f(L[eo.RIGHT_X]||0),G=f(L[eo.RIGHT_Y]||0);if((K!==0||G!==0)&&(e.gamepad.cursorX+=K*cn,e.gamepad.cursorY+=G*cn,e.gamepad.cursorActive=!0),C!==void 0&&b!==void 0&&S!==void 0){let B=e.gamepad.cursorX-b,T=e.gamepad.cursorY-S,y=Math.sqrt(B*B+T*T);if(y>C){let D=C/y;e.gamepad.cursorX=b+B*D,e.gamepad.cursorY=S+T*D}}else e.gamepad.cursorX=Math.max(0,Math.min(A,e.gamepad.cursorX)),e.gamepad.cursorY=Math.max(0,Math.min(M,e.gamepad.cursorY));x[bt.RT]&&(e.gamepad.breakAction=x[bt.RT].pressed&&x[bt.RT].value>.5),x[bt.LT]&&(e.gamepad.placeAction=x[bt.LT].pressed&&x[bt.LT].value>.5);let w=gt.length;d(x,bt.LB)&&(u=(u-1+w)%w,o&&o(u)),d(x,bt.RB)&&(u=(u+1)%w,o&&o(u));for(let B=0;B<x.length;B++)e.gamepad.prevButtons[B]=x[B]&&x[B].pressed}return e.pollGamepads=E,e}var bt,eo,oo,cn,dn=N(()=>{j();bt={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,BACK:8,START:9,L_STICK:10,R_STICK:11,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15},eo={LEFT_X:0,LEFT_Y:1,RIGHT_X:2,RIGHT_Y:3},oo=.01,cn=.3});function hn(){return gt[Wt]}function un(){let t={};return gt.forEach(o=>{t[o]=st[o]||0}),{counts:t,selectedIndex:Wt}}function io(t){if(!t||!t.counts)return;gt.forEach(i=>{st[i]=t.counts[i]??0});let o=t.selectedIndex??0;Wt=Math.min(Math.max(0,o),gt.length-1),Dt(),zt(Wt,{playSound:!1})}function Dt(){gt.forEach((t,o)=>{let i=document.getElementById(`slot-count-${o}`);if(i){i.innerText=st[t];let r=document.getElementById(`slot-${o}`);r&&(r.style.opacity=st[t]>0?"1":"0.5")}})}function Re(t){if(t===s.AIR)return;let o=xo(t,Q);st[o]!==void 0&&(st[o]++,Dt())}function mn(t){return st[t]>0?(st[t]--,Dt(),!0):!1}function no(){let t=document.getElementById("hotbar"),o=document.getElementById("hotbar-scroll-left"),i=document.getElementById("hotbar-scroll-right");if(!t||!o||!i)return;let r=t.scrollLeft>0,e=t.scrollLeft<t.scrollWidth-t.clientWidth-1;o.classList.toggle("visible",r),i.classList.toggle("visible",e)}function pn(t){let o=document.getElementById("hotbar");o.innerHTML="",gt.forEach((i,r)=>{let e=document.createElement("div");e.className="slot"+(r===0?" active":""),e.id=`slot-${r}`,e.onclick=()=>zt(r);let n=document.createElement("canvas");n.width=32,n.height=32;let a=n.getContext("2d");t&&t[i]&&a.drawImage(t[i],0,0,32,32);let l=document.createElement("div");l.className="count",l.id=`slot-count-${r}`,l.innerText="0",e.appendChild(n),e.appendChild(l),o.appendChild(e)}),zt(Wt,{playSound:!1}),o.addEventListener("scroll",no),window.addEventListener("resize",no),setTimeout(no,0)}function zt(t,{playSound:o=!0}={}){if(t<0||t>=gt.length)return;let i=document.querySelectorAll(".slot");i.forEach(r=>r.classList.remove("active")),i[t]&&i[t].classList.add("active"),Wt=t,o&&Z.playPop()}var st,Wt,ro=N(()=>{j();rt();Bt();st={};gt.forEach(t=>st[t]=0);Wt=0});var An={};da(An,{currentLanguage:()=>gn,initI18n:()=>so,resources:()=>It,setLanguage:()=>ao,strings:()=>pt,supportedLanguages:()=>_a});function ga(){let t=localStorage.getItem(_n);if(t&&It[t])return t;let o=navigator.language||navigator.userLanguage||"en",i=o.split("-")[0];return It[o]?o:It[i]?i:"en"}function bn(t){let o=It[t]||It.en;gn=t,Object.keys(pt).forEach(i=>delete pt[i]),Object.assign(pt,o),document.documentElement.lang=t,document.querySelectorAll("[data-i18n]").forEach(i=>{let r=i.getAttribute("data-i18n");pt[r]&&(i.innerText=pt[r])})}function ao(t){if(!It[t]){console.warn(`Language '${t}' not supported`);return}localStorage.setItem(_n,t),bn(t)}function so(){let t=ga();bn(t)}var It,pt,_n,_a,gn,Qt=N(()=>{It={semantics:{continue_btn:"Title screen: Continue button. Resumes from autosave (game saves to browser localStorage every 5 seconds).",start_btn:"Title screen: Start button. Displayed when no save data exists. Starts with new player data and world.",reset_btn:"Title screen: Restart button. Displayed when save data exists. Deletes current save and starts fresh.",world_btn:"Title screen: World button. Opens modal to export/import world data as images.",inst_pc:"Title screen: Instruction header. Guide for keyboard + mouse controls.",inst_move_pc:"Title screen: Instruction. A, D, Left, Right to move.",inst_jump_pc:"Title screen: Instruction. Space key, W, Up to jump.",inst_action_pc:"Title screen: Instruction. Click to place or break (gather) blocks.",inst_climb_pc:"Title screen: Instruction. S to place block at feet and climb.",inst_mobile:"Title screen: Instruction header. Guide for touch controls.",inst_move_mobile:"Title screen: Instruction. Left/Right triangle buttons appear at bottom left; tap to move.",inst_jump_mobile:"Title screen: Instruction. Up triangle button appears at bottom right; tap to jump.",inst_action_mobile:"Title screen: Instruction. Tap tiles directly around the player character to break or place blocks.",inst_climb_mobile:"Title screen: Instruction. Tap the player character to place a block at feet and climb up.",inst_gamepad:"Title screen: Instruction header. Guide for gamepad controls.",label_move:"Title screen: Gamepad instruction label. Indicates controls for character movement.",label_cursor:"Title screen: Gamepad instruction label. Indicates controls for cursor movement.",label_jump:"Title screen: Gamepad instruction label. Indicates the button for jumping.",label_make:"Title screen: Gamepad instruction label. Indicates the button for placing blocks.",label_break:"Title screen: Gamepad instruction label. Indicates the button for breaking blocks.",label_climb:"Title screen: Gamepad instruction label. Indicates the button to place a block at feet and climb up.",label_select:"Title screen: Gamepad instruction label. Indicates buttons to cycle through items in the hotbar (left/right).",world_modal_title:"Modal window title for reading/writing world data.",world_export_title:"Header for the export section.",world_export_desc:"Export world data as a PNG image. 1 tile converts to 1 pixel, allowing the world to be viewed directly as an image.",world_export_btn:"Button to execute export.",world_import_title:"Header for the import section.",world_import_desc:"Imports an image, converts it to world data, and starts the game. Keeps existing player data. Forces closest-color matching for any uploaded image.",world_import_btn:"Button to execute import.",world_back_btn:"Button to close the window.",craft_missing:"Crafting screen message. Displayed when selecting an item at workbench but inventory lacks required materials.",craft_done:"Crafting screen message. Displayed when an item is successfully created.",msg_import_err:"World window alert message. Displayed when the try-catch block fails during image loading/world generation."},style:{target_audience:"6-year-olds",tone:"Carefree, colloquial, and friendly",context:"Children playing independently without adult supervision",vocabulary:"Simple, easy-to-understand words; strictly avoid technical jargon"},ja:{continue_btn:"\u3064\u3065\u304D\u304B\u3089",start_btn:"\u306F\u3058\u3081\u308B",reset_btn:"\u306F\u3058\u3081\u304B\u3089",world_btn:"\u30EF\u30FC\u30EB\u30C9",inst_pc:"\u30D1\u30BD\u30B3\u30F3",inst_move_pc:"\u3046\u3054\u304F: \u3084\u3058\u308B\u3057 / A D",inst_jump_pc:"\u3068\u3076: \u30B9\u30DA\u30FC\u30B9 / W / \u2191",inst_action_pc:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30AF\u30EA\u30C3\u30AF",inst_climb_pc:"\u306E\u307C\u308B: S",inst_mobile:"\u30B9\u30DE\u30DB",inst_move_mobile:"\u3046\u3054\u304F: \u2190 \u2192",inst_jump_mobile:"\u3068\u3076: \u2191",inst_action_mobile:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30BF\u30C3\u30D7",inst_climb_mobile:"\u306E\u307C\u308B: \u30AD\u30E3\u30E9\u3092\u30BF\u30C3\u30D7",inst_gamepad:"\u30B3\u30F3\u30C8\u30ED\u30FC\u30E9\u30FC",label_move:"\u3046\u3054\u304F",label_cursor:"\u30AB\u30FC\u30BD\u30EB",label_jump:"\u3068\u3076",label_make:"\u3064\u304F\u308B",label_break:"\u3053\u308F\u3059",label_climb:"\u306E\u307C\u308B",label_select:"\u3048\u3089\u3076",world_modal_title:"\u30EF\u30FC\u30EB\u30C9",world_export_title:"\u306E\u3053\u3059",world_export_desc:"\u3064\u304F\u3063\u305F \u305B\u304B\u3044\u3092 \u3048\u306B\u3059\u308B",world_export_btn:"\u3048\u306B\u3059\u308B",world_import_title:"\u3088\u307F\u3053\u3080",world_import_desc:"\u3048\u3092 \u3088\u307F\u3053\u3093\u3067 \u3042\u305D\u3076",world_import_btn:"\u3088\u307F\u3053\u3080",world_back_btn:"\u3082\u3069\u308B",craft_missing:"\u3056\u3044\u308A\u3087\u3046\u304C\u305F\u308A\u306A\u3044\u3088",craft_done:"\u3067\u304D\u305F\u3088\uFF01",msg_import_err:"\u3053\u306E \u3048\u3067\u306F \u30EF\u30FC\u30EB\u30C9\u3092 \u3064\u304F\u308C\u306A\u3044\u3088"},en:{continue_btn:"Continue",start_btn:"Start",reset_btn:"Start Over",world_btn:"World",inst_pc:"PC Controls",inst_move_pc:"Move: Arrows / A D",inst_jump_pc:"Jump: Space / W / Up",inst_action_pc:"Put / Break: Click",inst_climb_pc:"Climb: S",inst_mobile:"Touch Controls",inst_move_mobile:"Move: \u2190 \u2192",inst_jump_mobile:"Jump: \u2191",inst_action_mobile:"Put / Break: Tap",inst_climb_mobile:"Climb: Tap Player",inst_gamepad:"Controller",label_move:"Move",label_cursor:"Cursor",label_jump:"Jump",label_make:"Put",label_break:"Break",label_climb:"Climb",label_select:"Select",world_modal_title:"My World",world_export_title:"Save",world_export_desc:"Turn your world into a picture.",world_export_btn:"Make Picture",world_import_title:"Load",world_import_desc:"Load a picture to play.",world_import_btn:"Load Picture",world_back_btn:"Back",craft_missing:"Need more items!",craft_done:"Done!",msg_import_err:"Can't use this picture."},zh:{continue_btn:"\u7EE7\u7EED\u73A9",start_btn:"\u5F00\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u5F00\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u7535\u8111\u600E\u4E48\u73A9",inst_move_pc:"\u79FB\u52A8: \u7BAD\u5934 / A D",inst_jump_pc:"\u8DF3: \u7A7A\u683C\u952E / W / \u2191",inst_action_pc:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u51FB",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u673A\u600E\u4E48\u73A9",inst_move_mobile:"\u79FB\u52A8: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u6309",inst_climb_mobile:"\u722C\u9AD8: \u70B9\u6309\u89D2\u8272",inst_gamepad:"\u624B\u67C4\u600E\u4E48\u73A9",label_move:"\u79FB\u52A8",label_cursor:"\u5149\u6807",label_jump:"\u8DF3",label_make:"\u76D6",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9009",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u53D8\u6210\u4E00\u5F20\u753B",world_export_btn:"\u53D8\u6210\u753B",world_import_title:"\u8BFB\u53D6",world_import_desc:"\u8BFB\u53D6\u753B\u6765\u73A9",world_import_btn:"\u8BFB\u53D6\u753B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u591F\u54E6",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u8FD9\u5F20\u753B\u4E0D\u80FD\u7528\u54E6"},"zh-TW":{continue_btn:"\u7E7C\u7E8C\u73A9",start_btn:"\u958B\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u958B\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u96FB\u8166\u600E\u9EBC\u73A9",inst_move_pc:"\u79FB\u52D5: \u7BAD\u982D / A D",inst_jump_pc:"\u8DF3: \u7A7A\u767D\u9375 / W / \u2191",inst_action_pc:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u64CA",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u6A5F\u600E\u9EBC\u73A9",inst_move_mobile:"\u79FB\u52D5: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u6309",inst_climb_mobile:"\u722C\u9AD8: \u9EDE\u6309\u89D2\u8272",inst_gamepad:"\u624B\u628A\u600E\u9EBC\u73A9",label_move:"\u79FB\u52D5",label_cursor:"\u6E38\u6A19",label_jump:"\u8DF3",label_make:"\u84CB",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9078",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u8B8A\u6210\u4E00\u5F35\u756B",world_export_btn:"\u8B8A\u6210\u756B",world_import_title:"\u8B80\u53D6",world_import_desc:"\u8B80\u53D6\u756B\u4F86\u73A9",world_import_btn:"\u8B80\u53D6\u756B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u5920\u5594",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u9019\u5F35\u756B\u4E0D\u80FD\u7528\u5594"},es:{continue_btn:"Seguir",start_btn:"Jugar",reset_btn:"Desde cero",world_btn:"Mundo",inst_pc:"En PC",inst_move_pc:"Mover: Flechas / A D",inst_jump_pc:"Saltar: Espacio / W / \u2191",inst_action_pc:"Poner / Quitar: Clic",inst_climb_pc:"Subir: S",inst_mobile:"En m\xF3vil",inst_move_mobile:"Mover: \u2190 \u2192",inst_jump_mobile:"Saltar: \u2191",inst_action_mobile:"Poner / Quitar: Tocar",inst_climb_mobile:"Subir: Tocar personaje",inst_gamepad:"Mando",label_move:"Mover",label_cursor:"Cursor",label_jump:"Saltar",label_make:"Poner",label_break:"Quitar",label_climb:"Subir",label_select:"Elegir",world_modal_title:"Mi Mundo",world_export_title:"Guardar",world_export_desc:"Convierte tu mundo en un dibujo.",world_export_btn:"Hacer dibujo",world_import_title:"Cargar",world_import_desc:"Usa un dibujo para jugar.",world_import_btn:"Usar dibujo",world_back_btn:"Volver",craft_missing:"\xA1Te faltan cosas!",craft_done:"\xA1Listo!",msg_import_err:"No puedo usar este dibujo."},fr:{continue_btn:"Continuer",start_btn:"Jouer",reset_btn:"Recommencer",world_btn:"Monde",inst_pc:"Sur ordi",inst_move_pc:"Bouger : Fl\xE8ches / A D",inst_jump_pc:"Sauter : Espace / W / \u2191",inst_action_pc:"Mettre / Casser : Clic",inst_climb_pc:"Monter : S",inst_mobile:"Sur mobile",inst_move_mobile:"Bouger : \u2190 \u2192",inst_jump_mobile:"Sauter : \u2191",inst_action_mobile:"Mettre / Casser : Toucher",inst_climb_mobile:"Monter : Touche sur toi",inst_gamepad:"Manette",label_move:"Bouger",label_cursor:"Curseur",label_jump:"Sauter",label_make:"Mettre",label_break:"Casser",label_climb:"Monter",label_select:"Choisir",world_modal_title:"Mon Monde",world_export_title:"Garder",world_export_desc:"Transforme ton monde en image.",world_export_btn:"Faire une image",world_import_title:"Ouvrir",world_import_desc:"Ouvre une image pour jouer.",world_import_btn:"Ouvrir une image",world_back_btn:"Retour",craft_missing:"Il te manque des trucs !",craft_done:"C'est fait !",msg_import_err:"Je ne peux pas utiliser cette image."},de:{continue_btn:"Weiter",start_btn:"Starten",reset_btn:"Neustart",world_btn:"Welt",inst_pc:"Am Computer",inst_move_pc:"Laufen: Pfeile / A D",inst_jump_pc:"H\xFCpfen: Leertaste / W / \u2191",inst_action_pc:"Bauen / Abbauen: Klick",inst_climb_pc:"Klettern: S",inst_mobile:"Am Handy",inst_move_mobile:"Laufen: \u2190 \u2192",inst_jump_mobile:"H\xFCpfen: \u2191",inst_action_mobile:"Bauen / Abbauen: Tippen",inst_climb_mobile:"Klettern: Tipp auf dich",inst_gamepad:"Controller",label_move:"Laufen",label_cursor:"Cursor",label_jump:"H\xFCpfen",label_make:"Bauen",label_break:"Abbauen",label_climb:"Klettern",label_select:"W\xE4hlen",world_modal_title:"Meine Welt",world_export_title:"Speichern",world_export_desc:"Mach ein Bild aus deiner Welt.",world_export_btn:"Bild machen",world_import_title:"Laden",world_import_desc:"Lade ein Bild zum Spielen.",world_import_btn:"Bild laden",world_back_btn:"Zur\xFCck",craft_missing:"Dir fehlen Sachen!",craft_done:"Fertig!",msg_import_err:"Das Bild geht nicht."},it:{continue_btn:"Continua",start_btn:"Gioca",reset_btn:"Ricomincia",world_btn:"Mondo",inst_pc:"Computer",inst_move_pc:"Muovi: Frecce / A D",inst_jump_pc:"Salta: Spazio / W / \u2191",inst_action_pc:"Metti / Rompi: Clic",inst_climb_pc:"Sali: S",inst_mobile:"Telefono",inst_move_mobile:"Muovi: \u2190 \u2192",inst_jump_mobile:"Salta: \u2191",inst_action_mobile:"Metti / Rompi: Tocca",inst_climb_mobile:"Sali: Tocca l'omino",inst_gamepad:"Controller",label_move:"Muovi",label_cursor:"Cursore",label_jump:"Salta",label_make:"Metti",label_break:"Rompi",label_climb:"Sali",label_select:"Scegli",world_modal_title:"Mio Mondo",world_export_title:"Salva",world_export_desc:"Trasforma il mondo in una foto.",world_export_btn:"Fai una foto",world_import_title:"Carica",world_import_desc:"Usa una foto per giocare.",world_import_btn:"Usa foto",world_back_btn:"Indietro",craft_missing:"Mancano oggetti!",craft_done:"Fatto!",msg_import_err:"Non posso usare questa foto."},pt:{continue_btn:"Continuar",start_btn:"Jogar",reset_btn:"Do come\xE7o",world_btn:"Mundo",inst_pc:"No PC",inst_move_pc:"Andar: Setas / A D",inst_jump_pc:"Pular: Espa\xE7o / W / \u2191",inst_action_pc:"P\xF4r / Tirar: Clique",inst_climb_pc:"Subir: S",inst_mobile:"No Celular",inst_move_mobile:"Andar: \u2190 \u2192",inst_jump_mobile:"Pular: \u2191",inst_action_mobile:"P\xF4r / Tirar: Toque",inst_climb_mobile:"Subir: Toque no boneco",inst_gamepad:"Controle",label_move:"Andar",label_cursor:"Cursor",label_jump:"Pular",label_make:"P\xF4r",label_break:"Tirar",label_climb:"Subir",label_select:"Escolher",world_modal_title:"Meu Mundo",world_export_title:"Salvar",world_export_desc:"Vira uma foto do seu mundo.",world_export_btn:"Criar foto",world_import_title:"Abrir",world_import_desc:"Use uma foto para jogar.",world_import_btn:"Abrir foto",world_back_btn:"Voltar",craft_missing:"Falta coisa!",craft_done:"Pronto!",msg_import_err:"N\xE3o d\xE1 pra usar essa foto."},ko:{continue_btn:"\uC774\uC5B4\uD558\uAE30",start_btn:"\uC2DC\uC791\uD558\uAE30",reset_btn:"\uCC98\uC74C\uBD80\uD130",world_btn:"\uC6D4\uB4DC",inst_pc:"\uCEF4\uD4E8\uD130",inst_move_pc:"\uC774\uB3D9: \uD654\uC0B4\uD45C / A D",inst_jump_pc:"\uC810\uD504: \uC2A4\uD398\uC774\uC2A4\uBC14 / W / \u2191",inst_action_pc:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD074\uB9AD",inst_climb_pc:"\uC62C\uB77C\uAC00\uAE30: S",inst_mobile:"\uC2A4\uB9C8\uD2B8\uD3F0",inst_move_mobile:"\uC774\uB3D9: \u2190 \u2192",inst_jump_mobile:"\uC810\uD504: \u2191",inst_action_mobile:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD130\uCE58",inst_climb_mobile:"\uC62C\uB77C\uAC00\uAE30: \uCE90\uB9AD\uD130 \uD130\uCE58",inst_gamepad:"\uAC8C\uC784\uD328\uB4DC",label_move:"\uC774\uB3D9",label_cursor:"\uCEE4\uC11C",label_jump:"\uC810\uD504",label_make:"\uB193\uAE30",label_break:"\uBD80\uC218\uAE30",label_climb:"\uC62C\uB77C\uAC00\uAE30",label_select:"\uC120\uD0DD",world_modal_title:"\uB098\uC758 \uC6D4\uB4DC",world_export_title:"\uC800\uC7A5",world_export_desc:"\uC6D4\uB4DC\uB97C \uADF8\uB9BC\uC73C\uB85C \uB9CC\uB4E4\uAE30.",world_export_btn:"\uADF8\uB9BC \uB9CC\uB4E4\uAE30",world_import_title:"\uBD88\uB7EC\uC624\uAE30",world_import_desc:"\uADF8\uB9BC\uC744 \uBD88\uB7EC\uC640\uC11C \uB180\uAE30.",world_import_btn:"\uADF8\uB9BC \uAC00\uC838\uC624\uAE30",world_back_btn:"\uB3CC\uC544\uAC00\uAE30",craft_missing:"\uC7AC\uB8CC\uAC00 \uBD80\uC871\uD574!",craft_done:"\uB2E4 \uB9CC\uB4E4\uC5C8\uC5B4!",msg_import_err:"\uC774 \uADF8\uB9BC\uC740 \uC4F8 \uC218 \uC5C6\uC5B4."},ru:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",start_btn:"\u0418\u0433\u0440\u0430\u0442\u044C",reset_btn:"\u0421 \u043D\u0430\u0447\u0430\u043B\u0430",world_btn:"\u041C\u0438\u0440",inst_pc:"\u041A\u043E\u043C\u043F\u044C\u044E\u0442\u0435\u0440",inst_move_pc:"\u0425\u043E\u0434\u0438\u0442\u044C: \u0421\u0442\u0440\u0435\u043B\u043A\u0438 / A D",inst_jump_pc:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u041F\u0440\u043E\u0431\u0435\u043B / W / \u2191",inst_action_pc:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041A\u043B\u0438\u043A",inst_climb_pc:"\u041B\u0435\u0437\u0442\u044C: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0425\u043E\u0434\u0438\u0442\u044C: \u2190 \u2192",inst_jump_mobile:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u2191",inst_action_mobile:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041D\u0430\u0436\u043C\u0438",inst_climb_mobile:"\u041B\u0435\u0437\u0442\u044C: \u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0433\u0435\u0440\u043E\u044F",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0425\u043E\u0434\u0438\u0442\u044C",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C",label_make:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C",label_break:"\u041B\u043E\u043C\u0430\u0442\u044C",label_climb:"\u041B\u0435\u0437\u0442\u044C",label_select:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C",world_modal_title:"\u041C\u043E\u0439 \u043C\u0438\u0440",world_export_title:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",world_export_desc:"\u041F\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442\u044C \u043C\u0438\u0440 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_import_desc:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 \u0438 \u0438\u0433\u0440\u0430\u0442\u044C.",world_import_btn:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0432\u0435\u0449\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u042D\u0442\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442."},id:{continue_btn:"Lanjut",start_btn:"Main",reset_btn:"Mulai ulang",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Panah / A D",inst_jump_pc:"Lompat: Spasi / W / \u2191",inst_action_pc:"Buat / Pecahkan: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"HP",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Buat / Pecahkan: Sentuh",inst_climb_mobile:"Panjat: Sentuh karakter",inst_gamepad:"Stik",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Buat",label_break:"Pecahkan",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Jadikan duniamu gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main pakai gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barangnya kurang!",craft_done:"Jadi deh!",msg_import_err:"Gambar ini gak bisa dipakai."},pl:{continue_btn:"Graj dalej",start_btn:"Graj",reset_btn:"Od nowa",world_btn:"\u015Awiat",inst_pc:"Komputer",inst_move_pc:"Ruch: Strza\u0142ki / A D",inst_jump_pc:"Skok: Spacja / W / \u2191",inst_action_pc:"Buduj / Niszcz: Klik",inst_climb_pc:"Wspinaj si\u0119: S",inst_mobile:"Telefon",inst_move_mobile:"Ruch: \u2190 \u2192",inst_jump_mobile:"Skok: \u2191",inst_action_mobile:"Buduj / Niszcz: Dotknij",inst_climb_mobile:"Wspinaj si\u0119: Dotknij siebie",inst_gamepad:"Pad",label_move:"Ruch",label_cursor:"Kursor",label_jump:"Skok",label_make:"Buduj",label_break:"Niszcz",label_climb:"Wspinaj",label_select:"Wybierz",world_modal_title:"M\xF3j \u015Awiat",world_export_title:"Zapisz",world_export_desc:"Zr\xF3b obrazek ze \u015Bwiata.",world_export_btn:"Zr\xF3b obrazek",world_import_title:"Wczytaj",world_import_desc:"U\u017Cyj obrazka do gry.",world_import_btn:"Wczytaj obrazek",world_back_btn:"Wr\xF3\u0107",craft_missing:"Brakuje rzeczy!",craft_done:"Gotowe!",msg_import_err:"Ten obrazek nie dzia\u0142a."},uk:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u0432\u0436\u0438\u0442\u0438",start_btn:"\u0413\u0440\u0430\u0442\u0438",reset_btn:"\u0421\u043F\u043E\u0447\u0430\u0442\u043A\u0443",world_btn:"\u0421\u0432\u0456\u0442",inst_pc:"\u041A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440",inst_move_pc:"\u0420\u0443\u0445: \u0421\u0442\u0440\u0456\u043B\u043A\u0438 / A D",inst_jump_pc:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u041F\u0440\u043E\u0431\u0456\u043B / W / \u2191",inst_action_pc:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041A\u043B\u0456\u043A",inst_climb_pc:"\u041B\u0456\u0437\u0442\u0438: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0420\u0443\u0445: \u2190 \u2192",inst_jump_mobile:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u2191",inst_action_mobile:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438",inst_climb_mobile:"\u041B\u0456\u0437\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438 \u043D\u0430 \u0441\u0435\u0431\u0435",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0420\u0443\u0445",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A",label_make:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438",label_break:"\u041B\u0430\u043C\u0430\u0442\u0438",label_climb:"\u041B\u0456\u0437\u0442\u0438",label_select:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438",world_modal_title:"\u041C\u0456\u0439 \u0421\u0432\u0456\u0442",world_export_title:"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438",world_export_desc:"\u041F\u0435\u0440\u0435\u0442\u0432\u043E\u0440\u0438 \u0441\u0432\u0456\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0417\u0440\u043E\u0431\u0438\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0438\u0442\u0438",world_import_desc:"\u0413\u0440\u0430\u0439 \u0437 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438.",world_import_btn:"\u0412\u0437\u044F\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0432\u0438\u0441\u0442\u0430\u0447\u0430\u0454 \u0440\u0435\u0447\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u0426\u044F \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u043F\u0440\u0430\u0446\u044E\u0454."},tr:{continue_btn:"Devam Et",start_btn:"Oyna",reset_btn:"Ba\u015Ftan Ba\u015Fla",world_btn:"D\xFCnya",inst_pc:"Bilgisayar",inst_move_pc:"Git: Oklar / A D",inst_jump_pc:"Z\u0131pla: Bo\u015Fluk / W / \u2191",inst_action_pc:"Koy / K\u0131r: T\u0131kla",inst_climb_pc:"T\u0131rman: S",inst_mobile:"Telefon",inst_move_mobile:"Git: \u2190 \u2192",inst_jump_mobile:"Z\u0131pla: \u2191",inst_action_mobile:"Koy / K\u0131r: Dokun",inst_climb_mobile:"T\u0131rman: Kendine dokun",inst_gamepad:"Oyun Kolu",label_move:"Git",label_cursor:"\u0130mle\xE7",label_jump:"Z\u0131pla",label_make:"Koy",label_break:"K\u0131r",label_climb:"T\u0131rman",label_select:"Se\xE7",world_modal_title:"D\xFCnyam",world_export_title:"Kaydet",world_export_desc:"D\xFCnyay\u0131 resme \xE7evir.",world_export_btn:"Resim Yap",world_import_title:"A\xE7",world_import_desc:"Resimden oyun a\xE7.",world_import_btn:"Resim A\xE7",world_back_btn:"Geri",craft_missing:"Malzeme eksik!",craft_done:"Oldu!",msg_import_err:"Bu resim \xE7al\u0131\u015Fm\u0131yor."},ms:{continue_btn:"Sambung",start_btn:"Mula",reset_btn:"Mula Semula",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Anak Panah / A D",inst_jump_pc:"Lompat: Space / W / \u2191",inst_action_pc:"Bina / Pecah: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"Telefon",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Bina / Pecah: Sentuh",inst_climb_mobile:"Panjat: Sentuh orang",inst_gamepad:"Alat Kawalan",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Bina",label_break:"Pecah",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Tukar dunia jadi gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main guna gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barang tak cukup!",craft_done:"Siap!",msg_import_err:"Gambar ini tak boleh guna."}},pt={};Object.assign(pt,It.en);_n="pictoco_language",_a=["ja","en","zh","zh-TW","es","fr","de","it","pt","ko","ru","id","pl","uk","tr","ms"],gn="en"});function On(){if(!At)return;let t=navigator.getGamepads(),o=null;for(let l of t)if(l&&l.connected){o=l;break}if(!o)return;let{buttons:i}=o,r=i[In]&&i[In].pressed;r&&!Tn&&(Ct=Math.max(0,Ct-1),co()),Tn=r;let e=i[Cn]&&i[Cn].pressed;e&&!Mn&&(Ct=Math.min(Ie.length-1,Ct+1),co()),Mn=e;let n=i[Rn]&&i[Rn].pressed;if(n){if(!En){let l=Ie[Ct];l&&fo(l)}if(ye++,ye>=$e&&(ye-$e)%Vo===0){let c=Ie[Ct];c&&fo(c)}}else ye=0;En=n;let a=i[yn]&&i[yn].pressed;a&&!Sn&&kn(!0),Sn=a}function co(){let t=document.getElementById("craft-list");if(!t)return;t.querySelectorAll(".craft-item").forEach((i,r)=>{r===Ct?(i.classList.add("gamepad-selected"),i.scrollIntoView({block:"nearest",behavior:"smooth"})):i.classList.remove("gamepad-selected")})}function ba(t,o){let i=t.x,r=t.y,e=t.width,n=t.height,a=Math.floor(i/p),l=Math.floor((i+e)/p),c=Math.floor(r/p),f=Math.floor((r+n)/p),d=!1;for(let h=c;h<=f;h++)for(let u=a;u<=l;u++)if(o.getBlock(u,h)===s.WORKBENCH){d=!0;break}return d}function Pn(t,o,i){ba(t,o)?!At&&!lo&&Aa(i):(At&&kn(!1),lo=!1)}function Aa(t){At=!0,Ct=0;let o=document.getElementById("crafting-modal"),i=document.getElementById("craft-list"),r=document.getElementById("crafting-status");r&&(r.innerText=""),i.innerHTML="",Ie.forEach(e=>{let n=document.createElement("div");n.className="craft-item",n.onclick=()=>fo(e);let a=document.createElement("div");a.className="craft-inputs";let l=document.createElement("div");l.className="craft-cost-icons";for(let[h,u]of Object.entries(e.cost)){let m=document.createElement("div");m.className="craft-cost-item";let _=wn(h,32,t);_.classList.add("craft-icon");let E=document.createElement("span");E.className="craft-cost-count",E.innerText=`\xD7${u}`,m.appendChild(_),m.appendChild(E),l.appendChild(m)}a.appendChild(l);let c=document.createElement("div");c.className="craft-outputs";let f=document.createElement("div");f.className="craft-arrow",f.innerText="\u279C";let d=wn(e.id,48,t);d.classList.add("craft-icon-output"),c.appendChild(f),c.appendChild(d),n.appendChild(a),n.appendChild(c),i.appendChild(n)}),o.style.display="block",co()}function kn(t=!1){At=!1,document.getElementById("crafting-modal").style.display="none",t&&(lo=!0)}function fo(t){for(let[i,r]of Object.entries(t.cost))if((st[i]||0)<r){let e=document.getElementById("crafting-status");e&&(e.innerText=pt.craft_missing);return}for(let[i,r]of Object.entries(t.cost))st[i]-=r;st[t.id]||(st[t.id]=0),st[t.id]+=t.count,Dt(),Z.playPop();let o=document.getElementById("crafting-status");o&&(o.innerText=pt.craft_done)}function wn(t,o,i){let r=document.createElement("canvas");r.width=o,r.height=o;let e=r.getContext("2d");return i&&i[t]&&e.drawImage(i[t],0,0,o,o),r}var Ie,At,Ct,Tn,Mn,En,Sn,ye,lo,Rn,yn,In,Cn,vn=N(()=>{j();Bt();ro();Qt();Ie=[{id:s.FIREWORK,cost:{[s.WOOD]:2},count:1},{id:s.JUMP_PAD,cost:{[s.STONE]:2,[s.LEAVES]:2},count:1},{id:s.TNT,cost:{[s.COAL]:3,[s.WOOD]:2},count:1},{id:s.SAPLING,cost:{[s.WOOD]:1,[s.LEAVES]:1},count:1},{id:s.JACKPOT,cost:{[s.GOLD]:3},count:1},{id:s.ACCELERATOR_LEFT,cost:{[s.GOLD]:2,[s.SAND]:2},count:1},{id:s.ACCELERATOR_RIGHT,cost:{[s.GOLD]:2,[s.SNOW]:2},count:1}],At=!1,Ct=0,Tn=!1,Mn=!1,En=!1,Sn=!1,ye=0,lo=!1,Rn=0,yn=1,In=12,Cn=13});function Nn(t){let o=k.count-1;t!==o&&(k.x[t]=k.x[o],k.y[t]=k.y[o],k.vx[t]=k.vx[o],k.vy[t]=k.vy[o],k.life[t]=k.life[o],k.hue[t]=k.hue[o]),k.count--}function we(t,o,i,r,e,n){if(k.count>=Nt)return;let a=k.count;k.x[a]=t,k.y[a]=o,k.vx[a]=i,k.vy[a]=r,k.life[a]=e,k.hue[a]=n,k.count++}function Sa(t,o){let i=o-10*p;we(t,o,0,Ma,-i,ho)}function Ra(t,o){let i=Math.floor(Math.random()*360);mo(t,o,i)}function Fn(t,o,i=p*2){let r=(Math.random()-.5)*.05,e=Ea*(.8+Math.random()*.4),n=Math.abs(e),a=20+Math.random()*40,l=Math.max(50,i/n+a);we(t,o,r,e,l,uo)}function Gn(t,o){for(let r=0;r<20;r++){let e=-Math.PI/2+(Math.random()-.5)*1.5,n=Math.random()*.15+.05,a=Math.cos(e)*n,l=Math.sin(e)*n,c=300+Math.random()*200;we(t,o,a,l,c,195)}}function mo(t,o,i){let r;if(typeof i=="string"){let e=i.match(/hsl\((\d+)/);r=e?parseInt(e[1],10):Math.floor(Math.random()*360)}else typeof i=="number"?r=i:r=35;for(let e=0;e<100;e++){let n=Math.random()*Math.PI*2,a=Math.random()*.17+.08,l=720+Math.random()*720;we(t,o,Math.cos(n)*a,Math.sin(n)*a,l,r)}}function Wn(t,o,i,r){if(t.fireworkTimer||(t.fireworkTimer=0),t.fireworkTimer++,t.fireworkTimer>3600){t.fireworkTimer=0;let n=Ae(o,i,r.width,r.height,p);for(let a=n.startY-10;a<n.endY+10;a++)for(let l=n.startX-10;l<n.endX+10;l++)t.getBlock(l,a)===s.FIREWORK&&Sa(l*p+p/2,a*p+p/2)}let e=0;for(;e<k.count;){let n=k.life[e],a=k.hue[e];if(a===ho){k.y[e]+=k.vy[e];let l=-n;if(k.y[e]<=l){let c=k.x[e],f=k.y[e];Nn(e),Ra(c,f);continue}}else if(k.x[e]+=k.vx[e],k.y[e]+=k.vy[e],a!==uo&&(k.vy[e]+=Ta),k.life[e]--,k.life[e]<=0){Nn(e);continue}e++}}function Kn(t,o,i,r,e){if(k.count===0)return;Ln=o-Ce,xn=o+r+Ce,Bn=i-Ce,Dn=i+e+Ce;let n=new Map;for(let a=0;a<k.count;a++){let l=k.x[a],c=k.y[a];if(l<Ln||l>xn||c<Bn||c>Dn)continue;let f=k.hue[a];n.has(f)||n.set(f,[]),n.get(f).push(a)}for(let[a,l]of n)if(a===ho){t.fillStyle="#ffffff";for(let c of l)t.fillRect(k.x[c]-2,k.y[c]-2,4,8)}else if(a===uo){t.fillStyle="rgba(200, 240, 255, 0.6)";for(let c of l)t.fillRect(k.x[c],k.y[c],3,3)}else{t.fillStyle=`hsl(${a}, 100%, 50%)`;for(let c of l)t.fillRect(k.x[c],k.y[c],4,4)}}var Nt,k,ho,uo,Ta,Ma,Ea,Ln,xn,Bn,Dn,Ce,Oe=N(()=>{j();rt();Nt=8e3,k={x:new Float32Array(Nt),y:new Float32Array(Nt),vx:new Float32Array(Nt),vy:new Float32Array(Nt),life:new Float32Array(Nt),hue:new Uint16Array(Nt),count:0},ho=361,uo=362,Ta=35e-5,Ma=-.33,Ea=-.15,Ln=0,xn=0,Bn=0,Dn=0,Ce=50});function Jn(t){ke=t}function Ca(t){if(po.has(t))return po.get(t);if(!ke||!ke[t])return null;let r=ke[t].getContext("2d").getImageData(0,0,p,p);return po.set(t,r),r}function wa(t){let o=Ca(t);if(!o)return{r:128,g:128,b:128};let i=Math.floor(Math.random()*p),e=(Math.floor(Math.random()*p)*p+i)*4;return{r:o.data[e],g:o.data[e+1],b:o.data[e+2]}}function Oa(t){let o=v.count-1;t!==o&&(v.x[t]=v.x[o],v.y[t]=v.y[o],v.vx[t]=v.vx[o],v.vy[t]=v.vy[o],v.life[t]=v.life[o],v.r[t]=v.r[o],v.g[t]=v.g[o],v.b[t]=v.b[o]),v.count--}function Pa(t,o,i,r,e,n,a,l){if(v.count>=Mt)return;let c=v.count;v.x[c]=t,v.y[c]=o,v.vx[c]=i,v.vy[c]=r,v.life[c]=e,v.r[c]=n,v.g[c]=a,v.b[c]=l,v.count++}function ve(t,o,i){let r=t*p+p/2,e=o*p+p/2;for(let n=0;n<Ia;n++){let a=wa(i),l=Math.random()*Math.PI*2,c=.4+Math.random()*.4,f=Math.cos(l)*c,d=Math.sin(l)*c,h=(Math.random()-.5)*p*.5,u=(Math.random()-.5)*p*.5,m=jn+Math.floor(Math.random()*120)-60;Pa(r+h,e+u,f,d,m,a.r,a.g,a.b)}}function qn(){let t=0;for(;t<v.count;){if(v.x[t]+=v.vx[t],v.y[t]+=v.vy[t],v.vy[t]+=ya,v.vx[t]*=Vn,v.vy[t]*=Vn,v.life[t]--,v.life[t]<=0){Oa(t);continue}t++}}function Zn(t,o,i,r,e){if(v.count===0)return;Yn=o-Pe,Un=o+r+Pe,Hn=i-Pe,Xn=i+e+Pe;let n=new Map;for(let a=0;a<v.count;a++){let l=v.x[a],c=v.y[a];if(l<Yn||l>Un||c<Hn||c>Xn)continue;let f=v.r[a]<<16|v.g[a]<<8|v.b[a];n.has(f)||n.set(f,[]),n.get(f).push(a)}for(let[a,l]of n){let c=a>>16&255,f=a>>8&255,d=a&255;t.fillStyle=`rgb(${c}, ${f}, ${d})`;for(let h of l){let u=v.life[h]/jn;t.globalAlpha=u*.9+.1,t.fillRect(Math.floor(v.x[h])-2,Math.floor(v.y[h])-2,4,4)}}t.globalAlpha=1}var Mt,v,ya,Vn,jn,Ia,Yn,Un,Hn,Xn,Pe,ke,po,te=N(()=>{j();Mt=500,v={x:new Float32Array(Mt),y:new Float32Array(Mt),vx:new Float32Array(Mt),vy:new Float32Array(Mt),life:new Uint16Array(Mt),r:new Uint8Array(Mt),g:new Uint8Array(Mt),b:new Uint8Array(Mt),count:0},ya=.008,Vn=.995,jn=360,Ia=8,Yn=0,Un=0,Hn=0,Xn=0,Pe=50,ke=null,po=new Map});function $n({world:t,player:o,inventory:i,camera:r,sounds:e,constants:n,utils:a,onBlockPlaced:l}){let{TILE_SIZE:c,BLOCKS:f,BLOCK_PROPS:d,REACH:h}=n,{screenToWorld:u,worldToTile:m,isWithinReach:_,isBlockBreakable:E,isBlockTransparent:A,isBlockSolid:M,getBlockMaterialType:b,rectsIntersect:S}=a;function C(L,x,V){let K=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(let{dx:G,dy:w}of K){let B=t.getBlock(L+G,x+w);if(B!==f.AIR&&(B!==f.WATER||V===f.WATER))return!0}return!1}function P(){let L=o.getCenterX(),x=Math.floor(L/c),V=Math.floor((o.y+o.height-.01)/c),K=Math.floor((o.y+o.height+.1)/c),G=Math.floor(o.x/c),w=Math.floor((o.x+o.width-.01)/c),B=x,T=t.getBlock(x,K);if(!M(T,d)){let g=t.getBlock(G,K),R=t.getBlock(w,K);M(g,d)?B=G:M(R,d)&&(B=w)}let y=t.getBlock(B,V),D=A(y,d)&&(y===f.AIR||E(y,d)),W=V*c-o.height,z=t.checkAreaFree(o.x,W,o.width,o.height);if(D&&z){let g=i.getSelectedBlockId();if(y===g)return!1;if(g===f.CLOUD||C(B,V,g)){if(i.consumeFromInventory(g))return y!==f.AIR&&i.addToInventory(y),t.setBlock(B,V,g),e.playDig("dirt"),l&&l(B,V,g),A(g,d)||(o.y=W-.1,o.vy=0,o.grounded=!0),!0;e.playPop()}}return!1}function Y(){P()}function O(L,x,V){let K=u(L,x,r.x,r.y,r.zoom),{tx:G,ty:w}=m(K.x,K.y,c);if(!_(K.x,K.y,o.getCenterX(),o.getCenterY(),h))return;let B=o.getCenterX(),T=Math.floor(B/c),y=Math.floor(o.y/c),D=G===T&&w===y,W=G===T&&w===y+1,z=K.y%c<c/2,g=W&&z,R=B-16,U=o.y-4,et=K.x>=R&&K.x<R+32&&K.y>=U&&K.y<U+48;if((D||g||et)&&!V){P();return}let q=t.getBlock(G,w);if(V!=="place"&&q!==f.AIR&&E(q,d))return i.addToInventory(q),e.playDig(b(q,d)),ve(G,w,q),t.setBlock(G,w,f.AIR),!0;if(V!=="break"&&(q===f.AIR||A(q,d))&&q!==f.WORKBENCH){let _t=o.getRect(),ht={x:G*c,y:w*c,w:c,h:c};if(!S(_t,ht)){let Tt=i.getSelectedBlockId();if(q===Tt)return;(Tt===f.CLOUD||C(G,w,Tt))&&(i.consumeFromInventory(Tt)?(q!==f.AIR&&i.addToInventory(q),t.setBlock(G,w,Tt),e.playDig("dirt"),l&&l(G,w,Tt)):V!=="place"&&e.playPop())}}}return{handlePointer:O,triggerClimb:Y}}var zn=N(()=>{te()});function Qn(t){let o=t/2;return{[I.PLAINS]:{weight:20,baseHeight:o,terrain:{largeAmplitude:10,smallAmplitude:3,largeFrequency:32,smallFrequency:9}},[I.FOREST]:{weight:20,baseHeight:o+2,terrain:{largeAmplitude:12,smallAmplitude:2,largeFrequency:30,smallFrequency:10}},[I.DESERT]:{weight:15,baseHeight:o+8,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:36,smallFrequency:12}},[I.SNOWFIELD]:{weight:15,baseHeight:o-4,terrain:{largeAmplitude:10,smallAmplitude:4,largeFrequency:28,smallFrequency:10}},[I.MOUNTAIN]:{weight:10,baseHeight:o-18,terrain:{largeAmplitude:20,smallAmplitude:6,largeFrequency:35,smallFrequency:9}},[I.WASTELAND]:{weight:5,baseHeight:o-5,terrain:{largeAmplitude:8,smallAmplitude:5,largeFrequency:40,smallFrequency:5}},[I.DEEP_FOREST]:{weight:10,baseHeight:o+5,terrain:{largeAmplitude:15,smallAmplitude:4,largeFrequency:25,smallFrequency:8}},[I.SAVANNA]:{weight:15,baseHeight:o,terrain:{largeAmplitude:5,smallAmplitude:1,largeFrequency:50,smallFrequency:15}},[I.PLATEAU]:{weight:10,baseHeight:o-10,terrain:{largeAmplitude:25,smallAmplitude:2,largeFrequency:60,smallFrequency:5}},[I.OCEAN]:{weight:12,baseHeight:o+25,terrain:{largeAmplitude:15,smallAmplitude:5,largeFrequency:45,smallFrequency:10}},[I.SWAMP]:{weight:5,baseHeight:o+2,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:40,smallFrequency:8}}}}function ti(t,o,i,r){let e=r/2-14;return t===I.DESERT?s.SAND:t===I.SNOWFIELD?s.SNOW:t===I.WASTELAND?s.STONE:t===I.OCEAN?s.SAND:t===I.MOUNTAIN?o<e?s.SNOW:o>r/2-6?s.GRASS:s.STONE:t===I.SAVANNA?i%7<3||Math.random()<.2?s.DIRT:s.GRASS:t===I.PLATEAU?o%4===0?s.SAND:s.STONE:t===I.SWAMP?Math.random()<.3?s.DIRT:s.GRASS:s.GRASS}function ei(t,o,i){let r=o<=i+4;return t===I.DESERT?r?s.SAND:s.STONE:t===I.OCEAN?s.SAND:t===I.MOUNTAIN||t===I.WASTELAND||t===I.PLATEAU?s.STONE:s.DIRT}var I,Kt=N(()=>{j();I={PLAINS:"plains",DESERT:"desert",SNOWFIELD:"snowfield",MOUNTAIN:"mountain",FOREST:"forest",WASTELAND:"wasteland",DEEP_FOREST:"deep_forest",SAVANNA:"savanna",PLATEAU:"plateau",OCEAN:"ocean",SWAMP:"swamp"}});function oi(t,o,i){let e=-80;for(let n=20;n<o-20;n++){if(n-e<80)continue;let a=Math.random(),l=t[n];if(a<.003){let c=25+Math.floor(Math.random()*20);ka(t,n,c,o,i),e=n+c}else if(a<.0045){let c=30+Math.floor(Math.random()*20);l>50&&(va(t,n,c,o),e=n+c)}else if(a>.995){let c=20+Math.floor(Math.random()*25);La(t,n,c,o),e=n+c}else if(a>.985){let c=40+Math.floor(Math.random()*30);xa(t,n,c,o),e=n+c}}}function ka(t,o,i,r,e){let n=25+Math.floor(Math.random()*20),a=Math.floor(i/2);for(let l=-a;l<=a;l++){let c=o+l,f=(c%r+r)%r,d=Math.abs(l)/a,h=Math.pow(Math.cos(d*Math.PI/2),.5),u=Math.floor(h*4)/4,m=h*.3+u*.7,_=Math.sin(c*.5)*2,E=Math.floor(n*m)+_,A=t[f];t[f]=Math.min(e-5,A+E)}Ba(t,o-a,o+a,r)}function va(t,o,i,r){let e=30+Math.floor(Math.random()*15),n=Math.floor(i/2),a=i*.25;for(let l=-n;l<=n;l++){let f=((o+l)%r+r)%r,d=Math.abs(l),h=Math.exp(-Math.pow(d/(i*.35),2));if(d<a){let m=Math.pow((a-d)/a,2);h-=m*1.5}let u=Math.floor(e*h);t[f]=Math.max(10,t[f]-u)}}function La(t,o,i,r){let e=15+Math.floor(Math.random()*15),n=Math.floor(i/2);for(let a=-n;a<=n;a++){let c=((o+a)%r+r)%r,f=Math.abs(a)/n,d=0;if(f<.6)d=1+Math.random()*.1;else{let h=(1-f)/.4;d=h*h}t[c]=Math.max(10,t[c]-Math.floor(e*d))}}function xa(t,o,i,r){let e=Math.floor(i/2);for(let n=-e;n<=e;n++){let l=((o+n)%r+r)%r,c=n/i*Math.PI*4,f=Math.sin(c)*6,d=Math.abs(n)/e,h=1-Math.pow(d,3);t[l]-=Math.floor(f*h)}}function Ba(t,o,i,r){for(let e=o;e<=i;e++){let n=((e-1)%r+r)%r,a=(e%r+r)%r,l=((e+1)%r+r)%r,c=t[n],f=t[a],d=t[l];Math.abs(c-f)>3&&Math.abs(d-f)>3&&(t[a]=Math.floor((c+f+d)/3))}}function ni(t,o){for(let i=0;i<t.width;i++){let r=(i-1+t.width)%t.width,e=(i+1)%t.width,n=o[i],a=o[r],l=o[e];if(n>a+2)for(let c=a+1;c<=n;c++)t.getBlock(r,c)===s.DIRT&&t.setBlock(r,c,s.STONE);if(n>l+2)for(let c=l+1;c<=n;c++)t.getBlock(e,c)===s.DIRT&&t.setBlock(e,c,s.STONE)}}var ii=N(()=>{j()});function ri(t){for(let i=0;i<12;i++){let r=0,e=i%2===0,n=e?0:t.width-1,a=e?t.width:-1,l=e?1:-1;for(let c=0;c<t.height-1;c++)for(let f=n;f!==a;f+=l)if(t.getBlock(f,c)===s.WATER){if(t.getBlock(f,c+1)===s.AIR){t.setBlock(f,c+1,s.WATER),t.setBlock(f,c,s.AIR),r++;continue}let d=(f-1+t.width)%t.width,h=(f+1)%t.width,u=c+1,m=t.getBlock(d,c)===s.AIR&&t.getBlock(d,u)===s.AIR,_=t.getBlock(h,c)===s.AIR&&t.getBlock(h,u)===s.AIR;if(m||_){let M=(m&&_?Math.random()<.5:m)?d:h;t.setBlock(M,u,s.WATER),t.setBlock(f,c,s.AIR),r++;continue}let E=t.getBlock(f,c+1);if(E===s.WATER||dt(E,Q)){let A=t.getBlock(d,c)===s.AIR,M=t.getBlock(h,c)===s.AIR;if(A||M){let b;if(A&&M){let C=(f-2+t.width)%t.width,P=(f+2)%t.width,Y=t.getBlock(C,c),O=t.getBlock(P,c),L=Y===s.WATER||dt(Y,Q),x=O===s.WATER||dt(O,Q);L&&!x?b=!0:!L&&x?b=!1:b=Math.random()<.5}else b=A;let S=b?d:h;t.setBlock(S,c,s.WATER),t.setBlock(f,c,s.AIR),r++}}}if(r===0)break}}function ai(t,o,i){for(let e=0;e<t.width;e++)if(o[e]===I.OCEAN){let n=!1;for(let l=-5;l<=5;l++){let c=(e+l+t.width)%t.width;if(o[c]!==I.OCEAN){n=!0;break}}if(n)continue;let a=i+1;for(let l=a;l<t.height;l++){let c=t.getBlock(e,l);if(c===s.AIR)t.setBlock(e,l,s.WATER);else if(dt(c,Q)||c===s.WATER)break}}}var si=N(()=>{j();rt();Kt()});function Le(t,o,i,r,e){let n=e*e,a=Math.ceil(e);for(let l=-a;l<=a;l++)for(let c=-a;c<=a;c++)if(l*l+c*c<=n){let f=o+l,d=i+c,h=t.get(f,d);(h===s.STONE||h===s.DIRT)&&t.set(f,d,r)}}function ee(t,o,i,r){for(let e=-r;e<=r;e++)for(let n=0;n<=r/2;n++)e*e+n*n*4<=r*r&&t.set(o+e,i+n,s.WATER)}function li(t,o,i){let r=2+Math.floor(Math.random()*3);for(let e=-r;e<=r;e++)for(let n=-r;n<=r;n++)if(e*e+n*n<=r*r){let a=o+e,l=i+n;l<t.height-1&&t.set(a,l,s.AIR)}}var ci=N(()=>{j()});function Ft(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<r;e++)t.set(o,i-e,s.WOOD);for(let e=o-2;e<=o+2;e++)for(let n=i-r-2;n<=i-r;n++)Math.abs(e-o)===2&&Math.abs(n-(i-r))===2||t.get(e,n)===s.AIR&&t.set(e,n,s.LEAVES)}function fi(t,o,i){let r=5+Math.floor(Math.random()*4);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD);let e=1;for(let n=r;n>1;n--){let a=i-n;(r-n)%2===0&&(e=Math.min(3,e+1)),n===r&&(e=1);for(let l=o-e;l<=o+e;l++)l===o&&n!==r||t.get(l,a)===s.AIR&&t.set(l,a,s.LEAVES)}t.set(o,i-r,s.LEAVES)}function di(t,o,i){let r=2+Math.floor(Math.random()*3);for(let e=0;e<r;e++)t.set(o,i-e,s.LEAVES);if(r>=3&&Math.random()<.5){let e=Math.random()<.5?-1:1,n=1+Math.floor(Math.random()*(r-2));t.get(o+e,i-n)===s.AIR&&(t.set(o+e,i-n,s.LEAVES),t.get(o+e,i-n-1)===s.AIR&&t.set(o+e,i-n-1,s.LEAVES))}}function xe(t,o,i){let r=3+Math.floor(Math.random()*3),e=o;for(let n=0;n<r;n++)t.set(e,i-n,s.WOOD),n>1&&Math.random()<.3&&(e+=Math.random()<.5?-1:1);if(Math.random()<.5){let n=i-Math.floor(r/2),a=Math.random()<.5?-1:1;t.get(e+a,n)===s.AIR&&t.set(e+a,n,s.WOOD)}}function Be(t,o,i){let r=8+Math.floor(Math.random()*5);for(let n=0;n<r;n++)if(t.set(o,i-n,s.WOOD),Math.random()<.3){let a=Math.random()<.5?-1:1;t.get(o+a,i-n)===s.AIR&&t.set(o+a,i-n,s.LEAVES)}let e=3;for(let n=0;n<3;n++)for(let a=-e;a<=e;a++)Math.abs(a)+n<4&&t.set(o+a,i-r+1-n,s.LEAVES)}function hi(t,o,i){let r=4+Math.floor(Math.random()*2),e=o;for(let a=0;a<Math.floor(r/2);a++)t.set(e,i-a,s.WOOD);let n=Math.random()<.5?1:-1;for(let a=Math.floor(r/2);a<r;a++)e+=n,t.set(e,i-a,s.WOOD);for(let a=-2;a<=2;a++)t.set(e+a,i-r,s.LEAVES);for(let a=-1;a<=1;a++)t.set(e+a,i-r-1,s.LEAVES)}function ui(t,o,i){let r=6+Math.floor(Math.random()*4);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD);let e=3;for(let n=0;n<=2;n++)for(let a=-e;a<=e;a++)if(Math.abs(a)+n<5){let l=i-r+1-n;if(t.get(o+a,l)===s.AIR&&t.set(o+a,l,s.LEAVES),Math.abs(a)>=2&&Math.random()<.6){let c=1+Math.floor(Math.random()*3);for(let f=1;f<=c;f++)t.get(o+a,l+f)===s.AIR&&t.set(o+a,l+f,s.LEAVES)}}}function wt(t,o,i){t.set(o,i,s.LEAVES),Math.random()<.5&&t.get(o+1,i)===s.AIR&&t.set(o+1,i,s.LEAVES),Math.random()<.3&&t.get(o,i-1)===s.AIR&&t.set(o,i-1,s.LEAVES)}function _o(t,o,i){t.set(o,i,s.STONE),Math.random()<.7&&t.set(o+1,i,s.STONE),Math.random()<.5&&t.set(o,i-1,s.STONE)}var go=N(()=>{j()});function mi(t,o,i){let r=3+Math.floor(Math.random()*2),e=r+2;for(let a=-e;a<=e;a++){let l=Math.abs(a);for(let c=-1;c<=3;c++){let f=o+a,d=i+c;l<=r?c>0&&t.set(f,d,s.SAND):c===0?t.set(f,d,s.GRASS):c>0&&t.set(f,d,s.DIRT)}}for(let a=-r;a<=r;a++){let l=Math.abs(a)<r-1?1:0;for(let c=0;c<=l;c++)t.set(o+a,i+c,s.WATER);t.set(o+a,i-1,s.AIR),t.set(o+a,i-2,s.AIR)}let n=1+Math.floor(Math.random()*2);for(let a=0;a<n;a++){let l=Math.random()<.5?-1:1,c=o+l*(r+1);t.get(c,i)===s.GRASS&&Be(t,c,i-1)}if(Math.random()<.5){let a=Math.random()<.5?-1:1,l=o+a*(e-1);t.get(l,i)===s.GRASS&&wt(t,l,i-1)}}function pi(t,o,i){let r=6+Math.floor(Math.random()*5);for(let e=0;e<r;e++)t.set(o,i-e,s.BEDROCK),t.set(o+1,i-e,s.BEDROCK);t.set(o,i-r,s.GOLD),t.set(o+1,i-r,s.GOLD),t.set(o-1,i,s.STONE),t.set(o+2,i,s.STONE)}function _i(t,o,i){let n=o-Math.floor(3),a=i;for(let l=-1;l<=6;l++)for(let c=-1;c<=5;c++){let f=n+l,d=a+c;l===-1||l===6||c===-1||c===5?t.set(f,d,s.STONE):t.set(f,d,s.AIR)}t.set(n+1,a+5-1,s.JACKPOT),t.set(n+6-2,a+5-1,s.TNT),t.set(n+Math.floor(6/2),a+5-1,s.WORKBENCH)}function gi(t,o,i){let r=15+Math.floor(Math.random()*10);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD),t.set(o+1,i-n,s.WOOD),n<3&&(t.set(o-1,i-n+1,s.WOOD),t.set(o+2,i-n+1,s.WOOD));let e=6;for(let n=-e;n<=e;n++)for(let a=-e;a<=e+1;a++)if(a*a+n*n<=e*e+Math.random()*5){let l=i-r+n;t.get(o+a,l)===s.AIR&&t.set(o+a,l,s.LEAVES)}t.set(o,i-r-2,s.GOLD)}function bi(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<=r*1.5;e++){let n=Math.max(0,r-e*.7);for(let a=-Math.ceil(n);a<=Math.ceil(n);a++){let l=o+a,c=i+e;e===0?(t.set(l,c,s.GRASS),a===0&&Math.random()<.3&&Ft(t,l,c-1)):e<2?t.set(l,c,s.DIRT):Math.random()<.4||a===0&&e>2?t.set(l,c,s.GOLD):t.set(l,c,s.STONE)}}}function Ai(t,o,i){let r=4+Math.floor(Math.random()*5),e=4+Math.floor(Math.random()*3);for(let n=-r;n<=r;n++){let a=Math.abs(n)/r,l=Math.floor(e*(1-a*a)),c=i-l,f=i+4+Math.floor(Math.random()*3);for(let d=c;d<=f;d++)d<i?(t.set(o+n,d,s.SAND),d===c&&Math.random()>.2&&t.set(o+n,d,s.GRASS)):t.set(o+n,d,s.SAND)}Math.random()>.3&&Ft(t,o,i-e-1)}function Ti(t,o,i){let r=Math.floor(Math.random()*4);if(r===0){let e=3+Math.floor(Math.random()*4);for(let n=0;n<e;n++)t.set(o,i-1-n,s.STONE);Math.random()<.5&&t.set(o,i-1-e,s.STONE),Math.random()<.4&&t.set(o+1,i-1,s.STONE)}else if(r===1){let e=3+Math.floor(Math.random()*2);for(let n=0;n<e;n++){let a=e-n-1;for(let l=-a;l<=a;l++)Math.random()>.1&&t.set(o+l,i-1-n,s.STONE)}}else if(r===2){for(let a=-1;a<=1;a++)t.set(o+a,i-4,s.STONE);for(let a=1;a<4;a++)t.set(o-1,i-a,s.STONE),t.set(o+1,i-a,s.STONE)}else if(r===3){let e=4+Math.floor(Math.random()*3);for(let n=0;n<e;n++){let a=1+Math.floor(Math.random()*2);for(let l=0;l<a;l++)t.set(o+n,i-1-l,s.STONE)}}}function Mi(t,o,i){let r=10+Math.floor(Math.random()*15),e=o,n=i;for(let a=0;a<r&&!(e>=t.width-2);a++)t.set(e,n,s.AIR),t.set(e,n-1,s.AIR),t.set(e,n-2,s.AIR),t.set(e,n+1,s.WOOD),a%4===0&&(t.get(e,n+1)!==s.AIR&&t.set(e,n,s.WOOD),t.get(e,n-2)!==s.AIR&&t.set(e,n-1,s.WOOD),t.set(e,n-2,s.WOOD)),e++,Math.random()<.1&&(n+=Math.random()<.5?-1:1),n>t.height-5&&(n=t.height-5),n<50&&(n=50)}function Ei(t,o,i){let r=25+Math.floor(Math.random()*10),e=20+Math.floor(Math.random()*5);for(let c=0;c<=e;c++){let f=r*(1-Math.pow(c/e,.8)),d=Math.ceil(f);for(let h=-d;h<=d;h++)if(h*h/(f*f)<=1){let u=o+h,m=i+c;if(c===0)t.set(u,m,s.GRASS);else if(c<3)t.set(u,m,s.DIRT);else{let _=Math.random();_>.98?t.set(u,m,s.GOLD):_>.95?t.set(u,m,s.COAL):t.set(u,m,s.STONE)}}}for(let c=-r+2;c<=r-2;c++){let f=o+c,d=i;if(Math.abs(c)%5===0&&Math.random()<.6){let h=4+Math.floor(Math.random()*5);for(let u=1;u<=h;u++)t.set(f,d-u,s.STONE);Math.random()<.5&&(t.set(f+1,d-h,s.STONE),t.set(f-1,d-h,s.STONE))}Math.random()<.05&&t.get(f,d)===s.GRASS&&Ft(t,f,d-1),Math.abs(c)<5&&Math.random()<.3&&(t.set(f,d,s.WATER),t.set(f,d+1,s.STONE))}let n=8,a=8;for(let c=-n;c<=n;c++)for(let f=0;f<a;f++){let d=o+c,h=i-1-f;(Math.abs(c)===n||Math.abs(c)===n-2)&&Math.random()>.2&&t.set(d,h,s.STONE)}let l=i-a+2;t.set(o,l,s.JACKPOT),t.set(o,l-1,s.GOLD),t.set(o,l+1,s.GOLD),t.set(o-1,l,s.GOLD),t.set(o+1,l,s.GOLD)}function Si(t,o,i){let r=20+Math.floor(Math.random()*10),e=16+Math.floor(Math.random()*5);for(let d=-e;d<=2;d++)for(let h=-r;h<=r;h++)if(h*h/(r*r)+d*d/(e*e)<=1){let u=o+h,m=i+d-Math.floor(e*.6);m>0&&m<t.height-1&&t.set(u,m,s.AIR)}let n=o,a=i-e-2,l=3;for(let d=-l;d<=l;d++)for(let h=-l;h<=l;h++)d*d+h*h<=l*l&&t.set(n+d,a+h,s.GOLD);t.set(n,a,s.JACKPOT);let c=16+Math.floor(Math.random()*8),f=Math.ceil(c/2);for(let d=0;d<f;d++){let h=c-d*2,u=i-d,m=o-Math.floor(h/2);for(let _=0;_<h;_++)t.set(m+_,u,s.SAND)}t.set(o,i-f,s.SAND),t.set(o,i-1,s.JACKPOT),t.set(o-1,i-1,s.GOLD),t.set(o+1,i-1,s.GOLD)}var Ri=N(()=>{j();go()});function yi(t,o,i,r,e){for(let a=0;a<r;a++)for(let l=0;l<e;l++){let c=r/2,f=e/2,d=Math.abs(a-c)/c,h=Math.abs(l-f)/f,u=.7+Math.random()*.3;d+h<u&&t.set(o+a,i+l,s.CLOUD)}let n=Math.floor(r/3);for(let a=0;a<n;a++){let l=o+1+Math.floor(Math.random()*(r-2));Math.random()>.4&&t.set(l,i-1,s.CLOUD)}}function Da(t,o,i,r,e){for(let n=0;n<r;n++){for(let a=0;a<e;a++)(n<2||n>=r-2)&&a>0&&Math.random()>.5||t.set(o+n,i+a,s.CLOUD);Math.random()>.7&&n>0&&n<r-1&&t.set(o+n,i-1,s.CLOUD)}}function Na(t,o,i){for(let r=2;r<8;r++)Math.random()>.3&&t.set(o+r,i,s.CLOUD);for(let r=0;r<12;r++)t.set(o+r,i+1,s.CLOUD);for(let r=1;r<10;r++)Math.random()>.2&&t.set(o+r,i+2,s.CLOUD)}function Fa(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<r;e++){let n=Math.floor(Math.random()*15),a=Math.floor(Math.random()*4),l=2+Math.floor(Math.random()*3);for(let c=0;c<l;c++)for(let f=0;f<Math.ceil(l/2);f++)Math.random()>.3&&t.set(o+n+c,i+a+f,s.CLOUD)}}function Ii(t,o,i,r){switch(r){case 0:yi(t,o,i,4,2);break;case 1:Da(t,o,i,12,1);break;case 2:yi(t,o,i,8,3);break;case 3:Na(t,o,i);break;case 4:Fa(t,o,i);break}}var Ci=N(()=>{j()});var oe=N(()=>{ci();go();Ri();Ci()});function wi(t,o,i,r){let e=Math.random();switch(r){case I.PLAINS:e<.05?Ft(t,o,i):e<.08&&wt(t,o,i);break;case I.FOREST:e<.15?Ft(t,o,i):e<.3&&wt(t,o,i);break;case I.SNOWFIELD:e<.06&&fi(t,o,i);break;case I.DESERT:e<.02&&di(t,o,i);break;case I.MOUNTAIN:e<.015?xe(t,o,i):e<.025&&_o(t,o,i);break;case I.WASTELAND:e<.04?xe(t,o,i):e<.1&&_o(t,o,i);break;case I.DEEP_FOREST:e<.25?Be(t,o,i):e<.6&&wt(t,o,i);break;case I.SAVANNA:e<.04?hi(t,o,i):e<.1&&wt(t,o,i);break;case I.PLATEAU:e<.02&&xe(t,o,i);break;case I.SWAMP:e<.1?ui(t,o,i):e<.2?ee(t,o,i,2):e<.4&&Math.random()<.5&&wt(t,o,i);break}}var Oi=N(()=>{Kt();oe()});function Pi(t,o,i,r){let e=t.getAccessor(),n=Math.floor(t.width/80);for(let l=0;l<n;l++){let c=Math.floor(Math.random()*t.width),f=o[c],h=Math.min(f,r)-35,u=15;if(h>u){let m=u+Math.floor(Math.random()*(h-u));bi(e,c,m)}}for(let l=0;l<t.width;l+=1)i[l]===I.OCEAN&&Math.random()<.03&&(Ai(e,l,r),l+=40);for(let l=0;l<t.width;l+=1)if(i[l]===I.DESERT){if(Math.random()<.002)mi(e,l,o[l]),l+=25;else if(Math.random()<.015){let c=o[(l+2)%t.width];Math.abs(c-o[l])<2&&(Ti(e,l,o[l]),l+=15)}}let a=Math.floor(t.width/50);for(let l=0;l<a;l++){let c=Math.floor(Math.random()*t.width),f=o[c];Mi(e,c,f+15+Math.floor(Math.random()*(t.height-f-20)))}}function ki(t,o,i){let r=t.getAccessor();for(let c=0;c<t.width;c++){let f=i[c],d=o[c];if((f===I.PLAINS||f===I.WASTELAND)&&Math.random()<.003){pi(r,c,d),c+=10;continue}if((f===I.FOREST||f===I.SAVANNA)&&Math.random()<.004&&d<t.height-20){_i(r,c,d+8),c+=15;continue}if(f===I.DEEP_FOREST&&Math.random()<.005){gi(r,c,d),c+=15;continue}}let e=100+Math.floor(Math.random()*(t.width-200)),n=t.height-10-Math.floor(Math.random()*10);Si(r,e,n);let a=150+Math.floor(Math.random()*(t.width-300)),l=30+Math.floor(Math.random()*10);Ei(r,a,l)}function vi(t,o,i,r){let e=t.getAccessor(),n=Math.floor(t.width/60),a=t.height/2-14;for(let l=0;l<n;l++){let c=Math.floor(Math.random()*(t.width-10))+5,f=i[c],d=o[c];if(f===I.SNOWFIELD||f===I.DESERT||f===I.MOUNTAIN&&d<a)continue;let h=o[(c-2+t.width)%t.width],u=o[(c+2)%t.width];d<=r&&Math.abs(h-u)<3&&ee(e,c,d,2+Math.floor(Math.random()*3))}}function Li(t,o,i,r){let e=t.getAccessor(),n=2+Math.floor(Math.random()*2),a=0,l=0;for(;a<n&&l<t.width*4;){l++;let c=Math.floor(Math.random()*t.width),f=i[c];if(f===I.DESERT||f===I.SNOWFIELD||f===I.WASTELAND)continue;let d=o[c];if(d>=r)continue;let h=5,u=10,m=o[(c-h+t.width)%t.width],_=o[(c+h)%t.width],E=m-d,A=_-d;if(E>u||A>u){ee(e,c,d,3);for(let M=-4;M<=4;M++){let b=(c+M+t.width)%t.width;if(t.getBlock(b,d)===s.WATER){let S=d+1;for(;S<t.height;){let C=t.getBlock(b,S);if(C===s.AIR)t.setBlock(b,S,s.WATER);else if(C!==s.WATER)break;S++}}}a++}}}var xi=N(()=>{j();Kt();oe()});function Bi(t,o){let i=t.getAccessor(),r=Math.max(3,Math.floor(t.width/35));for(let e=0;e<r;e++){let n=Math.floor(Math.random()*t.width),l=o[n]+8,c=t.height-6;if(l>=c)continue;let f=n,d=l+Math.floor(Math.random()*(c-l)),h=30+Math.floor(Math.random()*40);for(let u=0;u<h;u++){li(i,f,d),f+=Math.floor(Math.random()*3)-1,d+=Math.floor(Math.random()*3)-1,f=(f%t.width+t.width)%t.width;let m=o[f];d=Math.max(m+6,Math.min(t.height-5,d))}}}function Di(t,o){let i=t.getAccessor(),r=Math.floor(t.width*t.height/1500);for(let a=0;a<r;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+8&&Le(i,l,c,s.DIRT,2+Math.random()*2.5)}let e=Math.floor(t.width*t.height/2500);for(let a=0;a<e;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+10&&Le(i,l,c,s.SAND,1.5+Math.random()*2)}let n=Math.floor(t.width*t.height/2e3);for(let a=0;a<n;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+15&&c<t.height-10&&Le(i,l,c,s.WATER,2+Math.random()*2.5)}}var Ni=N(()=>{j();oe()});function Fi(t,o){let r=Math.floor(t.width/25),e=t.getAccessor(),n=Math.floor(t.height/2)+2;for(let a=0;a<r;a++){let l=Math.floor(Math.random()*t.width),c=o[l],d=Math.min(c,n)-20,h=5;if(d<=h)continue;let u=h+Math.floor(Math.random()*(d-h)),m=Math.floor(Math.random()*5);Ii(e,l,u,m)}}var Gi=N(()=>{oe()});function Wi(t){for(let c=0;c<t.width;c++){let f=Math.sin(c*.02)*8+Math.cos(c*.1)*4+Math.sin(c*.5)*2+Math.random()*2,d=Math.max(0,2+f),h=Math.floor(t.height-d),u=Math.max(t.height-40,Math.min(t.height,h));for(let m=t.height-1;m>=u;m--)t.setBlock(c,m,s.AIR)}}var Ki=N(()=>{j()});function Vi(t){let o=Qn(t.height),{heights:i,biomeByColumn:r}=Do(t.width,o,96,192),e=Math.floor(t.height/2)+2;oi(i,t.width,t.height);for(let n=0;n<t.width;n++){let a=i[n],l=r[n],c=ti(l,a,n,t.height);for(let f=0;f<t.height;f++)if(f>a)if(f>a+5){let d=Math.random();d>.995&&f>a+15?t.setBlock(n,f,s.GOLD):d>.96?t.setBlock(n,f,s.COAL):Math.random()>.95?t.setBlock(n,f,s.DIRT):t.setBlock(n,f,s.STONE)}else t.setBlock(n,f,ei(l,f,a));else f===a?f>e?t.setBlock(n,f,s.SAND):(t.setBlock(n,f,c),(c===s.GRASS||l===I.SNOWFIELD&&c===s.SNOW||l===I.DESERT&&c===s.SAND||l===I.WASTELAND&&c===s.STONE||l===I.SAVANNA&&(c===s.GRASS||c===s.DIRT)||l===I.PLATEAU&&c===s.STONE)&&n>5&&n<t.width-5&&wi(t.getAccessor(),n,f-1,l)):f>e&&l===I.OCEAN&&t.setBlock(n,f,s.WATER)}ni(t,i),Di(t,i),Bi(t,i),vi(t,i,r,e),Li(t,i,r,e),Pi(t,i,r,e),ki(t,i,r),Wi(t);for(let n=10;n<t.width-10;n+=50+Math.floor(Math.random()*20)){let a=i[n];a<=e&&t.getBlock(n,a-1)===s.AIR&&t.setBlock(n,a-1,s.WORKBENCH)}ri(t),ai(t,r,e),Fi(t,i)}var Yi=N(()=>{j();rt();Kt();ii();si();Oi();xi();Ni();Gi();Ki()});var Vt,bo=N(()=>{rt();j();Yi();Kt();Vt=class{constructor(o,i){this.width=o,this.height=i,this.map=new Uint8Array(o*i),this.map.fill(s.AIR),Vi(this)}getIndex(o,i){return Lo(o,i,this.width,this.height)}getBlock(o,i){let r=this.getIndex(o,i);return r===-1?s.BEDROCK:this.map[r]}setBlock(o,i,r){let e=this.getIndex(o,i);e!==-1&&(this.map[e]=r)}getAccessor(){return{get:(o,i)=>this.getBlock(o,i),set:(o,i,r)=>this.setBlock(o,i,r),width:this.width,height:this.height}}checkAreaFree(o,i,r,e){let n=Math.floor(o/p),a=Math.floor((o+r)/p),l=Math.floor(i/p),c=Math.floor((i+e)/p);for(let f=l;f<=c;f++)for(let d=n;d<=a;d++)if(dt(this.getBlock(d,f),Q))return!1;return!0}}});var ne,nt,H,Ot,Ui,Hi,Ao,Xi,ie,ji,kl,Ji,qi,Zi,$i,zi,Qi,re,X,To,tr,Mo,Yt,er,or,nr,ir,rr,ar,sr,lr,Ut,ae=N(()=>{j();ne=12,nt=1<<ne,H=t=>Math.floor(t*nt),Ot=t=>t/nt,Ui=Math.floor(Math.pow(.8,mt)*nt),Hi=H(Yo),Ao=H(15/720),Xi=H(mt),ie=H(5),ji=H(Ee),kl=H(ze),Ji=H(jo),qi=H(Jo),Zi=H(Xo),$i=H(Ho),zi=H(qo),Qi=H(2),re=41,X=H(p),To=H(.1),tr=H(.2*p),Mo=H(.1),Yt=H(Se),er=H(on),or=H(Qo),nr=H(tn*p),ir=p*p,rr=ie*2,ar=1097,sr=2458,lr=Uo,Ut=[];for(let t=0;t<=128;t++)Ut[t]=H(ze*Math.sqrt(t))});function cr(t){return Math.trunc(t*Ui/nt)}function fr(t,o){if(t===0)return{boardVx:0,lowFrictionActive:!1};let i=o?Ao>>1:Ao,r;t>0?r=Math.max(0,t-i):r=Math.min(0,t+i);let e=o;return o&&Math.abs(r)<er&&(e=!1),{boardVx:r,lowFrictionActive:e}}function dr(t,o,i,r,e){if(t>=$i)return{vy:t,fastballActive:r};let n=Hi,a=r;if(o)n=Math.floor(n*Zi/nt);else if(i&&(n=Math.floor(n*lr)),r){let l=Math.abs(e);if(l<Yt>>2)a=!1;else{let c=Math.floor(n*l/Yt);n-=c}}return{vy:t+n,fastballActive:a}}function hr(t,o,i,r,e,n,a,l){let c=t-e,f=o-n,d=c*c+f*f,u=a*a*ir;if(d>=u||d<=0)return{vx:i,vy:r,affected:!1};let m=Math.floor(Math.sqrt(d)),_=Math.floor(c*nt/m),E=Math.floor(f*nt/m),A=Math.max(m,X),M=Math.floor(or*l/nt),b=Math.floor(a*X/nt),C=Math.floor(M*M/nt)*b,P=A+nr,Y=Math.floor(C/P),O=Math.floor((i*_+r*E)/nt),L=Math.floor(O*O/nt),x=Y*2,V=L+x,K=Math.floor(Math.sqrt(Math.max(0,V)*nt)),G=-O+K;return{vx:i+Math.floor(_*G/nt),vy:r+Math.floor(E*G/nt),affected:!0}}var ur=N(()=>{ae()});function Eo(t,o,i){let r=0,e=i;for(;t.getBlock(o,e)===s.JUMP_PAD;)r++,e--;for(e=i+1;t.getBlock(o,e)===s.JUMP_PAD;)r++,e++;return r}function So(t,o,i,r,e){let{_x:n,_y:a,_vx:l,_vy:c,_width:f,_height:d,_boardVx:h,lowGravityActive:u}=t,m=!1,_=!1,E=Math.floor(n/X),A=Math.floor((n+f)/X),M=Math.floor(a/X),b=Math.floor((a+d)/X);for(let S=M;S<=b;S++)for(let C=E;C<=A;C++){let P=o.getBlock(C,S);if(dt(P,Q))if(i)r>0?n=C*X-f-re:r<0&&(n=(C+1)*X+re),l=0,h=0;else{if(c>0)a=S*X-d-re,m=!0,c=0,u=!1;else if(c<0){if(a=(S+1)*X+re,c<zi&&yt(P,Q)&&Bo(P,Zo))return e&&e(P),Z.playDig(be(P,Q)),ve(C,S,P),o.setBlock(C,S,s.AIR),c+=Qi,_=!0,{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:!1,lowGravityActive:u,blockBroken:_};if(P===s.JUMP_PAD){let Y=Eo(o,C,S),O=Math.min(Y,128);c=Ut[O],Z.playBigJump()}else c=0}return{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}}return i||(m=!1),{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}function mr(t,o,i,r,e){let n=o-r,a=Math.floor(n/X),l=Math.floor(t/X),c=Math.floor((t+i)/X);for(let f=l;f<=c;f++)if(dt(e.getBlock(f,a),Q))return!1;return!0}var Ro=N(()=>{ae();rt();j();Bt();te()});function pr(t,o,i,r){let e=t.gamepad&&t.gamepad.connected?t.gamepad.axisLeftX:0;if(Math.abs(e)>0){let n=Math.abs(e),a=Math.floor(ie*n);return e<0?{vx:-a,facingRight:!1}:{vx:a,facingRight:!0}}return t.keys.left?{vx:-ie,facingRight:!1}:t.keys.right?{vx:ie,facingRight:!0}:{vx:r(o),facingRight:i}}function _r(t,o,i,r,e,n,a,l){if(n<=0)return null;let c=t+(i>>1),f=o+r+To,d=Math.floor(c/X),h=Math.floor(f/X);if(l.getBlock(d,h)!==s.WATER||l.getBlock(d,h-1)===s.WATER)return null;let m=e+a,_=m>0?m:-m,E=n;return _<rr?null:E*nt<_*ar?(Z.playJump(),H(Ee*-.5)):null}function Wa(t,o,i){let r=[],e=i;for(;t.getBlock(o,e)===s.TNT;)r.push(e),e++;return r}function gr(t,o,i,r,e,n){let a=t+(i>>1),l=o+r+To,c=Math.floor(a/X),f=Math.floor(l/X);if(e.getBlock(c,f)!==s.JUMP_PAD)return null;let h=f;for(;e.getBlock(c,h+1)===s.JUMP_PAD;)h++;let m=e.getBlock(c,h+1)===s.CLOUD,_=Wa(e,c,f+1);if(_.length>0&&n){let E=_.length*16,A=Math.min(E,128);return{vy:-Ut[A],lowGravityActive:m,tntTriggered:!0,feetX:c,tntPositions:_}}else{let E=Eo(e,c,f),A=Math.min(E,128);return Z.playBigJump(),{vy:-Ut[A],lowGravityActive:m,tntTriggered:!1,feetX:c,tntPositions:[]}}}function br(t,o,i,r,e,n,a,l,c,f){return t.keys.jump?o?(Z.playJump(),{vy:-ji,grounded:!1,jumped:!0}):i&&r>qi&&f(e,n,a,l,c)?(Z.playJump(),{vy:-Ji,grounded:!1,jumped:!0}):null:null}var Ar=N(()=>{ae();j();Bt();Ro()});function Tr(t,o,i,r,e,n){t.save(),t.translate(Math.floor(o),Math.floor(i));let a=Math.sin(n*.01)*5,l=Math.abs(r)>.1;t.fillStyle="#f8b090",t.fillRect(4,0,12,12),t.fillStyle="#00bcd4",t.fillRect(4,12,12,18),t.fillStyle="#3f51b5",t.fillRect(4,30,5,18+(l?a:0)),t.fillRect(11,30,5,18-(l?a:0)),t.fillStyle="#f8b090",e?t.fillRect(10,12,6,18+a):t.fillRect(4,12,-6,18+a),t.restore()}var Mr=N(()=>{});var Ne,Er=N(()=>{j();Oe();ae();ur();Ro();Ar();Mr();Ne=class{constructor(o,i=null,r=null,e=null){this.world=o,this.addToInventory=i,this.onTNTJumpPad=r,this.onSplash=e,this._x=0,this._y=0,this._vx=0,this._vy=0,this._boardVx=0,this._width=H(.6*p),this._height=H(1.8*p),this._x=H(o.width/2*p),this._y=0,this.grounded=!1,this.facingRight=!0,this.animTimer=0,this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1,this.bubbleTimer=0,this.wasInWater=!1,this.findSpawnPoint()}get x(){return Ot(this._x)}set x(o){this._x=H(o)}get y(){return Ot(this._y)}set y(o){this._y=H(o)}get vx(){return Ot(this._vx)}set vx(o){this._vx=H(o)}get vy(){return Ot(this._vy)}set vy(o){this._vy=H(o)}get boardVx(){return Ot(this._boardVx)}set boardVx(o){this._boardVx=H(o)}get width(){return Ot(this._width)}get height(){return Ot(this._height)}getGridRect(){let o=Math.floor(this._x/X),i=Math.floor(this._y/X),r=Math.floor((this._x+this._width)/X),e=Math.floor((this._y+this._height)/X);return{startX:o,endX:r,startY:i,endY:e}}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getRect(){return{x:this.x,y:this.y,w:this.width,h:this.height}}applyAcceleratorForce(o){let i=this._boardVx*this._boardVx,r=Yt*Yt,e=Math.floor(Math.sqrt(i+r));this._boardVx=o>0?e:-e,this.facingRight=o>0}activateFastballMode(){this.fastballActive=!0}activateLowFrictionMode(){this.lowFrictionActive=!0}applyExplosionImpulse(o,i,r,e){let n=this._x+(this._width>>1),a=this._y+(this._height>>1),l=hr(n,a,this._vx,this._vy,o,i,r,e);l.affected&&(this._vx=l.vx,this._vy=l.vy,this.grounded=!1)}findSpawnPoint(){let o=Math.floor(this._x/X),i=Math.floor(this.world.height*.4),r=this.world.getBlock(o,i);if(r!==s.AIR&&r!==s.CLOUD)for(let e=i;e>=0;e--){let n=this.world.getBlock(o,e);if(n===s.AIR||n===s.CLOUD){this._y=(e-1)*X;return}}else for(let e=i;e<this.world.height;e++){let n=this.world.getBlock(o,e);if(n!==s.AIR&&n!==s.CLOUD){this._y=(e-2)*X;return}}for(let e=0;e<this.world.height;e++){let n=this.world.getBlock(o,e);if(n!==s.AIR&&n!==s.CLOUD){this._y=(e-2)*X;break}}}respawn(){this._y=0,this._vy=0,this._vx=0,this._boardVx=0,this._x=H(this.world.width/2*p),this.findSpawnPoint(),this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1}tick(o){let i=this._x+(this._width>>1),r=this._y+(this._height>>1),e=Math.floor(i/X),n=Math.floor(r/X),a=this.world.getBlock(e,n)===s.WATER;a&&!this.wasInWater&&this.onSplash&&this.onSplash(this.getCenterX(),this.getCenterY()),this.wasInWater=a;let l=pr(o,this._vx,this.facingRight,cr);this._vx=l.vx,this.facingRight=l.facingRight;let c=_r(this._x,this._y,this._width,this._height,this._vx,this._vy,this._boardVx,this.world);c!==null&&(this._vy=c);let f=gr(this._x,this._y,this._width,this._height,this.world,this.onTNTJumpPad);if(f)this._vy=f.vy,this.grounded=!1,f.lowGravityActive&&(this.lowGravityActive=!0),f.tntTriggered&&this.onTNTJumpPad&&this.onTNTJumpPad(f.feetX,f.tntPositions);else{let C=br(o,this.grounded,a,this._vy,this._x,this._y,this._width,tr,this.world,mr);C&&(this._vy=C.vy,this.grounded=C.grounded)}let d=fr(this._boardVx,this.lowFrictionActive);this._boardVx=d.boardVx,this.lowFrictionActive=d.lowFrictionActive;let h=dr(this._vy,a,this.lowGravityActive,this.fastballActive,this._boardVx);this._vy=h.vy,this.fastballActive=h.fastballActive;let u=Xi;a&&(u=u*sr>>ne);let m=this._vx+this._boardVx;this._x+=m*u>>ne;let _=So({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!0,m,this.addToInventory);this._x=_._x,this._vx=_._vx,this._boardVx=_._boardVx,this._y+=this._vy*u>>ne;let E=So({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!1,this._vy,this.addToInventory);this._y=E._y,this._vy=E._vy,this.grounded=E.grounded,this.lowGravityActive=E.lowGravityActive,this.wrapHorizontally(),this.wrapVertically(),(this._vx>Mo||this._vx<-Mo)&&(this.animTimer+=Zt);let A=this.getCenterX(),M=this.y+4,b=Math.floor(A/p),S=Math.floor(M/p);if(this.world.getBlock(b,S)===s.WATER){if(this.bubbleTimer++,this.bubbleTimer>40){let C=p;for(let P=S-1;P>=0;P--)if(this.world.getBlock(b,P)!==s.WATER){C=M-(P+1)*p;break}Fn(A,M,Math.max(p,C)),this.bubbleTimer=Math.floor(Math.random()*-30)}}else this.bubbleTimer=0}wrapHorizontally(){let o=this.world.width*X;for(;this._x>=o;)this._x-=o;for(;this._x+this._width<=0;)this._x+=o}wrapVertically(){let o=this.world.height*X;for(;this._y>=o;)this._y-=o;for(;this._y+this._height<=0;)this._y+=o}draw(o){Tr(o,this.x,this.y,this.vx,this.facingRight,this.animTimer)}}});function Ya(t){let o=F.count-1;t!==o&&(F.x[t]=F.x[o],F.y[t]=F.y[o],F.vx[t]=F.vx[o],F.vy[t]=F.vy[o],F.life[t]=F.life[o],F.colorIdx[t]=F.colorIdx[o]),F.count--}function wr(t,o,i,r,e,n){if(F.count>=Gt)return;let a=F.count;F.x[a]=t,F.y[a]=o,F.vx[a]=i,F.vy[a]=r,F.life[a]=e,F.colorIdx[a]=n,F.count++}function Or(t,o,i){let r=Math.floor(t.x/p),e=Math.floor((t.x+t.width)/p),n=Math.floor(t.y/p),a=Math.floor((t.y+t.height)/p);for(let l=n;l<=a;l++)for(let c=r;c<=e;c++)if(o.getBlock(c,l)===s.JACKPOT){let f=`${c},${l}`;se.has(f)||(Ua(c,l),se.set(f,an),i.playCoin())}}function Pr(t,o){let i=t*p+p/2,r=o*p+p/2;for(let e=0;e<100;e++){let n=Qe+Math.floor(Math.random()*to);wr(i+(Math.random()-.5)*p,r+(Math.random()-.5)*p,(Math.random()-.5)*25*mt,-(4+Math.random()*14)*mt,n,e%2)}}function Ua(t,o){let i=t*p+p/2,r=o*p+p/2;for(let e=0;e<24;e++){let n=Qe+Math.floor(Math.random()*to);wr(i+(Math.random()-.5)*p*.6,r+(Math.random()-.5)*p*.2,(Math.random()-.5)*3.2*mt,-(1.2+Math.random()*4.5)*mt,n,e%2)}}function kr(){se.forEach((o,i)=>{let r=o-1;r<=0?se.delete(i):se.set(i,r)});let t=0;for(;t<F.count;){if(F.vx[t]*=Va,F.vy[t]+=Ka,F.x[t]+=F.vx[t],F.y[t]+=F.vy[t],F.life[t]--,F.life[t]<=0){Ya(t);continue}t++}}function vr(t,o,i,r,e){if(F.count===0)return;Rr=o-Fe,yr=o+r+Fe,Ir=i-Fe,Cr=i+e+Fe;let n=[],a=[];for(let l=0;l<F.count;l++){let c=F.x[l],f=F.y[l];c<Rr||c>yr||f<Ir||f>Cr||(F.colorIdx[l]===0?n.push(l):a.push(l))}if(n.length>0){t.fillStyle=Sr[0];for(let l of n)t.fillRect(F.x[l]-3,F.y[l]-3,6,6)}if(a.length>0){t.fillStyle=Sr[1];for(let l of a)t.fillRect(F.x[l]-3,F.y[l]-3,6,6)}}var Gt,F,Sr,Ka,Va,se,Rr,yr,Ir,Cr,Fe,Ge=N(()=>{j();Gt=4e3,F={x:new Float32Array(Gt),y:new Float32Array(Gt),vx:new Float32Array(Gt),vy:new Float32Array(Gt),life:new Uint16Array(Gt),colorIdx:new Uint8Array(Gt),count:0},Sr=["#ffd54f","#fbc02d"],Ka=.15*mt*mt,Va=Math.pow(.99,mt),se=new Map,Rr=0,yr=0,Ir=0,Cr=0,Fe=50});function Lr(t){t.onTNTAccelerator&&(yo=t.onTNTAccelerator)}function Ha(t,o,i){let r=Math.min(i*16,128),e=Se*Math.sqrt(r);t.boardVx=o*e,t.facingRight=o>0}function Xa(t,o,i,r){let e=[],n=o;for(;t.getBlock(n,i)===s.TNT;)e.push(n),n-=r;return e}function xr(t,o){let{startX:i,endX:r,startY:e,endY:n}=t.getGridRect();for(let a=e;a<=n;a++)for(let l=i;l<=r;l++){let c=o.getBlock(l,a),f=`${l},${a}`;if((c===s.ACCELERATOR_LEFT||c===s.ACCELERATOR_RIGHT)&&!le.has(f)){let d=c===s.ACCELERATOR_RIGHT?1:-1,h=l-d,u=Xa(o,h,a,d);u.length>0&&yo?(Ha(t,d,u.length),yo(u,a)):t.applyAcceleratorForce(d);let m=o.getBlock(l,a+1);m===s.CLOUD&&t.activateFastballMode(),m===s.SNOW&&t.activateLowFrictionMode(),le.set(f,en);return}}}function Br(){le.forEach((t,o)=>{let i=t-1;i<=0?le.delete(o):le.set(o,i)})}var le,yo,Dr=N(()=>{j();le=new Map,yo=null});function Ja(t){let o=atob(t),i=o.length,r=new Uint8Array(i);for(let e=0;e<i;e++)r[e]=o.charCodeAt(e);return r}function Pt(){let t=localStorage.getItem(Io);if(!t)return null;try{return JSON.parse(t)}catch(o){return console.warn("Failed to parse saved state",o),localStorage.removeItem(Io),null}}function Nr({world:t,player:o,timers:i,inventory:r,utils:e,constants:n}){let a=null,l=!1,c=null;try{c=new Worker(new URL("./save.worker.js",qa.url),{type:"module"}),c.onmessage=u=>{let{type:m,data:_,error:E}=u.data;if(m==="SAVE_COMPLETE")try{localStorage.setItem(Io,_)}catch(A){console.warn("LocalStorage write failed:",A)}finally{l=!1}else m==="SAVE_ERROR"&&(console.warn("Worker save failed:",E),l=!1)},c.onerror=u=>{console.error("Save Worker Error:",u),l=!1}}catch(u){console.warn("Failed to initialize Save Worker, autosave disabled.",u)}function f(){if(!t||!o||!c||l)return;l=!0;let u={map:t.map,width:t.width,height:t.height,player:{x:o.x,y:o.y,vx:o.vx,vy:o.vy,grounded:o.grounded,facingRight:o.facingRight},inventory:r.getInventoryState(),timers:{tnt:i.tnt.map(m=>({x:m.x,y:m.y,timer:m.timer})),saplings:i.saplings.map(m=>({x:m.x,y:m.y,timer:m.timer}))}};c.postMessage({type:"SAVE",payload:u})}function d(u){if(u){if(u.world&&u.world.map&&u.world.width===t.width&&u.world.height===t.height){let m=Ja(u.world.map),_=u.schema>=2?Te(m):m;_.length===t.map.length&&(t.map=_)}u.player&&(o.x=u.player.x??o.x,o.y=u.player.y??o.y,o.vx=u.player.vx??o.vx,o.vy=u.player.vy??o.vy,o.grounded=u.player.grounded??o.grounded,o.facingRight=u.player.facingRight??o.facingRight,o.wrapVertically()),u.inventory&&r.loadInventoryState(u.inventory),u.timers&&(i.tnt.length=0,(u.timers.tnt||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&i.tnt.push({x:m.x,y:m.y,timer:m.timer})}),i.saplings.length=0,(u.timers.saplings||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&i.saplings.push({x:m.x,y:m.y,timer:m.timer})}))}}function h(){a&&clearInterval(a),a=setInterval(f,ja)}return{saveGameState:f,applySavedState:d,startAutosave:h}}var qa,Io,ja,Co=N(()=>{rt();qa={},Io="blockCraftSave",ja=5e3});function $a(t,o,i){let r=[],e=new Set,n=[{x:t,y:o}],a=(l,c)=>`${kt(l,i.width)},${kt(c,i.height)}`;for(e.add(a(t,o));n.length>0;){let l=n.pop();r.push(l);let c=[{x:l.x+1,y:l.y},{x:l.x-1,y:l.y},{x:l.x,y:l.y+1},{x:l.x,y:l.y-1}];for(let f of c){let d=kt(f.x,i.width),h=kt(f.y,i.height),u=a(f.x,f.y);e.has(u)||i.getBlock(d,h)===s.TNT&&(e.add(u),n.push(f))}}return r}function za(t,o){let{world:i,player:r,sounds:e,addToInventory:n,createExplosionParticles:a}=o;e.playExplosion();let l=0,c=0;for(let w of t)l+=w.x,c+=w.y,i.setBlock(kt(w.x,i.width),kt(w.y,i.height),s.AIR);let f=t.length,d=Math.floor(l*ut/f),h=Math.floor(c*ut/f),u=d*p+ce(p/2),m=h*p+ce(p/2),_=u/ut,E=m/ut,A=Math.floor(Math.sqrt(f)*ut),M=ce(zo),b=Math.floor(M*A/ut),S=Math.min(10,Math.ceil(f*1.5)),C=A/ut;for(let w=0;w<S;w++){let B=p*C*.5,T=(Math.random()-.5)*B,y=(Math.random()-.5)*B;a(_+T,E+y)}r.applyExplosionImpulse(u,m,b,A);let P=Math.ceil(b/ut),Y=Math.floor(_/p),O=Math.floor(E/p),L=Y-P,x=Y+P,V=O-P,K=O+P,G=Math.floor(b*p*(b*p));for(let w=V;w<=K;w++)for(let B=L;B<=x;B++){let T=B*p*ut+ce(p/2),y=w*p*ut+ce(p/2),D=T-u,W=y-m;if(D*D+W*W<=G){let z=kt(B,i.width),g=kt(w,i.height),R=i.getBlock(z,g);if(R===s.AIR)continue;if(R===s.FIREWORK){let U=T/ut,J=y/ut;for(let tt=0;tt<10;tt++){let et=`hsl(${Math.random()*360}, 100%, 50%)`,q=p*.75,_t=(Math.random()-.5)*2*q,ht=(Math.random()-.5)*2*q;a(U+_t,J+ht,et)}i.setBlock(z,g,s.AIR);continue}if(R===s.JACKPOT){Pr(z,g),n(R),i.setBlock(z,g,s.AIR);continue}yt(R,Q)&&(n(R),i.setBlock(z,g,s.AIR))}}}function Fr(t){let{world:o}=t,i=[];return{tick(){for(let r=i.length-1;r>=0;r--){let e=i[r];if(o.getBlock(e.x,e.y)!==s.TNT){i.splice(r,1);continue}if(e.timer--,e.timer<=0){let n=$a(e.x,e.y,o);za(n,t),i.splice(r,1)}}},onBlockPlaced(r,e){i.push({x:r,y:e,timer:$o})},getTimers(){return i},loadTimers(r){i.length=0,i.push(...r)},cancelTimerAt(r,e){let n=i.findIndex(a=>a.x===r&&a.y===e);return n!==-1?(i.splice(n,1),!0):!1},hasTimerAt(r,e){return i.some(n=>n.x===r&&n.y===e)},detonateTNT(r,e){if(this.cancelTimerAt(r,e),o.getBlock(r,e)===s.TNT){o.setBlock(r,e,s.AIR);let n=r*p+p/2,a=e*p+p/2;t.createExplosionParticles(n,a)}}}}var Za,ut,ce,kt,Gr=N(()=>{j();rt();Ge();Za=12,ut=1<<Za,ce=t=>Math.floor(t*ut),kt=(t,o)=>(t%o+o)%o});function es(t){let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:{r:0,g:0,b:0}}function os(t,o,i,r,e,n){let a=(t+r)/2,l=t-r,c=o-e,f=i-n,d=2+a/256,h=4,u=2+(255-a)/256;return Math.sqrt(d*l*l+h*c*c+u*f*f)}function ns(t,o,i){let r=1/0,e=s.DIRT;for(let[n,a]of Object.entries(Ht)){let l=parseInt(n),c=os(t,o,i,a.r,a.g,a.b);(l===s.AIR||l===s.WORKBENCH)&&c>ts||c<r&&(r=c,e=l)}return e}function Wr(t,o,i){let r=Te(t);return new Promise(e=>{let n=document.createElement("canvas");n.width=o,n.height=i;let a=n.getContext("2d"),l=a.createImageData(o,i),c=l.data;for(let f=0;f<i;f++)for(let d=0;d<o;d++){let h=f*o+d,u=r[h],m=Ht[u]||Ht[s.AIR],_=h*4;c[_]=m.r,c[_+1]=m.g,c[_+2]=m.b,c[_+3]=255}a.putImageData(l,0,0),n.toBlob(e,"image/png")})}function Kr(t){return new Promise((o,i)=>{let r=new FileReader;r.onload=e=>{let n=new Image;n.onload=()=>{let l=new Vt(it,at).map,c=document.createElement("canvas");c.width=it,c.height=at;let f=c.getContext("2d");f.clearRect(0,0,it,at),f.imageSmoothingEnabled=!1;let d=it/at,h=n.width/n.height,u,m,_,E;if(h>d)m=at,u=n.width*(at/n.height),_=(it-u)/2,E=0;else{let O=Math.min(it/n.width,at/n.height);u=n.width*O,m=n.height*O,_=(it-u)/2,E=(at-m)/2}f.drawImage(n,_,E,u,m);let M=f.getImageData(0,0,it,at).data,b=new Float32Array(M.length);for(let O=0;O<M.length;O++)b[O]=M[O];let S=Math.floor(_),C=Math.floor(_+u),P=Math.floor(E),Y=Math.floor(E+m);for(let O=0;O<at;O++)for(let L=0;L<it;L++){let x=O*it+L,V=x*4,K=b[V+3];if(L>=S&&L<C&&O>=P&&O<Y&&K>=128){let w=b[V],B=b[V+1],T=b[V+2],y=ns(w,B,T);l[x]=y;let D=Ht[y]||Ht[s.DIRT],W=w-D.r,z=B-D.g,g=T-D.b,R=(U,J,tt)=>{let et=L+U,q=O+J;if(et>=0&&et<it&&q>=0&&q<at){let _t=(q*it+et)*4;b[_t]+=W*tt/16,b[_t+1]+=z*tt/16,b[_t+2]+=g*tt/16}};R(1,0,7),R(-1,1,3),R(0,1,5),R(1,1,1)}}o(l)},n.onerror=()=>i(new Error("Failed to load image")),n.src=e.target.result},r.onerror=()=>i(new Error("Failed to read file")),r.readAsDataURL(t)})}function Vr(t,o){let i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}function Yr(t,o,i){let r=Math.floor(o/2);for(let e=0;e<i-1;e++){let n=e*o+r,a=t[(e+1)*o+r];if(t[n]===s.AIR&&a!==s.AIR)return{x:r,y:e}}return{x:r,y:10}}var Qa,ts,Ht,wo=N(()=>{j();bo();rt();Qa={[s.AIR]:"#87CEEB",[s.DIRT]:"#5d4037",[s.GRASS]:"#388e3c",[s.STONE]:"#757575",[s.WOOD]:"#6d4c41",[s.LEAVES]:"#2e7d32",[s.BEDROCK]:"#000000",[s.COAL]:"#212121",[s.GOLD]:"#ffb300",[s.WORKBENCH]:"#8d6e63",[s.SAND]:"#d7c27a",[s.SNOW]:"#e0f7fa",[s.CLOUD]:"#ffffff",[s.FIREWORK]:"#ef5350",[s.JUMP_PAD]:"#ab47bc",[s.TNT]:"#d32f2f",[s.SAPLING]:"#6fa85b",[s.JACKPOT]:"#ffd54f",[s.ACCELERATOR_LEFT]:"#42a5f5",[s.ACCELERATOR_RIGHT]:"#66bb6a",[s.WATER]:"#2196f3"},ts=30;Ht={};for(let[t,o]of Object.entries(Qa))Ht[t]=es(o)});function Lt(t,o,i){let r=parseInt(t.slice(1,3),16),e=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),a=parseInt(o.slice(1,3),16),l=parseInt(o.slice(3,5),16),c=parseInt(o.slice(5,7),16),f=Math.round(r+(a-r)*i),d=Math.round(e+(l-e)*i),h=Math.round(n+(c-n)*i),u=m=>m.toString(16).padStart(2,"0");return`#${u(f)}${u(d)}${u(h)}`}function Ye(t){if(t>Ve){let o=(t-Ve)*5;return Rt(1-o,0,1)}return 1}function Hr(t,o){t=t%1,t<0&&(t+=1);let i=vt[0],r=vt[vt.length-1];for(let c=0;c<vt.length-1;c++)if(t>=vt[c].time&&t<vt[c+1].time){i=vt[c],r=vt[c+1];break}let e=r.time-i.time,n=(t-i.time)/e,a=Lt(i.top,r.top,n),l=Lt(i.bottom,r.bottom,n);if(o<fe){let c=Rt((fe-o)*4,0,1);a=Lt(a,We,c),l=Lt(l,We,c)}if(o>Ve&&o<=.8){let c=Rt((o-Ve)*3.33,0,1);a=Lt(a,Ke,c),l=Lt(l,Ke,c)}if(o>.8){let c=(o-.8)/.2;a=Lt(Ke,We,c),l=Lt(Ke,We,c)}return{top:a,bottom:l}}function Xr(t,o,i,r){let e=t*Math.PI*2-Math.PI/2,n=r*.9,a=i/2,l=r*.9,c=a+Math.cos(e)*n,f=l+Math.sin(e)*n,d=50,h=f<r+d*4,u=Ye(o);u<=0&&(h=!1);let m="#FFFFA0",_="#FFFFFF",E="rgba(255, 255, 200, 0.4)";return t>.35&&t<.65&&(m="#FF7E5F",_="#FD746C",E="rgba(255, 100, 50, 0.4)"),{type:"sun",isVisible:h,x:c,y:f,radius:d,color:m,shadow:{color:_,blur:40},glowColor:E,opacity:u}}function jr(t,o,i,r,e=0){let n=t*Math.PI*2+Math.PI/2,a=r*.8,l=i/2,c=r*.9,f=l+Math.cos(n)*a,d=c+Math.sin(n)*a,h=30,u=d<r+h*4,m=Ye(o);m<=0&&(u=!1);let _=28,E=e%_/_;return{type:"moon",isVisible:u,x:f,y:d,radius:h,color:"#F4F6F0",shadow:{color:"#ffffff",blur:10},glowColor:"rgba(200, 220, 255, 0.2)",opacity:m,phase:E}}function Jr(t,o,i,r){let e=0;t>.4&&t<.6&&(t<.5?e=(t-.4)*10:e=(.6-t)*10);let n=Ye(o);e*=n;let a=0;o<fe&&(a=Rt((fe-o)*5,0,1));let l=1-fe;o>l&&(a=Rt((o-l)*5,0,1));let c=Math.max(e,a);return c<=.01?[]:Ur.map(f=>({x:f.x*i,y:f.y*r,size:f.size,opacity:c*(.7+Math.sin(Date.now()*f.twinkleSpeed)*.3)}))}function qr(t,o,i,r,e,n=0){if(n%28!==0)return;let a=0;if(o>.4&&o<.6)o<.45?a=(o-.4)*20:o>.55?a=(.6-o)*20:a=1;else return;let l=Ye(i);if(a*=l,a<=.01)return;t.save(),t.globalCompositeOperation="lighter";let c=Date.now()/4e3,f=[{color:[160,100,50],yBase:e*.2,amp:e*.1,speed:1,widthScale:1},{color:[260,100,60],yBase:e*.15,amp:e*.15,speed:.7,widthScale:1.5},{color:[190,100,50],yBase:e*.25,amp:e*.08,speed:1.3,widthScale:.8}];for(let d=0;d<f.length;d++){let h=f[d];t.beginPath();let u=40;for(let M=0;M<=r+u;M+=u){let b=Math.sin(M*.002*h.widthScale+c*h.speed+d),S=Math.sin(M*.005*h.widthScale-c*h.speed*.5),C=h.yBase+b*h.amp+S*h.amp*.5;M===0?t.moveTo(M,C):t.lineTo(M,C)}t.lineTo(r,0),t.lineTo(0,0),t.closePath();let m=t.createLinearGradient(0,0,0,e*.6),[_,E,A]=h.color;m.addColorStop(0,`hsla(${_}, ${E}%, ${A}%, 0)`),m.addColorStop(.2,`hsla(${_}, ${E}%, ${A}%, ${.15*a})`),m.addColorStop(1,`hsla(${_}, ${E}%, ${A}%, 0)`),t.fillStyle=m,t.fill()}t.restore()}var vt,We,Ke,fe,Ve,is,Ur,Zr=N(()=>{rt();vt=[{time:0,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.35,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.4,top:"#ff758c",bottom:"#ff7eb3"},{time:.42,top:"#2C3E50",bottom:"#FD746C"},{time:.45,top:"#0f2027",bottom:"#203a43"},{time:.5,top:"#000000",bottom:"#1a1a2e"},{time:.55,top:"#0f2027",bottom:"#203a43"},{time:.58,top:"#2C3E50",bottom:"#FD746C"},{time:.6,top:"#ff758c",bottom:"#ff7eb3"},{time:.65,top:"#4CA1AF",bottom:"#C4E0E5"},{time:1,top:"#4CA1AF",bottom:"#C4E0E5"}],We="#020205",Ke="#050505",fe=.2,Ve=.5,is=60,Ur=[];for(let t=0;t<is;t++)Ur.push({x:Math.random(),y:Math.random()*.6,size:Math.random()*2+1,twinkleSpeed:Math.random()*.05+.01})});function $r(t,{world:o,player:i,cameraX:r,cameraY:e,zoom:n=1,logicalWidth:a,logicalHeight:l,textures:c,input:f,tntManager:d}){if(!o)return;let h=Date.now(),u=h%Me/Me,m=Math.floor(h/Me),_=o.height*p,A=((e+l/2)%_+_)%_/_,{top:M,bottom:b}=Hr(u,A),S=t.createLinearGradient(0,0,0,l);S.addColorStop(0,M),S.addColorStop(1,b),t.fillStyle=S,t.fillRect(0,0,a,l);let C=Jr(u,A,a,l);t.fillStyle="#FFFFFF",C.forEach(T=>{t.globalAlpha=T.opacity,t.beginPath(),t.arc(T.x,T.y,T.size,0,Math.PI*2),t.fill()}),t.globalAlpha=1,qr(t,u,A,a,l,m);let P=Xr(u,A,a,l),Y=jr(u,A,a,l,m),O=[P,Y];O.forEach(T=>{if(!T.isVisible)return;t.globalAlpha=T.opacity!==void 0?T.opacity:1;let y=T.radius*6,D=t.createRadialGradient(T.x,T.y,T.radius,T.x,T.y,y),W=T.glowColor||"rgba(255, 255, 255, 0.2)";D.addColorStop(0,W),D.addColorStop(.3,W.replace(/[\d.]+\)$/,"0.1)")),D.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=D,t.beginPath(),t.arc(T.x,T.y,y,0,Math.PI*2),t.fill(),t.globalAlpha=1}),O.forEach(T=>{if(T.isVisible){if(t.globalAlpha=T.opacity!==void 0?T.opacity:1,T.type==="sun")t.beginPath(),t.arc(T.x,T.y,T.radius,0,Math.PI*2),t.fillStyle=T.color,t.shadowColor=T.shadow.color,t.shadowBlur=T.shadow.blur,t.fill(),t.shadowBlur=0;else if(T.type==="moon"){let y=T.radius,D=T.phase;t.save(),t.translate(T.x,T.y);let W=Math.PI/4;if(t.rotate(W),t.shadowColor=T.shadow.color,t.shadowBlur=T.shadow.blur,t.fillStyle=T.color,t.beginPath(),D<=.5){t.arc(0,0,y,-Math.PI/2,Math.PI/2,!1);let g=y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,Math.PI/2,3*Math.PI/2,g>0)}else{t.arc(0,0,y,Math.PI/2,-Math.PI/2,!1);let g=-y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,-Math.PI/2,Math.PI/2,g<0)}t.closePath(),t.fill(),t.shadowBlur=0,t.save(),t.clip(),t.fillStyle="rgba(0,0,0,0.1)",[{dx:-8,dy:-5,r:6},{dx:10,dy:8,r:4},{dx:-5,dy:10,r:3}].forEach(g=>{t.beginPath(),t.arc(g.dx,g.dy,g.r,0,Math.PI*2),t.fill()}),t.restore(),t.restore()}t.globalAlpha=1}});let{startX:L,endX:x,startY:V,endY:K}=Ae(r,e,a,l,p,n);t.fillStyle=S;let G=Math.ceil(p*n),w=Math.ceil(p*n);for(let T=V;T<K;T++)for(let y=L;y<x;y++){let D=(T%o.height+o.height)%o.height;if(o.getBlock(y,D)===s.WATER){let z=Math.floor((y*p-r)*n),g=Math.floor((T*p-e)*n);t.fillRect(z,g,G,w)}}let B=new Set([s.CLOUD,s.JUMP_PAD,s.JACKPOT,s.ACCELERATOR_LEFT,s.ACCELERATOR_RIGHT]);for(let T=V;T<K;T++)for(let y=L;y<x;y++){let D=(T%o.height+o.height)%o.height,W=o.getBlock(y,D);if(W!==s.AIR&&c[W]){let z=Math.floor((y*p-r)*n),g=Math.floor((T*p-e)*n);if(W===s.TNT&&d&&d.hasTimerAt(y,D)){let R=h*.01,U=Math.sin(R*15+y*7)*1.2,J=Math.cos(R*18+T*5)*1.2,tt=Math.floor((y*p+U-r)*n),et=Math.floor((T*p+J-e)*n);t.drawImage(c[W],tt,et,G,w);let q=(Math.sin(R*8)+1)/2;if(t.fillStyle=`rgba(255, ${Math.floor(100-q*100)}, 0, ${.2+q*.3})`,t.fillRect(tt,et,G,w),Math.sin(R*20)>.3){let ht=tt+G/2+(Math.random()-.5)*8*n,Xe=et+2*n,Tt=(3+Math.random()*3)*n;t.fillStyle="#ffff00",t.beginPath(),t.arc(ht,Xe,Tt,0,Math.PI*2),t.fill(),t.fillStyle="rgba(255, 200, 0, 0.5)",t.beginPath(),t.arc(ht,Xe,Tt+2*n,0,Math.PI*2),t.fill()}}else t.drawImage(c[W],z,g,G,w);if(!B.has(W)){let R=(D-1+o.height)%o.height,U=o.getBlock(y,R);U!==s.AIR&&!ge(U,Q)&&(t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(z,g,G,w))}}}if(t.save(),t.scale(n,n),t.translate(-r,-e),i&&i.draw(t),vr(t,r,e,a,l),Kn(t,r,e,a,l),Zn(t,r,e,a,l),f&&f.mouse&&f.mouse.active){let T=qt(f.mouse.x,f.mouse.y,r,e,n),{tx:y,ty:D}=Jt(T.x,T.y,p);_e(T.x,T.y,i.getCenterX(),i.getCenterY(),$t)&&(t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=2,t.strokeRect(y*p,D*p,p,p))}if(f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let T=f.gamepad.cursorX,y=f.gamepad.cursorY,D=qt(T,y,r,e,n),{tx:W,ty:z}=Jt(D.x,D.y,p);t.strokeStyle="rgba(255, 235, 59, 0.7)",t.lineWidth=3,t.strokeRect(W*p,z*p,p,p)}if(t.restore(),f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let T=f.gamepad.cursorX,y=f.gamepad.cursorY,D=12,W=4;t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.moveTo(T-D,y),t.lineTo(T-W,y),t.moveTo(T+W,y),t.lineTo(T+D,y),t.moveTo(T,y-D),t.lineTo(T,y-W),t.moveTo(T,y+W),t.lineTo(T,y+D),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath(),t.arc(T,y,2,0,Math.PI*2),t.fill()}}var zr=N(()=>{rt();j();Zr();Ge();Oe();te()});function Qr({world:t,player:o}){let i=[];function r(f,d,h){let u=h||nn+Math.floor(Math.random()*rn);i.push({x:f,y:d,timer:u})}function e(f){let d=f.y-o.height-.1;o.y=d;let h=t.height*p;o.y=(o.y%h+h)%h,o.vy=0,o.grounded=!0;let u=Math.floor(o.x/p),m=Math.floor((o.x+o.width)/p),_=Math.floor(o.y/p),E=Math.floor((o.y+o.height)/p),A=null;for(let M=_;M<=E;M++)for(let b=u;b<=m;b++){let S=(M%t.height+t.height)%t.height,C=(b%t.width+t.width)%t.width,P=t.getBlock(C,S);if(dt(P,Q))if(yt(P,Q))t.setBlock(C,S,s.AIR);else{let Y=M*p;A=A===null?Y:Math.min(A,Y)}}A!==null&&(o.y=A-o.height-.1,o.y=(o.y%h+h)%h)}function n(f,d,h){if(f<0||f>=t.width)return;let u=(d%t.height+t.height)%t.height,m=t.getBlock(f,u);if(Q[m]&&Q[m].unbreakable)return;m!==s.AIR&&m!==s.SAPLING&&t.setBlock(f,u,s.AIR);let _={x:f*p,y:u*p,w:p,h:p};pe(o.getRect(),_)&&e(_),t.setBlock(f,u,h)}function a(f,d){let h=[],u=[{x:f,y:d}],m=new Set,_=(E,A)=>`${E},${A}`;for(m.add(_(f,d));u.length>0;){let E=u.shift();if(t.getBlock(E.x,E.y)===s.SAPLING){h.push(E);let A=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(let M of A){let b=E.x+M.dx,C=((E.y+M.dy)%t.height+t.height)%t.height;if(b>=0&&b<t.width){let P=_(b,C);!m.has(P)&&t.getBlock(b,C)===s.SAPLING&&(m.add(P),u.push({x:b,y:C}))}}}}return h}function l(f){let d=f.length;if(d===0)return;let h=1/0,u=-1/0,m=1/0,_=-1/0;f.forEach(g=>{g.x<h&&(h=g.x),g.x>u&&(u=g.x),g.y<m&&(m=g.y),g.y>_&&(_=g.y)});let E=u-h+1,A=_-m+1,M=A/E,b=Math.floor((h+u)/2),S=_;f.forEach(g=>{t.setBlock(g.x,g.y,s.AIR)});let C=5,P=1,Y=0,O=0,L=1,x=A>t.height/2;!x&&M>=2?(P=1,L=1.5,Y=.02):!x&&M<=.5?(P=E,L=.8,Y=.05):(P=Math.ceil(Math.sqrt(d)),Y=.3,O=.3);let V=Math.floor(d*C*L),K=[],G=0,w=S,B=b;for(;G<V;){let g=P;if(O>0&&Math.random()<O&&(g+=Math.random()<.5?-1:1),g<1&&(g=1),!(S-w<2)){if(Math.random()<Y){let J=Math.random()<.5?-1:1;B+=J}B<b-3&&Math.random()<.2&&B++,B>b+3&&Math.random()<.2&&B--}let U=B-Math.floor((g-1)/2);for(let J=0;J<g;J++)K.push({x:U+J,y:w,type:s.WOOD}),G++;if(w--,S-w>100)break}let T=w+1,y=B,D=2+P*.8;D>6&&(D=6);let W=Math.ceil(D),z=Math.ceil(D*.8);for(let g=T-z;g<=T+z;g++)for(let R=y-W;R<=y+W;R++){let U=(R-y)/W,J=(g-T)/z;Math.sqrt(U*U+J*J)<1-Math.random()*.25&&(K.some(q=>q.x===R&&q.y===g&&q.type===s.WOOD)||K.push({x:R,y:g,type:s.LEAVES}))}K.forEach(({x:g,y:R,type:U})=>n(g,R,U))}function c(){for(let f=i.length-1;f>=0;f--){let d=i[f];if(t.getBlock(d.x,d.y)!==s.SAPLING){i.splice(f,1);continue}if(d.timer--,d.timer<=0){let h=a(d.x,d.y);l(h)}}for(let f=i.length-1;f>=0;f--)t.getBlock(i[f].x,i[f].y)!==s.SAPLING&&i.splice(f,1)}return{addSapling:r,tick:c,getTimers:()=>i,restoreTimers:f=>{i.length=0,f&&i.push(...f)}}}var ta=N(()=>{j();rt()});function ia(t){let{onStartGame:o,onLoadGame:i,onImportWorld:r}=t;function e(){let g=document.getElementById("start-screen");g&&(g.style.display="none")}function n(){let g=Pt(),R=document.querySelector(".start-buttons");R&&(g?R.classList.add("has-save"):R.classList.remove("has-save"))}n();let a=document.getElementById("vol-bgm"),l=document.getElementById("vol-sfx"),c=document.getElementById("volume-toggle-btn"),f=document.getElementById("volume-popup");function d(){let g=localStorage.getItem("pictoco_vol_bgm"),R=localStorage.getItem("pictoco_vol_sfx"),U=g!==null?parseFloat(g):1,J=R!==null?parseFloat(R):1;a&&(a.value=U),l&&(l.value=J),Z.setMusicVolume(U),Z.setSfxVolume(J)}a&&a.addEventListener("input",g=>{let R=parseFloat(g.target.value);Z.setMusicVolume(R),localStorage.setItem("pictoco_vol_bgm",R)}),l&&l.addEventListener("input",g=>{let R=parseFloat(g.target.value);Z.setSfxVolume(R),localStorage.setItem("pictoco_vol_sfx",R)}),c&&f&&c.addEventListener("click",g=>{g.stopPropagation(),f.classList.contains("open")?f.classList.remove("open"):f.classList.add("open")}),d();let h=document.getElementById("start-btn");h&&h.addEventListener("click",()=>{e(),o()});let u=document.getElementById("reset-btn");u&&u.addEventListener("click",()=>{e(),o()});let m=document.getElementById("continue-btn");m&&m.addEventListener("click",()=>{let g=Pt();g&&(e(),i(g))});let _=document.getElementById("world-modal"),E=document.getElementById("world-btn"),A=document.getElementById("world-close-btn"),M=document.getElementById("export-btn"),b=document.getElementById("import-btn"),S=document.getElementById("import-file");function C(){if(M){let g=Pt();M.disabled=!g||!g.world||!g.world.map}b&&S&&(b.disabled=!S.files[0])}function P(){_&&(_.classList.add("visible"),C())}function Y(){_&&_.classList.remove("visible")}E&&E.addEventListener("click",P),A&&A.addEventListener("click",Y),_&&_.addEventListener("click",g=>{g.target===_&&Y()}),S&&S.addEventListener("change",C),M&&M.addEventListener("click",async()=>{let g=Pt();if(!g||!g.world||!g.world.map)return;let R=atob(g.world.map),U=new Uint8Array(R.length);for(let et=0;et<R.length;et++)U[et]=R.charCodeAt(et);let J=await Wr(U,g.world.width,g.world.height),tt=new Date().toISOString().slice(0,19).replace(/[:-]/g,"");Vr(J,`world_${tt}.png`)}),b&&S&&b.addEventListener("click",async()=>{let g=S.files[0];if(g)try{let R=await Kr(g);Y(),e(),r(R)}catch{alert(pt.msg_import_err)}});let O=document.getElementById("lang-current"),L=document.getElementById("lang-popup"),x=document.querySelectorAll(".lang-option");function V(){Promise.resolve().then(()=>(Qt(),An)).then(({currentLanguage:g})=>{if(O){O.innerHTML="";let R=document.createElement("div");R.className=`flag-icon flag-${g}`,O.appendChild(R)}x.forEach(R=>{R.dataset.lang===g?R.classList.add("active"):R.classList.remove("active")})})}function K(){L&&L.classList.add("open")}function G(){L&&L.classList.remove("open")}V(),O&&O.addEventListener("click",g=>{g.stopPropagation(),L&&L.classList.contains("open")?G():K()}),x.forEach(g=>{g.addEventListener("click",R=>{R.stopPropagation();let U=g.dataset.lang;ao(U),V(),G()})}),document.addEventListener("click",g=>{L&&L.classList.contains("open")&&!L.contains(g.target)&&g.target!==O&&G(),f&&f.classList.contains("open")&&!f.contains(g.target)&&g.target!==c&&f.classList.remove("open")});let w=0,B=!1,T=!1,y=!1;function D(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none")return[];let R=[];if(Pt()){let tt=document.getElementById("continue-btn");tt&&R.push(tt);let et=document.getElementById("reset-btn");et&&R.push(et)}else{let tt=document.getElementById("start-btn");tt&&R.push(tt)}let J=document.getElementById("world-btn");return J&&R.push(J),R}function W(){D().forEach((R,U)=>{U===w?(R.classList.add("gamepad-selected"),R.focus()):R.classList.remove("gamepad-selected")})}function z(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none"||_&&_.classList.contains("visible"))return;let R=navigator.getGamepads(),U=null;for(let ht of R)if(ht&&ht.connected){U=ht;break}if(!U)return;let{buttons:J}=U,tt=D(),et=J[oa]&&J[oa].pressed;et&&!B&&(w=Math.max(0,w-1),W()),B=et;let q=J[na]&&J[na].pressed;q&&!T&&(w=Math.min(tt.length-1,w+1),W()),T=q;let _t=J[ea]&&J[ea].pressed;if(_t&&!y){let ht=tt[w];ht&&ht.click()}y=_t}setInterval(z,50),window.addEventListener("gamepadconnected",()=>{w=0,W()})}var ea,oa,na,ra=N(()=>{Co();wo();Qt();Bt();ea=0,oa=12,na=13});function aa(){let t=0,o=0,i=1;return{get x(){return t},get y(){return o},get zoom(){return i},setPosition(r,e){t=r,o=e},update(r,e,n,a){let l=Math.hypot(r.vx,r.vy),c=1;l>Ze&&(c=Math.max(Wo,1-(l-Ze)*Go));let f=1e-4,d=.002,h=.06,u=.05,m=c-i,_=Math.abs(m);_<f?i=c:_>u?(i+=Math.sign(m)*d,(c-i)*m<0&&(i=c)):(i+=m*h,Math.abs(c-i)<f&&(i=c));let E=n/i,A=a/i,M=r.getCenterX()-E/2,b=r.getCenterY()-A/2,S=e.width*p,C=M-t;Math.abs(C)>S/2&&(C>0?t+=S:t-=S);let P=e.height*p,Y=b-o;Math.abs(Y)>P/2&&(Y>0?o+=P:o-=P),t=je(t,M,qe),o=je(o,b,qe)}}}var sa=N(()=>{rt();j()});var cs=fa(()=>{rt();Bt();j();ln();dn();ro();vn();Oe();te();zn();bo();Er();Ge();Dr();Co();Gr();wo();zr();ta();ra();sa();Qt();so();var ue={},Xt=document.getElementById("gameCanvas"),ko=Xt.getContext("2d"),$,ot,de=0,ft,lt,jt,ct=null,he=null,Ue=null,He=0,rs=.25,Oo=0,Et=window.innerWidth,St=window.innerHeight;function la(){let t=window.devicePixelRatio||1;Et=window.innerWidth,St=window.innerHeight,Xt.width=Et*t,Xt.height=St*t,Xt.style.width=Et+"px",Xt.style.height=St+"px",ko.scale(t,t),ko.imageSmoothingEnabled=!1}window.addEventListener("resize",la);function Po(t=null){$=new Vt(it,at);let o=(i,r)=>{Z.playExplosion();for(let e of r)$.setBlock(i,e,s.AIR),ct&&ct.cancelTimerAt(i,e)};ot=new Ne($,Re,o,(i,r)=>{Gn(i,r)}),ue=sn(),Jn(ue),ft=aa(),ct=Fr({world:$,player:ot,sounds:Z,addToInventory:Re,createExplosionParticles:mo}),he=Qr({world:$,player:ot}),Lr({onTNTAccelerator:(i,r)=>{Z.playExplosion();for(let e of i)$.setBlock(e,r,s.AIR),ct&&ct.cancelTimerAt(e,r)}}),jt=$n({world:$,player:ot,inventory:{addToInventory:Re,consumeFromInventory:mn,getSelectedBlockId:hn},camera:ft,sounds:Z,constants:{TILE_SIZE:p,BLOCKS:s,BLOCK_PROPS:Q,REACH:$t},utils:{screenToWorld:qt,worldToTile:Jt,isWithinReach:_e,isBlockBreakable:yt,isBlockTransparent:ge,isBlockSolid:dt,getBlockMaterialType:be,rectsIntersect:pe,hasAdjacentBlock:No},onBlockPlaced:(i,r,e)=>{if(e===s.TNT){let n=r-1;for(;$.getBlock(i,n)===s.TNT;)n--;let l=$.getBlock(i,n)===s.JUMP_PAD,c=i-1;for(;$.getBlock(c,r)===s.TNT;)c--;let f=$.getBlock(c,r)===s.ACCELERATOR_LEFT,d=i+1;for(;$.getBlock(d,r)===s.TNT;)d++;let h=$.getBlock(d,r)===s.ACCELERATOR_RIGHT;if(!(l||f||h))ct.onBlockPlaced(i,r);else{if(l){let m=r+1;for(;$.getBlock(i,m)===s.TNT;)ct.cancelTimerAt(i,m),m++}if(f){let m=i+1;for(;$.getBlock(m,r)===s.TNT;)ct.cancelTimerAt(m,r),m++}if(h){let m=i-1;for(;$.getBlock(m,r)===s.TNT;)ct.cancelTimerAt(m,r),m--}}}else if(e===s.JUMP_PAD){let n=r+1;for(;$.getBlock(i,n)===s.TNT;)ct.cancelTimerAt(i,n),n++}else if(e===s.ACCELERATOR_LEFT){let n=i+1;for(;$.getBlock(n,r)===s.TNT;)ct.cancelTimerAt(n,r),n++}else if(e===s.ACCELERATOR_RIGHT){let n=i-1;for(;$.getBlock(n,r)===s.TNT;)ct.cancelTimerAt(n,r),n--}else e===s.SAPLING&&he.addSapling(i,r)}}),lt=fn(Xt,{onHotbarSelect:zt,onTouch:(i,r)=>jt.handlePointer(i,r),onClimb:()=>jt.triggerClimb()}),pn(ue),Ue=Nr({world:$,player:ot,timers:{tnt:ct.getTimers(),saplings:he.getTimers()},inventory:{getInventoryState:un,loadInventoryState:io},utils:{clamp:Rt},constants:{TILE_SIZE:p}}),t?(Ue.applySavedState(t),t.timers&&t.timers.saplings&&he.restoreTimers(t.timers.saplings)):Dt(),la(),ft.setPosition(ot.getCenterX()-Et/2,ot.getCenterY()-St/2),Ue.startAutosave(),Ue.saveGameState(),de===0&&requestAnimationFrame(vo)}function as(){if(ot){if(He>0&&He--,lt.pollGamepads){let t=(ot.getCenterX()-ft.x)*ft.zoom,o=(ot.getCenterY()-ft.y)*ft.zoom;lt.pollGamepads({screenWidth:Et,screenHeight:St,playerScreenX:t,playerScreenY:o,reach:($t-Fo)*ft.zoom,skipJump:At})}if(ot.tick(lt),lt.mouse.leftDown&&(At||jt.handlePointer(lt.mouse.x,lt.mouse.y),lt.mouse.leftDown=!1),lt.gamepad&&lt.gamepad.connected&&!At){let t=lt.gamepad.cursorX,o=lt.gamepad.cursorY;lt.gamepad.breakAction&&He===0&&jt.handlePointer(t,o,"break")&&(He=Ko),lt.gamepad.placeAction&&jt.handlePointer(t,o,"place")}Pn(ot,$,ue),At&&On(),Or(ot,$,Z),kr(),xr(ot,$),Br(),Wn($,ft.x,ft.y,{width:Et,height:St}),qn(),ct.tick(),he.tick()}}function ss(){ot&&ft.update(ot,$,Et,St)}function ls(){$r(ko,{world:$,player:ot,cameraX:ft.x,cameraY:ft.y,zoom:ft.zoom,logicalWidth:Et,logicalHeight:St,textures:ue,input:lt,tntManager:ct})}function vo(t){if(de===0){de=t,requestAnimationFrame(vo);return}let o=t-de;for(de=t,o>50&&(o=50),Oo+=o;Oo>=Zt-rs;)as(),Oo-=Zt;ss(),ls(),requestAnimationFrame(vo)}var xt=()=>{Z.resume()};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&xt()});window.addEventListener("pageshow",t=>{t.persisted&&xt(),xt()});window.addEventListener("focus",xt);window.addEventListener("click",xt);window.addEventListener("keydown",xt);window.addEventListener("touchstart",xt);window.addEventListener("touchend",xt);ia({onStartGame:()=>{Z.init(),Po()},onLoadGame:t=>{Z.init(),Po(t)},onImportWorld:t=>{Z.init();let i=Pt()?.inventory||null;Po(),$.map=t,i&&io(i);let r=Yr(t,it,at);ot.x=r.x*p,ot.y=r.y*p,ot.vx=0,ot.vy=0,ft.setPosition(ot.getCenterX()-Et/2,ot.getCenterY()-St/2)}});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(t=>{console.log("ServiceWorker registered:",t.scope)}).catch(t=>{console.log("ServiceWorker registration failed:",t)})})});cs();})();
