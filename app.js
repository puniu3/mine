(()=>{var Mr=Object.defineProperty;var Er=(t,e)=>()=>(t&&(e=t(t=0)),e);var Sr=(t,e)=>{for(var n in e)Mr(t,n,{get:e[n],enumerable:!0})};var en={};Sr(en,{currentLanguage:()=>Qo,initI18n:()=>$e,resources:()=>St,setLanguage:()=>Ze,strings:()=>ht,supportedLanguages:()=>wr});function Or(){let t=localStorage.getItem(zo);if(t&&St[t])return t;let e=navigator.language||navigator.userLanguage||"en",n=e.split("-")[0];return St[e]?e:St[n]?n:"en"}function tn(t){let e=St[t]||St.en;Qo=t,Object.keys(ht).forEach(n=>delete ht[n]),Object.assign(ht,e),document.documentElement.lang=t,document.querySelectorAll("[data-i18n]").forEach(n=>{let a=n.getAttribute("data-i18n");ht[a]&&(n.innerText=ht[a])})}function Ze(t){if(!St[t]){console.warn(`Language '${t}' not supported`);return}localStorage.setItem(zo,t),tn(t),navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_LANGUAGE_FONTS",lang:t})}function $e(){let t=Or();tn(t),navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_LANGUAGE_FONTS",lang:t})}var St,ht,zo,wr,Qo,Jt=Er(()=>{St={semantics:{continue_btn:"Title screen: Continue button. Resumes from autosave (game saves to browser localStorage every 5 seconds).",start_btn:"Title screen: Start button. Displayed when no save data exists. Starts with new player data and world.",reset_btn:"Title screen: Restart button. Displayed when save data exists. Deletes current save and starts fresh.",world_btn:"Title screen: World button. Opens modal to export/import world data as images.",inst_pc:"Title screen: Instruction header. Guide for keyboard + mouse controls.",inst_move_pc:"Title screen: Instruction. A, D, Left, Right to move.",inst_jump_pc:"Title screen: Instruction. Space key, W, Up to jump.",inst_action_pc:"Title screen: Instruction. Click to place or break (gather) blocks.",inst_climb_pc:"Title screen: Instruction. S to place block at feet and climb.",inst_mobile:"Title screen: Instruction header. Guide for touch controls.",inst_move_mobile:"Title screen: Instruction. Left/Right triangle buttons appear at bottom left; tap to move.",inst_jump_mobile:"Title screen: Instruction. Up triangle button appears at bottom right; tap to jump.",inst_action_mobile:"Title screen: Instruction. Tap tiles directly around the player character to break or place blocks.",inst_climb_mobile:"Title screen: Instruction. Tap the player character to place a block at feet and climb up.",inst_gamepad:"Title screen: Instruction header. Guide for gamepad controls.",label_move:"Title screen: Gamepad instruction label. Indicates controls for character movement.",label_cursor:"Title screen: Gamepad instruction label. Indicates controls for cursor movement.",label_jump:"Title screen: Gamepad instruction label. Indicates the button for jumping.",label_make:"Title screen: Gamepad instruction label. Indicates the button for placing blocks.",label_break:"Title screen: Gamepad instruction label. Indicates the button for breaking blocks.",label_climb:"Title screen: Gamepad instruction label. Indicates the button to place a block at feet and climb up.",label_select:"Title screen: Gamepad instruction label. Indicates buttons to cycle through items in the hotbar (left/right).",world_modal_title:"Modal window title for reading/writing world data.",world_export_title:"Header for the export section.",world_export_desc:"Export world data as a PNG image. 1 tile converts to 1 pixel, allowing the world to be viewed directly as an image.",world_export_btn:"Button to execute export.",world_import_title:"Header for the import section.",world_import_desc:"Imports an image, converts it to world data, and starts the game. Keeps existing player data. Forces closest-color matching for any uploaded image.",world_import_btn:"Button to execute import.",world_back_btn:"Button to close the window.",craft_missing:"Crafting screen message. Displayed when selecting an item at workbench but inventory lacks required materials.",craft_done:"Crafting screen message. Displayed when an item is successfully created.",msg_import_err:"World window alert message. Displayed when the try-catch block fails during image loading/world generation."},style:{target_audience:"6-year-olds",tone:"Carefree, colloquial, and friendly",context:"Children playing independently without adult supervision",vocabulary:"Simple, easy-to-understand words; strictly avoid technical jargon"},ja:{continue_btn:"\u3064\u3065\u304D\u304B\u3089",start_btn:"\u306F\u3058\u3081\u308B",reset_btn:"\u306F\u3058\u3081\u304B\u3089",world_btn:"\u30EF\u30FC\u30EB\u30C9",inst_pc:"\u30D1\u30BD\u30B3\u30F3",inst_move_pc:"\u3046\u3054\u304F: \u3084\u3058\u308B\u3057 / A D",inst_jump_pc:"\u3068\u3076: \u30B9\u30DA\u30FC\u30B9 / W / \u2191",inst_action_pc:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30AF\u30EA\u30C3\u30AF",inst_climb_pc:"\u306E\u307C\u308B: S",inst_mobile:"\u30B9\u30DE\u30DB",inst_move_mobile:"\u3046\u3054\u304F: \u2190 \u2192",inst_jump_mobile:"\u3068\u3076: \u2191",inst_action_mobile:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30BF\u30C3\u30D7",inst_climb_mobile:"\u306E\u307C\u308B: \u30AD\u30E3\u30E9\u3092\u30BF\u30C3\u30D7",inst_gamepad:"\u30B3\u30F3\u30C8\u30ED\u30FC\u30E9\u30FC",label_move:"\u3046\u3054\u304F",label_cursor:"\u30AB\u30FC\u30BD\u30EB",label_jump:"\u3068\u3076",label_make:"\u3064\u304F\u308B",label_break:"\u3053\u308F\u3059",label_climb:"\u306E\u307C\u308B",label_select:"\u3048\u3089\u3076",world_modal_title:"\u30EF\u30FC\u30EB\u30C9",world_export_title:"\u306E\u3053\u3059",world_export_desc:"\u3064\u304F\u3063\u305F \u305B\u304B\u3044\u3092 \u3048\u306B\u3059\u308B",world_export_btn:"\u3048\u306B\u3059\u308B",world_import_title:"\u3088\u307F\u3053\u3080",world_import_desc:"\u3048\u3092 \u3088\u307F\u3053\u3093\u3067 \u3042\u305D\u3076",world_import_btn:"\u3088\u307F\u3053\u3080",world_back_btn:"\u3082\u3069\u308B",craft_missing:"\u3056\u3044\u308A\u3087\u3046\u304C\u305F\u308A\u306A\u3044\u3088",craft_done:"\u3067\u304D\u305F\u3088\uFF01",msg_import_err:"\u3053\u306E \u3048\u3067\u306F \u30EF\u30FC\u30EB\u30C9\u3092 \u3064\u304F\u308C\u306A\u3044\u3088"},en:{continue_btn:"Continue",start_btn:"Start",reset_btn:"Start Over",world_btn:"World",inst_pc:"PC Controls",inst_move_pc:"Move: Arrows / A D",inst_jump_pc:"Jump: Space / W / Up",inst_action_pc:"Put / Break: Click",inst_climb_pc:"Climb: S",inst_mobile:"Touch Controls",inst_move_mobile:"Move: \u2190 \u2192",inst_jump_mobile:"Jump: \u2191",inst_action_mobile:"Put / Break: Tap",inst_climb_mobile:"Climb: Tap Player",inst_gamepad:"Controller",label_move:"Move",label_cursor:"Cursor",label_jump:"Jump",label_make:"Put",label_break:"Break",label_climb:"Climb",label_select:"Select",world_modal_title:"My World",world_export_title:"Save",world_export_desc:"Turn your world into a picture.",world_export_btn:"Make Picture",world_import_title:"Load",world_import_desc:"Load a picture to play.",world_import_btn:"Load Picture",world_back_btn:"Back",craft_missing:"Need more items!",craft_done:"Done!",msg_import_err:"Can't use this picture."},zh:{continue_btn:"\u7EE7\u7EED\u73A9",start_btn:"\u5F00\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u5F00\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u7535\u8111\u600E\u4E48\u73A9",inst_move_pc:"\u79FB\u52A8: \u7BAD\u5934 / A D",inst_jump_pc:"\u8DF3: \u7A7A\u683C\u952E / W / \u2191",inst_action_pc:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u51FB",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u673A\u600E\u4E48\u73A9",inst_move_mobile:"\u79FB\u52A8: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u6309",inst_climb_mobile:"\u722C\u9AD8: \u70B9\u6309\u89D2\u8272",inst_gamepad:"\u624B\u67C4\u600E\u4E48\u73A9",label_move:"\u79FB\u52A8",label_cursor:"\u5149\u6807",label_jump:"\u8DF3",label_make:"\u76D6",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9009",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u53D8\u6210\u4E00\u5F20\u753B",world_export_btn:"\u53D8\u6210\u753B",world_import_title:"\u8BFB\u53D6",world_import_desc:"\u8BFB\u53D6\u753B\u6765\u73A9",world_import_btn:"\u8BFB\u53D6\u753B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u591F\u54E6",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u8FD9\u5F20\u753B\u4E0D\u80FD\u7528\u54E6"},"zh-TW":{continue_btn:"\u7E7C\u7E8C\u73A9",start_btn:"\u958B\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u958B\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u96FB\u8166\u600E\u9EBC\u73A9",inst_move_pc:"\u79FB\u52D5: \u7BAD\u982D / A D",inst_jump_pc:"\u8DF3: \u7A7A\u767D\u9375 / W / \u2191",inst_action_pc:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u64CA",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u6A5F\u600E\u9EBC\u73A9",inst_move_mobile:"\u79FB\u52D5: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u6309",inst_climb_mobile:"\u722C\u9AD8: \u9EDE\u6309\u89D2\u8272",inst_gamepad:"\u624B\u628A\u600E\u9EBC\u73A9",label_move:"\u79FB\u52D5",label_cursor:"\u6E38\u6A19",label_jump:"\u8DF3",label_make:"\u84CB",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9078",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u8B8A\u6210\u4E00\u5F35\u756B",world_export_btn:"\u8B8A\u6210\u756B",world_import_title:"\u8B80\u53D6",world_import_desc:"\u8B80\u53D6\u756B\u4F86\u73A9",world_import_btn:"\u8B80\u53D6\u756B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u5920\u5594",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u9019\u5F35\u756B\u4E0D\u80FD\u7528\u5594"},es:{continue_btn:"Seguir",start_btn:"Jugar",reset_btn:"Desde cero",world_btn:"Mundo",inst_pc:"En PC",inst_move_pc:"Mover: Flechas / A D",inst_jump_pc:"Saltar: Espacio / W / \u2191",inst_action_pc:"Poner / Quitar: Clic",inst_climb_pc:"Subir: S",inst_mobile:"En m\xF3vil",inst_move_mobile:"Mover: \u2190 \u2192",inst_jump_mobile:"Saltar: \u2191",inst_action_mobile:"Poner / Quitar: Tocar",inst_climb_mobile:"Subir: Tocar personaje",inst_gamepad:"Mando",label_move:"Mover",label_cursor:"Cursor",label_jump:"Saltar",label_make:"Poner",label_break:"Quitar",label_climb:"Subir",label_select:"Elegir",world_modal_title:"Mi Mundo",world_export_title:"Guardar",world_export_desc:"Convierte tu mundo en un dibujo.",world_export_btn:"Hacer dibujo",world_import_title:"Cargar",world_import_desc:"Usa un dibujo para jugar.",world_import_btn:"Usar dibujo",world_back_btn:"Volver",craft_missing:"\xA1Te faltan cosas!",craft_done:"\xA1Listo!",msg_import_err:"No puedo usar este dibujo."},fr:{continue_btn:"Continuer",start_btn:"Jouer",reset_btn:"Recommencer",world_btn:"Monde",inst_pc:"Sur ordi",inst_move_pc:"Bouger : Fl\xE8ches / A D",inst_jump_pc:"Sauter : Espace / W / \u2191",inst_action_pc:"Mettre / Casser : Clic",inst_climb_pc:"Monter : S",inst_mobile:"Sur mobile",inst_move_mobile:"Bouger : \u2190 \u2192",inst_jump_mobile:"Sauter : \u2191",inst_action_mobile:"Mettre / Casser : Toucher",inst_climb_mobile:"Monter : Touche sur toi",inst_gamepad:"Manette",label_move:"Bouger",label_cursor:"Curseur",label_jump:"Sauter",label_make:"Mettre",label_break:"Casser",label_climb:"Monter",label_select:"Choisir",world_modal_title:"Mon Monde",world_export_title:"Garder",world_export_desc:"Transforme ton monde en image.",world_export_btn:"Faire une image",world_import_title:"Ouvrir",world_import_desc:"Ouvre une image pour jouer.",world_import_btn:"Ouvrir une image",world_back_btn:"Retour",craft_missing:"Il te manque des trucs !",craft_done:"C'est fait !",msg_import_err:"Je ne peux pas utiliser cette image."},de:{continue_btn:"Weiter",start_btn:"Starten",reset_btn:"Neustart",world_btn:"Welt",inst_pc:"Am Computer",inst_move_pc:"Laufen: Pfeile / A D",inst_jump_pc:"H\xFCpfen: Leertaste / W / \u2191",inst_action_pc:"Bauen / Abbauen: Klick",inst_climb_pc:"Klettern: S",inst_mobile:"Am Handy",inst_move_mobile:"Laufen: \u2190 \u2192",inst_jump_mobile:"H\xFCpfen: \u2191",inst_action_mobile:"Bauen / Abbauen: Tippen",inst_climb_mobile:"Klettern: Tipp auf dich",inst_gamepad:"Controller",label_move:"Laufen",label_cursor:"Cursor",label_jump:"H\xFCpfen",label_make:"Bauen",label_break:"Abbauen",label_climb:"Klettern",label_select:"W\xE4hlen",world_modal_title:"Meine Welt",world_export_title:"Speichern",world_export_desc:"Mach ein Bild aus deiner Welt.",world_export_btn:"Bild machen",world_import_title:"Laden",world_import_desc:"Lade ein Bild zum Spielen.",world_import_btn:"Bild laden",world_back_btn:"Zur\xFCck",craft_missing:"Dir fehlen Sachen!",craft_done:"Fertig!",msg_import_err:"Das Bild geht nicht."},it:{continue_btn:"Continua",start_btn:"Gioca",reset_btn:"Ricomincia",world_btn:"Mondo",inst_pc:"Computer",inst_move_pc:"Muovi: Frecce / A D",inst_jump_pc:"Salta: Spazio / W / \u2191",inst_action_pc:"Metti / Rompi: Clic",inst_climb_pc:"Sali: S",inst_mobile:"Telefono",inst_move_mobile:"Muovi: \u2190 \u2192",inst_jump_mobile:"Salta: \u2191",inst_action_mobile:"Metti / Rompi: Tocca",inst_climb_mobile:"Sali: Tocca l'omino",inst_gamepad:"Controller",label_move:"Muovi",label_cursor:"Cursore",label_jump:"Salta",label_make:"Metti",label_break:"Rompi",label_climb:"Sali",label_select:"Scegli",world_modal_title:"Mio Mondo",world_export_title:"Salva",world_export_desc:"Trasforma il mondo in una foto.",world_export_btn:"Fai una foto",world_import_title:"Carica",world_import_desc:"Usa una foto per giocare.",world_import_btn:"Usa foto",world_back_btn:"Indietro",craft_missing:"Mancano oggetti!",craft_done:"Fatto!",msg_import_err:"Non posso usare questa foto."},pt:{continue_btn:"Continuar",start_btn:"Jogar",reset_btn:"Do come\xE7o",world_btn:"Mundo",inst_pc:"No PC",inst_move_pc:"Andar: Setas / A D",inst_jump_pc:"Pular: Espa\xE7o / W / \u2191",inst_action_pc:"P\xF4r / Tirar: Clique",inst_climb_pc:"Subir: S",inst_mobile:"No Celular",inst_move_mobile:"Andar: \u2190 \u2192",inst_jump_mobile:"Pular: \u2191",inst_action_mobile:"P\xF4r / Tirar: Toque",inst_climb_mobile:"Subir: Toque no boneco",inst_gamepad:"Controle",label_move:"Andar",label_cursor:"Cursor",label_jump:"Pular",label_make:"P\xF4r",label_break:"Tirar",label_climb:"Subir",label_select:"Escolher",world_modal_title:"Meu Mundo",world_export_title:"Salvar",world_export_desc:"Vira uma foto do seu mundo.",world_export_btn:"Criar foto",world_import_title:"Abrir",world_import_desc:"Use uma foto para jogar.",world_import_btn:"Abrir foto",world_back_btn:"Voltar",craft_missing:"Falta coisa!",craft_done:"Pronto!",msg_import_err:"N\xE3o d\xE1 pra usar essa foto."},ko:{continue_btn:"\uC774\uC5B4\uD558\uAE30",start_btn:"\uC2DC\uC791\uD558\uAE30",reset_btn:"\uCC98\uC74C\uBD80\uD130",world_btn:"\uC6D4\uB4DC",inst_pc:"\uCEF4\uD4E8\uD130",inst_move_pc:"\uC774\uB3D9: \uD654\uC0B4\uD45C / A D",inst_jump_pc:"\uC810\uD504: \uC2A4\uD398\uC774\uC2A4\uBC14 / W / \u2191",inst_action_pc:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD074\uB9AD",inst_climb_pc:"\uC62C\uB77C\uAC00\uAE30: S",inst_mobile:"\uC2A4\uB9C8\uD2B8\uD3F0",inst_move_mobile:"\uC774\uB3D9: \u2190 \u2192",inst_jump_mobile:"\uC810\uD504: \u2191",inst_action_mobile:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD130\uCE58",inst_climb_mobile:"\uC62C\uB77C\uAC00\uAE30: \uCE90\uB9AD\uD130 \uD130\uCE58",inst_gamepad:"\uAC8C\uC784\uD328\uB4DC",label_move:"\uC774\uB3D9",label_cursor:"\uCEE4\uC11C",label_jump:"\uC810\uD504",label_make:"\uB193\uAE30",label_break:"\uBD80\uC218\uAE30",label_climb:"\uC62C\uB77C\uAC00\uAE30",label_select:"\uC120\uD0DD",world_modal_title:"\uB098\uC758 \uC6D4\uB4DC",world_export_title:"\uC800\uC7A5",world_export_desc:"\uC6D4\uB4DC\uB97C \uADF8\uB9BC\uC73C\uB85C \uB9CC\uB4E4\uAE30.",world_export_btn:"\uADF8\uB9BC \uB9CC\uB4E4\uAE30",world_import_title:"\uBD88\uB7EC\uC624\uAE30",world_import_desc:"\uADF8\uB9BC\uC744 \uBD88\uB7EC\uC640\uC11C \uB180\uAE30.",world_import_btn:"\uADF8\uB9BC \uAC00\uC838\uC624\uAE30",world_back_btn:"\uB3CC\uC544\uAC00\uAE30",craft_missing:"\uC7AC\uB8CC\uAC00 \uBD80\uC871\uD574!",craft_done:"\uB2E4 \uB9CC\uB4E4\uC5C8\uC5B4!",msg_import_err:"\uC774 \uADF8\uB9BC\uC740 \uC4F8 \uC218 \uC5C6\uC5B4."},ru:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",start_btn:"\u0418\u0433\u0440\u0430\u0442\u044C",reset_btn:"\u0421 \u043D\u0430\u0447\u0430\u043B\u0430",world_btn:"\u041C\u0438\u0440",inst_pc:"\u041A\u043E\u043C\u043F\u044C\u044E\u0442\u0435\u0440",inst_move_pc:"\u0425\u043E\u0434\u0438\u0442\u044C: \u0421\u0442\u0440\u0435\u043B\u043A\u0438 / A D",inst_jump_pc:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u041F\u0440\u043E\u0431\u0435\u043B / W / \u2191",inst_action_pc:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041A\u043B\u0438\u043A",inst_climb_pc:"\u041B\u0435\u0437\u0442\u044C: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0425\u043E\u0434\u0438\u0442\u044C: \u2190 \u2192",inst_jump_mobile:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u2191",inst_action_mobile:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041D\u0430\u0436\u043C\u0438",inst_climb_mobile:"\u041B\u0435\u0437\u0442\u044C: \u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0433\u0435\u0440\u043E\u044F",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0425\u043E\u0434\u0438\u0442\u044C",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C",label_make:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C",label_break:"\u041B\u043E\u043C\u0430\u0442\u044C",label_climb:"\u041B\u0435\u0437\u0442\u044C",label_select:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C",world_modal_title:"\u041C\u043E\u0439 \u043C\u0438\u0440",world_export_title:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",world_export_desc:"\u041F\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442\u044C \u043C\u0438\u0440 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_import_desc:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 \u0438 \u0438\u0433\u0440\u0430\u0442\u044C.",world_import_btn:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0432\u0435\u0449\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u042D\u0442\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442."},id:{continue_btn:"Lanjut",start_btn:"Main",reset_btn:"Mulai ulang",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Panah / A D",inst_jump_pc:"Lompat: Spasi / W / \u2191",inst_action_pc:"Buat / Pecahkan: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"HP",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Buat / Pecahkan: Sentuh",inst_climb_mobile:"Panjat: Sentuh karakter",inst_gamepad:"Stik",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Buat",label_break:"Pecahkan",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Jadikan duniamu gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main pakai gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barangnya kurang!",craft_done:"Jadi deh!",msg_import_err:"Gambar ini gak bisa dipakai."},pl:{continue_btn:"Graj dalej",start_btn:"Graj",reset_btn:"Od nowa",world_btn:"\u015Awiat",inst_pc:"Komputer",inst_move_pc:"Ruch: Strza\u0142ki / A D",inst_jump_pc:"Skok: Spacja / W / \u2191",inst_action_pc:"Buduj / Niszcz: Klik",inst_climb_pc:"Wspinaj si\u0119: S",inst_mobile:"Telefon",inst_move_mobile:"Ruch: \u2190 \u2192",inst_jump_mobile:"Skok: \u2191",inst_action_mobile:"Buduj / Niszcz: Dotknij",inst_climb_mobile:"Wspinaj si\u0119: Dotknij siebie",inst_gamepad:"Pad",label_move:"Ruch",label_cursor:"Kursor",label_jump:"Skok",label_make:"Buduj",label_break:"Niszcz",label_climb:"Wspinaj",label_select:"Wybierz",world_modal_title:"M\xF3j \u015Awiat",world_export_title:"Zapisz",world_export_desc:"Zr\xF3b obrazek ze \u015Bwiata.",world_export_btn:"Zr\xF3b obrazek",world_import_title:"Wczytaj",world_import_desc:"U\u017Cyj obrazka do gry.",world_import_btn:"Wczytaj obrazek",world_back_btn:"Wr\xF3\u0107",craft_missing:"Brakuje rzeczy!",craft_done:"Gotowe!",msg_import_err:"Ten obrazek nie dzia\u0142a."},uk:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u0432\u0436\u0438\u0442\u0438",start_btn:"\u0413\u0440\u0430\u0442\u0438",reset_btn:"\u0421\u043F\u043E\u0447\u0430\u0442\u043A\u0443",world_btn:"\u0421\u0432\u0456\u0442",inst_pc:"\u041A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440",inst_move_pc:"\u0420\u0443\u0445: \u0421\u0442\u0440\u0456\u043B\u043A\u0438 / A D",inst_jump_pc:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u041F\u0440\u043E\u0431\u0456\u043B / W / \u2191",inst_action_pc:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041A\u043B\u0456\u043A",inst_climb_pc:"\u041B\u0456\u0437\u0442\u0438: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0420\u0443\u0445: \u2190 \u2192",inst_jump_mobile:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u2191",inst_action_mobile:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438",inst_climb_mobile:"\u041B\u0456\u0437\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438 \u043D\u0430 \u0441\u0435\u0431\u0435",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0420\u0443\u0445",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A",label_make:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438",label_break:"\u041B\u0430\u043C\u0430\u0442\u0438",label_climb:"\u041B\u0456\u0437\u0442\u0438",label_select:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438",world_modal_title:"\u041C\u0456\u0439 \u0421\u0432\u0456\u0442",world_export_title:"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438",world_export_desc:"\u041F\u0435\u0440\u0435\u0442\u0432\u043E\u0440\u0438 \u0441\u0432\u0456\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0417\u0440\u043E\u0431\u0438\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0438\u0442\u0438",world_import_desc:"\u0413\u0440\u0430\u0439 \u0437 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438.",world_import_btn:"\u0412\u0437\u044F\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0432\u0438\u0441\u0442\u0430\u0447\u0430\u0454 \u0440\u0435\u0447\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u0426\u044F \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u043F\u0440\u0430\u0446\u044E\u0454."},tr:{continue_btn:"Devam Et",start_btn:"Oyna",reset_btn:"Ba\u015Ftan Ba\u015Fla",world_btn:"D\xFCnya",inst_pc:"Bilgisayar",inst_move_pc:"Git: Oklar / A D",inst_jump_pc:"Z\u0131pla: Bo\u015Fluk / W / \u2191",inst_action_pc:"Koy / K\u0131r: T\u0131kla",inst_climb_pc:"T\u0131rman: S",inst_mobile:"Telefon",inst_move_mobile:"Git: \u2190 \u2192",inst_jump_mobile:"Z\u0131pla: \u2191",inst_action_mobile:"Koy / K\u0131r: Dokun",inst_climb_mobile:"T\u0131rman: Kendine dokun",inst_gamepad:"Oyun Kolu",label_move:"Git",label_cursor:"\u0130mle\xE7",label_jump:"Z\u0131pla",label_make:"Koy",label_break:"K\u0131r",label_climb:"T\u0131rman",label_select:"Se\xE7",world_modal_title:"D\xFCnyam",world_export_title:"Kaydet",world_export_desc:"D\xFCnyay\u0131 resme \xE7evir.",world_export_btn:"Resim Yap",world_import_title:"A\xE7",world_import_desc:"Resimden oyun a\xE7.",world_import_btn:"Resim A\xE7",world_back_btn:"Geri",craft_missing:"Malzeme eksik!",craft_done:"Oldu!",msg_import_err:"Bu resim \xE7al\u0131\u015Fm\u0131yor."},ms:{continue_btn:"Sambung",start_btn:"Mula",reset_btn:"Mula Semula",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Anak Panah / A D",inst_jump_pc:"Lompat: Space / W / \u2191",inst_action_pc:"Bina / Pecah: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"Telefon",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Bina / Pecah: Sentuh",inst_climb_mobile:"Panjat: Sentuh orang",inst_gamepad:"Alat Kawalan",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Bina",label_break:"Pecah",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Tukar dunia jadi gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main guna gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barang tak cukup!",craft_done:"Siap!",msg_import_err:"Gambar ini tak boleh guna."}},ht={};Object.assign(ht,St.en);zo="pictoco_language",wr=["ja","en","zh","zh-TW","es","fr","de","it","pt","ko","ru","id","pl","uk","tr","ms"],Qo="en"});function Mt(t,e,n){return Math.max(e,Math.min(n,t))}function se(t,e,n){return t+(e-t)*n}function Rr(t,e){return Math.floor(Math.random()*(e-t+1))+t}function yr(t,e,n,a){return Math.hypot(n-t,a-e)}function Ut(t,e,n){return{tx:Math.floor(t/n),ty:Math.floor(e/n)}}function bo(t,e,n,a){let i=(t%n+n)%n;return(e%a+a)%a*n+i}function Yt(t,e,n,a,i=1){return{x:t/i+n,y:e/i+a}}function le(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function ce(t,e,n,a,i){return yr(t,e,n,a)<=i}function lt(t,e){let n=e[t];return n&&n.solid===!0}function fe(t,e){let n=e[t];return n&&n.transparent===!0}function Et(t,e){let n=e[t];return n&&!n.unbreakable}function Ao(t,e){let n=e[t];return n&&n.drop!==void 0?n.drop:t}function de(t,e){let n=e[t];return n?n.type:void 0}function To(t,e){return e.has(t)}function Ir(t,e,n={}){let a=n.largeAmplitude??12,i=n.smallAmplitude??3,s=n.largeFrequency??30,o=n.smallFrequency??8,r=Math.sin(t/s)*a+Math.sin(t/o)*i;return Math.floor(e+r)}function Mo(t,e,n,a){let i=[],s=[],o=Object.keys(e),r=0,l=[...o];for(let _=l.length-1;_>0;_--){let E=Math.floor(Math.random()*(_+1));[l[_],l[E]]=[l[E],l[_]]}let f=0,d=o.map(_=>{let E=e[_].weight!==void 0?e[_].weight:1;return f+=E,{key:_,threshold:f}}),h=0;for(;h<t;){let _;if(l.length>0)_=l.pop();else{let b=Math.random()*f,S=d.find(C=>b<C.threshold);_=S?S.key:o[0]}let E=Math.min(t-h,Rr(n,a)),A=e[_],T=[];for(let b=0;b<E;b++){let S=h+b;T[b]=Ir(S,A.baseHeight,A.terrain)}if(h>0){let b=i[h-1],S=T[0];if(S!==b){let C=Math.abs(S-b),k=Math.ceil(C*1.5),V=Math.max(8,k);if(S>b){let O=Math.min(V,E);for(let L=0;L<O;L++){let x=(L+1)/O;T[L]=Math.round(se(b,T[L],x))}}else{let O=Math.min(V,h-r),L=i.slice(h-O,h);for(let x=0;x<O;x++){let K=(x+1)/O,W=h-O+x;i[W]=Math.round(se(L[x],S,K))}}}}for(let b=0;b<E;b++){let S=h+b;i[S]=T[b],s[S]=_}h+=E,r=h-E}let u=i[0],m=i[t-1];if(u!==m){let _=Math.abs(u-m),E=Math.ceil(_*1.5),A=Math.max(8,E),T=Math.min(A,Math.floor(t/2));if(m>u)for(let b=0;b<T;b++){let S=t-T+b,C=(b+1)/T;i[S]=Math.round(se(i[S],u,C))}else for(let b=0;b<T;b++){let S=(b+1)/T;i[b]=Math.round(se(m,i[b],S))}}return{heights:i,biomeByColumn:s}}function Fe(t,e,n){return t+(e-t)*n}function he(t,e,n,a,i,s=1){let o=Math.floor(t/i),r=o+Math.ceil(n/s/i)+1,l=Math.floor(e/i),f=l+Math.ceil(a/s/i)+1;return{startX:o,endX:r,startY:l,endY:f}}var Cr=[[0,1],[0,-1],[1,0],[-1,0]];function Eo(t,e,n,a){for(let[i,s]of Cr)if(n(t+i,e+s)!==a)return!0;return!1}function ue(t){if(t.length===0)return new Uint8Array(0);let e=[],n=0;for(;n<t.length;){let a=t[n++],i=t[n++];if(i===0){let s=t[n++],o=t[n++];i=s<<8|o}for(let s=0;s<i;s++)e.push(a)}return new Uint8Array(e)}var Ge=class{constructor(){this.ctx=null,this.ready=!1,this.reverbNode=null,this.isMusicPlaying=!1,this.nextNoteTimeout=null,this.musicGainNode=null,this.sfxGainNode=null,this.musicVolume=.5,this.sfxVolume=.5,this.MAX_MUSIC_GAIN=.2,this.MAX_SFX_GAIN=1,this.scale=[196,220,246.94,261.63,293.66,329.63,392,440,523.25,587.33,659.25,783.99,880]}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{this.startMusic()})),this.ctx.state==="suspended"&&this.ctx.resume()}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN)}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this.ready&&(this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}updateVolumes(){this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN,this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}resume(){if(!this.ctx)return;let e=this.ctx.state;(e==="suspended"||e==="interrupted")&&this.ctx.resume().catch(()=>{}),e==="closed"&&this._recreateContext()}_recreateContext(){let e=this.isMusicPlaying;this.nextNoteTimeout&&(clearTimeout(this.nextNoteTimeout),this.nextNoteTimeout=null),this.ctx=null,this.ready=!1,this.reverbNode=null,this.musicGainNode=null,this.sfxGainNode=null,this.isMusicPlaying=!1,this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{e&&this.startMusic()})}async setupReverb(){if(!this.ctx)return;let e=this.ctx.sampleRate,n=e*3,a=this.ctx.createBuffer(2,n,e),i=a.getChannelData(0),s=a.getChannelData(1);for(let o=0;o<n;o++){let r=Math.pow(1-o/n,2);i[o]=(Math.random()*2-1)*r,s[o]=(Math.random()*2-1)*r}this.reverbNode=this.ctx.createConvolver(),this.reverbNode.buffer=a,this.reverbNode.connect(this.musicGainNode)}startMusic(){this.isMusicPlaying||!this.ready||(this.isMusicPlaying=!0,this.scheduleNextNote())}stopMusic(){this.isMusicPlaying=!1,this.nextNoteTimeout&&clearTimeout(this.nextNoteTimeout)}toggleMusic(){this.isMusicPlaying?this.stopMusic():this.startMusic()}scheduleNextNote(){if(!this.isMusicPlaying)return;this.ctx&&this.ctx.state==="running"&&this.playAmbientNote();let e=2e3+Math.random()*5e3;this.nextNoteTimeout=setTimeout(()=>this.scheduleNextNote(),e)}playAmbientNote(){if(!this.ready||!this.reverbNode)return;let e=this.scale[Math.floor(Math.random()*this.scale.length)],n=this.ctx.createOscillator(),a=this.ctx.createGain(),i=this.ctx.createStereoPanner();n.type=Math.random()>.5?"sine":"triangle",n.frequency.value=e,i.pan.value=Math.random()*2-1,n.connect(a),a.connect(i),i.connect(this.musicGainNode),i.connect(this.reverbNode);let s=this.ctx.currentTime,o=.5+Math.random()*1.5,r=2+Math.random()*2,l=3+Math.random()*2;a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(.1+Math.random()*.1,s+o),a.gain.exponentialRampToValueAtTime(.001,s+o+r+l),n.start(s),n.stop(s+o+r+l+1)}playJump(){if(!this.ready)return;let e=this.ctx.createOscillator(),n=this.ctx.createGain();e.connect(n),n.connect(this.sfxGainNode),e.type="square",e.frequency.setValueAtTime(150,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+.1),n.gain.setValueAtTime(.1,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.start(),e.stop(this.ctx.currentTime+.1)}playBigJump(){if(!this.ready)return;let e=this.ctx.createOscillator(),n=this.ctx.createGain();e.connect(n),n.connect(this.sfxGainNode),e.type="square",e.frequency.setValueAtTime(100,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(500,this.ctx.currentTime+.3),n.gain.setValueAtTime(.1,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.3),e.start(),e.stop(this.ctx.currentTime+.3)}playDig(e){if(!this.ready)return;let n=this.ctx.createBuffer(1,this.ctx.sampleRate*.1,this.ctx.sampleRate),a=n.getChannelData(0);for(let r=0;r<a.length;r++)a[r]=Math.random()*2-1;let i=this.ctx.createBufferSource();i.buffer=n;let s=this.ctx.createGain(),o=this.ctx.createBiquadFilter();e==="stone"?(o.type="highpass",o.frequency.value=800):e==="wood"?(o.type="lowpass",o.frequency.value=600):(o.type="lowpass",o.frequency.value=300),i.connect(o),o.connect(s),s.connect(this.sfxGainNode),s.gain.setValueAtTime(.2,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),i.start()}playPop(){if(!this.ready)return;let e=this.ctx.createOscillator(),n=this.ctx.createGain();e.connect(n),n.connect(this.sfxGainNode),e.frequency.setValueAtTime(600,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(1200,this.ctx.currentTime+.05),n.gain.setValueAtTime(.1,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.05),e.start(),e.stop(this.ctx.currentTime+.05)}playExplosion(){if(!this.ready)return;let e=this.ctx.sampleRate*.5,n=this.ctx.createBuffer(1,e,this.ctx.sampleRate),a=n.getChannelData(0);for(let r=0;r<e;r++)a[r]=Math.random()*2-1;let i=this.ctx.createBufferSource();i.buffer=n;let s=this.ctx.createGain(),o=this.ctx.createBiquadFilter();i.connect(o),o.connect(s),s.connect(this.sfxGainNode),o.type="lowpass",o.frequency.setValueAtTime(1200,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.4),s.gain.setValueAtTime(.5,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.4),i.start()}playCoin(){if(!this.ready)return;let e=this.ctx.createOscillator(),n=this.ctx.createOscillator(),a=this.ctx.createGain();e.type="square",n.type="square",e.frequency.setValueAtTime(880,this.ctx.currentTime),n.frequency.setValueAtTime(1320,this.ctx.currentTime),e.connect(a),n.connect(a),a.connect(this.sfxGainNode),a.gain.setValueAtTime(.12,this.ctx.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.25),e.frequency.exponentialRampToValueAtTime(1760,this.ctx.currentTime+.2),n.frequency.exponentialRampToValueAtTime(1980,this.ctx.currentTime+.2),e.start(),n.start(),e.stop(this.ctx.currentTime+.25),n.stop(this.ctx.currentTime+.25)}},J=new Ge;var Ht=1.3888888888888888,dt=60/720,me=36e4,p=32,ot=512*8,nt=256,Xt=5*p,So=p/2,We=.1,Ke=15,Ro=.015,yo=.6,Io=60,Ve=720,Co=90,wo=.5*dt,Oo=.25,ko=20,pe=10,Ue=18,Po=.1,vo=8,Lo=0,xo=-20;var Bo=new Set([0,1,2,3,4,5,6,7,8,9,10,11,12,20]),Do=2160,No=8,Fo=15,Go=2,Wo=360,_e=15,Ko=3,Vo=4320,Uo=720,Yo=576,Ye=648,He=288,c={AIR:0,DIRT:1,GRASS:2,STONE:3,WOOD:4,LEAVES:5,BEDROCK:6,COAL:7,GOLD:8,WORKBENCH:9,SAND:10,SNOW:11,CLOUD:12,FIREWORK:13,JUMP_PAD:14,TNT:15,SAPLING:16,JACKPOT:17,ACCELERATOR_LEFT:18,ACCELERATOR_RIGHT:19,WATER:20},$={[c.AIR]:{name:"Air",solid:!1,transparent:!0},[c.DIRT]:{name:"Dirt",solid:!0,color:"#5d4037",type:"soil"},[c.GRASS]:{name:"Grass",solid:!0,color:"#388e3c",type:"soil",drop:c.DIRT},[c.STONE]:{name:"Stone",solid:!0,color:"#757575",type:"stone"},[c.WOOD]:{name:"Wood",solid:!0,color:"#5d4037",type:"wood"},[c.LEAVES]:{name:"Leaves",solid:!0,transparent:!1,color:"#2e7d32",type:"plant",drop:c.LEAVES},[c.BEDROCK]:{name:"Bedrock",solid:!0,unbreakable:!0,color:"#000000",type:"stone"},[c.COAL]:{name:"Coal Ore",solid:!0,color:"#212121",type:"stone",drop:c.COAL},[c.GOLD]:{name:"Gold Ore",solid:!0,color:"#ffb300",type:"stone",drop:c.GOLD},[c.WORKBENCH]:{name:"Workbench",solid:!1,unbreakable:!0,transparent:!0,color:"#8d6e63",type:"wood"},[c.SAND]:{name:"Sand",solid:!0,color:"#d7c27a",type:"sand",drop:c.SAND},[c.SNOW]:{name:"Snow",solid:!0,color:"#e0f7fa",type:"snow",drop:c.SNOW},[c.CLOUD]:{name:"Cloud",solid:!0,color:"#ffffff",type:"cloud",drop:c.CLOUD},[c.FIREWORK]:{name:"Firework",solid:!0,color:"#ef5350",type:"wood",drop:c.FIREWORK},[c.JUMP_PAD]:{name:"Jump Pad",solid:!0,color:"#ab47bc",type:"stone",drop:c.JUMP_PAD},[c.TNT]:{name:"TNT",solid:!0,color:"#d32f2f",type:"wood",drop:c.TNT},[c.SAPLING]:{name:"Sapling",solid:!1,transparent:!0,color:"#6fa85b",type:"plant",drop:c.SAPLING},[c.JACKPOT]:{name:"Jackpot",solid:!1,transparent:!0,color:"#ffd54f",type:"stone",drop:c.JACKPOT},[c.ACCELERATOR_LEFT]:{name:"Accelerator Left",solid:!1,transparent:!0,color:"#42a5f5",type:"stone",drop:c.ACCELERATOR_LEFT},[c.ACCELERATOR_RIGHT]:{name:"Accelerator Right",solid:!1,transparent:!0,color:"#66bb6a",type:"stone",drop:c.ACCELERATOR_RIGHT},[c.WATER]:{name:"Water",solid:!1,transparent:!0,color:"#2196f3",type:"water",drop:c.WATER}},mt=[c.DIRT,c.STONE,c.WOOD,c.LEAVES,c.COAL,c.GOLD,c.SAND,c.SNOW,c.CLOUD,c.WATER,c.FIREWORK,c.JUMP_PAD,c.TNT,c.SAPLING,c.JACKPOT,c.ACCELERATOR_LEFT,c.ACCELERATOR_RIGHT];function Ho(){let t=0x9512320b9b5e,e=()=>{let o=t+=1831565813;return o=Math.imul(o^o>>>15,o|1),o^=o+Math.imul(o^o>>>7,o|61),((o^o>>>14)>>>0)/4294967296},n={},a=(o,r)=>{let l=document.createElement("canvas");l.width=p,l.height=p;let f=l.getContext("2d");r(f,p),n[o]=l},i=(o,r=.1)=>{let l=o.getImageData(0,0,p,p),f=l.data;for(let d=0;d<f.length;d+=4){let h=(e()-.5)*r*255;f[d]+=h,f[d+1]+=h,f[d+2]+=h}o.putImageData(l,0,0)};a(c.DIRT,(o,r)=>{o.fillStyle="#5d4037",o.fillRect(0,0,r,r),i(o,.15)}),a(c.GRASS,(o,r)=>{o.fillStyle="#5d4037",o.fillRect(0,0,r,r),i(o,.15),o.fillStyle="#4caf50",o.fillRect(0,0,r,r/3),i(o,.1);for(let l=0;l<r;l+=4)e()>.5&&o.fillRect(l,r/3,4,4)}),a(c.STONE,(o,r)=>{o.fillStyle="#757575",o.fillRect(0,0,r,r),i(o,.2)}),a(c.SAND,(o,r)=>{o.fillStyle="#d7c27a",o.fillRect(0,0,r,r),o.fillStyle="#c2aa63";for(let l=0;l<12;l++)o.fillRect(e()*r,e()*r,3,3);i(o,.12)}),a(c.SNOW,(o,r)=>{let l=o.createLinearGradient(0,0,0,r);l.addColorStop(0,"#ffffff"),l.addColorStop(1,"#d7e4f2"),o.fillStyle=l,o.fillRect(0,0,r,r),o.fillStyle="#b0c4de";for(let f=0;f<8;f++)o.fillRect(e()*r,e()*r,2,2);i(o,.06)}),a(c.WOOD,(o,r)=>{o.fillStyle="#6d4c41",o.fillRect(0,0,r,r),o.fillStyle="#4e342e";for(let l=4;l<r;l+=8)o.fillRect(l,0,2,r);i(o,.1)}),a(c.LEAVES,(o,r)=>{o.fillStyle="#2e7d32",o.fillRect(0,0,r,r),i(o,.2),o.fillStyle="#1b5e20";for(let l=0;l<10;l++)o.fillRect(e()*r,e()*r,4,4)}),a(c.SAPLING,(o,r)=>{o.clearRect(0,0,r,r),o.strokeStyle="#43a047",o.lineWidth=r*.1,o.lineCap="round",o.beginPath(),o.moveTo(r*.5,r*.95),o.quadraticCurveTo(r*.5,r*.7,r*.5,r*.5),o.stroke(),o.fillStyle="#76ff03",o.beginPath(),o.ellipse(r*.35,r*.45,r*.16,r*.08,-.6,0,Math.PI*2),o.fill(),o.beginPath(),o.ellipse(r*.65,r*.35,r*.18,r*.09,.5,0,Math.PI*2),o.fill(),i(o,.05)}),a(c.WATER,(o,r)=>{o.clearRect(0,0,r,r),o.fillStyle="rgba(33, 150, 243, 0.5)",o.fillRect(0,0,r,r),o.strokeStyle="rgba(255, 255, 255, 0.3)",o.lineWidth=2,o.beginPath();for(let l=0;l<3;l++){let f=r*(.3+l*.25);o.moveTo(0,f),o.bezierCurveTo(r*.3,f-4,r*.7,f+4,r,f)}o.stroke(),i(o,.05)}),a(c.BEDROCK,(o,r)=>{o.fillStyle="#212121",o.fillRect(0,0,r,r),i(o,.4)});let s=(o,r)=>(l,f)=>{l.fillStyle=o,l.fillRect(0,0,f,f),i(l,.2),l.fillStyle=r;for(let d=0;d<6;d++)l.fillRect(e()*(f-6),e()*(f-6),6,6)};return a(c.COAL,s("#757575","#000")),a(c.GOLD,s("#757575","#FFD700")),a(c.JACKPOT,(o,r)=>{o.fillStyle="#4e342e",o.fillRect(0,0,r,r),o.fillStyle="#ffd54f",o.fillRect(2,2,r-4,r-4),o.fillStyle="#f9a825";for(let l=0;l<6;l++){let f=6+e()*4,d=6+e()*4;o.fillRect(4+e()*(r-8-f),4+e()*(r-8-d),f,d)}o.strokeStyle="#fff9c4",o.lineWidth=2,o.strokeRect(3,3,r-6,r-6),i(o,.06)}),a(c.WORKBENCH,(o,r)=>{o.fillStyle="#8d6e63",o.fillRect(0,0,r,r),o.fillStyle="#5d4037",o.fillRect(0,0,r,r/3),o.fillStyle="#3e2723",o.fillRect(4,r/3,4,r-r/3),o.fillRect(r-8,r/3,4,r-r/3),o.fillStyle="#bcaaa4",o.fillRect(8,4,16,4),i(o,.1)}),a(c.FIREWORK,(o,r)=>{o.fillStyle="#ef5350",o.fillRect(4,8,r-8,r-8),o.fillStyle="#ffffff",o.fillRect(4,12,r-8,4),o.fillRect(4,20,r-8,4),o.fillStyle="#795548",o.fillRect(r/2-1,0,2,8),i(o,.1)}),a(c.JUMP_PAD,(o,r)=>{let f=r-8;o.fillStyle="#212121",o.fillRect(4,r-4,f,4),o.fillStyle="#616161",o.fillRect(6,10,f-4,r-14),o.fillStyle="#bdbdbd";for(let d=10;d<r-6;d+=4)o.fillRect(6,d,f-4,2);o.fillStyle="#d32f2f",o.fillRect(3,4,f+2,6),o.fillStyle="#ef9a9a",o.fillRect(6,5,f-4,2),i(o,.1)}),a(c.TNT,(o,r)=>{o.fillStyle="#d32f2f",o.fillRect(0,0,r,r),o.fillStyle="#ffffff",o.fillRect(0,r/3,r,r/3),o.fillStyle="#000000",o.fillRect(4,r/3+2,6,2),o.fillRect(6,r/3+2,2,6),o.fillRect(12,r/3+2,2,6),o.fillRect(16,r/3+2,2,6),o.fillRect(12,r/3+2,4,2),o.fillRect(13,r/3+3,2,2),o.fillRect(20,r/3+2,6,2),o.fillRect(22,r/3+2,2,6),o.fillStyle="#757575",o.fillRect(0,0,r,4),o.fillRect(0,r-4,r,4),i(o,.1)}),a(c.CLOUD,(o,r)=>{o.clearRect(0,0,r,r),o.fillStyle="rgba(255, 255, 255, 0.9)",o.beginPath(),o.arc(r*.25,r*.3,r*.22,0,Math.PI*2),o.arc(r*.5,r*.2,r*.25,0,Math.PI*2),o.arc(r*.75,r*.3,r*.22,0,Math.PI*2),o.fill(),o.fillStyle="rgba(255, 255, 255, 0.85)",o.fillRect(0,r*.25,r,r*.5),o.fillStyle="rgba(255, 255, 255, 0.9)",o.beginPath(),o.arc(r*.2,r*.7,r*.2,0,Math.PI*2),o.arc(r*.5,r*.75,r*.22,0,Math.PI*2),o.arc(r*.8,r*.7,r*.2,0,Math.PI*2),o.fill(),o.fillStyle="rgba(200, 220, 240, 0.3)",o.fillRect(0,r*.7,r,r*.3),i(o,.04)}),a(c.ACCELERATOR_LEFT,(o,r)=>{o.clearRect(0,0,r,r),o.fillStyle="rgba(66, 165, 245, 0.7)",o.fillRect(0,0,r,r),o.strokeStyle="#1976d2",o.lineWidth=2,o.strokeRect(1,1,r-2,r-2),o.fillStyle="#ffffff",o.beginPath(),o.moveTo(r*.25,r*.5),o.lineTo(r*.65,r*.2),o.lineTo(r*.65,r*.4),o.lineTo(r*.75,r*.4),o.lineTo(r*.75,r*.6),o.lineTo(r*.65,r*.6),o.lineTo(r*.65,r*.8),o.closePath(),o.fill(),i(o,.05)}),a(c.ACCELERATOR_RIGHT,(o,r)=>{o.clearRect(0,0,r,r),o.fillStyle="rgba(102, 187, 106, 0.7)",o.fillRect(0,0,r,r),o.strokeStyle="#388e3c",o.lineWidth=2,o.strokeRect(1,1,r-2,r-2),o.fillStyle="#ffffff",o.beginPath(),o.moveTo(r*.75,r*.5),o.lineTo(r*.35,r*.2),o.lineTo(r*.35,r*.4),o.lineTo(r*.25,r*.4),o.lineTo(r*.25,r*.6),o.lineTo(r*.35,r*.6),o.lineTo(r*.35,r*.8),o.closePath(),o.fill(),i(o,.05)}),n}var pt={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,BACK:8,START:9,L_STICK:10,R_STICK:11,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15},Xe={LEFT_X:0,LEFT_Y:1,RIGHT_X:2,RIGHT_Y:3},je=.01,Xo=.3;function jo(t,{onHotbarSelect:e,onTouch:n,onClimb:a}){let i={keys:{left:!1,right:!1,jump:!1},mouse:{x:0,y:0,leftDown:!1,active:!1},gamepad:{connected:!1,cursorX:0,cursorY:0,cursorActive:!1,breakAction:!1,placeAction:!1,prevButtons:{}}},s=0,o=null,r=()=>{let A=document.getElementById("mobile-controls");A&&(A.style.display="none"),window.removeEventListener("keydown",r)};window.addEventListener("keydown",r),window.addEventListener("keydown",A=>{switch(A.code){case"KeyA":case"ArrowLeft":i.keys.left=!0,A.preventDefault();break;case"KeyD":case"ArrowRight":i.keys.right=!0,A.preventDefault();break;case"KeyW":case"ArrowUp":case"Space":i.keys.jump=!0,A.preventDefault();break;case"Digit1":e&&e(0);break;case"Digit2":e&&e(1);break;case"Digit3":e&&e(2);break;case"Digit4":e&&e(3);break;case"Digit5":e&&e(4);break;case"Digit6":e&&e(5);break;case"Digit7":e&&e(6);break;case"Digit8":e&&e(7);break;case"Digit9":e&&e(8);break;case"KeyS":case"ArrowDown":a&&a();break}}),window.addEventListener("keyup",A=>{switch(A.code){case"KeyA":case"ArrowLeft":i.keys.left=!1;break;case"KeyD":case"ArrowRight":i.keys.right=!1;break;case"KeyW":case"ArrowUp":case"Space":i.keys.jump=!1;break}}),window.addEventListener("mousemove",A=>{let T=t.getBoundingClientRect();i.mouse.x=A.clientX-T.left,i.mouse.y=A.clientY-T.top,Date.now()-s>500&&(i.mouse.active=!0)}),window.addEventListener("mousedown",A=>{A.target===t&&(i.mouse.leftDown=!0)}),window.addEventListener("mouseup",()=>{i.mouse.leftDown=!1}),window.addEventListener("touchstart",()=>{i.mouse.active=!1,s=Date.now()},{passive:!0});let l=(A,T)=>{let b=document.getElementById(A);b&&(b.addEventListener("touchstart",S=>{S.preventDefault(),i.keys[T]=!0,i.mouse.active=!1,s=Date.now()}),b.addEventListener("touchend",S=>{S.preventDefault(),i.keys[T]=!1}))};l("btn-left","left"),l("btn-right","right"),l("btn-jump","jump"),t.addEventListener("touchstart",A=>{A.cancelable&&A.preventDefault();let T=A.touches[0],b=t.getBoundingClientRect();i.mouse.active=!1,s=Date.now(),n&&n(T.clientX-b.left,T.clientY-b.top)},{passive:!1});function f(A){return Math.abs(A)<je?0:Math.sign(A)*(Math.abs(A)-je)/(1-je)}function d(A,T){let b=A[T]&&A[T].pressed,S=i.gamepad.prevButtons[T];return b&&!S}window.addEventListener("gamepadconnected",A=>{if(A.gamepad.mapping!=="standard")return;o=A.gamepad.index,i.gamepad.connected=!0,i.gamepad.cursorActive=!0;let T=t.getBoundingClientRect();i.gamepad.cursorX=T.width/2,i.gamepad.cursorY=T.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none")}),window.addEventListener("gamepaddisconnected",A=>{A.gamepad.index===o&&(o=null,i.gamepad.connected=!1,i.gamepad.cursorActive=!1)});let h=navigator.getGamepads();for(let A of h)if(A&&A.connected&&A.mapping==="standard"){o=A.index,i.gamepad.connected=!0,i.gamepad.cursorActive=!0;let T=t.getBoundingClientRect();i.gamepad.cursorX=T.width/2,i.gamepad.cursorY=T.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none");break}let u=0,m=null,_=null;function E({screenWidth:A,screenHeight:T,playerScreenX:b,playerScreenY:S,reach:C,skipJump:k}){if(o===null)return;let O=navigator.getGamepads()[o];if(!O)return;let{axes:L,buttons:x}=O,K=f(L[Xe.LEFT_X]||0);if(i.keys.left=K<-.3,i.keys.right=K>.3,i.gamepad.axisLeftX=K,!k&&x[pt.A]&&(i.keys.jump=x[pt.A].pressed),d(x,pt.X)&&a&&a(),m!==null&&_!==null){let B=b-m,M=S-_;i.gamepad.cursorX+=B,i.gamepad.cursorY+=M}m=b,_=S;let W=f(L[Xe.RIGHT_X]||0),F=f(L[Xe.RIGHT_Y]||0);if((W!==0||F!==0)&&(i.gamepad.cursorX+=W*Xo,i.gamepad.cursorY+=F*Xo,i.gamepad.cursorActive=!0),C!==void 0&&b!==void 0&&S!==void 0){let B=i.gamepad.cursorX-b,M=i.gamepad.cursorY-S,y=Math.sqrt(B*B+M*M);if(y>C){let D=C/y;i.gamepad.cursorX=b+B*D,i.gamepad.cursorY=S+M*D}}else i.gamepad.cursorX=Math.max(0,Math.min(A,i.gamepad.cursorX)),i.gamepad.cursorY=Math.max(0,Math.min(T,i.gamepad.cursorY));x[pt.RT]&&(i.gamepad.breakAction=x[pt.RT].pressed&&x[pt.RT].value>.5),x[pt.LT]&&(i.gamepad.placeAction=x[pt.LT].pressed&&x[pt.LT].value>.5);let w=mt.length;d(x,pt.LB)&&(u=(u-1+w)%w,e&&e(u)),d(x,pt.RB)&&(u=(u+1)%w,e&&e(u));for(let B=0;B<x.length;B++)i.gamepad.prevButtons[B]=x[B]&&x[B].pressed}return i.pollGamepads=E,i}var it={};mt.forEach(t=>it[t]=0);var Dt=0;function Jo(){return mt[Dt]}function qo(){let t={};return mt.forEach(e=>{t[e]=it[e]||0}),{counts:t,selectedIndex:Dt}}function qe(t){if(!t||!t.counts)return;mt.forEach(n=>{it[n]=t.counts[n]??0});let e=t.selectedIndex??0;Dt=Math.min(Math.max(0,e),mt.length-1),vt(),jt(Dt,{playSound:!1})}function vt(){mt.forEach((t,e)=>{let n=document.getElementById(`slot-count-${e}`);if(n){n.innerText=it[t];let a=document.getElementById(`slot-${e}`);a&&(a.style.opacity=it[t]>0?"1":"0.5")}})}function ge(t){if(t===c.AIR)return;let e=Ao(t,$);it[e]!==void 0&&(it[e]++,vt())}function Zo(t){return it[t]>0?(it[t]--,vt(),!0):!1}function Je(){let t=document.getElementById("hotbar"),e=document.getElementById("hotbar-scroll-left"),n=document.getElementById("hotbar-scroll-right");if(!t||!e||!n)return;let a=t.scrollLeft>0,i=t.scrollLeft<t.scrollWidth-t.clientWidth-1;e.classList.toggle("visible",a),n.classList.toggle("visible",i)}function $o(t){let e=document.getElementById("hotbar");e.innerHTML="",mt.forEach((n,a)=>{let i=document.createElement("div");i.className="slot"+(a===0?" active":""),i.id=`slot-${a}`,i.onclick=()=>jt(a);let s=document.createElement("canvas");s.width=32,s.height=32;let o=s.getContext("2d");t&&t[n]&&o.drawImage(t[n],0,0,32,32);let r=document.createElement("div");r.className="count",r.id=`slot-count-${a}`,r.innerText="0",i.appendChild(s),i.appendChild(r),e.appendChild(i)}),jt(Dt,{playSound:!1}),e.addEventListener("scroll",Je),window.addEventListener("resize",Je),setTimeout(Je,0)}function jt(t,{playSound:e=!0}={}){if(t<0||t>=mt.length)return;let n=document.querySelectorAll(".slot");n.forEach(a=>a.classList.remove("active")),n[t]&&n[t].classList.add("active"),Dt=t,e&&J.playPop()}Jt();var Ae=[{id:c.FIREWORK,cost:{[c.WOOD]:2},count:1},{id:c.JUMP_PAD,cost:{[c.STONE]:2,[c.LEAVES]:2},count:1},{id:c.TNT,cost:{[c.COAL]:3,[c.WOOD]:2},count:1},{id:c.SAPLING,cost:{[c.WOOD]:1,[c.LEAVES]:1},count:1},{id:c.JACKPOT,cost:{[c.GOLD]:3},count:1},{id:c.ACCELERATOR_LEFT,cost:{[c.GOLD]:1,[c.SAND]:1},count:1},{id:c.ACCELERATOR_RIGHT,cost:{[c.GOLD]:1,[c.SAND]:1},count:1}],_t=!1,Rt=0;var on=!1,nn=!1,rn=!1,an=!1,be=0,ze=!1,sn=0,ln=1,cn=12,fn=13;function hn(){if(!_t)return;let t=navigator.getGamepads(),e=null;for(let r of t)if(r&&r.connected){e=r;break}if(!e)return;let{buttons:n}=e,a=n[cn]&&n[cn].pressed;a&&!on&&(Rt=Math.max(0,Rt-1),Qe()),on=a;let i=n[fn]&&n[fn].pressed;i&&!nn&&(Rt=Math.min(Ae.length-1,Rt+1),Qe()),nn=i;let s=n[sn]&&n[sn].pressed;if(s){if(!rn){let r=Ae[Rt];r&&to(r)}if(be++,be>=Ve&&(be-Ve)%Co===0){let l=Ae[Rt];l&&to(l)}}else be=0;rn=s;let o=n[ln]&&n[ln].pressed;o&&!an&&qt(!0),an=o}function Qe(){let t=document.getElementById("craft-list");if(!t)return;t.querySelectorAll(".craft-item").forEach((n,a)=>{a===Rt?(n.classList.add("gamepad-selected"),n.scrollIntoView({block:"nearest",behavior:"smooth"})):n.classList.remove("gamepad-selected")})}function kr(t,e){let n=t.x,a=t.y,i=t.width,s=t.height,o=Math.floor(n/p),r=Math.floor((n+i)/p),l=Math.floor(a/p),f=Math.floor((a+s)/p),d=!1;for(let h=l;h<=f;h++)for(let u=o;u<=r;u++)if(e.getBlock(u,h)===c.WORKBENCH){d=!0;break}return d}function un(t,e,n){kr(t,e)?!_t&&!ze&&Pr(n):(_t&&qt(!1),ze=!1)}function Pr(t){_t=!0,Rt=0;let e=document.getElementById("crafting-modal"),n=document.getElementById("craft-list"),a=document.getElementById("crafting-status");a&&(a.innerText=""),n.innerHTML="",Ae.forEach(i=>{let s=document.createElement("div");s.className="craft-item",s.onclick=()=>to(i);let o=document.createElement("div");o.className="craft-inputs";let r=document.createElement("div");r.className="craft-cost-icons";for(let[h,u]of Object.entries(i.cost)){let m=document.createElement("div");m.className="craft-cost-item";let _=dn(h,32,t);_.classList.add("craft-icon");let E=document.createElement("span");E.className="craft-cost-count",E.innerText=`\xD7${u}`,m.appendChild(_),m.appendChild(E),r.appendChild(m)}o.appendChild(r);let l=document.createElement("div");l.className="craft-outputs";let f=document.createElement("div");f.className="craft-arrow",f.innerText="\u279C";let d=dn(i.id,48,t);d.classList.add("craft-icon-output"),l.appendChild(f),l.appendChild(d),s.appendChild(o),s.appendChild(l),n.appendChild(s)}),e.style.display="block",Qe()}function qt(t=!1){_t=!1,document.getElementById("crafting-modal").style.display="none",t&&(ze=!0)}function to(t){for(let[n,a]of Object.entries(t.cost))if((it[n]||0)<a){let i=document.getElementById("crafting-status");i&&(i.innerText=ht.craft_missing);return}for(let[n,a]of Object.entries(t.cost))it[n]-=a;it[t.id]||(it[t.id]=0),it[t.id]+=t.count,vt(),J.playPop();let e=document.getElementById("crafting-status");e&&(e.innerText=ht.craft_done)}function dn(t,e,n){let a=document.createElement("canvas");a.width=e,a.height=e;let i=a.getContext("2d");return n&&n[t]&&i.drawImage(n[t],0,0,e,e),a}var Lt=8e3,P={x:new Float32Array(Lt),y:new Float32Array(Lt),vx:new Float32Array(Lt),vy:new Float32Array(Lt),life:new Float32Array(Lt),hue:new Uint16Array(Lt),count:0},eo=361,oo=362,vr=35e-5,Lr=-.33,xr=-.15,mn=0,pn=0,_n=0,gn=0,Te=50;function bn(t){let e=P.count-1;t!==e&&(P.x[t]=P.x[e],P.y[t]=P.y[e],P.vx[t]=P.vx[e],P.vy[t]=P.vy[e],P.life[t]=P.life[e],P.hue[t]=P.hue[e]),P.count--}function Me(t,e,n,a,i,s){if(P.count>=Lt)return;let o=P.count;P.x[o]=t,P.y[o]=e,P.vx[o]=n,P.vy[o]=a,P.life[o]=i,P.hue[o]=s,P.count++}function Br(t,e){let n=e-10*p;Me(t,e,0,Lr,-n,eo)}function Dr(t,e){let n=Math.floor(Math.random()*360);no(t,e,n)}function An(t,e,n=p*2){let a=(Math.random()-.5)*.05,i=xr*(.8+Math.random()*.4),s=Math.abs(i),o=20+Math.random()*40,r=Math.max(50,n/s+o);Me(t,e,a,i,r,oo)}function Tn(t,e){for(let a=0;a<20;a++){let i=-Math.PI/2+(Math.random()-.5)*1.5,s=Math.random()*.15+.05,o=Math.cos(i)*s,r=Math.sin(i)*s,l=300+Math.random()*200;Me(t,e,o,r,l,195)}}function no(t,e,n){let a;if(typeof n=="string"){let i=n.match(/hsl\((\d+)/);a=i?parseInt(i[1],10):Math.floor(Math.random()*360)}else typeof n=="number"?a=n:a=35;for(let i=0;i<100;i++){let s=Math.random()*Math.PI*2,o=Math.random()*.17+.08,r=720+Math.random()*720;Me(t,e,Math.cos(s)*o,Math.sin(s)*o,r,a)}}function Mn(t,e,n,a){if(t.fireworkTimer||(t.fireworkTimer=0),t.fireworkTimer++,t.fireworkTimer>3600){t.fireworkTimer=0;let s=he(e,n,a.width,a.height,p);for(let o=s.startY-10;o<s.endY+10;o++)for(let r=s.startX-10;r<s.endX+10;r++)t.getBlock(r,o)===c.FIREWORK&&Br(r*p+p/2,o*p+p/2)}let i=0;for(;i<P.count;){let s=P.life[i],o=P.hue[i];if(o===eo){P.y[i]+=P.vy[i];let r=-s;if(P.y[i]<=r){let l=P.x[i],f=P.y[i];bn(i),Dr(l,f);continue}}else if(P.x[i]+=P.vx[i],P.y[i]+=P.vy[i],o!==oo&&(P.vy[i]+=vr),P.life[i]--,P.life[i]<=0){bn(i);continue}i++}}function En(t,e,n,a,i){if(P.count===0)return;mn=e-Te,pn=e+a+Te,_n=n-Te,gn=n+i+Te;let s=new Map;for(let o=0;o<P.count;o++){let r=P.x[o],l=P.y[o];if(r<mn||r>pn||l<_n||l>gn)continue;let f=P.hue[o];s.has(f)||s.set(f,[]),s.get(f).push(o)}for(let[o,r]of s)if(o===eo){t.fillStyle="#ffffff";for(let l of r)t.fillRect(P.x[l]-2,P.y[l]-2,4,8)}else if(o===oo){t.fillStyle="rgba(200, 240, 255, 0.6)";for(let l of r)t.fillRect(P.x[l],P.y[l],3,3)}else{t.fillStyle=`hsl(${o}, 100%, 50%)`;for(let l of r)t.fillRect(P.x[l],P.y[l],4,4)}}var bt=500,v={x:new Float32Array(bt),y:new Float32Array(bt),vx:new Float32Array(bt),vy:new Float32Array(bt),life:new Uint16Array(bt),r:new Uint8Array(bt),g:new Uint8Array(bt),b:new Uint8Array(bt),count:0},Nr=.008,Sn=.995,wn=360,Fr=8,Rn=0,yn=0,In=0,Cn=0,Ee=50,Se=null,io=new Map;function On(t){Se=t}function Gr(t){if(io.has(t))return io.get(t);if(!Se||!Se[t])return null;let a=Se[t].getContext("2d").getImageData(0,0,p,p);return io.set(t,a),a}function Wr(t){let e=Gr(t);if(!e)return{r:128,g:128,b:128};let n=Math.floor(Math.random()*p),i=(Math.floor(Math.random()*p)*p+n)*4;return{r:e.data[i],g:e.data[i+1],b:e.data[i+2]}}function Kr(t){let e=v.count-1;t!==e&&(v.x[t]=v.x[e],v.y[t]=v.y[e],v.vx[t]=v.vx[e],v.vy[t]=v.vy[e],v.life[t]=v.life[e],v.r[t]=v.r[e],v.g[t]=v.g[e],v.b[t]=v.b[e]),v.count--}function Vr(t,e,n,a,i,s,o,r){if(v.count>=bt)return;let l=v.count;v.x[l]=t,v.y[l]=e,v.vx[l]=n,v.vy[l]=a,v.life[l]=i,v.r[l]=s,v.g[l]=o,v.b[l]=r,v.count++}function Re(t,e,n){let a=t*p+p/2,i=e*p+p/2;for(let s=0;s<Fr;s++){let o=Wr(n),r=Math.random()*Math.PI*2,l=.4+Math.random()*.4,f=Math.cos(r)*l,d=Math.sin(r)*l,h=(Math.random()-.5)*p*.5,u=(Math.random()-.5)*p*.5,m=wn+Math.floor(Math.random()*120)-60;Vr(a+h,i+u,f,d,m,o.r,o.g,o.b)}}function kn(){let t=0;for(;t<v.count;){if(v.x[t]+=v.vx[t],v.y[t]+=v.vy[t],v.vy[t]+=Nr,v.vx[t]*=Sn,v.vy[t]*=Sn,v.life[t]--,v.life[t]<=0){Kr(t);continue}t++}}function Pn(t,e,n,a,i){if(v.count===0)return;Rn=e-Ee,yn=e+a+Ee,In=n-Ee,Cn=n+i+Ee;let s=new Map;for(let o=0;o<v.count;o++){let r=v.x[o],l=v.y[o];if(r<Rn||r>yn||l<In||l>Cn)continue;let f=v.r[o]<<16|v.g[o]<<8|v.b[o];s.has(f)||s.set(f,[]),s.get(f).push(o)}for(let[o,r]of s){let l=o>>16&255,f=o>>8&255,d=o&255;t.fillStyle=`rgb(${l}, ${f}, ${d})`;for(let h of r){let u=v.life[h]/wn;t.globalAlpha=u*.9+.1,t.fillRect(Math.floor(v.x[h])-2,Math.floor(v.y[h])-2,4,4)}}t.globalAlpha=1}function vn({world:t,player:e,inventory:n,camera:a,sounds:i,constants:s,utils:o,onBlockPlaced:r}){let{TILE_SIZE:l,BLOCKS:f,BLOCK_PROPS:d,REACH:h}=s,{screenToWorld:u,worldToTile:m,isWithinReach:_,isBlockBreakable:E,isBlockTransparent:A,isBlockSolid:T,getBlockMaterialType:b,rectsIntersect:S}=o;function C(L,x,K){let W=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(let{dx:F,dy:w}of W){let B=t.getBlock(L+F,x+w);if(B!==f.AIR&&(B!==f.WATER||K===f.WATER))return!0}return!1}function k(){let L=e.getCenterX(),x=Math.floor(L/l),K=Math.floor((e.y+e.height-.01)/l),W=Math.floor((e.y+e.height+.1)/l),F=Math.floor(e.x/l),w=Math.floor((e.x+e.width-.01)/l),B=x,M=t.getBlock(x,W);if(!T(M,d)){let g=t.getBlock(F,W),R=t.getBlock(w,W);T(g,d)?B=F:T(R,d)&&(B=w)}let y=t.getBlock(B,K),D=A(y,d)&&(y===f.AIR||E(y,d)),G=K*l-e.height,Z=t.checkAreaFree(e.x,G,e.width,e.height);if(D&&Z){let g=n.getSelectedBlockId();if(y===g)return!1;if(g===f.CLOUD||C(B,K,g)){if(n.consumeFromInventory(g))return y!==f.AIR&&n.addToInventory(y),t.setBlock(B,K,g),i.playDig("dirt"),r&&r(B,K,g),A(g,d)||(e.y=G-.1,e.vy=0,e.grounded=!0),!0;i.playPop()}}return!1}function V(){k()}function O(L,x,K){let W=u(L,x,a.x,a.y,a.zoom),{tx:F,ty:w}=m(W.x,W.y,l);if(!_(W.x,W.y,e.getCenterX(),e.getCenterY(),h))return;let B=e.getCenterX(),M=Math.floor(B/l),y=Math.floor(e.y/l),D=F===M&&w===y,G=F===M&&w===y+1,Z=W.y%l<l/2,g=G&&Z,R=B-16,U=e.y-4,Q=W.x>=R&&W.x<R+32&&W.y>=U&&W.y<U+48;if((D||g||Q)&&!K){k();return}let j=t.getBlock(F,w);if(K!=="place"&&j!==f.AIR&&E(j,d))return n.addToInventory(j),i.playDig(b(j,d)),Re(F,w,j),t.setBlock(F,w,f.AIR),!0;if(K!=="break"&&(j===f.AIR||A(j,d))&&j!==f.WORKBENCH){let ut=e.getRect(),ct={x:F*l,y:w*l,w:l,h:l};if(!S(ut,ct)){let gt=n.getSelectedBlockId();if(j===gt)return;(gt===f.CLOUD||C(F,w,gt))&&(n.consumeFromInventory(gt)?(j!==f.AIR&&n.addToInventory(j),t.setBlock(F,w,gt),i.playDig("dirt"),r&&r(F,w,gt)):K!=="place"&&i.playPop())}}}return{handlePointer:O,triggerClimb:V}}var I={PLAINS:"plains",DESERT:"desert",SNOWFIELD:"snowfield",MOUNTAIN:"mountain",FOREST:"forest",WASTELAND:"wasteland",DEEP_FOREST:"deep_forest",SAVANNA:"savanna",PLATEAU:"plateau",OCEAN:"ocean",SWAMP:"swamp"};function Ln(t){let e=t/2;return{[I.PLAINS]:{weight:20,baseHeight:e,terrain:{largeAmplitude:10,smallAmplitude:3,largeFrequency:32,smallFrequency:9}},[I.FOREST]:{weight:20,baseHeight:e+2,terrain:{largeAmplitude:12,smallAmplitude:2,largeFrequency:30,smallFrequency:10}},[I.DESERT]:{weight:15,baseHeight:e+8,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:36,smallFrequency:12}},[I.SNOWFIELD]:{weight:15,baseHeight:e-4,terrain:{largeAmplitude:10,smallAmplitude:4,largeFrequency:28,smallFrequency:10}},[I.MOUNTAIN]:{weight:10,baseHeight:e-18,terrain:{largeAmplitude:20,smallAmplitude:6,largeFrequency:35,smallFrequency:9}},[I.WASTELAND]:{weight:5,baseHeight:e-5,terrain:{largeAmplitude:8,smallAmplitude:5,largeFrequency:40,smallFrequency:5}},[I.DEEP_FOREST]:{weight:10,baseHeight:e+5,terrain:{largeAmplitude:15,smallAmplitude:4,largeFrequency:25,smallFrequency:8}},[I.SAVANNA]:{weight:15,baseHeight:e,terrain:{largeAmplitude:5,smallAmplitude:1,largeFrequency:50,smallFrequency:15}},[I.PLATEAU]:{weight:10,baseHeight:e-10,terrain:{largeAmplitude:25,smallAmplitude:2,largeFrequency:60,smallFrequency:5}},[I.OCEAN]:{weight:12,baseHeight:e+25,terrain:{largeAmplitude:15,smallAmplitude:5,largeFrequency:45,smallFrequency:10}},[I.SWAMP]:{weight:5,baseHeight:e+2,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:40,smallFrequency:8}}}}function xn(t,e,n,a){let i=a/2-14;return t===I.DESERT?c.SAND:t===I.SNOWFIELD?c.SNOW:t===I.WASTELAND?c.STONE:t===I.OCEAN?c.SAND:t===I.MOUNTAIN?e<i?c.SNOW:e>a/2-6?c.GRASS:c.STONE:t===I.SAVANNA?n%7<3||Math.random()<.2?c.DIRT:c.GRASS:t===I.PLATEAU?e%4===0?c.SAND:c.STONE:t===I.SWAMP?Math.random()<.3?c.DIRT:c.GRASS:c.GRASS}function Bn(t,e,n){let a=e<=n+4;return t===I.DESERT?a?c.SAND:c.STONE:t===I.OCEAN?c.SAND:t===I.MOUNTAIN||t===I.WASTELAND||t===I.PLATEAU?c.STONE:c.DIRT}function Dn(t,e,n){let i=-80;for(let s=20;s<e-20;s++){if(s-i<80)continue;let o=Math.random(),r=t[s];if(o<.003){let l=25+Math.floor(Math.random()*20);Ur(t,s,l,e,n),i=s+l}else if(o<.0045){let l=30+Math.floor(Math.random()*20);r>50&&(Yr(t,s,l,e),i=s+l)}else if(o>.995){let l=20+Math.floor(Math.random()*25);Hr(t,s,l,e),i=s+l}else if(o>.985){let l=40+Math.floor(Math.random()*30);Xr(t,s,l,e),i=s+l}}}function Ur(t,e,n,a,i){let s=25+Math.floor(Math.random()*20),o=Math.floor(n/2);for(let r=-o;r<=o;r++){let l=e+r,f=(l%a+a)%a,d=Math.abs(r)/o,h=Math.pow(Math.cos(d*Math.PI/2),.5),u=Math.floor(h*4)/4,m=h*.3+u*.7,_=Math.sin(l*.5)*2,E=Math.floor(s*m)+_,A=t[f];t[f]=Math.min(i-5,A+E)}jr(t,e-o,e+o,a)}function Yr(t,e,n,a){let i=30+Math.floor(Math.random()*15),s=Math.floor(n/2),o=n*.25;for(let r=-s;r<=s;r++){let f=((e+r)%a+a)%a,d=Math.abs(r),h=Math.exp(-Math.pow(d/(n*.35),2));if(d<o){let m=Math.pow((o-d)/o,2);h-=m*1.5}let u=Math.floor(i*h);t[f]=Math.max(10,t[f]-u)}}function Hr(t,e,n,a){let i=15+Math.floor(Math.random()*15),s=Math.floor(n/2);for(let o=-s;o<=s;o++){let l=((e+o)%a+a)%a,f=Math.abs(o)/s,d=0;if(f<.6)d=1+Math.random()*.1;else{let h=(1-f)/.4;d=h*h}t[l]=Math.max(10,t[l]-Math.floor(i*d))}}function Xr(t,e,n,a){let i=Math.floor(n/2);for(let s=-i;s<=i;s++){let r=((e+s)%a+a)%a,l=s/n*Math.PI*4,f=Math.sin(l)*6,d=Math.abs(s)/i,h=1-Math.pow(d,3);t[r]-=Math.floor(f*h)}}function jr(t,e,n,a){for(let i=e;i<=n;i++){let s=((i-1)%a+a)%a,o=(i%a+a)%a,r=((i+1)%a+a)%a,l=t[s],f=t[o],d=t[r];Math.abs(l-f)>3&&Math.abs(d-f)>3&&(t[o]=Math.floor((l+f+d)/3))}}function Nn(t,e){for(let n=0;n<t.width;n++){let a=(n-1+t.width)%t.width,i=(n+1)%t.width,s=e[n],o=e[a],r=e[i];if(s>o+2)for(let l=o+1;l<=s;l++)t.getBlock(a,l)===c.DIRT&&t.setBlock(a,l,c.STONE);if(s>r+2)for(let l=r+1;l<=s;l++)t.getBlock(i,l)===c.DIRT&&t.setBlock(i,l,c.STONE)}}function Fn(t){for(let n=0;n<12;n++){let a=0,i=n%2===0,s=i?0:t.width-1,o=i?t.width:-1,r=i?1:-1;for(let l=0;l<t.height-1;l++)for(let f=s;f!==o;f+=r)if(t.getBlock(f,l)===c.WATER){if(t.getBlock(f,l+1)===c.AIR){t.setBlock(f,l+1,c.WATER),t.setBlock(f,l,c.AIR),a++;continue}let d=(f-1+t.width)%t.width,h=(f+1)%t.width,u=l+1,m=t.getBlock(d,l)===c.AIR&&t.getBlock(d,u)===c.AIR,_=t.getBlock(h,l)===c.AIR&&t.getBlock(h,u)===c.AIR;if(m||_){let T=(m&&_?Math.random()<.5:m)?d:h;t.setBlock(T,u,c.WATER),t.setBlock(f,l,c.AIR),a++;continue}let E=t.getBlock(f,l+1);if(E===c.WATER||lt(E,$)){let A=t.getBlock(d,l)===c.AIR,T=t.getBlock(h,l)===c.AIR;if(A||T){let b;if(A&&T){let C=(f-2+t.width)%t.width,k=(f+2)%t.width,V=t.getBlock(C,l),O=t.getBlock(k,l),L=V===c.WATER||lt(V,$),x=O===c.WATER||lt(O,$);L&&!x?b=!0:!L&&x?b=!1:b=Math.random()<.5}else b=A;let S=b?d:h;t.setBlock(S,l,c.WATER),t.setBlock(f,l,c.AIR),a++}}}if(a===0)break}}function Gn(t,e,n){for(let i=0;i<t.width;i++)if(e[i]===I.OCEAN){let s=!1;for(let r=-5;r<=5;r++){let l=(i+r+t.width)%t.width;if(e[l]!==I.OCEAN){s=!0;break}}if(s)continue;let o=n+1;for(let r=o;r<t.height;r++){let l=t.getBlock(i,r);if(l===c.AIR)t.setBlock(i,r,c.WATER);else if(lt(l,$)||l===c.WATER)break}}}function ye(t,e,n,a,i){let s=i*i,o=Math.ceil(i);for(let r=-o;r<=o;r++)for(let l=-o;l<=o;l++)if(r*r+l*l<=s){let f=e+r,d=n+l,h=t.get(f,d);(h===c.STONE||h===c.DIRT)&&t.set(f,d,a)}}function Zt(t,e,n,a){for(let i=-a;i<=a;i++)for(let s=0;s<=a/2;s++)i*i+s*s*4<=a*a&&t.set(e+i,n+s,c.WATER)}function Wn(t,e,n){let a=2+Math.floor(Math.random()*3);for(let i=-a;i<=a;i++)for(let s=-a;s<=a;s++)if(i*i+s*s<=a*a){let o=e+i,r=n+s;r<t.height-1&&t.set(o,r,c.AIR)}}function xt(t,e,n){let a=3+Math.floor(Math.random()*3);for(let i=0;i<a;i++)t.set(e,n-i,c.WOOD);for(let i=e-2;i<=e+2;i++)for(let s=n-a-2;s<=n-a;s++)Math.abs(i-e)===2&&Math.abs(s-(n-a))===2||t.get(i,s)===c.AIR&&t.set(i,s,c.LEAVES)}function Kn(t,e,n){let a=5+Math.floor(Math.random()*4);for(let s=0;s<a;s++)t.set(e,n-s,c.WOOD);let i=1;for(let s=a;s>1;s--){let o=n-s;(a-s)%2===0&&(i=Math.min(3,i+1)),s===a&&(i=1);for(let r=e-i;r<=e+i;r++)r===e&&s!==a||t.get(r,o)===c.AIR&&t.set(r,o,c.LEAVES)}t.set(e,n-a,c.LEAVES)}function Vn(t,e,n){let a=2+Math.floor(Math.random()*3);for(let i=0;i<a;i++)t.set(e,n-i,c.LEAVES);if(a>=3&&Math.random()<.5){let i=Math.random()<.5?-1:1,s=1+Math.floor(Math.random()*(a-2));t.get(e+i,n-s)===c.AIR&&(t.set(e+i,n-s,c.LEAVES),t.get(e+i,n-s-1)===c.AIR&&t.set(e+i,n-s-1,c.LEAVES))}}function Ie(t,e,n){let a=3+Math.floor(Math.random()*3),i=e;for(let s=0;s<a;s++)t.set(i,n-s,c.WOOD),s>1&&Math.random()<.3&&(i+=Math.random()<.5?-1:1);if(Math.random()<.5){let s=n-Math.floor(a/2),o=Math.random()<.5?-1:1;t.get(i+o,s)===c.AIR&&t.set(i+o,s,c.WOOD)}}function Ce(t,e,n){let a=8+Math.floor(Math.random()*5);for(let s=0;s<a;s++)if(t.set(e,n-s,c.WOOD),Math.random()<.3){let o=Math.random()<.5?-1:1;t.get(e+o,n-s)===c.AIR&&t.set(e+o,n-s,c.LEAVES)}let i=3;for(let s=0;s<3;s++)for(let o=-i;o<=i;o++)Math.abs(o)+s<4&&t.set(e+o,n-a+1-s,c.LEAVES)}function Un(t,e,n){let a=4+Math.floor(Math.random()*2),i=e;for(let o=0;o<Math.floor(a/2);o++)t.set(i,n-o,c.WOOD);let s=Math.random()<.5?1:-1;for(let o=Math.floor(a/2);o<a;o++)i+=s,t.set(i,n-o,c.WOOD);for(let o=-2;o<=2;o++)t.set(i+o,n-a,c.LEAVES);for(let o=-1;o<=1;o++)t.set(i+o,n-a-1,c.LEAVES)}function Yn(t,e,n){let a=6+Math.floor(Math.random()*4);for(let s=0;s<a;s++)t.set(e,n-s,c.WOOD);let i=3;for(let s=0;s<=2;s++)for(let o=-i;o<=i;o++)if(Math.abs(o)+s<5){let r=n-a+1-s;if(t.get(e+o,r)===c.AIR&&t.set(e+o,r,c.LEAVES),Math.abs(o)>=2&&Math.random()<.6){let l=1+Math.floor(Math.random()*3);for(let f=1;f<=l;f++)t.get(e+o,r+f)===c.AIR&&t.set(e+o,r+f,c.LEAVES)}}}function yt(t,e,n){t.set(e,n,c.LEAVES),Math.random()<.5&&t.get(e+1,n)===c.AIR&&t.set(e+1,n,c.LEAVES),Math.random()<.3&&t.get(e,n-1)===c.AIR&&t.set(e,n-1,c.LEAVES)}function ro(t,e,n){t.set(e,n,c.STONE),Math.random()<.7&&t.set(e+1,n,c.STONE),Math.random()<.5&&t.set(e,n-1,c.STONE)}function Hn(t,e,n){let a=3+Math.floor(Math.random()*2),i=a+2;for(let o=-i;o<=i;o++){let r=Math.abs(o);for(let l=-1;l<=3;l++){let f=e+o,d=n+l;r<=a?l>0&&t.set(f,d,c.SAND):l===0?t.set(f,d,c.GRASS):l>0&&t.set(f,d,c.DIRT)}}for(let o=-a;o<=a;o++){let r=Math.abs(o)<a-1?1:0;for(let l=0;l<=r;l++)t.set(e+o,n+l,c.WATER);t.set(e+o,n-1,c.AIR),t.set(e+o,n-2,c.AIR)}let s=1+Math.floor(Math.random()*2);for(let o=0;o<s;o++){let r=Math.random()<.5?-1:1,l=e+r*(a+1);t.get(l,n)===c.GRASS&&Ce(t,l,n-1)}if(Math.random()<.5){let o=Math.random()<.5?-1:1,r=e+o*(i-1);t.get(r,n)===c.GRASS&&yt(t,r,n-1)}}function Xn(t,e,n){let a=6+Math.floor(Math.random()*5);for(let i=0;i<a;i++)t.set(e,n-i,c.BEDROCK),t.set(e+1,n-i,c.BEDROCK);t.set(e,n-a,c.GOLD),t.set(e+1,n-a,c.GOLD),t.set(e-1,n,c.STONE),t.set(e+2,n,c.STONE)}function jn(t,e,n){let s=e-Math.floor(3),o=n;for(let r=-1;r<=6;r++)for(let l=-1;l<=5;l++){let f=s+r,d=o+l;r===-1||r===6||l===-1||l===5?t.set(f,d,c.STONE):t.set(f,d,c.AIR)}t.set(s+1,o+5-1,c.JACKPOT),t.set(s+6-2,o+5-1,c.TNT),t.set(s+Math.floor(6/2),o+5-1,c.WORKBENCH)}function Jn(t,e,n){let a=15+Math.floor(Math.random()*10);for(let s=0;s<a;s++)t.set(e,n-s,c.WOOD),t.set(e+1,n-s,c.WOOD),s<3&&(t.set(e-1,n-s+1,c.WOOD),t.set(e+2,n-s+1,c.WOOD));let i=6;for(let s=-i;s<=i;s++)for(let o=-i;o<=i+1;o++)if(o*o+s*s<=i*i+Math.random()*5){let r=n-a+s;t.get(e+o,r)===c.AIR&&t.set(e+o,r,c.LEAVES)}t.set(e,n-a-2,c.GOLD)}function qn(t,e,n){let a=3+Math.floor(Math.random()*3);for(let i=0;i<=a*1.5;i++){let s=Math.max(0,a-i*.7);for(let o=-Math.ceil(s);o<=Math.ceil(s);o++){let r=e+o,l=n+i;i===0?(t.set(r,l,c.GRASS),o===0&&Math.random()<.3&&xt(t,r,l-1)):i<2?t.set(r,l,c.DIRT):Math.random()<.4||o===0&&i>2?t.set(r,l,c.GOLD):t.set(r,l,c.STONE)}}}function Zn(t,e,n){let a=4+Math.floor(Math.random()*5),i=4+Math.floor(Math.random()*3);for(let s=-a;s<=a;s++){let o=Math.abs(s)/a,r=Math.floor(i*(1-o*o)),l=n-r,f=n+4+Math.floor(Math.random()*3);for(let d=l;d<=f;d++)d<n?(t.set(e+s,d,c.SAND),d===l&&Math.random()>.2&&t.set(e+s,d,c.GRASS)):t.set(e+s,d,c.SAND)}Math.random()>.3&&xt(t,e,n-i-1)}function $n(t,e,n){let a=Math.floor(Math.random()*4);if(a===0){let i=3+Math.floor(Math.random()*4);for(let s=0;s<i;s++)t.set(e,n-1-s,c.STONE);Math.random()<.5&&t.set(e,n-1-i,c.STONE),Math.random()<.4&&t.set(e+1,n-1,c.STONE)}else if(a===1){let i=3+Math.floor(Math.random()*2);for(let s=0;s<i;s++){let o=i-s-1;for(let r=-o;r<=o;r++)Math.random()>.1&&t.set(e+r,n-1-s,c.STONE)}}else if(a===2){for(let o=-1;o<=1;o++)t.set(e+o,n-4,c.STONE);for(let o=1;o<4;o++)t.set(e-1,n-o,c.STONE),t.set(e+1,n-o,c.STONE)}else if(a===3){let i=4+Math.floor(Math.random()*3);for(let s=0;s<i;s++){let o=1+Math.floor(Math.random()*2);for(let r=0;r<o;r++)t.set(e+s,n-1-r,c.STONE)}}}function zn(t,e,n){let a=10+Math.floor(Math.random()*15),i=e,s=n;for(let o=0;o<a&&!(i>=t.width-2);o++)t.set(i,s,c.AIR),t.set(i,s-1,c.AIR),t.set(i,s-2,c.AIR),t.set(i,s+1,c.WOOD),o%4===0&&(t.get(i,s+1)!==c.AIR&&t.set(i,s,c.WOOD),t.get(i,s-2)!==c.AIR&&t.set(i,s-1,c.WOOD),t.set(i,s-2,c.WOOD)),i++,Math.random()<.1&&(s+=Math.random()<.5?-1:1),s>t.height-5&&(s=t.height-5),s<50&&(s=50)}function Qn(t,e,n){let a=25+Math.floor(Math.random()*10),i=20+Math.floor(Math.random()*5);for(let l=0;l<=i;l++){let f=a*(1-Math.pow(l/i,.8)),d=Math.ceil(f);for(let h=-d;h<=d;h++)if(h*h/(f*f)<=1){let u=e+h,m=n+l;if(l===0)t.set(u,m,c.GRASS);else if(l<3)t.set(u,m,c.DIRT);else{let _=Math.random();_>.98?t.set(u,m,c.GOLD):_>.95?t.set(u,m,c.COAL):t.set(u,m,c.STONE)}}}for(let l=-a+2;l<=a-2;l++){let f=e+l,d=n;if(Math.abs(l)%5===0&&Math.random()<.6){let h=4+Math.floor(Math.random()*5);for(let u=1;u<=h;u++)t.set(f,d-u,c.STONE);Math.random()<.5&&(t.set(f+1,d-h,c.STONE),t.set(f-1,d-h,c.STONE))}Math.random()<.05&&t.get(f,d)===c.GRASS&&xt(t,f,d-1),Math.abs(l)<5&&Math.random()<.3&&(t.set(f,d,c.WATER),t.set(f,d+1,c.STONE))}let s=8,o=8;for(let l=-s;l<=s;l++)for(let f=0;f<o;f++){let d=e+l,h=n-1-f;(Math.abs(l)===s||Math.abs(l)===s-2)&&Math.random()>.2&&t.set(d,h,c.STONE)}let r=n-o+2;t.set(e,r,c.JACKPOT),t.set(e,r-1,c.GOLD),t.set(e,r+1,c.GOLD),t.set(e-1,r,c.GOLD),t.set(e+1,r,c.GOLD)}function ti(t,e,n){let a=20+Math.floor(Math.random()*10),i=16+Math.floor(Math.random()*5);for(let d=-i;d<=2;d++)for(let h=-a;h<=a;h++)if(h*h/(a*a)+d*d/(i*i)<=1){let u=e+h,m=n+d-Math.floor(i*.6);m>0&&m<t.height-1&&t.set(u,m,c.AIR)}let s=e,o=n-i-2,r=3;for(let d=-r;d<=r;d++)for(let h=-r;h<=r;h++)d*d+h*h<=r*r&&t.set(s+d,o+h,c.GOLD);t.set(s,o,c.JACKPOT);let l=16+Math.floor(Math.random()*8),f=Math.ceil(l/2);for(let d=0;d<f;d++){let h=l-d*2,u=n-d,m=e-Math.floor(h/2);for(let _=0;_<h;_++)t.set(m+_,u,c.SAND)}t.set(e,n-f,c.SAND),t.set(e,n-1,c.JACKPOT),t.set(e-1,n-1,c.GOLD),t.set(e+1,n-1,c.GOLD)}function ei(t,e,n,a,i){for(let o=0;o<a;o++)for(let r=0;r<i;r++){let l=a/2,f=i/2,d=Math.abs(o-l)/l,h=Math.abs(r-f)/f,u=.7+Math.random()*.3;d+h<u&&t.set(e+o,n+r,c.CLOUD)}let s=Math.floor(a/3);for(let o=0;o<s;o++){let r=e+1+Math.floor(Math.random()*(a-2));Math.random()>.4&&t.set(r,n-1,c.CLOUD)}}function Jr(t,e,n,a,i){for(let s=0;s<a;s++){for(let o=0;o<i;o++)(s<2||s>=a-2)&&o>0&&Math.random()>.5||t.set(e+s,n+o,c.CLOUD);Math.random()>.7&&s>0&&s<a-1&&t.set(e+s,n-1,c.CLOUD)}}function qr(t,e,n){for(let a=2;a<8;a++)Math.random()>.3&&t.set(e+a,n,c.CLOUD);for(let a=0;a<12;a++)t.set(e+a,n+1,c.CLOUD);for(let a=1;a<10;a++)Math.random()>.2&&t.set(e+a,n+2,c.CLOUD)}function Zr(t,e,n){let a=3+Math.floor(Math.random()*3);for(let i=0;i<a;i++){let s=Math.floor(Math.random()*15),o=Math.floor(Math.random()*4),r=2+Math.floor(Math.random()*3);for(let l=0;l<r;l++)for(let f=0;f<Math.ceil(r/2);f++)Math.random()>.3&&t.set(e+s+l,n+o+f,c.CLOUD)}}function oi(t,e,n,a){switch(a){case 0:ei(t,e,n,4,2);break;case 1:Jr(t,e,n,12,1);break;case 2:ei(t,e,n,8,3);break;case 3:qr(t,e,n);break;case 4:Zr(t,e,n);break}}function ni(t,e,n,a){let i=Math.random();switch(a){case I.PLAINS:i<.05?xt(t,e,n):i<.08&&yt(t,e,n);break;case I.FOREST:i<.15?xt(t,e,n):i<.3&&yt(t,e,n);break;case I.SNOWFIELD:i<.06&&Kn(t,e,n);break;case I.DESERT:i<.02&&Vn(t,e,n);break;case I.MOUNTAIN:i<.015?Ie(t,e,n):i<.025&&ro(t,e,n);break;case I.WASTELAND:i<.04?Ie(t,e,n):i<.1&&ro(t,e,n);break;case I.DEEP_FOREST:i<.25?Ce(t,e,n):i<.6&&yt(t,e,n);break;case I.SAVANNA:i<.04?Un(t,e,n):i<.1&&yt(t,e,n);break;case I.PLATEAU:i<.02&&Ie(t,e,n);break;case I.SWAMP:i<.1?Yn(t,e,n):i<.2?Zt(t,e,n,2):i<.4&&Math.random()<.5&&yt(t,e,n);break}}function ii(t,e,n,a){let i=t.getAccessor(),s=Math.floor(t.width/80);for(let r=0;r<s;r++){let l=Math.floor(Math.random()*t.width),f=e[l],h=Math.min(f,a)-35,u=15;if(h>u){let m=u+Math.floor(Math.random()*(h-u));qn(i,l,m)}}for(let r=0;r<t.width;r+=1)n[r]===I.OCEAN&&Math.random()<.03&&(Zn(i,r,a),r+=40);for(let r=0;r<t.width;r+=1)if(n[r]===I.DESERT){if(Math.random()<.002)Hn(i,r,e[r]),r+=25;else if(Math.random()<.015){let l=e[(r+2)%t.width];Math.abs(l-e[r])<2&&($n(i,r,e[r]),r+=15)}}let o=Math.floor(t.width/50);for(let r=0;r<o;r++){let l=Math.floor(Math.random()*t.width),f=e[l];zn(i,l,f+15+Math.floor(Math.random()*(t.height-f-20)))}}function ri(t,e,n){let a=t.getAccessor();for(let l=0;l<t.width;l++){let f=n[l],d=e[l];if((f===I.PLAINS||f===I.WASTELAND)&&Math.random()<.003){Xn(a,l,d),l+=10;continue}if((f===I.FOREST||f===I.SAVANNA)&&Math.random()<.004&&d<t.height-20){jn(a,l,d+8),l+=15;continue}if(f===I.DEEP_FOREST&&Math.random()<.005){Jn(a,l,d),l+=15;continue}}let i=100+Math.floor(Math.random()*(t.width-200)),s=t.height-10-Math.floor(Math.random()*10);ti(a,i,s);let o=150+Math.floor(Math.random()*(t.width-300)),r=30+Math.floor(Math.random()*10);Qn(a,o,r)}function ai(t,e,n,a){let i=t.getAccessor(),s=Math.floor(t.width/60),o=t.height/2-14;for(let r=0;r<s;r++){let l=Math.floor(Math.random()*(t.width-10))+5,f=n[l],d=e[l];if(f===I.SNOWFIELD||f===I.DESERT||f===I.MOUNTAIN&&d<o)continue;let h=e[(l-2+t.width)%t.width],u=e[(l+2)%t.width];d<=a&&Math.abs(h-u)<3&&Zt(i,l,d,2+Math.floor(Math.random()*3))}}function si(t,e,n,a){let i=t.getAccessor(),s=2+Math.floor(Math.random()*2),o=0,r=0;for(;o<s&&r<t.width*4;){r++;let l=Math.floor(Math.random()*t.width),f=n[l];if(f===I.DESERT||f===I.SNOWFIELD||f===I.WASTELAND)continue;let d=e[l];if(d>=a)continue;let h=5,u=10,m=e[(l-h+t.width)%t.width],_=e[(l+h)%t.width],E=m-d,A=_-d;if(E>u||A>u){Zt(i,l,d,3);for(let T=-4;T<=4;T++){let b=(l+T+t.width)%t.width;if(t.getBlock(b,d)===c.WATER){let S=d+1;for(;S<t.height;){let C=t.getBlock(b,S);if(C===c.AIR)t.setBlock(b,S,c.WATER);else if(C!==c.WATER)break;S++}}}o++}}}function li(t,e){let n=t.getAccessor(),a=Math.max(3,Math.floor(t.width/35));for(let i=0;i<a;i++){let s=Math.floor(Math.random()*t.width),r=e[s]+8,l=t.height-6;if(r>=l)continue;let f=s,d=r+Math.floor(Math.random()*(l-r)),h=30+Math.floor(Math.random()*40);for(let u=0;u<h;u++){Wn(n,f,d),f+=Math.floor(Math.random()*3)-1,d+=Math.floor(Math.random()*3)-1,f=(f%t.width+t.width)%t.width;let m=e[f];d=Math.max(m+6,Math.min(t.height-5,d))}}}function ci(t,e){let n=t.getAccessor(),a=Math.floor(t.width*t.height/1500);for(let o=0;o<a;o++){let r=Math.floor(Math.random()*t.width),l=Math.floor(Math.random()*t.height);l>e[r]+8&&ye(n,r,l,c.DIRT,2+Math.random()*2.5)}let i=Math.floor(t.width*t.height/2500);for(let o=0;o<i;o++){let r=Math.floor(Math.random()*t.width),l=Math.floor(Math.random()*t.height);l>e[r]+10&&ye(n,r,l,c.SAND,1.5+Math.random()*2)}let s=Math.floor(t.width*t.height/2e3);for(let o=0;o<s;o++){let r=Math.floor(Math.random()*t.width),l=Math.floor(Math.random()*t.height);l>e[r]+15&&l<t.height-10&&ye(n,r,l,c.WATER,2+Math.random()*2.5)}}function fi(t,e){let a=Math.floor(t.width/25),i=t.getAccessor(),s=Math.floor(t.height/2)+2;for(let o=0;o<a;o++){let r=Math.floor(Math.random()*t.width),l=e[r],d=Math.min(l,s)-20,h=5;if(d<=h)continue;let u=h+Math.floor(Math.random()*(d-h)),m=Math.floor(Math.random()*5);oi(i,r,u,m)}}function di(t){for(let l=0;l<t.width;l++){let f=Math.sin(l*.02)*8+Math.cos(l*.1)*4+Math.sin(l*.5)*2+Math.random()*2,d=Math.max(0,2+f),h=Math.floor(t.height-d),u=Math.max(t.height-40,Math.min(t.height,h));for(let m=t.height-1;m>=u;m--)t.setBlock(l,m,c.AIR)}}function hi(t){let e=Ln(t.height),{heights:n,biomeByColumn:a}=Mo(t.width,e,96,192),i=Math.floor(t.height/2)+2;Dn(n,t.width,t.height);for(let s=0;s<t.width;s++){let o=n[s],r=a[s],l=xn(r,o,s,t.height);for(let f=0;f<t.height;f++)if(f>o)if(f>o+5){let d=Math.random();d>.995&&f>o+15?t.setBlock(s,f,c.GOLD):d>.96?t.setBlock(s,f,c.COAL):Math.random()>.95?t.setBlock(s,f,c.DIRT):t.setBlock(s,f,c.STONE)}else t.setBlock(s,f,Bn(r,f,o));else f===o?f>i?t.setBlock(s,f,c.SAND):(t.setBlock(s,f,l),(l===c.GRASS||r===I.SNOWFIELD&&l===c.SNOW||r===I.DESERT&&l===c.SAND||r===I.WASTELAND&&l===c.STONE||r===I.SAVANNA&&(l===c.GRASS||l===c.DIRT)||r===I.PLATEAU&&l===c.STONE)&&s>5&&s<t.width-5&&ni(t.getAccessor(),s,f-1,r)):f>i&&r===I.OCEAN&&t.setBlock(s,f,c.WATER)}Nn(t,n),ci(t,n),li(t,n),ai(t,n,a,i),si(t,n,a,i),ii(t,n,a,i),ri(t,n,a),di(t);for(let s=10;s<t.width-10;s+=50+Math.floor(Math.random()*20)){let o=n[s];o<=i&&t.getBlock(s,o-1)===c.AIR&&t.setBlock(s,o-1,c.WORKBENCH)}Fn(t),Gn(t,a,i),fi(t,n)}var Nt=class{constructor(e,n){this.width=e,this.height=n,this.map=new Uint8Array(e*n),this.map.fill(c.AIR),hi(this)}getIndex(e,n){return bo(e,n,this.width,this.height)}getBlock(e,n){let a=this.getIndex(e,n);return a===-1?c.BEDROCK:this.map[a]}setBlock(e,n,a){let i=this.getIndex(e,n);i!==-1&&(this.map[i]=a)}getAccessor(){return{get:(e,n)=>this.getBlock(e,n),set:(e,n,a)=>this.setBlock(e,n,a),width:this.width,height:this.height}}checkAreaFree(e,n,a,i){let s=Math.floor(e/p),o=Math.floor((e+a)/p),r=Math.floor(n/p),l=Math.floor((n+i)/p);for(let f=r;f<=l;f++)for(let d=s;d<=o;d++)if(lt(this.getBlock(d,f),$))return!1;return!0}};var $t=12,et=1<<$t,Y=t=>Math.floor(t*et),It=t=>t/et,ui=Math.floor(Math.pow(.8,dt)*et),mi=Y(wo),ao=Y(15/720),pi=Y(dt),zt=Y(5),_i=Y(pe),Vs=Y(Ue),gi=Y(vo),bi=Y(Lo),Ai=Y(Po),Ti=Y(ko),Mi=Y(xo),Ei=Y(2),Qt=41,H=Y(p),so=Y(.1),Si=Y(.2*p),lo=Y(.1),Ft=Y(_e),Ri=Y(Ko),yi=Y(Fo),Ii=Y(Go*p),Ci=p*p,wi=zt*2,Oi=1097,ki=2458,Pi=Oo,Gt=[];for(let t=0;t<=128;t++)Gt[t]=Y(Ue*Math.sqrt(t));function vi(t){return Math.trunc(t*ui/et)}function Li(t,e){if(t===0)return{boardVx:0,lowFrictionActive:!1};let n=e?ao>>1:ao,a;t>0?a=Math.max(0,t-n):a=Math.min(0,t+n);let i=e;return e&&Math.abs(a)<Ri&&(i=!1),{boardVx:a,lowFrictionActive:i}}function xi(t,e,n,a,i){if(t>=Ti)return{vy:t,fastballActive:a};let s=mi,o=a;if(e)s=Math.floor(s*Ai/et);else if(n&&(s=Math.floor(s*Pi)),a){let r=Math.abs(i);if(r<Ft>>2)o=!1;else{let l=Math.floor(s*r/Ft);s-=l}}return{vy:t+s,fastballActive:o}}function Bi(t,e,n,a,i,s,o,r){let l=t-i,f=e-s,d=l*l+f*f,u=o*o*Ci;if(d>=u||d<=0)return{vx:n,vy:a,affected:!1};let m=Math.floor(Math.sqrt(d)),_=Math.floor(l*et/m),E=Math.floor(f*et/m),A=Math.max(m,H),T=Math.floor(yi*r/et),b=Math.floor(o*H/et),C=Math.floor(T*T/et)*b,k=A+Ii,V=Math.floor(C/k),O=Math.floor((n*_+a*E)/et),L=Math.floor(O*O/et),x=V*2,K=L+x,W=Math.floor(Math.sqrt(Math.max(0,K)*et)),F=-O+W;return{vx:n+Math.floor(_*F/et),vy:a+Math.floor(E*F/et),affected:!0}}function co(t,e,n){let a=0,i=n;for(;t.getBlock(e,i)===c.JUMP_PAD;)a++,i--;for(i=n+1;t.getBlock(e,i)===c.JUMP_PAD;)a++,i++;return a}function fo(t,e,n,a,i){let{_x:s,_y:o,_vx:r,_vy:l,_width:f,_height:d,_boardVx:h,lowGravityActive:u}=t,m=!1,_=!1,E=Math.floor(s/H),A=Math.floor((s+f)/H),T=Math.floor(o/H),b=Math.floor((o+d)/H);for(let S=T;S<=b;S++)for(let C=E;C<=A;C++){let k=e.getBlock(C,S);if(lt(k,$))if(n)a>0?s=C*H-f-Qt:a<0&&(s=(C+1)*H+Qt),r=0,h=0;else{if(l>0)o=S*H-d-Qt,m=!0,l=0,u=!1;else if(l<0){if(o=(S+1)*H+Qt,l<Mi&&Et(k,$)&&To(k,Bo))return i&&i(k),J.playDig(de(k,$)),Re(C,S,k),e.setBlock(C,S,c.AIR),l+=Ei,_=!0,{_x:s,_y:o,_vx:r,_vy:l,_boardVx:h,grounded:!1,lowGravityActive:u,blockBroken:_};if(k===c.JUMP_PAD){let V=co(e,C,S),O=Math.min(V,128);l=Gt[O],J.playBigJump()}else l=0}return{_x:s,_y:o,_vx:r,_vy:l,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}}return n||(m=!1),{_x:s,_y:o,_vx:r,_vy:l,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}function Di(t,e,n,a,i){let s=e-a,o=Math.floor(s/H),r=Math.floor(t/H),l=Math.floor((t+n)/H);for(let f=r;f<=l;f++)if(lt(i.getBlock(f,o),$))return!1;return!0}function Ni(t,e,n,a){let i=t.gamepad&&t.gamepad.connected?t.gamepad.axisLeftX:0;if(Math.abs(i)>0){let s=Math.abs(i),o=Math.floor(zt*s);return i<0?{vx:-o,facingRight:!1}:{vx:o,facingRight:!0}}return t.keys.left?{vx:-zt,facingRight:!1}:t.keys.right?{vx:zt,facingRight:!0}:{vx:a(e),facingRight:n}}function Fi(t,e,n,a,i,s,o,r){if(s<=0)return null;let l=t+(n>>1),f=e+a+so,d=Math.floor(l/H),h=Math.floor(f/H);if(r.getBlock(d,h)!==c.WATER||r.getBlock(d,h-1)===c.WATER)return null;let m=i+o,_=m>0?m:-m,E=s;return _<wi?null:E*et<_*Oi?(J.playJump(),Y(pe*-.5)):null}function zr(t,e,n){let a=[],i=n;for(;t.getBlock(e,i)===c.TNT;)a.push(i),i++;return a}function Gi(t,e,n,a,i,s){let o=t+(n>>1),r=e+a+so,l=Math.floor(o/H),f=Math.floor(r/H);if(i.getBlock(l,f)!==c.JUMP_PAD)return null;let h=f;for(;i.getBlock(l,h+1)===c.JUMP_PAD;)h++;let m=i.getBlock(l,h+1)===c.CLOUD,_=zr(i,l,f+1);if(_.length>0&&s){let E=_.length*16,A=Math.min(E,128);return{vy:-Gt[A],lowGravityActive:m,tntTriggered:!0,feetX:l,tntPositions:_}}else{let E=co(i,l,f),A=Math.min(E,128);return J.playBigJump(),{vy:-Gt[A],lowGravityActive:m,tntTriggered:!1,feetX:l,tntPositions:[]}}}function Wi(t,e,n,a,i,s,o,r,l,f){return t.keys.jump?e?(J.playJump(),{vy:-_i,grounded:!1,jumped:!0}):n&&a>bi&&f(i,s,o,r,l)?(J.playJump(),{vy:-gi,grounded:!1,jumped:!0}):null:null}function Ki(t,e,n,a,i,s){t.save(),t.translate(Math.floor(e),Math.floor(n));let o=Math.sin(s*.01)*5,r=Math.abs(a)>.1;t.fillStyle="#f8b090",t.fillRect(4,0,12,12),t.fillStyle="#00bcd4",t.fillRect(4,12,12,18),t.fillStyle="#3f51b5",t.fillRect(4,30,5,18+(r?o:0)),t.fillRect(11,30,5,18-(r?o:0)),t.fillStyle="#f8b090",i?t.fillRect(10,12,6,18+o):t.fillRect(4,12,-6,18+o),t.restore()}var Oe=class{constructor(e,n=null,a=null,i=null){this.world=e,this.addToInventory=n,this.onTNTJumpPad=a,this.onSplash=i,this._x=0,this._y=0,this._vx=0,this._vy=0,this._boardVx=0,this._width=Y(.6*p),this._height=Y(1.8*p),this._x=Y(e.width/2*p),this._y=0,this.grounded=!1,this.facingRight=!0,this.animTimer=0,this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1,this.bubbleTimer=0,this.wasInWater=!1,this.findSpawnPoint()}get x(){return It(this._x)}set x(e){this._x=Y(e)}get y(){return It(this._y)}set y(e){this._y=Y(e)}get vx(){return It(this._vx)}set vx(e){this._vx=Y(e)}get vy(){return It(this._vy)}set vy(e){this._vy=Y(e)}get boardVx(){return It(this._boardVx)}set boardVx(e){this._boardVx=Y(e)}get width(){return It(this._width)}get height(){return It(this._height)}getGridRect(){let e=Math.floor(this._x/H),n=Math.floor(this._y/H),a=Math.floor((this._x+this._width)/H),i=Math.floor((this._y+this._height)/H);return{startX:e,endX:a,startY:n,endY:i}}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getRect(){return{x:this.x,y:this.y,w:this.width,h:this.height}}applyAcceleratorForce(e){let n=this._boardVx*this._boardVx,a=Ft*Ft,i=Math.floor(Math.sqrt(n+a));this._boardVx=e>0?i:-i,this.facingRight=e>0}activateFastballMode(){this.fastballActive=!0}activateLowFrictionMode(){this.lowFrictionActive=!0}applyExplosionImpulse(e,n,a,i){let s=this._x+(this._width>>1),o=this._y+(this._height>>1),r=Bi(s,o,this._vx,this._vy,e,n,a,i);r.affected&&(this._vx=r.vx,this._vy=r.vy,this.grounded=!1)}findSpawnPoint(){let e=Math.floor(this._x/H),n=Math.floor(this.world.height*.4),a=this.world.getBlock(e,n);if(a!==c.AIR&&a!==c.CLOUD)for(let i=n;i>=0;i--){let s=this.world.getBlock(e,i);if(s===c.AIR||s===c.CLOUD){this._y=(i-1)*H;return}}else for(let i=n;i<this.world.height;i++){let s=this.world.getBlock(e,i);if(s!==c.AIR&&s!==c.CLOUD){this._y=(i-2)*H;return}}for(let i=0;i<this.world.height;i++){let s=this.world.getBlock(e,i);if(s!==c.AIR&&s!==c.CLOUD){this._y=(i-2)*H;break}}}respawn(){this._y=0,this._vy=0,this._vx=0,this._boardVx=0,this._x=Y(this.world.width/2*p),this.findSpawnPoint(),this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1}tick(e){let n=this._x+(this._width>>1),a=this._y+(this._height>>1),i=Math.floor(n/H),s=Math.floor(a/H),o=this.world.getBlock(i,s)===c.WATER;o&&!this.wasInWater&&this.onSplash&&this.onSplash(this.getCenterX(),this.getCenterY()),this.wasInWater=o;let r=Ni(e,this._vx,this.facingRight,vi);this._vx=r.vx,this.facingRight=r.facingRight;let l=Fi(this._x,this._y,this._width,this._height,this._vx,this._vy,this._boardVx,this.world);l!==null&&(this._vy=l);let f=Gi(this._x,this._y,this._width,this._height,this.world,this.onTNTJumpPad);if(f)this._vy=f.vy,this.grounded=!1,f.lowGravityActive&&(this.lowGravityActive=!0),f.tntTriggered&&this.onTNTJumpPad&&this.onTNTJumpPad(f.feetX,f.tntPositions);else{let C=Wi(e,this.grounded,o,this._vy,this._x,this._y,this._width,Si,this.world,Di);C&&(this._vy=C.vy,this.grounded=C.grounded)}let d=Li(this._boardVx,this.lowFrictionActive);this._boardVx=d.boardVx,this.lowFrictionActive=d.lowFrictionActive;let h=xi(this._vy,o,this.lowGravityActive,this.fastballActive,this._boardVx);this._vy=h.vy,this.fastballActive=h.fastballActive;let u=pi;o&&(u=u*ki>>$t);let m=this._vx+this._boardVx;this._x+=m*u>>$t;let _=fo({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!0,m,this.addToInventory);this._x=_._x,this._vx=_._vx,this._boardVx=_._boardVx,this._y+=this._vy*u>>$t;let E=fo({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!1,this._vy,this.addToInventory);this._y=E._y,this._vy=E._vy,this.grounded=E.grounded,this.lowGravityActive=E.lowGravityActive,this.wrapHorizontally(),this.wrapVertically(),(this._vx>lo||this._vx<-lo)&&(this.animTimer+=Ht);let A=this.getCenterX(),T=this.y+4,b=Math.floor(A/p),S=Math.floor(T/p);if(this.world.getBlock(b,S)===c.WATER){if(this.bubbleTimer++,this.bubbleTimer>40){let C=p;for(let k=S-1;k>=0;k--)if(this.world.getBlock(b,k)!==c.WATER){C=T-(k+1)*p;break}An(A,T,Math.max(p,C)),this.bubbleTimer=Math.floor(Math.random()*-30)}}else this.bubbleTimer=0}wrapHorizontally(){let e=this.world.width*H;for(;this._x>=e;)this._x-=e;for(;this._x+this._width<=0;)this._x+=e}wrapVertically(){let e=this.world.height*H;for(;this._y>=e;)this._y-=e;for(;this._y+this._height<=0;)this._y+=e}draw(e){Ki(e,this.x,this.y,this.vx,this.facingRight,this.animTimer)}};var Bt=4e3,N={x:new Float32Array(Bt),y:new Float32Array(Bt),vx:new Float32Array(Bt),vy:new Float32Array(Bt),life:new Uint16Array(Bt),colorIdx:new Uint8Array(Bt),count:0},Vi=["#ffd54f","#fbc02d"],Qr=.15*dt*dt,ta=Math.pow(.99,dt),te=new Map,Ui=0,Yi=0,Hi=0,Xi=0,ke=50;function ea(t){let e=N.count-1;t!==e&&(N.x[t]=N.x[e],N.y[t]=N.y[e],N.vx[t]=N.vx[e],N.vy[t]=N.vy[e],N.life[t]=N.life[e],N.colorIdx[t]=N.colorIdx[e]),N.count--}function ji(t,e,n,a,i,s){if(N.count>=Bt)return;let o=N.count;N.x[o]=t,N.y[o]=e,N.vx[o]=n,N.vy[o]=a,N.life[o]=i,N.colorIdx[o]=s,N.count++}function Ji(t,e,n){let a=Math.floor(t.x/p),i=Math.floor((t.x+t.width)/p),s=Math.floor(t.y/p),o=Math.floor((t.y+t.height)/p);for(let r=s;r<=o;r++)for(let l=a;l<=i;l++)if(e.getBlock(l,r)===c.JACKPOT){let f=`${l},${r}`;te.has(f)||(oa(l,r),te.set(f,Yo),n.playCoin())}}function qi(t,e){let n=t*p+p/2,a=e*p+p/2;for(let i=0;i<100;i++){let s=Ye+Math.floor(Math.random()*He);ji(n+(Math.random()-.5)*p,a+(Math.random()-.5)*p,(Math.random()-.5)*25*dt,-(4+Math.random()*14)*dt,s,i%2)}}function oa(t,e){let n=t*p+p/2,a=e*p+p/2;for(let i=0;i<24;i++){let s=Ye+Math.floor(Math.random()*He);ji(n+(Math.random()-.5)*p*.6,a+(Math.random()-.5)*p*.2,(Math.random()-.5)*3.2*dt,-(1.2+Math.random()*4.5)*dt,s,i%2)}}function Zi(){te.forEach((e,n)=>{let a=e-1;a<=0?te.delete(n):te.set(n,a)});let t=0;for(;t<N.count;){if(N.vx[t]*=ta,N.vy[t]+=Qr,N.x[t]+=N.vx[t],N.y[t]+=N.vy[t],N.life[t]--,N.life[t]<=0){ea(t);continue}t++}}function $i(t,e,n,a,i){if(N.count===0)return;Ui=e-ke,Yi=e+a+ke,Hi=n-ke,Xi=n+i+ke;let s=[],o=[];for(let r=0;r<N.count;r++){let l=N.x[r],f=N.y[r];l<Ui||l>Yi||f<Hi||f>Xi||(N.colorIdx[r]===0?s.push(r):o.push(r))}if(s.length>0){t.fillStyle=Vi[0];for(let r of s)t.fillRect(N.x[r]-3,N.y[r]-3,6,6)}if(o.length>0){t.fillStyle=Vi[1];for(let r of o)t.fillRect(N.x[r]-3,N.y[r]-3,6,6)}}var ee=new Map,ho=null;function zi(t){t.onTNTAccelerator&&(ho=t.onTNTAccelerator)}function na(t,e,n){let a=Math.min(n*16,128),i=_e*Math.sqrt(a);t.boardVx=e*i,t.facingRight=e>0}function ia(t,e,n,a){let i=[],s=e;for(;t.getBlock(s,n)===c.TNT;)i.push(s),s-=a;return i}function Qi(t,e){let{startX:n,endX:a,startY:i,endY:s}=t.getGridRect();for(let o=i;o<=s;o++)for(let r=n;r<=a;r++){let l=e.getBlock(r,o),f=`${r},${o}`;if((l===c.ACCELERATOR_LEFT||l===c.ACCELERATOR_RIGHT)&&!ee.has(f)){let d=l===c.ACCELERATOR_RIGHT?1:-1,h=r-d,u=ia(e,h,o,d);u.length>0&&ho?(na(t,d,u.length),ho(u,o)):t.applyAcceleratorForce(d);let m=e.getBlock(r,o+1);m===c.CLOUD&&t.activateFastballMode(),m===c.SNOW&&t.activateLowFrictionMode(),ee.set(f,Wo);return}}}function tr(){ee.forEach((t,e)=>{let n=t-1;n<=0?ee.delete(e):ee.set(e,n)})}var uo="blockCraftSave",ra=1e3,aa=`
const SAVE_SCHEMA_VERSION = 2;

function rleEncode(data) {
    if (data.length === 0) return new Uint8Array(0);
    const result = [];
    let i = 0;
    while (i < data.length) {
        const value = data[i];
        let count = 1;
        while (i + count < data.length && data[i + count] === value && count < 65535) {
            count++;
        }
        result.push(value);
        if (count <= 255) {
            result.push(count);
        } else {
            result.push(0);
            result.push((count >> 8) & 0xff);
            result.push(count & 0xff);
        }
        i += count;
    }
    return new Uint8Array(result);
}

function uint8ToBase64(bytes) {
    const chunkSize = 0x8000;
    const chunks = [];
    for (let i = 0; i < bytes.length; i += chunkSize) {
        const slice = bytes.subarray(i, i + chunkSize);
        chunks.push(String.fromCharCode(...slice));
    }
    return btoa(chunks.join(''));
}

self.onmessage = function(e) {
    const { type, payload } = e.data;
    if (type === 'SAVE') {
        try {
            const { map, width, height, player, inventory, timers } = payload;
            const compressedMap = rleEncode(map);
            const base64Map = uint8ToBase64(compressedMap);
            const state = {
                schema: SAVE_SCHEMA_VERSION,
                world: { width, height, map: base64Map },
                player,
                inventory,
                timers
            };
            const jsonString = JSON.stringify(state);
            self.postMessage({ type: 'SAVE_COMPLETE', data: jsonString });
        } catch (err) {
            self.postMessage({ type: 'SAVE_ERROR', error: err.message });
        }
    }
};
`;function sa(t){let e=atob(t),n=e.length,a=new Uint8Array(n);for(let i=0;i<n;i++)a[i]=e.charCodeAt(i);return a}function Ct(){let t=localStorage.getItem(uo);if(!t)return null;try{return JSON.parse(t)}catch(e){return console.warn("Failed to parse saved state",e),localStorage.removeItem(uo),null}}function er({world:t,player:e,timers:n,inventory:a,utils:i,constants:s}){let o=null,r=!1,l=null;try{let u=new Blob([aa],{type:"application/javascript"}),m=URL.createObjectURL(u);l=new Worker(m),l.onmessage=_=>{let{type:E,data:A,error:T}=_.data;if(E==="SAVE_COMPLETE")try{localStorage.setItem(uo,A)}catch(b){console.warn("LocalStorage write failed:",b)}finally{r=!1}else E==="SAVE_ERROR"&&(console.warn("Worker save failed:",T),r=!1)},l.onerror=_=>{console.error("Save Worker Error:",_),r=!1}}catch(u){console.warn("Failed to initialize Save Worker, autosave disabled.",u)}function f(){if(!t||!e||!l||r)return;r=!0;let u={map:t.map,width:t.width,height:t.height,player:{x:e.x,y:e.y,vx:e.vx,vy:e.vy,grounded:e.grounded,facingRight:e.facingRight},inventory:a.getInventoryState(),timers:{tnt:n.tnt.map(m=>({x:m.x,y:m.y,timer:m.timer})),saplings:n.saplings.map(m=>({x:m.x,y:m.y,timer:m.timer}))}};l.postMessage({type:"SAVE",payload:u})}function d(u){if(u){if(u.world&&u.world.map&&u.world.width===t.width&&u.world.height===t.height){let m=sa(u.world.map),_=u.schema>=2?ue(m):m;_.length===t.map.length&&(t.map=_)}u.player&&(e.x=u.player.x??e.x,e.y=u.player.y??e.y,e.vx=u.player.vx??e.vx,e.vy=u.player.vy??e.vy,e.grounded=u.player.grounded??e.grounded,e.facingRight=u.player.facingRight??e.facingRight,e.wrapVertically()),u.inventory&&a.loadInventoryState(u.inventory),u.timers&&(n.tnt.length=0,(u.timers.tnt||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&n.tnt.push({x:m.x,y:m.y,timer:m.timer})}),n.saplings.length=0,(u.timers.saplings||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&n.saplings.push({x:m.x,y:m.y,timer:m.timer})}))}}function h(){o&&clearInterval(o),o=setInterval(f,ra)}return{saveGameState:f,applySavedState:d,startAutosave:h}}var la=12,ft=1<<la,oe=t=>Math.floor(t*ft),wt=(t,e)=>(t%e+e)%e;function ca(t,e,n){let a=[],i=new Set,s=[{x:t,y:e}],o=(r,l)=>`${wt(r,n.width)},${wt(l,n.height)}`;for(i.add(o(t,e));s.length>0;){let r=s.pop();a.push(r);let l=[{x:r.x+1,y:r.y},{x:r.x-1,y:r.y},{x:r.x,y:r.y+1},{x:r.x,y:r.y-1}];for(let f of l){let d=wt(f.x,n.width),h=wt(f.y,n.height),u=o(f.x,f.y);i.has(u)||n.getBlock(d,h)===c.TNT&&(i.add(u),s.push(f))}}return a}function fa(t,e){let{world:n,player:a,sounds:i,addToInventory:s,createExplosionParticles:o}=e;i.playExplosion();let r=0,l=0;for(let w of t)r+=w.x,l+=w.y,n.setBlock(wt(w.x,n.width),wt(w.y,n.height),c.AIR);let f=t.length,d=Math.floor(r*ft/f),h=Math.floor(l*ft/f),u=d*p+oe(p/2),m=h*p+oe(p/2),_=u/ft,E=m/ft,A=Math.floor(Math.sqrt(f)*ft),T=oe(No),b=Math.floor(T*A/ft),S=Math.min(10,Math.ceil(f*1.5)),C=A/ft;for(let w=0;w<S;w++){let B=p*C*.5,M=(Math.random()-.5)*B,y=(Math.random()-.5)*B;o(_+M,E+y)}a.applyExplosionImpulse(u,m,b,A);let k=Math.ceil(b/ft),V=Math.floor(_/p),O=Math.floor(E/p),L=V-k,x=V+k,K=O-k,W=O+k,F=Math.floor(b*p*(b*p));for(let w=K;w<=W;w++)for(let B=L;B<=x;B++){let M=B*p*ft+oe(p/2),y=w*p*ft+oe(p/2),D=M-u,G=y-m;if(D*D+G*G<=F){let Z=wt(B,n.width),g=wt(w,n.height),R=n.getBlock(Z,g);if(R===c.AIR)continue;if(R===c.FIREWORK){let U=M/ft,X=y/ft;for(let z=0;z<10;z++){let Q=`hsl(${Math.random()*360}, 100%, 50%)`,j=p*.75,ut=(Math.random()-.5)*2*j,ct=(Math.random()-.5)*2*j;o(U+ut,X+ct,Q)}n.setBlock(Z,g,c.AIR);continue}if(R===c.JACKPOT){qi(Z,g),s(R),n.setBlock(Z,g,c.AIR);continue}Et(R,$)&&(s(R),n.setBlock(Z,g,c.AIR))}}}function or(t){let{world:e}=t,n=[];return{tick(){for(let a=n.length-1;a>=0;a--){let i=n[a];if(e.getBlock(i.x,i.y)!==c.TNT){n.splice(a,1);continue}if(i.timer--,i.timer<=0){let s=ca(i.x,i.y,e);fa(s,t),n.splice(a,1)}}},onBlockPlaced(a,i){n.push({x:a,y:i,timer:Do})},getTimers(){return n},loadTimers(a){n.length=0,n.push(...a)},cancelTimerAt(a,i){let s=n.findIndex(o=>o.x===a&&o.y===i);return s!==-1?(n.splice(s,1),!0):!1},hasTimerAt(a,i){return n.some(s=>s.x===a&&s.y===i)},detonateTNT(a,i){if(this.cancelTimerAt(a,i),e.getBlock(a,i)===c.TNT){e.setBlock(a,i,c.AIR);let s=a*p+p/2,o=i*p+p/2;t.createExplosionParticles(s,o)}}}}var da={[c.AIR]:"#87CEEB",[c.DIRT]:"#5d4037",[c.GRASS]:"#388e3c",[c.STONE]:"#757575",[c.WOOD]:"#6d4c41",[c.LEAVES]:"#2e7d32",[c.BEDROCK]:"#000000",[c.COAL]:"#212121",[c.GOLD]:"#ffb300",[c.WORKBENCH]:"#8d6e63",[c.SAND]:"#d7c27a",[c.SNOW]:"#e0f7fa",[c.CLOUD]:"#ffffff",[c.FIREWORK]:"#ef5350",[c.JUMP_PAD]:"#ab47bc",[c.TNT]:"#d32f2f",[c.SAPLING]:"#6fa85b",[c.JACKPOT]:"#ffd54f",[c.ACCELERATOR_LEFT]:"#42a5f5",[c.ACCELERATOR_RIGHT]:"#66bb6a",[c.WATER]:"#2196f3"},ha=30;function ua(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}var Wt={};for(let[t,e]of Object.entries(da))Wt[t]=ua(e);function ma(t,e,n,a,i,s){let o=(t+a)/2,r=t-a,l=e-i,f=n-s,d=2+o/256,h=4,u=2+(255-o)/256;return Math.sqrt(d*r*r+h*l*l+u*f*f)}function pa(t,e,n){let a=1/0,i=c.DIRT;for(let[s,o]of Object.entries(Wt)){let r=parseInt(s),l=ma(t,e,n,o.r,o.g,o.b);(r===c.AIR||r===c.WORKBENCH)&&l>ha||l<a&&(a=l,i=r)}return i}function nr(t,e,n){let a=ue(t);return new Promise(i=>{let s=document.createElement("canvas");s.width=e,s.height=n;let o=s.getContext("2d"),r=o.createImageData(e,n),l=r.data;for(let f=0;f<n;f++)for(let d=0;d<e;d++){let h=f*e+d,u=a[h],m=Wt[u]||Wt[c.AIR],_=h*4;l[_]=m.r,l[_+1]=m.g,l[_+2]=m.b,l[_+3]=255}o.putImageData(r,0,0),s.toBlob(i,"image/png")})}function ir(t){return new Promise((e,n)=>{let a=new FileReader;a.onload=i=>{let s=new Image;s.onload=()=>{let r=new Nt(ot,nt).map,l=document.createElement("canvas");l.width=ot,l.height=nt;let f=l.getContext("2d");f.clearRect(0,0,ot,nt),f.imageSmoothingEnabled=!1;let d=ot/nt,h=s.width/s.height,u,m,_,E;if(h>d)m=nt,u=s.width*(nt/s.height),_=(ot-u)/2,E=0;else{let O=Math.min(ot/s.width,nt/s.height);u=s.width*O,m=s.height*O,_=(ot-u)/2,E=(nt-m)/2}f.drawImage(s,_,E,u,m);let T=f.getImageData(0,0,ot,nt).data,b=new Float32Array(T.length);for(let O=0;O<T.length;O++)b[O]=T[O];let S=Math.floor(_),C=Math.floor(_+u),k=Math.floor(E),V=Math.floor(E+m);for(let O=0;O<nt;O++)for(let L=0;L<ot;L++){let x=O*ot+L,K=x*4,W=b[K+3];if(L>=S&&L<C&&O>=k&&O<V&&W>=128){let w=b[K],B=b[K+1],M=b[K+2],y=pa(w,B,M);r[x]=y;let D=Wt[y]||Wt[c.DIRT],G=w-D.r,Z=B-D.g,g=M-D.b,R=(U,X,z)=>{let Q=L+U,j=O+X;if(Q>=0&&Q<ot&&j>=0&&j<nt){let ut=(j*ot+Q)*4;b[ut]+=G*z/16,b[ut+1]+=Z*z/16,b[ut+2]+=g*z/16}};R(1,0,7),R(-1,1,3),R(0,1,5),R(1,1,1)}}e(r)},s.onerror=()=>n(new Error("Failed to load image")),s.src=i.target.result},a.onerror=()=>n(new Error("Failed to read file")),a.readAsDataURL(t)})}function rr(t,e){let n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}function ar(t,e,n){let a=Math.floor(e/2);for(let i=0;i<n-1;i++){let s=i*e+a,o=t[(i+1)*e+a];if(t[s]===c.AIR&&o!==c.AIR)return{x:a,y:i}}return{x:a,y:10}}var Ot=[{time:0,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.35,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.4,top:"#ff758c",bottom:"#ff7eb3"},{time:.42,top:"#2C3E50",bottom:"#FD746C"},{time:.45,top:"#0f2027",bottom:"#203a43"},{time:.5,top:"#000000",bottom:"#1a1a2e"},{time:.55,top:"#0f2027",bottom:"#203a43"},{time:.58,top:"#2C3E50",bottom:"#FD746C"},{time:.6,top:"#ff758c",bottom:"#ff7eb3"},{time:.65,top:"#4CA1AF",bottom:"#C4E0E5"},{time:1,top:"#4CA1AF",bottom:"#C4E0E5"}],Pe="#020205",ve="#050505",ne=.2;var Le=.5,_a=60,sr=[];for(let t=0;t<_a;t++)sr.push({x:Math.random(),y:Math.random()*.6,size:Math.random()*2+1,twinkleSpeed:Math.random()*.05+.01});function kt(t,e,n){let a=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16),o=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16),f=Math.round(a+(o-a)*n),d=Math.round(i+(r-i)*n),h=Math.round(s+(l-s)*n),u=m=>m.toString(16).padStart(2,"0");return`#${u(f)}${u(d)}${u(h)}`}function xe(t){if(t>Le){let e=(t-Le)*5;return Mt(1-e,0,1)}return 1}function lr(t,e){t=t%1,t<0&&(t+=1);let n=Ot[0],a=Ot[Ot.length-1];for(let l=0;l<Ot.length-1;l++)if(t>=Ot[l].time&&t<Ot[l+1].time){n=Ot[l],a=Ot[l+1];break}let i=a.time-n.time,s=(t-n.time)/i,o=kt(n.top,a.top,s),r=kt(n.bottom,a.bottom,s);if(e<ne){let l=Mt((ne-e)*4,0,1);o=kt(o,Pe,l),r=kt(r,Pe,l)}if(e>Le&&e<=.8){let l=Mt((e-Le)*3.33,0,1);o=kt(o,ve,l),r=kt(r,ve,l)}if(e>.8){let l=(e-.8)/.2;o=kt(ve,Pe,l),r=kt(ve,Pe,l)}return{top:o,bottom:r}}function cr(t,e,n,a){let i=t*Math.PI*2-Math.PI/2,s=a*.9,o=n/2,r=a*.9,l=o+Math.cos(i)*s,f=r+Math.sin(i)*s,d=50,h=f<a+d*4,u=xe(e);u<=0&&(h=!1);let m="#FFFFA0",_="#FFFFFF",E="rgba(255, 255, 200, 0.4)";return t>.35&&t<.65&&(m="#FF7E5F",_="#FD746C",E="rgba(255, 100, 50, 0.4)"),{type:"sun",isVisible:h,x:l,y:f,radius:d,color:m,shadow:{color:_,blur:40},glowColor:E,opacity:u}}function fr(t,e,n,a,i=0){let s=t*Math.PI*2+Math.PI/2,o=a*.8,r=n/2,l=a*.9,f=r+Math.cos(s)*o,d=l+Math.sin(s)*o,h=30,u=d<a+h*4,m=xe(e);m<=0&&(u=!1);let _=28,E=i%_/_;return{type:"moon",isVisible:u,x:f,y:d,radius:h,color:"#F4F6F0",shadow:{color:"#ffffff",blur:10},glowColor:"rgba(200, 220, 255, 0.2)",opacity:m,phase:E}}function dr(t,e,n,a){let i=0;t>.4&&t<.6&&(t<.5?i=(t-.4)*10:i=(.6-t)*10);let s=xe(e);i*=s;let o=0;e<ne&&(o=Mt((ne-e)*5,0,1));let r=1-ne;e>r&&(o=Mt((e-r)*5,0,1));let l=Math.max(i,o);return l<=.01?[]:sr.map(f=>({x:f.x*n,y:f.y*a,size:f.size,opacity:l*(.7+Math.sin(Date.now()*f.twinkleSpeed)*.3)}))}function hr(t,e,n,a,i,s=0){if(s%28!==0)return;let o=0;if(e>.4&&e<.6)e<.45?o=(e-.4)*20:e>.55?o=(.6-e)*20:o=1;else return;let r=xe(n);if(o*=r,o<=.01)return;t.save(),t.globalCompositeOperation="lighter";let l=Date.now()/4e3,f=[{color:[160,100,50],yBase:i*.2,amp:i*.1,speed:1,widthScale:1},{color:[260,100,60],yBase:i*.15,amp:i*.15,speed:.7,widthScale:1.5},{color:[190,100,50],yBase:i*.25,amp:i*.08,speed:1.3,widthScale:.8}];for(let d=0;d<f.length;d++){let h=f[d];t.beginPath();let u=40;for(let T=0;T<=a+u;T+=u){let b=Math.sin(T*.002*h.widthScale+l*h.speed+d),S=Math.sin(T*.005*h.widthScale-l*h.speed*.5),C=h.yBase+b*h.amp+S*h.amp*.5;T===0?t.moveTo(T,C):t.lineTo(T,C)}t.lineTo(a,0),t.lineTo(0,0),t.closePath();let m=t.createLinearGradient(0,0,0,i*.6),[_,E,A]=h.color;m.addColorStop(0,`hsla(${_}, ${E}%, ${A}%, 0)`),m.addColorStop(.2,`hsla(${_}, ${E}%, ${A}%, ${.15*o})`),m.addColorStop(1,`hsla(${_}, ${E}%, ${A}%, 0)`),t.fillStyle=m,t.fill()}t.restore()}function ur(t,{world:e,player:n,cameraX:a,cameraY:i,zoom:s=1,logicalWidth:o,logicalHeight:r,textures:l,input:f,tntManager:d}){if(!e)return;let h=Date.now(),u=h%me/me,m=Math.floor(h/me),_=e.height*p,A=((i+r/2)%_+_)%_/_,{top:T,bottom:b}=lr(u,A),S=t.createLinearGradient(0,0,0,r);S.addColorStop(0,T),S.addColorStop(1,b),t.fillStyle=S,t.fillRect(0,0,o,r);let C=dr(u,A,o,r);t.fillStyle="#FFFFFF",C.forEach(M=>{t.globalAlpha=M.opacity,t.beginPath(),t.arc(M.x,M.y,M.size,0,Math.PI*2),t.fill()}),t.globalAlpha=1,hr(t,u,A,o,r,m);let k=cr(u,A,o,r),V=fr(u,A,o,r,m),O=[k,V];O.forEach(M=>{if(!M.isVisible)return;t.globalAlpha=M.opacity!==void 0?M.opacity:1;let y=M.radius*6,D=t.createRadialGradient(M.x,M.y,M.radius,M.x,M.y,y),G=M.glowColor||"rgba(255, 255, 255, 0.2)";D.addColorStop(0,G),D.addColorStop(.3,G.replace(/[\d.]+\)$/,"0.1)")),D.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=D,t.beginPath(),t.arc(M.x,M.y,y,0,Math.PI*2),t.fill(),t.globalAlpha=1}),O.forEach(M=>{if(M.isVisible){if(t.globalAlpha=M.opacity!==void 0?M.opacity:1,M.type==="sun")t.beginPath(),t.arc(M.x,M.y,M.radius,0,Math.PI*2),t.fillStyle=M.color,t.shadowColor=M.shadow.color,t.shadowBlur=M.shadow.blur,t.fill(),t.shadowBlur=0;else if(M.type==="moon"){let y=M.radius,D=M.phase;t.save(),t.translate(M.x,M.y);let G=Math.PI/4;if(t.rotate(G),t.shadowColor=M.shadow.color,t.shadowBlur=M.shadow.blur,t.fillStyle=M.color,t.beginPath(),D<=.5){t.arc(0,0,y,-Math.PI/2,Math.PI/2,!1);let g=y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,Math.PI/2,3*Math.PI/2,g>0)}else{t.arc(0,0,y,Math.PI/2,-Math.PI/2,!1);let g=-y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,-Math.PI/2,Math.PI/2,g<0)}t.closePath(),t.fill(),t.shadowBlur=0,t.save(),t.clip(),t.fillStyle="rgba(0,0,0,0.1)",[{dx:-8,dy:-5,r:6},{dx:10,dy:8,r:4},{dx:-5,dy:10,r:3}].forEach(g=>{t.beginPath(),t.arc(g.dx,g.dy,g.r,0,Math.PI*2),t.fill()}),t.restore(),t.restore()}t.globalAlpha=1}});let{startX:L,endX:x,startY:K,endY:W}=he(a,i,o,r,p,s);t.fillStyle=S;let F=Math.ceil(p*s),w=Math.ceil(p*s);for(let M=K;M<W;M++)for(let y=L;y<x;y++){let D=(M%e.height+e.height)%e.height;if(e.getBlock(y,D)===c.WATER){let Z=Math.floor((y*p-a)*s),g=Math.floor((M*p-i)*s);t.fillRect(Z,g,F,w)}}let B=new Set([c.CLOUD,c.JUMP_PAD,c.JACKPOT,c.ACCELERATOR_LEFT,c.ACCELERATOR_RIGHT]);for(let M=K;M<W;M++)for(let y=L;y<x;y++){let D=(M%e.height+e.height)%e.height,G=e.getBlock(y,D);if(G!==c.AIR&&l[G]){let Z=Math.floor((y*p-a)*s),g=Math.floor((M*p-i)*s);if(G===c.TNT&&d&&d.hasTimerAt(y,D)){let R=h*.01,U=Math.sin(R*15+y*7)*1.2,X=Math.cos(R*18+M*5)*1.2,z=Math.floor((y*p+U-a)*s),Q=Math.floor((M*p+X-i)*s);t.drawImage(l[G],z,Q,F,w);let j=(Math.sin(R*8)+1)/2;if(t.fillStyle=`rgba(255, ${Math.floor(100-j*100)}, 0, ${.2+j*.3})`,t.fillRect(z,Q,F,w),Math.sin(R*20)>.3){let ct=z+F/2+(Math.random()-.5)*8*s,Ne=Q+2*s,gt=(3+Math.random()*3)*s;t.fillStyle="#ffff00",t.beginPath(),t.arc(ct,Ne,gt,0,Math.PI*2),t.fill(),t.fillStyle="rgba(255, 200, 0, 0.5)",t.beginPath(),t.arc(ct,Ne,gt+2*s,0,Math.PI*2),t.fill()}}else t.drawImage(l[G],Z,g,F,w);if(!B.has(G)){let R=(D-1+e.height)%e.height,U=e.getBlock(y,R);U!==c.AIR&&!fe(U,$)&&(t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(Z,g,F,w))}}}if(t.save(),t.scale(s,s),t.translate(-a,-i),n&&n.draw(t),$i(t,a,i,o,r),En(t,a,i,o,r),Pn(t,a,i,o,r),f&&f.mouse&&f.mouse.active){let M=Yt(f.mouse.x,f.mouse.y,a,i,s),{tx:y,ty:D}=Ut(M.x,M.y,p);ce(M.x,M.y,n.getCenterX(),n.getCenterY(),Xt)&&(t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=2,t.strokeRect(y*p,D*p,p,p))}if(f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let M=f.gamepad.cursorX,y=f.gamepad.cursorY,D=Yt(M,y,a,i,s),{tx:G,ty:Z}=Ut(D.x,D.y,p);t.strokeStyle="rgba(255, 235, 59, 0.7)",t.lineWidth=3,t.strokeRect(G*p,Z*p,p,p)}if(t.restore(),f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let M=f.gamepad.cursorX,y=f.gamepad.cursorY,D=12,G=4;t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.moveTo(M-D,y),t.lineTo(M-G,y),t.moveTo(M+G,y),t.lineTo(M+D,y),t.moveTo(M,y-D),t.lineTo(M,y-G),t.moveTo(M,y+G),t.lineTo(M,y+D),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath(),t.arc(M,y,2,0,Math.PI*2),t.fill()}}function mr({world:t,player:e}){let n=[];function a(f,d,h){let u=h||Vo+Math.floor(Math.random()*Uo);n.push({x:f,y:d,timer:u})}function i(f){let d=f.y-e.height-.1;e.y=d;let h=t.height*p;e.y=(e.y%h+h)%h,e.vy=0,e.grounded=!0;let u=Math.floor(e.x/p),m=Math.floor((e.x+e.width)/p),_=Math.floor(e.y/p),E=Math.floor((e.y+e.height)/p),A=null;for(let T=_;T<=E;T++)for(let b=u;b<=m;b++){let S=(T%t.height+t.height)%t.height,C=(b%t.width+t.width)%t.width,k=t.getBlock(C,S);if(lt(k,$))if(Et(k,$))t.setBlock(C,S,c.AIR);else{let V=T*p;A=A===null?V:Math.min(A,V)}}A!==null&&(e.y=A-e.height-.1,e.y=(e.y%h+h)%h)}function s(f,d,h){if(f<0||f>=t.width)return;let u=(d%t.height+t.height)%t.height,m=t.getBlock(f,u);if($[m]&&$[m].unbreakable)return;m!==c.AIR&&m!==c.SAPLING&&t.setBlock(f,u,c.AIR);let _={x:f*p,y:u*p,w:p,h:p};le(e.getRect(),_)&&i(_),t.setBlock(f,u,h)}function o(f,d){let h=[],u=[{x:f,y:d}],m=new Set,_=(E,A)=>`${E},${A}`;for(m.add(_(f,d));u.length>0;){let E=u.shift();if(t.getBlock(E.x,E.y)===c.SAPLING){h.push(E);let A=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(let T of A){let b=E.x+T.dx,C=((E.y+T.dy)%t.height+t.height)%t.height;if(b>=0&&b<t.width){let k=_(b,C);!m.has(k)&&t.getBlock(b,C)===c.SAPLING&&(m.add(k),u.push({x:b,y:C}))}}}}return h}function r(f){let d=f.length;if(d===0)return;let h=1/0,u=-1/0,m=1/0,_=-1/0;f.forEach(g=>{g.x<h&&(h=g.x),g.x>u&&(u=g.x),g.y<m&&(m=g.y),g.y>_&&(_=g.y)});let E=u-h+1,A=_-m+1,T=A/E,b=Math.floor((h+u)/2),S=_;f.forEach(g=>{t.setBlock(g.x,g.y,c.AIR)});let C=5,k=1,V=0,O=0,L=1,x=A>t.height/2;!x&&T>=2?(k=1,L=1.5,V=.02):!x&&T<=.5?(k=E,L=.8,V=.05):(k=Math.ceil(Math.sqrt(d)),V=.3,O=.3);let K=Math.floor(d*C*L),W=[],F=0,w=S,B=b;for(;F<K;){let g=k;if(O>0&&Math.random()<O&&(g+=Math.random()<.5?-1:1),g<1&&(g=1),!(S-w<2)){if(Math.random()<V){let X=Math.random()<.5?-1:1;B+=X}B<b-3&&Math.random()<.2&&B++,B>b+3&&Math.random()<.2&&B--}let U=B-Math.floor((g-1)/2);for(let X=0;X<g;X++)W.push({x:U+X,y:w,type:c.WOOD}),F++;if(w--,S-w>100)break}let M=w+1,y=B,D=2+k*.8;D>6&&(D=6);let G=Math.ceil(D),Z=Math.ceil(D*.8);for(let g=M-Z;g<=M+Z;g++)for(let R=y-G;R<=y+G;R++){let U=(R-y)/G,X=(g-M)/Z;Math.sqrt(U*U+X*X)<1-Math.random()*.25&&(W.some(j=>j.x===R&&j.y===g&&j.type===c.WOOD)||W.push({x:R,y:g,type:c.LEAVES}))}W.forEach(({x:g,y:R,type:U})=>s(g,R,U))}function l(){for(let f=n.length-1;f>=0;f--){let d=n[f];if(t.getBlock(d.x,d.y)!==c.SAPLING){n.splice(f,1);continue}if(d.timer--,d.timer<=0){let h=o(d.x,d.y);r(h)}}for(let f=n.length-1;f>=0;f--)t.getBlock(n[f].x,n[f].y)!==c.SAPLING&&n.splice(f,1)}return{addSapling:a,tick:l,getTimers:()=>n,restoreTimers:f=>{n.length=0,f&&n.push(...f)}}}Jt();var pr=0;var _r=12,gr=13;function br(t){let{onStartGame:e,onLoadGame:n,onImportWorld:a}=t;function i(){let g=document.getElementById("start-screen");g&&(g.style.display="none")}function s(){let g=Ct(),R=document.querySelector(".start-buttons");R&&(g?R.classList.add("has-save"):R.classList.remove("has-save"))}s();let o=document.getElementById("vol-bgm"),r=document.getElementById("vol-sfx"),l=document.getElementById("volume-toggle-btn"),f=document.getElementById("volume-popup");function d(){let g=localStorage.getItem("pictoco_vol_bgm"),R=localStorage.getItem("pictoco_vol_sfx"),U=g!==null?parseFloat(g):1,X=R!==null?parseFloat(R):1;o&&(o.value=U),r&&(r.value=X),J.setMusicVolume(U),J.setSfxVolume(X)}o&&o.addEventListener("input",g=>{let R=parseFloat(g.target.value);J.setMusicVolume(R),localStorage.setItem("pictoco_vol_bgm",R)}),r&&r.addEventListener("input",g=>{let R=parseFloat(g.target.value);J.setSfxVolume(R),localStorage.setItem("pictoco_vol_sfx",R)}),l&&f&&l.addEventListener("click",g=>{g.stopPropagation(),f.classList.contains("open")?f.classList.remove("open"):f.classList.add("open")}),d();let h=document.getElementById("start-btn");h&&h.addEventListener("click",()=>{i(),e()});let u=document.getElementById("reset-btn");u&&u.addEventListener("click",()=>{i(),e()});let m=document.getElementById("continue-btn");m&&m.addEventListener("click",()=>{let g=Ct();g&&(i(),n(g))});let _=document.getElementById("world-modal"),E=document.getElementById("world-btn"),A=document.getElementById("world-close-btn"),T=document.getElementById("export-btn"),b=document.getElementById("import-btn"),S=document.getElementById("import-file");function C(){if(T){let g=Ct();T.disabled=!g||!g.world||!g.world.map}b&&S&&(b.disabled=!S.files[0])}function k(){_&&(_.classList.add("visible"),C())}function V(){_&&_.classList.remove("visible")}E&&E.addEventListener("click",k),A&&A.addEventListener("click",V),_&&_.addEventListener("click",g=>{g.target===_&&V()}),S&&S.addEventListener("change",C),T&&T.addEventListener("click",async()=>{let g=Ct();if(!g||!g.world||!g.world.map)return;let R=atob(g.world.map),U=new Uint8Array(R.length);for(let Q=0;Q<R.length;Q++)U[Q]=R.charCodeAt(Q);let X=await nr(U,g.world.width,g.world.height),z=new Date().toISOString().slice(0,19).replace(/[:-]/g,"");rr(X,`world_${z}.png`)}),b&&S&&b.addEventListener("click",async()=>{let g=S.files[0];if(g)try{let R=await ir(g);V(),i(),a(R)}catch{alert(ht.msg_import_err)}});let O=document.getElementById("lang-current"),L=document.getElementById("lang-popup"),x=document.querySelectorAll(".lang-option");function K(){Promise.resolve().then(()=>(Jt(),en)).then(({currentLanguage:g})=>{if(O){O.innerHTML="";let R=document.createElement("div");R.className=`flag-icon flag-${g}`,O.appendChild(R)}x.forEach(R=>{R.dataset.lang===g?R.classList.add("active"):R.classList.remove("active")})})}function W(){L&&L.classList.add("open")}function F(){L&&L.classList.remove("open")}K(),O&&O.addEventListener("click",g=>{g.stopPropagation(),L&&L.classList.contains("open")?F():W()}),x.forEach(g=>{g.addEventListener("click",R=>{R.stopPropagation();let U=g.dataset.lang;Ze(U),K(),F()})}),document.addEventListener("click",g=>{L&&L.classList.contains("open")&&!L.contains(g.target)&&g.target!==O&&F(),f&&f.classList.contains("open")&&!f.contains(g.target)&&g.target!==l&&f.classList.remove("open")});let w=0,B=!1,M=!1,y=!1;function D(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none")return[];let R=[];if(Ct()){let z=document.getElementById("continue-btn");z&&R.push(z);let Q=document.getElementById("reset-btn");Q&&R.push(Q)}else{let z=document.getElementById("start-btn");z&&R.push(z)}let X=document.getElementById("world-btn");return X&&R.push(X),R}function G(){D().forEach((R,U)=>{U===w?(R.classList.add("gamepad-selected"),R.focus()):R.classList.remove("gamepad-selected")})}function Z(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none"||_&&_.classList.contains("visible"))return;let R=navigator.getGamepads(),U=null;for(let ct of R)if(ct&&ct.connected){U=ct;break}if(!U)return;let{buttons:X}=U,z=D(),Q=X[_r]&&X[_r].pressed;Q&&!B&&(w=Math.max(0,w-1),G()),B=Q;let j=X[gr]&&X[gr].pressed;j&&!M&&(w=Math.min(z.length-1,w+1),G()),M=j;let ut=X[pr]&&X[pr].pressed;if(ut&&!y){let ct=z[w];ct&&ct.click()}y=ut}setInterval(Z,50),window.addEventListener("gamepadconnected",()=>{w=0,G()})}function Ar(){let t=0,e=0,n=1;return{get x(){return t},get y(){return e},get zoom(){return n},setPosition(a,i){t=a,e=i},update(a,i,s,o){let r=Math.hypot(a.vx,a.vy),l=1;r>Ke&&(l=Math.max(yo,1-(r-Ke)*Ro));let f=1e-4,d=.002,h=.06,u=.05,m=l-n,_=Math.abs(m);_<f?n=l:_>u?(n+=Math.sign(m)*d,(l-n)*m<0&&(n=l)):(n+=m*h,Math.abs(l-n)<f&&(n=l));let E=s/n,A=o/n,T=a.getCenterX()-E/2,b=a.getCenterY()-A/2,S=i.width*p,C=T-t;Math.abs(C)>S/2&&(C>0?t+=S:t-=S);let k=i.height*p,V=b-e;Math.abs(V)>k/2&&(V>0?e+=k:e-=k),t=Fe(t,T,We),e=Fe(e,b,We)}}}Jt();$e();var ae={},Kt=document.getElementById("gameCanvas"),_o=Kt.getContext("2d"),q,tt,ie=0,st,rt,Vt,at=null,re=null,Be=null,De=0,ga=.25,mo=0,At=window.innerWidth,Tt=window.innerHeight;function Tr(){let t=window.devicePixelRatio||1;At=window.innerWidth,Tt=window.innerHeight,Kt.width=At*t,Kt.height=Tt*t,Kt.style.width=At+"px",Kt.style.height=Tt+"px",_o.scale(t,t),_o.imageSmoothingEnabled=!1}window.addEventListener("resize",Tr);function po(t=null){q=new Nt(ot,nt);let e=(n,a)=>{J.playExplosion();for(let i of a)q.setBlock(n,i,c.AIR),at&&at.cancelTimerAt(n,i)};tt=new Oe(q,ge,e,(n,a)=>{Tn(n,a)}),ae=Ho(),On(ae),st=Ar(),at=or({world:q,player:tt,sounds:J,addToInventory:ge,createExplosionParticles:no}),re=mr({world:q,player:tt}),zi({onTNTAccelerator:(n,a)=>{J.playExplosion();for(let i of n)q.setBlock(i,a,c.AIR),at&&at.cancelTimerAt(i,a)}}),Vt=vn({world:q,player:tt,inventory:{addToInventory:ge,consumeFromInventory:Zo,getSelectedBlockId:Jo},camera:st,sounds:J,constants:{TILE_SIZE:p,BLOCKS:c,BLOCK_PROPS:$,REACH:Xt},utils:{screenToWorld:Yt,worldToTile:Ut,isWithinReach:ce,isBlockBreakable:Et,isBlockTransparent:fe,isBlockSolid:lt,getBlockMaterialType:de,rectsIntersect:le,hasAdjacentBlock:Eo},onBlockPlaced:(n,a,i)=>{if(i===c.TNT){let s=a-1;for(;q.getBlock(n,s)===c.TNT;)s--;let r=q.getBlock(n,s)===c.JUMP_PAD,l=n-1;for(;q.getBlock(l,a)===c.TNT;)l--;let f=q.getBlock(l,a)===c.ACCELERATOR_LEFT,d=n+1;for(;q.getBlock(d,a)===c.TNT;)d++;let h=q.getBlock(d,a)===c.ACCELERATOR_RIGHT;if(!(r||f||h))at.onBlockPlaced(n,a);else{if(r){let m=a+1;for(;q.getBlock(n,m)===c.TNT;)at.cancelTimerAt(n,m),m++}if(f){let m=n+1;for(;q.getBlock(m,a)===c.TNT;)at.cancelTimerAt(m,a),m++}if(h){let m=n-1;for(;q.getBlock(m,a)===c.TNT;)at.cancelTimerAt(m,a),m--}}}else if(i===c.JUMP_PAD){let s=a+1;for(;q.getBlock(n,s)===c.TNT;)at.cancelTimerAt(n,s),s++}else if(i===c.ACCELERATOR_LEFT){let s=n+1;for(;q.getBlock(s,a)===c.TNT;)at.cancelTimerAt(s,a),s++}else if(i===c.ACCELERATOR_RIGHT){let s=n-1;for(;q.getBlock(s,a)===c.TNT;)at.cancelTimerAt(s,a),s--}else i===c.SAPLING&&re.addSapling(n,a)}}),rt=jo(Kt,{onHotbarSelect:jt,onTouch:(n,a)=>{_t?qt(!0):Vt.handlePointer(n,a)},onClimb:()=>Vt.triggerClimb()}),$o(ae),Be=er({world:q,player:tt,timers:{tnt:at.getTimers(),saplings:re.getTimers()},inventory:{getInventoryState:qo,loadInventoryState:qe},utils:{clamp:Mt},constants:{TILE_SIZE:p}}),t?(Be.applySavedState(t),t.timers&&t.timers.saplings&&re.restoreTimers(t.timers.saplings)):vt(),Tr(),st.setPosition(tt.getCenterX()-At/2,tt.getCenterY()-Tt/2),Be.startAutosave(),Be.saveGameState(),ie===0&&requestAnimationFrame(go)}function ba(){if(tt){if(De>0&&De--,rt.pollGamepads){let t=(tt.getCenterX()-st.x)*st.zoom,e=(tt.getCenterY()-st.y)*st.zoom;rt.pollGamepads({screenWidth:At,screenHeight:Tt,playerScreenX:t,playerScreenY:e,reach:(Xt-So)*st.zoom,skipJump:_t})}if(tt.tick(rt),rt.mouse.leftDown&&(_t?qt(!0):Vt.handlePointer(rt.mouse.x,rt.mouse.y),rt.mouse.leftDown=!1),rt.gamepad&&rt.gamepad.connected&&!_t){let t=rt.gamepad.cursorX,e=rt.gamepad.cursorY;rt.gamepad.breakAction&&De===0&&Vt.handlePointer(t,e,"break")&&(De=Io),rt.gamepad.placeAction&&Vt.handlePointer(t,e,"place")}un(tt,q,ae),_t&&hn(),Ji(tt,q,J),Zi(),Qi(tt,q),tr(),Mn(q,st.x,st.y,{width:At,height:Tt}),kn(),at.tick(),re.tick()}}function Aa(){tt&&st.update(tt,q,At,Tt)}function Ta(){ur(_o,{world:q,player:tt,cameraX:st.x,cameraY:st.y,zoom:st.zoom,logicalWidth:At,logicalHeight:Tt,textures:ae,input:rt,tntManager:at})}function go(t){if(ie===0){ie=t,requestAnimationFrame(go);return}let e=t-ie;for(ie=t,e>50&&(e=50),mo+=e;mo>=Ht-ga;)ba(),mo-=Ht;Aa(),Ta(),requestAnimationFrame(go)}var Pt=()=>{J.resume()};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Pt()});window.addEventListener("pageshow",t=>{t.persisted&&Pt(),Pt()});window.addEventListener("focus",Pt);window.addEventListener("click",Pt);window.addEventListener("keydown",Pt);window.addEventListener("touchstart",Pt);window.addEventListener("touchend",Pt);br({onStartGame:()=>{J.init(),po()},onLoadGame:t=>{J.init(),po(t)},onImportWorld:t=>{J.init();let n=Ct()?.inventory||null;po(),q.map=t,n&&qe(n);let a=ar(t,ot,nt);tt.x=a.x*p,tt.y=a.y*p,tt.vx=0,tt.vy=0,st.setPosition(tt.getCenterX()-At/2,tt.getCenterY()-Tt/2)}});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(t=>{console.log("ServiceWorker registered:",t.scope)}).catch(t=>{console.log("ServiceWorker registration failed:",t)})});})();
