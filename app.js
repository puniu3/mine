(()=>{var Mr=Object.defineProperty;var Er=(t,o)=>()=>(t&&(o=t(t=0)),o);var Sr=(t,o)=>{for(var i in o)Mr(t,i,{get:o[i],enumerable:!0})};var tn={};Sr(tn,{currentLanguage:()=>zo,initI18n:()=>Ze,resources:()=>St,setLanguage:()=>qe,strings:()=>ht,supportedLanguages:()=>wr});function Or(){let t=localStorage.getItem($o);if(t&&St[t])return t;let o=navigator.language||navigator.userLanguage||"en",i=o.split("-")[0];return St[o]?o:St[i]?i:"en"}function Qo(t){let o=St[t]||St.en;zo=t,Object.keys(ht).forEach(i=>delete ht[i]),Object.assign(ht,o),document.documentElement.lang=t,document.querySelectorAll("[data-i18n]").forEach(i=>{let r=i.getAttribute("data-i18n");ht[r]&&(i.innerText=ht[r])})}function qe(t){if(!St[t]){console.warn(`Language '${t}' not supported`);return}localStorage.setItem($o,t),Qo(t),navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_LANGUAGE_FONTS",lang:t})}function Ze(){let t=Or();Qo(t),navigator.serviceWorker&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CACHE_LANGUAGE_FONTS",lang:t})}var St,ht,$o,wr,zo,Jt=Er(()=>{St={semantics:{continue_btn:"Title screen: Continue button. Resumes from autosave (game saves to browser localStorage every 5 seconds).",start_btn:"Title screen: Start button. Displayed when no save data exists. Starts with new player data and world.",reset_btn:"Title screen: Restart button. Displayed when save data exists. Deletes current save and starts fresh.",world_btn:"Title screen: World button. Opens modal to export/import world data as images.",inst_pc:"Title screen: Instruction header. Guide for keyboard + mouse controls.",inst_move_pc:"Title screen: Instruction. A, D, Left, Right to move.",inst_jump_pc:"Title screen: Instruction. Space key, W, Up to jump.",inst_action_pc:"Title screen: Instruction. Click to place or break (gather) blocks.",inst_climb_pc:"Title screen: Instruction. S to place block at feet and climb.",inst_mobile:"Title screen: Instruction header. Guide for touch controls.",inst_move_mobile:"Title screen: Instruction. Left/Right triangle buttons appear at bottom left; tap to move.",inst_jump_mobile:"Title screen: Instruction. Up triangle button appears at bottom right; tap to jump.",inst_action_mobile:"Title screen: Instruction. Tap tiles directly around the player character to break or place blocks.",inst_climb_mobile:"Title screen: Instruction. Tap the player character to place a block at feet and climb up.",inst_gamepad:"Title screen: Instruction header. Guide for gamepad controls.",label_move:"Title screen: Gamepad instruction label. Indicates controls for character movement.",label_cursor:"Title screen: Gamepad instruction label. Indicates controls for cursor movement.",label_jump:"Title screen: Gamepad instruction label. Indicates the button for jumping.",label_make:"Title screen: Gamepad instruction label. Indicates the button for placing blocks.",label_break:"Title screen: Gamepad instruction label. Indicates the button for breaking blocks.",label_climb:"Title screen: Gamepad instruction label. Indicates the button to place a block at feet and climb up.",label_select:"Title screen: Gamepad instruction label. Indicates buttons to cycle through items in the hotbar (left/right).",world_modal_title:"Modal window title for reading/writing world data.",world_export_title:"Header for the export section.",world_export_desc:"Export world data as a PNG image. 1 tile converts to 1 pixel, allowing the world to be viewed directly as an image.",world_export_btn:"Button to execute export.",world_import_title:"Header for the import section.",world_import_desc:"Imports an image, converts it to world data, and starts the game. Keeps existing player data. Forces closest-color matching for any uploaded image.",world_import_btn:"Button to execute import.",world_back_btn:"Button to close the window.",craft_missing:"Crafting screen message. Displayed when selecting an item at workbench but inventory lacks required materials.",craft_done:"Crafting screen message. Displayed when an item is successfully created.",msg_import_err:"World window alert message. Displayed when the try-catch block fails during image loading/world generation."},style:{target_audience:"6-year-olds",tone:"Carefree, colloquial, and friendly",context:"Children playing independently without adult supervision",vocabulary:"Simple, easy-to-understand words; strictly avoid technical jargon"},ja:{continue_btn:"\u3064\u3065\u304D\u304B\u3089",start_btn:"\u306F\u3058\u3081\u308B",reset_btn:"\u306F\u3058\u3081\u304B\u3089",world_btn:"\u30EF\u30FC\u30EB\u30C9",inst_pc:"\u30D1\u30BD\u30B3\u30F3",inst_move_pc:"\u3046\u3054\u304F: \u3084\u3058\u308B\u3057 / A D",inst_jump_pc:"\u3068\u3076: \u30B9\u30DA\u30FC\u30B9 / W / \u2191",inst_action_pc:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30AF\u30EA\u30C3\u30AF",inst_climb_pc:"\u306E\u307C\u308B: S",inst_mobile:"\u30B9\u30DE\u30DB",inst_move_mobile:"\u3046\u3054\u304F: \u2190 \u2192",inst_jump_mobile:"\u3068\u3076: \u2191",inst_action_mobile:"\u3064\u304F\u308B\u30FB\u3053\u308F\u3059: \u30BF\u30C3\u30D7",inst_climb_mobile:"\u306E\u307C\u308B: \u30AD\u30E3\u30E9\u3092\u30BF\u30C3\u30D7",inst_gamepad:"\u30B3\u30F3\u30C8\u30ED\u30FC\u30E9\u30FC",label_move:"\u3046\u3054\u304F",label_cursor:"\u30AB\u30FC\u30BD\u30EB",label_jump:"\u3068\u3076",label_make:"\u3064\u304F\u308B",label_break:"\u3053\u308F\u3059",label_climb:"\u306E\u307C\u308B",label_select:"\u3048\u3089\u3076",world_modal_title:"\u30EF\u30FC\u30EB\u30C9",world_export_title:"\u306E\u3053\u3059",world_export_desc:"\u3064\u304F\u3063\u305F \u305B\u304B\u3044\u3092 \u3048\u306B\u3059\u308B",world_export_btn:"\u3048\u306B\u3059\u308B",world_import_title:"\u3088\u307F\u3053\u3080",world_import_desc:"\u3048\u3092 \u3088\u307F\u3053\u3093\u3067 \u3042\u305D\u3076",world_import_btn:"\u3088\u307F\u3053\u3080",world_back_btn:"\u3082\u3069\u308B",craft_missing:"\u3056\u3044\u308A\u3087\u3046\u304C\u305F\u308A\u306A\u3044\u3088",craft_done:"\u3067\u304D\u305F\u3088\uFF01",msg_import_err:"\u3053\u306E \u3048\u3067\u306F \u30EF\u30FC\u30EB\u30C9\u3092 \u3064\u304F\u308C\u306A\u3044\u3088"},en:{continue_btn:"Continue",start_btn:"Start",reset_btn:"Start Over",world_btn:"World",inst_pc:"PC Controls",inst_move_pc:"Move: Arrows / A D",inst_jump_pc:"Jump: Space / W / Up",inst_action_pc:"Put / Break: Click",inst_climb_pc:"Climb: S",inst_mobile:"Touch Controls",inst_move_mobile:"Move: \u2190 \u2192",inst_jump_mobile:"Jump: \u2191",inst_action_mobile:"Put / Break: Tap",inst_climb_mobile:"Climb: Tap Player",inst_gamepad:"Controller",label_move:"Move",label_cursor:"Cursor",label_jump:"Jump",label_make:"Put",label_break:"Break",label_climb:"Climb",label_select:"Select",world_modal_title:"My World",world_export_title:"Save",world_export_desc:"Turn your world into a picture.",world_export_btn:"Make Picture",world_import_title:"Load",world_import_desc:"Load a picture to play.",world_import_btn:"Load Picture",world_back_btn:"Back",craft_missing:"Need more items!",craft_done:"Done!",msg_import_err:"Can't use this picture."},zh:{continue_btn:"\u7EE7\u7EED\u73A9",start_btn:"\u5F00\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u5F00\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u7535\u8111\u600E\u4E48\u73A9",inst_move_pc:"\u79FB\u52A8: \u7BAD\u5934 / A D",inst_jump_pc:"\u8DF3: \u7A7A\u683C\u952E / W / \u2191",inst_action_pc:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u51FB",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u673A\u600E\u4E48\u73A9",inst_move_mobile:"\u79FB\u52A8: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u76D6\u4E1C\u897F / \u62C6\u65B9\u5757: \u70B9\u6309",inst_climb_mobile:"\u722C\u9AD8: \u70B9\u6309\u89D2\u8272",inst_gamepad:"\u624B\u67C4\u600E\u4E48\u73A9",label_move:"\u79FB\u52A8",label_cursor:"\u5149\u6807",label_jump:"\u8DF3",label_make:"\u76D6",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9009",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u53D8\u6210\u4E00\u5F20\u753B",world_export_btn:"\u53D8\u6210\u753B",world_import_title:"\u8BFB\u53D6",world_import_desc:"\u8BFB\u53D6\u753B\u6765\u73A9",world_import_btn:"\u8BFB\u53D6\u753B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u591F\u54E6",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u8FD9\u5F20\u753B\u4E0D\u80FD\u7528\u54E6"},"zh-TW":{continue_btn:"\u7E7C\u7E8C\u73A9",start_btn:"\u958B\u59CB\u73A9",reset_btn:"\u91CD\u65B0\u958B\u59CB",world_btn:"\u4E16\u754C",inst_pc:"\u96FB\u8166\u600E\u9EBC\u73A9",inst_move_pc:"\u79FB\u52D5: \u7BAD\u982D / A D",inst_jump_pc:"\u8DF3: \u7A7A\u767D\u9375 / W / \u2191",inst_action_pc:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u64CA",inst_climb_pc:"\u722C\u9AD8: S",inst_mobile:"\u624B\u6A5F\u600E\u9EBC\u73A9",inst_move_mobile:"\u79FB\u52D5: \u2190 \u2192",inst_jump_mobile:"\u8DF3: \u2191",inst_action_mobile:"\u84CB\u6771\u897F / \u62C6\u65B9\u584A: \u9EDE\u6309",inst_climb_mobile:"\u722C\u9AD8: \u9EDE\u6309\u89D2\u8272",inst_gamepad:"\u624B\u628A\u600E\u9EBC\u73A9",label_move:"\u79FB\u52D5",label_cursor:"\u6E38\u6A19",label_jump:"\u8DF3",label_make:"\u84CB",label_break:"\u62C6",label_climb:"\u722C",label_select:"\u9078",world_modal_title:"\u6211\u7684\u4E16\u754C",world_export_title:"\u4FDD\u5B58",world_export_desc:"\u628A\u4E16\u754C\u8B8A\u6210\u4E00\u5F35\u756B",world_export_btn:"\u8B8A\u6210\u756B",world_import_title:"\u8B80\u53D6",world_import_desc:"\u8B80\u53D6\u756B\u4F86\u73A9",world_import_btn:"\u8B80\u53D6\u756B",world_back_btn:"\u8FD4\u56DE",craft_missing:"\u6750\u6599\u4E0D\u5920\u5594",craft_done:"\u505A\u597D\u4E86\uFF01",msg_import_err:"\u9019\u5F35\u756B\u4E0D\u80FD\u7528\u5594"},es:{continue_btn:"Seguir",start_btn:"Jugar",reset_btn:"Desde cero",world_btn:"Mundo",inst_pc:"En PC",inst_move_pc:"Mover: Flechas / A D",inst_jump_pc:"Saltar: Espacio / W / \u2191",inst_action_pc:"Poner / Quitar: Clic",inst_climb_pc:"Subir: S",inst_mobile:"En m\xF3vil",inst_move_mobile:"Mover: \u2190 \u2192",inst_jump_mobile:"Saltar: \u2191",inst_action_mobile:"Poner / Quitar: Tocar",inst_climb_mobile:"Subir: Tocar personaje",inst_gamepad:"Mando",label_move:"Mover",label_cursor:"Cursor",label_jump:"Saltar",label_make:"Poner",label_break:"Quitar",label_climb:"Subir",label_select:"Elegir",world_modal_title:"Mi Mundo",world_export_title:"Guardar",world_export_desc:"Convierte tu mundo en un dibujo.",world_export_btn:"Hacer dibujo",world_import_title:"Cargar",world_import_desc:"Usa un dibujo para jugar.",world_import_btn:"Usar dibujo",world_back_btn:"Volver",craft_missing:"\xA1Te faltan cosas!",craft_done:"\xA1Listo!",msg_import_err:"No puedo usar este dibujo."},fr:{continue_btn:"Continuer",start_btn:"Jouer",reset_btn:"Recommencer",world_btn:"Monde",inst_pc:"Sur ordi",inst_move_pc:"Bouger : Fl\xE8ches / A D",inst_jump_pc:"Sauter : Espace / W / \u2191",inst_action_pc:"Mettre / Casser : Clic",inst_climb_pc:"Monter : S",inst_mobile:"Sur mobile",inst_move_mobile:"Bouger : \u2190 \u2192",inst_jump_mobile:"Sauter : \u2191",inst_action_mobile:"Mettre / Casser : Toucher",inst_climb_mobile:"Monter : Touche sur toi",inst_gamepad:"Manette",label_move:"Bouger",label_cursor:"Curseur",label_jump:"Sauter",label_make:"Mettre",label_break:"Casser",label_climb:"Monter",label_select:"Choisir",world_modal_title:"Mon Monde",world_export_title:"Garder",world_export_desc:"Transforme ton monde en image.",world_export_btn:"Faire une image",world_import_title:"Ouvrir",world_import_desc:"Ouvre une image pour jouer.",world_import_btn:"Ouvrir une image",world_back_btn:"Retour",craft_missing:"Il te manque des trucs !",craft_done:"C'est fait !",msg_import_err:"Je ne peux pas utiliser cette image."},de:{continue_btn:"Weiter",start_btn:"Starten",reset_btn:"Neustart",world_btn:"Welt",inst_pc:"Am Computer",inst_move_pc:"Laufen: Pfeile / A D",inst_jump_pc:"H\xFCpfen: Leertaste / W / \u2191",inst_action_pc:"Bauen / Abbauen: Klick",inst_climb_pc:"Klettern: S",inst_mobile:"Am Handy",inst_move_mobile:"Laufen: \u2190 \u2192",inst_jump_mobile:"H\xFCpfen: \u2191",inst_action_mobile:"Bauen / Abbauen: Tippen",inst_climb_mobile:"Klettern: Tipp auf dich",inst_gamepad:"Controller",label_move:"Laufen",label_cursor:"Cursor",label_jump:"H\xFCpfen",label_make:"Bauen",label_break:"Abbauen",label_climb:"Klettern",label_select:"W\xE4hlen",world_modal_title:"Meine Welt",world_export_title:"Speichern",world_export_desc:"Mach ein Bild aus deiner Welt.",world_export_btn:"Bild machen",world_import_title:"Laden",world_import_desc:"Lade ein Bild zum Spielen.",world_import_btn:"Bild laden",world_back_btn:"Zur\xFCck",craft_missing:"Dir fehlen Sachen!",craft_done:"Fertig!",msg_import_err:"Das Bild geht nicht."},it:{continue_btn:"Continua",start_btn:"Gioca",reset_btn:"Ricomincia",world_btn:"Mondo",inst_pc:"Computer",inst_move_pc:"Muovi: Frecce / A D",inst_jump_pc:"Salta: Spazio / W / \u2191",inst_action_pc:"Metti / Rompi: Clic",inst_climb_pc:"Sali: S",inst_mobile:"Telefono",inst_move_mobile:"Muovi: \u2190 \u2192",inst_jump_mobile:"Salta: \u2191",inst_action_mobile:"Metti / Rompi: Tocca",inst_climb_mobile:"Sali: Tocca l'omino",inst_gamepad:"Controller",label_move:"Muovi",label_cursor:"Cursore",label_jump:"Salta",label_make:"Metti",label_break:"Rompi",label_climb:"Sali",label_select:"Scegli",world_modal_title:"Mio Mondo",world_export_title:"Salva",world_export_desc:"Trasforma il mondo in una foto.",world_export_btn:"Fai una foto",world_import_title:"Carica",world_import_desc:"Usa una foto per giocare.",world_import_btn:"Usa foto",world_back_btn:"Indietro",craft_missing:"Mancano oggetti!",craft_done:"Fatto!",msg_import_err:"Non posso usare questa foto."},pt:{continue_btn:"Continuar",start_btn:"Jogar",reset_btn:"Do come\xE7o",world_btn:"Mundo",inst_pc:"No PC",inst_move_pc:"Andar: Setas / A D",inst_jump_pc:"Pular: Espa\xE7o / W / \u2191",inst_action_pc:"P\xF4r / Tirar: Clique",inst_climb_pc:"Subir: S",inst_mobile:"No Celular",inst_move_mobile:"Andar: \u2190 \u2192",inst_jump_mobile:"Pular: \u2191",inst_action_mobile:"P\xF4r / Tirar: Toque",inst_climb_mobile:"Subir: Toque no boneco",inst_gamepad:"Controle",label_move:"Andar",label_cursor:"Cursor",label_jump:"Pular",label_make:"P\xF4r",label_break:"Tirar",label_climb:"Subir",label_select:"Escolher",world_modal_title:"Meu Mundo",world_export_title:"Salvar",world_export_desc:"Vira uma foto do seu mundo.",world_export_btn:"Criar foto",world_import_title:"Abrir",world_import_desc:"Use uma foto para jogar.",world_import_btn:"Abrir foto",world_back_btn:"Voltar",craft_missing:"Falta coisa!",craft_done:"Pronto!",msg_import_err:"N\xE3o d\xE1 pra usar essa foto."},ko:{continue_btn:"\uC774\uC5B4\uD558\uAE30",start_btn:"\uC2DC\uC791\uD558\uAE30",reset_btn:"\uCC98\uC74C\uBD80\uD130",world_btn:"\uC6D4\uB4DC",inst_pc:"\uCEF4\uD4E8\uD130",inst_move_pc:"\uC774\uB3D9: \uD654\uC0B4\uD45C / A D",inst_jump_pc:"\uC810\uD504: \uC2A4\uD398\uC774\uC2A4\uBC14 / W / \u2191",inst_action_pc:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD074\uB9AD",inst_climb_pc:"\uC62C\uB77C\uAC00\uAE30: S",inst_mobile:"\uC2A4\uB9C8\uD2B8\uD3F0",inst_move_mobile:"\uC774\uB3D9: \u2190 \u2192",inst_jump_mobile:"\uC810\uD504: \u2191",inst_action_mobile:"\uB193\uAE30 / \uBD80\uC218\uAE30: \uD130\uCE58",inst_climb_mobile:"\uC62C\uB77C\uAC00\uAE30: \uCE90\uB9AD\uD130 \uD130\uCE58",inst_gamepad:"\uAC8C\uC784\uD328\uB4DC",label_move:"\uC774\uB3D9",label_cursor:"\uCEE4\uC11C",label_jump:"\uC810\uD504",label_make:"\uB193\uAE30",label_break:"\uBD80\uC218\uAE30",label_climb:"\uC62C\uB77C\uAC00\uAE30",label_select:"\uC120\uD0DD",world_modal_title:"\uB098\uC758 \uC6D4\uB4DC",world_export_title:"\uC800\uC7A5",world_export_desc:"\uC6D4\uB4DC\uB97C \uADF8\uB9BC\uC73C\uB85C \uB9CC\uB4E4\uAE30.",world_export_btn:"\uADF8\uB9BC \uB9CC\uB4E4\uAE30",world_import_title:"\uBD88\uB7EC\uC624\uAE30",world_import_desc:"\uADF8\uB9BC\uC744 \uBD88\uB7EC\uC640\uC11C \uB180\uAE30.",world_import_btn:"\uADF8\uB9BC \uAC00\uC838\uC624\uAE30",world_back_btn:"\uB3CC\uC544\uAC00\uAE30",craft_missing:"\uC7AC\uB8CC\uAC00 \uBD80\uC871\uD574!",craft_done:"\uB2E4 \uB9CC\uB4E4\uC5C8\uC5B4!",msg_import_err:"\uC774 \uADF8\uB9BC\uC740 \uC4F8 \uC218 \uC5C6\uC5B4."},ru:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",start_btn:"\u0418\u0433\u0440\u0430\u0442\u044C",reset_btn:"\u0421 \u043D\u0430\u0447\u0430\u043B\u0430",world_btn:"\u041C\u0438\u0440",inst_pc:"\u041A\u043E\u043C\u043F\u044C\u044E\u0442\u0435\u0440",inst_move_pc:"\u0425\u043E\u0434\u0438\u0442\u044C: \u0421\u0442\u0440\u0435\u043B\u043A\u0438 / A D",inst_jump_pc:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u041F\u0440\u043E\u0431\u0435\u043B / W / \u2191",inst_action_pc:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041A\u043B\u0438\u043A",inst_climb_pc:"\u041B\u0435\u0437\u0442\u044C: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0425\u043E\u0434\u0438\u0442\u044C: \u2190 \u2192",inst_jump_mobile:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C: \u2191",inst_action_mobile:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C / \u041B\u043E\u043C\u0430\u0442\u044C: \u041D\u0430\u0436\u043C\u0438",inst_climb_mobile:"\u041B\u0435\u0437\u0442\u044C: \u041D\u0430\u0436\u043C\u0438 \u043D\u0430 \u0433\u0435\u0440\u043E\u044F",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0425\u043E\u0434\u0438\u0442\u044C",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u041F\u0440\u044B\u0433\u0430\u0442\u044C",label_make:"\u0421\u0442\u0440\u043E\u0438\u0442\u044C",label_break:"\u041B\u043E\u043C\u0430\u0442\u044C",label_climb:"\u041B\u0435\u0437\u0442\u044C",label_select:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C",world_modal_title:"\u041C\u043E\u0439 \u043C\u0438\u0440",world_export_title:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",world_export_desc:"\u041F\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442\u044C \u043C\u0438\u0440 \u0432 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0421\u0434\u0435\u043B\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_import_desc:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 \u0438 \u0438\u0433\u0440\u0430\u0442\u044C.",world_import_btn:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0432\u0435\u0449\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u042D\u0442\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442."},id:{continue_btn:"Lanjut",start_btn:"Main",reset_btn:"Mulai ulang",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Panah / A D",inst_jump_pc:"Lompat: Spasi / W / \u2191",inst_action_pc:"Buat / Pecahkan: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"HP",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Buat / Pecahkan: Sentuh",inst_climb_mobile:"Panjat: Sentuh karakter",inst_gamepad:"Stik",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Buat",label_break:"Pecahkan",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Jadikan duniamu gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main pakai gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barangnya kurang!",craft_done:"Jadi deh!",msg_import_err:"Gambar ini gak bisa dipakai."},pl:{continue_btn:"Graj dalej",start_btn:"Graj",reset_btn:"Od nowa",world_btn:"\u015Awiat",inst_pc:"Komputer",inst_move_pc:"Ruch: Strza\u0142ki / A D",inst_jump_pc:"Skok: Spacja / W / \u2191",inst_action_pc:"Buduj / Niszcz: Klik",inst_climb_pc:"Wspinaj si\u0119: S",inst_mobile:"Telefon",inst_move_mobile:"Ruch: \u2190 \u2192",inst_jump_mobile:"Skok: \u2191",inst_action_mobile:"Buduj / Niszcz: Dotknij",inst_climb_mobile:"Wspinaj si\u0119: Dotknij siebie",inst_gamepad:"Pad",label_move:"Ruch",label_cursor:"Kursor",label_jump:"Skok",label_make:"Buduj",label_break:"Niszcz",label_climb:"Wspinaj",label_select:"Wybierz",world_modal_title:"M\xF3j \u015Awiat",world_export_title:"Zapisz",world_export_desc:"Zr\xF3b obrazek ze \u015Bwiata.",world_export_btn:"Zr\xF3b obrazek",world_import_title:"Wczytaj",world_import_desc:"U\u017Cyj obrazka do gry.",world_import_btn:"Wczytaj obrazek",world_back_btn:"Wr\xF3\u0107",craft_missing:"Brakuje rzeczy!",craft_done:"Gotowe!",msg_import_err:"Ten obrazek nie dzia\u0142a."},uk:{continue_btn:"\u041F\u0440\u043E\u0434\u043E\u0432\u0436\u0438\u0442\u0438",start_btn:"\u0413\u0440\u0430\u0442\u0438",reset_btn:"\u0421\u043F\u043E\u0447\u0430\u0442\u043A\u0443",world_btn:"\u0421\u0432\u0456\u0442",inst_pc:"\u041A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440",inst_move_pc:"\u0420\u0443\u0445: \u0421\u0442\u0440\u0456\u043B\u043A\u0438 / A D",inst_jump_pc:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u041F\u0440\u043E\u0431\u0456\u043B / W / \u2191",inst_action_pc:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041A\u043B\u0456\u043A",inst_climb_pc:"\u041B\u0456\u0437\u0442\u0438: S",inst_mobile:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",inst_move_mobile:"\u0420\u0443\u0445: \u2190 \u2192",inst_jump_mobile:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A: \u2191",inst_action_mobile:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438 / \u041B\u0430\u043C\u0430\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438",inst_climb_mobile:"\u041B\u0456\u0437\u0442\u0438: \u041D\u0430\u0442\u0438\u0441\u043D\u0438 \u043D\u0430 \u0441\u0435\u0431\u0435",inst_gamepad:"\u0413\u0435\u0439\u043C\u043F\u0430\u0434",label_move:"\u0420\u0443\u0445",label_cursor:"\u041A\u0443\u0440\u0441\u043E\u0440",label_jump:"\u0421\u0442\u0440\u0438\u0431\u043E\u043A",label_make:"\u0411\u0443\u0434\u0443\u0432\u0430\u0442\u0438",label_break:"\u041B\u0430\u043C\u0430\u0442\u0438",label_climb:"\u041B\u0456\u0437\u0442\u0438",label_select:"\u0412\u0438\u0431\u0440\u0430\u0442\u0438",world_modal_title:"\u041C\u0456\u0439 \u0421\u0432\u0456\u0442",world_export_title:"\u0417\u0431\u0435\u0440\u0435\u0433\u0442\u0438",world_export_desc:"\u041F\u0435\u0440\u0435\u0442\u0432\u043E\u0440\u0438 \u0441\u0432\u0456\u0442 \u043D\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443.",world_export_btn:"\u0417\u0440\u043E\u0431\u0438\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_import_title:"\u0417\u0430\u0432\u0430\u043D\u0442\u0430\u0436\u0438\u0442\u0438",world_import_desc:"\u0413\u0440\u0430\u0439 \u0437 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438.",world_import_btn:"\u0412\u0437\u044F\u0442\u0438 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443",world_back_btn:"\u041D\u0430\u0437\u0430\u0434",craft_missing:"\u041D\u0435 \u0432\u0438\u0441\u0442\u0430\u0447\u0430\u0454 \u0440\u0435\u0447\u0435\u0439!",craft_done:"\u0413\u043E\u0442\u043E\u0432\u043E!",msg_import_err:"\u0426\u044F \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u043D\u0435 \u043F\u0440\u0430\u0446\u044E\u0454."},tr:{continue_btn:"Devam Et",start_btn:"Oyna",reset_btn:"Ba\u015Ftan Ba\u015Fla",world_btn:"D\xFCnya",inst_pc:"Bilgisayar",inst_move_pc:"Git: Oklar / A D",inst_jump_pc:"Z\u0131pla: Bo\u015Fluk / W / \u2191",inst_action_pc:"Koy / K\u0131r: T\u0131kla",inst_climb_pc:"T\u0131rman: S",inst_mobile:"Telefon",inst_move_mobile:"Git: \u2190 \u2192",inst_jump_mobile:"Z\u0131pla: \u2191",inst_action_mobile:"Koy / K\u0131r: Dokun",inst_climb_mobile:"T\u0131rman: Kendine dokun",inst_gamepad:"Oyun Kolu",label_move:"Git",label_cursor:"\u0130mle\xE7",label_jump:"Z\u0131pla",label_make:"Koy",label_break:"K\u0131r",label_climb:"T\u0131rman",label_select:"Se\xE7",world_modal_title:"D\xFCnyam",world_export_title:"Kaydet",world_export_desc:"D\xFCnyay\u0131 resme \xE7evir.",world_export_btn:"Resim Yap",world_import_title:"A\xE7",world_import_desc:"Resimden oyun a\xE7.",world_import_btn:"Resim A\xE7",world_back_btn:"Geri",craft_missing:"Malzeme eksik!",craft_done:"Oldu!",msg_import_err:"Bu resim \xE7al\u0131\u015Fm\u0131yor."},ms:{continue_btn:"Sambung",start_btn:"Mula",reset_btn:"Mula Semula",world_btn:"Dunia",inst_pc:"Komputer",inst_move_pc:"Gerak: Anak Panah / A D",inst_jump_pc:"Lompat: Space / W / \u2191",inst_action_pc:"Bina / Pecah: Klik",inst_climb_pc:"Panjat: S",inst_mobile:"Telefon",inst_move_mobile:"Gerak: \u2190 \u2192",inst_jump_mobile:"Lompat: \u2191",inst_action_mobile:"Bina / Pecah: Sentuh",inst_climb_mobile:"Panjat: Sentuh orang",inst_gamepad:"Alat Kawalan",label_move:"Gerak",label_cursor:"Kursor",label_jump:"Lompat",label_make:"Bina",label_break:"Pecah",label_climb:"Panjat",label_select:"Pilih",world_modal_title:"Duniaku",world_export_title:"Simpan",world_export_desc:"Tukar dunia jadi gambar.",world_export_btn:"Buat Gambar",world_import_title:"Buka",world_import_desc:"Main guna gambar.",world_import_btn:"Buka Gambar",world_back_btn:"Kembali",craft_missing:"Barang tak cukup!",craft_done:"Siap!",msg_import_err:"Gambar ini tak boleh guna."}},ht={};Object.assign(ht,St.en);$o="pictoco_language",wr=["ja","en","zh","zh-TW","es","fr","de","it","pt","ko","ru","id","pl","uk","tr","ms"],zo="en"});function Mt(t,o,i){return Math.max(o,Math.min(i,t))}function ae(t,o,i){return t+(o-t)*i}function Rr(t,o){return Math.floor(Math.random()*(o-t+1))+t}function yr(t,o,i,r){return Math.hypot(i-t,r-o)}function Ut(t,o,i){return{tx:Math.floor(t/i),ty:Math.floor(o/i)}}function go(t,o,i,r){let e=(t%i+i)%i;return(o%r+r)%r*i+e}function Yt(t,o,i,r,e=1){return{x:t/e+i,y:o/e+r}}function se(t,o){return t.x<o.x+o.w&&t.x+t.w>o.x&&t.y<o.y+o.h&&t.y+t.h>o.y}function le(t,o,i,r,e){return yr(t,o,i,r)<=e}function lt(t,o){let i=o[t];return i&&i.solid===!0}function ce(t,o){let i=o[t];return i&&i.transparent===!0}function Et(t,o){let i=o[t];return i&&!i.unbreakable}function bo(t,o){let i=o[t];return i&&i.drop!==void 0?i.drop:t}function fe(t,o){let i=o[t];return i?i.type:void 0}function Ao(t,o){return o.has(t)}function Ir(t,o,i={}){let r=i.largeAmplitude??12,e=i.smallAmplitude??3,n=i.largeFrequency??30,a=i.smallFrequency??8,l=Math.sin(t/n)*r+Math.sin(t/a)*e;return Math.floor(o+l)}function To(t,o,i,r){let e=[],n=[],a=Object.keys(o),l=0,c=[...a];for(let _=c.length-1;_>0;_--){let E=Math.floor(Math.random()*(_+1));[c[_],c[E]]=[c[E],c[_]]}let f=0,d=a.map(_=>{let E=o[_].weight!==void 0?o[_].weight:1;return f+=E,{key:_,threshold:f}}),h=0;for(;h<t;){let _;if(c.length>0)_=c.pop();else{let b=Math.random()*f,S=d.find(C=>b<C.threshold);_=S?S.key:a[0]}let E=Math.min(t-h,Rr(i,r)),A=o[_],T=[];for(let b=0;b<E;b++){let S=h+b;T[b]=Ir(S,A.baseHeight,A.terrain)}if(h>0){let b=e[h-1],S=T[0];if(S!==b){let C=Math.abs(S-b),k=Math.ceil(C*1.5),V=Math.max(8,k);if(S>b){let O=Math.min(V,E);for(let L=0;L<O;L++){let x=(L+1)/O;T[L]=Math.round(ae(b,T[L],x))}}else{let O=Math.min(V,h-l),L=e.slice(h-O,h);for(let x=0;x<O;x++){let K=(x+1)/O,W=h-O+x;e[W]=Math.round(ae(L[x],S,K))}}}}for(let b=0;b<E;b++){let S=h+b;e[S]=T[b],n[S]=_}h+=E,l=h-E}let u=e[0],m=e[t-1];if(u!==m){let _=Math.abs(u-m),E=Math.ceil(_*1.5),A=Math.max(8,E),T=Math.min(A,Math.floor(t/2));if(m>u)for(let b=0;b<T;b++){let S=t-T+b,C=(b+1)/T;e[S]=Math.round(ae(e[S],u,C))}else for(let b=0;b<T;b++){let S=(b+1)/T;e[b]=Math.round(ae(m,e[b],S))}}return{heights:e,biomeByColumn:n}}function Ne(t,o,i){return t+(o-t)*i}function de(t,o,i,r,e,n=1){let a=Math.floor(t/e),l=a+Math.ceil(i/n/e)+1,c=Math.floor(o/e),f=c+Math.ceil(r/n/e)+1;return{startX:a,endX:l,startY:c,endY:f}}var Cr=[[0,1],[0,-1],[1,0],[-1,0]];function Mo(t,o,i,r){for(let[e,n]of Cr)if(i(t+e,o+n)!==r)return!0;return!1}function he(t){if(t.length===0)return new Uint8Array(0);let o=[],i=0;for(;i<t.length;){let r=t[i++],e=t[i++];if(e===0){let n=t[i++],a=t[i++];e=n<<8|a}for(let n=0;n<e;n++)o.push(r)}return new Uint8Array(o)}var Fe=class{constructor(){this.ctx=null,this.ready=!1,this.reverbNode=null,this.isMusicPlaying=!1,this.nextNoteTimeout=null,this.musicGainNode=null,this.sfxGainNode=null,this.musicVolume=.5,this.sfxVolume=.5,this.MAX_MUSIC_GAIN=.2,this.MAX_SFX_GAIN=1,this.scale=[196,220,246.94,261.63,293.66,329.63,392,440,523.25,587.33,659.25,783.99,880]}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{this.startMusic()})),this.ctx.state==="suspended"&&this.ctx.resume()}setMusicVolume(o){this.musicVolume=Math.max(0,Math.min(1,o)),this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN)}setSfxVolume(o){this.sfxVolume=Math.max(0,Math.min(1,o)),this.ready&&(this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}updateVolumes(){this.ready&&(this.musicGainNode.gain.value=this.musicVolume*this.MAX_MUSIC_GAIN,this.sfxGainNode.gain.value=this.sfxVolume*this.MAX_SFX_GAIN)}resume(){if(!this.ctx)return;let o=this.ctx.state;(o==="suspended"||o==="interrupted")&&this.ctx.resume().catch(()=>{}),o==="closed"&&this._recreateContext()}_recreateContext(){let o=this.isMusicPlaying;this.nextNoteTimeout&&(clearTimeout(this.nextNoteTimeout),this.nextNoteTimeout=null),this.ctx=null,this.ready=!1,this.reverbNode=null,this.musicGainNode=null,this.sfxGainNode=null,this.isMusicPlaying=!1,this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ready=!0,this.musicGainNode=this.ctx.createGain(),this.musicGainNode.connect(this.ctx.destination),this.sfxGainNode=this.ctx.createGain(),this.sfxGainNode.connect(this.ctx.destination),this.updateVolumes(),this.setupReverb().then(()=>{o&&this.startMusic()})}async setupReverb(){if(!this.ctx)return;let o=this.ctx.sampleRate,i=o*3,r=this.ctx.createBuffer(2,i,o),e=r.getChannelData(0),n=r.getChannelData(1);for(let a=0;a<i;a++){let l=Math.pow(1-a/i,2);e[a]=(Math.random()*2-1)*l,n[a]=(Math.random()*2-1)*l}this.reverbNode=this.ctx.createConvolver(),this.reverbNode.buffer=r,this.reverbNode.connect(this.musicGainNode)}startMusic(){this.isMusicPlaying||!this.ready||(this.isMusicPlaying=!0,this.scheduleNextNote())}stopMusic(){this.isMusicPlaying=!1,this.nextNoteTimeout&&clearTimeout(this.nextNoteTimeout)}toggleMusic(){this.isMusicPlaying?this.stopMusic():this.startMusic()}scheduleNextNote(){if(!this.isMusicPlaying)return;this.ctx&&this.ctx.state==="running"&&this.playAmbientNote();let o=2e3+Math.random()*5e3;this.nextNoteTimeout=setTimeout(()=>this.scheduleNextNote(),o)}playAmbientNote(){if(!this.ready||!this.reverbNode)return;let o=this.scale[Math.floor(Math.random()*this.scale.length)],i=this.ctx.createOscillator(),r=this.ctx.createGain(),e=this.ctx.createStereoPanner();i.type=Math.random()>.5?"sine":"triangle",i.frequency.value=o,e.pan.value=Math.random()*2-1,i.connect(r),r.connect(e),e.connect(this.musicGainNode),e.connect(this.reverbNode);let n=this.ctx.currentTime,a=.5+Math.random()*1.5,l=2+Math.random()*2,c=3+Math.random()*2;r.gain.setValueAtTime(0,n),r.gain.linearRampToValueAtTime(.1+Math.random()*.1,n+a),r.gain.exponentialRampToValueAtTime(.001,n+a+l+c),i.start(n),i.stop(n+a+l+c+1)}playJump(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.type="square",o.frequency.setValueAtTime(150,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(300,this.ctx.currentTime+.1),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),o.start(),o.stop(this.ctx.currentTime+.1)}playBigJump(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.type="square",o.frequency.setValueAtTime(100,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(500,this.ctx.currentTime+.3),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.3),o.start(),o.stop(this.ctx.currentTime+.3)}playDig(o){if(!this.ready)return;let i=this.ctx.createBuffer(1,this.ctx.sampleRate*.1,this.ctx.sampleRate),r=i.getChannelData(0);for(let l=0;l<r.length;l++)r[l]=Math.random()*2-1;let e=this.ctx.createBufferSource();e.buffer=i;let n=this.ctx.createGain(),a=this.ctx.createBiquadFilter();o==="stone"?(a.type="highpass",a.frequency.value=800):o==="wood"?(a.type="lowpass",a.frequency.value=600):(a.type="lowpass",a.frequency.value=300),e.connect(a),a.connect(n),n.connect(this.sfxGainNode),n.gain.setValueAtTime(.2,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.start()}playPop(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createGain();o.connect(i),i.connect(this.sfxGainNode),o.frequency.setValueAtTime(600,this.ctx.currentTime),o.frequency.exponentialRampToValueAtTime(1200,this.ctx.currentTime+.05),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.05),o.start(),o.stop(this.ctx.currentTime+.05)}playExplosion(){if(!this.ready)return;let o=this.ctx.sampleRate*.5,i=this.ctx.createBuffer(1,o,this.ctx.sampleRate),r=i.getChannelData(0);for(let l=0;l<o;l++)r[l]=Math.random()*2-1;let e=this.ctx.createBufferSource();e.buffer=i;let n=this.ctx.createGain(),a=this.ctx.createBiquadFilter();e.connect(a),a.connect(n),n.connect(this.sfxGainNode),a.type="lowpass",a.frequency.setValueAtTime(1200,this.ctx.currentTime),a.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.4),n.gain.setValueAtTime(.5,this.ctx.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.4),e.start()}playCoin(){if(!this.ready)return;let o=this.ctx.createOscillator(),i=this.ctx.createOscillator(),r=this.ctx.createGain();o.type="square",i.type="square",o.frequency.setValueAtTime(880,this.ctx.currentTime),i.frequency.setValueAtTime(1320,this.ctx.currentTime),o.connect(r),i.connect(r),r.connect(this.sfxGainNode),r.gain.setValueAtTime(.12,this.ctx.currentTime),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.25),o.frequency.exponentialRampToValueAtTime(1760,this.ctx.currentTime+.2),i.frequency.exponentialRampToValueAtTime(1980,this.ctx.currentTime+.2),o.start(),i.start(),o.stop(this.ctx.currentTime+.25),i.stop(this.ctx.currentTime+.25)}},J=new Fe;var Ht=1.3888888888888888,dt=60/720,ue=36e4,p=32,ot=512*8,nt=256,Xt=5*p,Eo=p/2,Ge=.1,We=15,So=.015,Ro=.6,yo=60,Ke=720,Io=90,Co=.5*dt,wo=.25,Oo=20,me=10,Ve=18,ko=.1,Po=8,vo=0,Lo=-20;var xo=new Set([0,1,2,3,4,5,6,7,8,9,10,11,12,20]),Bo=2160,Do=8,No=15,Fo=2,Go=360,pe=15,Wo=3,Ko=4320,Vo=720,Uo=576,Ue=648,Ye=288,s={AIR:0,DIRT:1,GRASS:2,STONE:3,WOOD:4,LEAVES:5,BEDROCK:6,COAL:7,GOLD:8,WORKBENCH:9,SAND:10,SNOW:11,CLOUD:12,FIREWORK:13,JUMP_PAD:14,TNT:15,SAPLING:16,JACKPOT:17,ACCELERATOR_LEFT:18,ACCELERATOR_RIGHT:19,WATER:20},$={[s.AIR]:{name:"Air",solid:!1,transparent:!0},[s.DIRT]:{name:"Dirt",solid:!0,color:"#5d4037",type:"soil"},[s.GRASS]:{name:"Grass",solid:!0,color:"#388e3c",type:"soil",drop:s.DIRT},[s.STONE]:{name:"Stone",solid:!0,color:"#757575",type:"stone"},[s.WOOD]:{name:"Wood",solid:!0,color:"#5d4037",type:"wood"},[s.LEAVES]:{name:"Leaves",solid:!0,transparent:!1,color:"#2e7d32",type:"plant",drop:s.LEAVES},[s.BEDROCK]:{name:"Bedrock",solid:!0,unbreakable:!0,color:"#000000",type:"stone"},[s.COAL]:{name:"Coal Ore",solid:!0,color:"#212121",type:"stone",drop:s.COAL},[s.GOLD]:{name:"Gold Ore",solid:!0,color:"#ffb300",type:"stone",drop:s.GOLD},[s.WORKBENCH]:{name:"Workbench",solid:!1,unbreakable:!0,transparent:!0,color:"#8d6e63",type:"wood"},[s.SAND]:{name:"Sand",solid:!0,color:"#d7c27a",type:"sand",drop:s.SAND},[s.SNOW]:{name:"Snow",solid:!0,color:"#e0f7fa",type:"snow",drop:s.SNOW},[s.CLOUD]:{name:"Cloud",solid:!0,color:"#ffffff",type:"cloud",drop:s.CLOUD},[s.FIREWORK]:{name:"Firework",solid:!0,color:"#ef5350",type:"wood",drop:s.FIREWORK},[s.JUMP_PAD]:{name:"Jump Pad",solid:!0,color:"#ab47bc",type:"stone",drop:s.JUMP_PAD},[s.TNT]:{name:"TNT",solid:!0,color:"#d32f2f",type:"wood",drop:s.TNT},[s.SAPLING]:{name:"Sapling",solid:!1,transparent:!0,color:"#6fa85b",type:"plant",drop:s.SAPLING},[s.JACKPOT]:{name:"Jackpot",solid:!1,transparent:!0,color:"#ffd54f",type:"stone",drop:s.JACKPOT},[s.ACCELERATOR_LEFT]:{name:"Accelerator Left",solid:!1,transparent:!0,color:"#42a5f5",type:"stone",drop:s.ACCELERATOR_LEFT},[s.ACCELERATOR_RIGHT]:{name:"Accelerator Right",solid:!1,transparent:!0,color:"#66bb6a",type:"stone",drop:s.ACCELERATOR_RIGHT},[s.WATER]:{name:"Water",solid:!1,transparent:!0,color:"#2196f3",type:"water",drop:s.WATER}},mt=[s.DIRT,s.STONE,s.WOOD,s.LEAVES,s.COAL,s.GOLD,s.SAND,s.SNOW,s.CLOUD,s.WATER,s.FIREWORK,s.JUMP_PAD,s.TNT,s.SAPLING,s.JACKPOT,s.ACCELERATOR_LEFT,s.ACCELERATOR_RIGHT];function Yo(){let t={},o=(e,n)=>{let a=document.createElement("canvas");a.width=p,a.height=p;let l=a.getContext("2d");n(l,p),t[e]=a},i=(e,n=.1)=>{let a=e.getImageData(0,0,p,p),l=a.data;for(let c=0;c<l.length;c+=4){let f=(Math.random()-.5)*n*255;l[c]+=f,l[c+1]+=f,l[c+2]+=f}e.putImageData(a,0,0)};o(s.DIRT,(e,n)=>{e.fillStyle="#5d4037",e.fillRect(0,0,n,n),i(e,.15)}),o(s.GRASS,(e,n)=>{e.fillStyle="#5d4037",e.fillRect(0,0,n,n),i(e,.15),e.fillStyle="#4caf50",e.fillRect(0,0,n,n/3),i(e,.1);for(let a=0;a<n;a+=4)Math.random()>.5&&e.fillRect(a,n/3,4,4)}),o(s.STONE,(e,n)=>{e.fillStyle="#757575",e.fillRect(0,0,n,n),i(e,.2)}),o(s.SAND,(e,n)=>{e.fillStyle="#d7c27a",e.fillRect(0,0,n,n),e.fillStyle="#c2aa63";for(let a=0;a<12;a++)e.fillRect(Math.random()*n,Math.random()*n,3,3);i(e,.12)}),o(s.SNOW,(e,n)=>{let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,"#ffffff"),a.addColorStop(1,"#d7e4f2"),e.fillStyle=a,e.fillRect(0,0,n,n),e.fillStyle="#b0c4de";for(let l=0;l<8;l++)e.fillRect(Math.random()*n,Math.random()*n,2,2);i(e,.06)}),o(s.WOOD,(e,n)=>{e.fillStyle="#6d4c41",e.fillRect(0,0,n,n),e.fillStyle="#4e342e";for(let a=4;a<n;a+=8)e.fillRect(a,0,2,n);i(e,.1)}),o(s.LEAVES,(e,n)=>{e.fillStyle="#2e7d32",e.fillRect(0,0,n,n),i(e,.2),e.fillStyle="#1b5e20";for(let a=0;a<10;a++)e.fillRect(Math.random()*n,Math.random()*n,4,4)}),o(s.SAPLING,(e,n)=>{e.clearRect(0,0,n,n),e.strokeStyle="#43a047",e.lineWidth=n*.1,e.lineCap="round",e.beginPath(),e.moveTo(n*.5,n*.95),e.quadraticCurveTo(n*.5,n*.7,n*.5,n*.5),e.stroke(),e.fillStyle="#76ff03",e.beginPath(),e.ellipse(n*.35,n*.45,n*.16,n*.08,-.6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n*.65,n*.35,n*.18,n*.09,.5,0,Math.PI*2),e.fill(),i(e,.05)}),o(s.WATER,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(33, 150, 243, 0.5)",e.fillRect(0,0,n,n),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.beginPath();for(let a=0;a<3;a++){let l=n*(.3+a*.25);e.moveTo(0,l),e.bezierCurveTo(n*.3,l-4,n*.7,l+4,n,l)}e.stroke(),i(e,.05)}),o(s.BEDROCK,(e,n)=>{e.fillStyle="#212121",e.fillRect(0,0,n,n),i(e,.4)});let r=(e,n)=>(a,l)=>{a.fillStyle=e,a.fillRect(0,0,l,l),i(a,.2),a.fillStyle=n;for(let c=0;c<6;c++)a.fillRect(Math.random()*(l-6),Math.random()*(l-6),6,6)};return o(s.COAL,r("#757575","#000")),o(s.GOLD,r("#757575","#FFD700")),o(s.JACKPOT,(e,n)=>{e.fillStyle="#4e342e",e.fillRect(0,0,n,n),e.fillStyle="#ffd54f",e.fillRect(2,2,n-4,n-4),e.fillStyle="#f9a825";for(let a=0;a<6;a++){let l=6+Math.random()*4,c=6+Math.random()*4;e.fillRect(4+Math.random()*(n-8-l),4+Math.random()*(n-8-c),l,c)}e.strokeStyle="#fff9c4",e.lineWidth=2,e.strokeRect(3,3,n-6,n-6),i(e,.06)}),o(s.WORKBENCH,(e,n)=>{e.fillStyle="#8d6e63",e.fillRect(0,0,n,n),e.fillStyle="#5d4037",e.fillRect(0,0,n,n/3),e.fillStyle="#3e2723",e.fillRect(4,n/3,4,n-n/3),e.fillRect(n-8,n/3,4,n-n/3),e.fillStyle="#bcaaa4",e.fillRect(8,4,16,4),i(e,.1)}),o(s.FIREWORK,(e,n)=>{e.fillStyle="#ef5350",e.fillRect(4,8,n-8,n-8),e.fillStyle="#ffffff",e.fillRect(4,12,n-8,4),e.fillRect(4,20,n-8,4),e.fillStyle="#795548",e.fillRect(n/2-1,0,2,8),i(e,.1)}),o(s.JUMP_PAD,(e,n)=>{let l=n-8;e.fillStyle="#212121",e.fillRect(4,n-4,l,4),e.fillStyle="#616161",e.fillRect(6,10,l-4,n-14),e.fillStyle="#bdbdbd";for(let c=10;c<n-6;c+=4)e.fillRect(6,c,l-4,2);e.fillStyle="#d32f2f",e.fillRect(3,4,l+2,6),e.fillStyle="#ef9a9a",e.fillRect(6,5,l-4,2),i(e,.1)}),o(s.TNT,(e,n)=>{e.fillStyle="#d32f2f",e.fillRect(0,0,n,n),e.fillStyle="#ffffff",e.fillRect(0,n/3,n,n/3),e.fillStyle="#000000",e.fillRect(4,n/3+2,6,2),e.fillRect(6,n/3+2,2,6),e.fillRect(12,n/3+2,2,6),e.fillRect(16,n/3+2,2,6),e.fillRect(12,n/3+2,4,2),e.fillRect(13,n/3+3,2,2),e.fillRect(20,n/3+2,6,2),e.fillRect(22,n/3+2,2,6),e.fillStyle="#757575",e.fillRect(0,0,n,4),e.fillRect(0,n-4,n,4),i(e,.1)}),o(s.CLOUD,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n*.25,n*.3,n*.22,0,Math.PI*2),e.arc(n*.5,n*.2,n*.25,0,Math.PI*2),e.arc(n*.75,n*.3,n*.22,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.85)",e.fillRect(0,n*.25,n,n*.5),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n*.2,n*.7,n*.2,0,Math.PI*2),e.arc(n*.5,n*.75,n*.22,0,Math.PI*2),e.arc(n*.8,n*.7,n*.2,0,Math.PI*2),e.fill(),e.fillStyle="rgba(200, 220, 240, 0.3)",e.fillRect(0,n*.7,n,n*.3),i(e,.04)}),o(s.ACCELERATOR_LEFT,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(66, 165, 245, 0.7)",e.fillRect(0,0,n,n),e.strokeStyle="#1976d2",e.lineWidth=2,e.strokeRect(1,1,n-2,n-2),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(n*.25,n*.5),e.lineTo(n*.65,n*.2),e.lineTo(n*.65,n*.4),e.lineTo(n*.75,n*.4),e.lineTo(n*.75,n*.6),e.lineTo(n*.65,n*.6),e.lineTo(n*.65,n*.8),e.closePath(),e.fill(),i(e,.05)}),o(s.ACCELERATOR_RIGHT,(e,n)=>{e.clearRect(0,0,n,n),e.fillStyle="rgba(102, 187, 106, 0.7)",e.fillRect(0,0,n,n),e.strokeStyle="#388e3c",e.lineWidth=2,e.strokeRect(1,1,n-2,n-2),e.fillStyle="#ffffff",e.beginPath(),e.moveTo(n*.75,n*.5),e.lineTo(n*.35,n*.2),e.lineTo(n*.35,n*.4),e.lineTo(n*.25,n*.4),e.lineTo(n*.25,n*.6),e.lineTo(n*.35,n*.6),e.lineTo(n*.35,n*.8),e.closePath(),e.fill(),i(e,.05)}),t}var pt={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,BACK:8,START:9,L_STICK:10,R_STICK:11,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15},He={LEFT_X:0,LEFT_Y:1,RIGHT_X:2,RIGHT_Y:3},Xe=.01,Ho=.3;function Xo(t,{onHotbarSelect:o,onTouch:i,onClimb:r}){let e={keys:{left:!1,right:!1,jump:!1},mouse:{x:0,y:0,leftDown:!1,active:!1},gamepad:{connected:!1,cursorX:0,cursorY:0,cursorActive:!1,breakAction:!1,placeAction:!1,prevButtons:{}}},n=0,a=null,l=()=>{let A=document.getElementById("mobile-controls");A&&(A.style.display="none"),window.removeEventListener("keydown",l)};window.addEventListener("keydown",l),window.addEventListener("keydown",A=>{switch(A.code){case"KeyA":case"ArrowLeft":e.keys.left=!0,A.preventDefault();break;case"KeyD":case"ArrowRight":e.keys.right=!0,A.preventDefault();break;case"KeyW":case"ArrowUp":case"Space":e.keys.jump=!0,A.preventDefault();break;case"Digit1":o&&o(0);break;case"Digit2":o&&o(1);break;case"Digit3":o&&o(2);break;case"Digit4":o&&o(3);break;case"Digit5":o&&o(4);break;case"Digit6":o&&o(5);break;case"Digit7":o&&o(6);break;case"Digit8":o&&o(7);break;case"Digit9":o&&o(8);break;case"KeyS":case"ArrowDown":r&&r();break}}),window.addEventListener("keyup",A=>{switch(A.code){case"KeyA":case"ArrowLeft":e.keys.left=!1;break;case"KeyD":case"ArrowRight":e.keys.right=!1;break;case"KeyW":case"ArrowUp":case"Space":e.keys.jump=!1;break}}),window.addEventListener("mousemove",A=>{let T=t.getBoundingClientRect();e.mouse.x=A.clientX-T.left,e.mouse.y=A.clientY-T.top,Date.now()-n>500&&(e.mouse.active=!0)}),window.addEventListener("mousedown",A=>{A.target===t&&(e.mouse.leftDown=!0)}),window.addEventListener("mouseup",()=>{e.mouse.leftDown=!1}),window.addEventListener("touchstart",()=>{e.mouse.active=!1,n=Date.now()},{passive:!0});let c=(A,T)=>{let b=document.getElementById(A);b&&(b.addEventListener("touchstart",S=>{S.preventDefault(),e.keys[T]=!0,e.mouse.active=!1,n=Date.now()}),b.addEventListener("touchend",S=>{S.preventDefault(),e.keys[T]=!1}))};c("btn-left","left"),c("btn-right","right"),c("btn-jump","jump"),t.addEventListener("touchstart",A=>{let T=A.touches[0],b=t.getBoundingClientRect();e.mouse.active=!1,n=Date.now(),i&&i(T.clientX-b.left,T.clientY-b.top)},{passive:!1});function f(A){return Math.abs(A)<Xe?0:Math.sign(A)*(Math.abs(A)-Xe)/(1-Xe)}function d(A,T){let b=A[T]&&A[T].pressed,S=e.gamepad.prevButtons[T];return b&&!S}window.addEventListener("gamepadconnected",A=>{if(A.gamepad.mapping!=="standard")return;a=A.gamepad.index,e.gamepad.connected=!0,e.gamepad.cursorActive=!0;let T=t.getBoundingClientRect();e.gamepad.cursorX=T.width/2,e.gamepad.cursorY=T.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none")}),window.addEventListener("gamepaddisconnected",A=>{A.gamepad.index===a&&(a=null,e.gamepad.connected=!1,e.gamepad.cursorActive=!1)});let h=navigator.getGamepads();for(let A of h)if(A&&A.connected&&A.mapping==="standard"){a=A.index,e.gamepad.connected=!0,e.gamepad.cursorActive=!0;let T=t.getBoundingClientRect();e.gamepad.cursorX=T.width/2,e.gamepad.cursorY=T.height/2;let b=document.getElementById("mobile-controls");b&&(b.style.display="none");break}let u=0,m=null,_=null;function E({screenWidth:A,screenHeight:T,playerScreenX:b,playerScreenY:S,reach:C,skipJump:k}){if(a===null)return;let O=navigator.getGamepads()[a];if(!O)return;let{axes:L,buttons:x}=O,K=f(L[He.LEFT_X]||0);if(e.keys.left=K<-.3,e.keys.right=K>.3,e.gamepad.axisLeftX=K,!k&&x[pt.A]&&(e.keys.jump=x[pt.A].pressed),d(x,pt.X)&&r&&r(),m!==null&&_!==null){let B=b-m,M=S-_;e.gamepad.cursorX+=B,e.gamepad.cursorY+=M}m=b,_=S;let W=f(L[He.RIGHT_X]||0),F=f(L[He.RIGHT_Y]||0);if((W!==0||F!==0)&&(e.gamepad.cursorX+=W*Ho,e.gamepad.cursorY+=F*Ho,e.gamepad.cursorActive=!0),C!==void 0&&b!==void 0&&S!==void 0){let B=e.gamepad.cursorX-b,M=e.gamepad.cursorY-S,y=Math.sqrt(B*B+M*M);if(y>C){let D=C/y;e.gamepad.cursorX=b+B*D,e.gamepad.cursorY=S+M*D}}else e.gamepad.cursorX=Math.max(0,Math.min(A,e.gamepad.cursorX)),e.gamepad.cursorY=Math.max(0,Math.min(T,e.gamepad.cursorY));x[pt.RT]&&(e.gamepad.breakAction=x[pt.RT].pressed&&x[pt.RT].value>.5),x[pt.LT]&&(e.gamepad.placeAction=x[pt.LT].pressed&&x[pt.LT].value>.5);let w=mt.length;d(x,pt.LB)&&(u=(u-1+w)%w,o&&o(u)),d(x,pt.RB)&&(u=(u+1)%w,o&&o(u));for(let B=0;B<x.length;B++)e.gamepad.prevButtons[B]=x[B]&&x[B].pressed}return e.pollGamepads=E,e}var it={};mt.forEach(t=>it[t]=0);var Dt=0;function jo(){return mt[Dt]}function Jo(){let t={};return mt.forEach(o=>{t[o]=it[o]||0}),{counts:t,selectedIndex:Dt}}function Je(t){if(!t||!t.counts)return;mt.forEach(i=>{it[i]=t.counts[i]??0});let o=t.selectedIndex??0;Dt=Math.min(Math.max(0,o),mt.length-1),vt(),jt(Dt,{playSound:!1})}function vt(){mt.forEach((t,o)=>{let i=document.getElementById(`slot-count-${o}`);if(i){i.innerText=it[t];let r=document.getElementById(`slot-${o}`);r&&(r.style.opacity=it[t]>0?"1":"0.5")}})}function _e(t){if(t===s.AIR)return;let o=bo(t,$);it[o]!==void 0&&(it[o]++,vt())}function qo(t){return it[t]>0?(it[t]--,vt(),!0):!1}function je(){let t=document.getElementById("hotbar"),o=document.getElementById("hotbar-scroll-left"),i=document.getElementById("hotbar-scroll-right");if(!t||!o||!i)return;let r=t.scrollLeft>0,e=t.scrollLeft<t.scrollWidth-t.clientWidth-1;o.classList.toggle("visible",r),i.classList.toggle("visible",e)}function Zo(t){let o=document.getElementById("hotbar");o.innerHTML="",mt.forEach((i,r)=>{let e=document.createElement("div");e.className="slot"+(r===0?" active":""),e.id=`slot-${r}`,e.onclick=()=>jt(r);let n=document.createElement("canvas");n.width=32,n.height=32;let a=n.getContext("2d");t&&t[i]&&a.drawImage(t[i],0,0,32,32);let l=document.createElement("div");l.className="count",l.id=`slot-count-${r}`,l.innerText="0",e.appendChild(n),e.appendChild(l),o.appendChild(e)}),jt(Dt,{playSound:!1}),o.addEventListener("scroll",je),window.addEventListener("resize",je),setTimeout(je,0)}function jt(t,{playSound:o=!0}={}){if(t<0||t>=mt.length)return;let i=document.querySelectorAll(".slot");i.forEach(r=>r.classList.remove("active")),i[t]&&i[t].classList.add("active"),Dt=t,o&&J.playPop()}Jt();var be=[{id:s.FIREWORK,cost:{[s.WOOD]:2},count:1},{id:s.JUMP_PAD,cost:{[s.STONE]:2,[s.LEAVES]:2},count:1},{id:s.TNT,cost:{[s.COAL]:3,[s.WOOD]:2},count:1},{id:s.SAPLING,cost:{[s.WOOD]:1,[s.LEAVES]:1},count:1},{id:s.JACKPOT,cost:{[s.GOLD]:3},count:1},{id:s.ACCELERATOR_LEFT,cost:{[s.GOLD]:2,[s.SAND]:2},count:1},{id:s.ACCELERATOR_RIGHT,cost:{[s.GOLD]:2,[s.SNOW]:2},count:1}],_t=!1,Rt=0;var en=!1,on=!1,nn=!1,rn=!1,ge=0,$e=!1,an=0,sn=1,ln=12,cn=13;function dn(){if(!_t)return;let t=navigator.getGamepads(),o=null;for(let l of t)if(l&&l.connected){o=l;break}if(!o)return;let{buttons:i}=o,r=i[ln]&&i[ln].pressed;r&&!en&&(Rt=Math.max(0,Rt-1),ze()),en=r;let e=i[cn]&&i[cn].pressed;e&&!on&&(Rt=Math.min(be.length-1,Rt+1),ze()),on=e;let n=i[an]&&i[an].pressed;if(n){if(!nn){let l=be[Rt];l&&Qe(l)}if(ge++,ge>=Ke&&(ge-Ke)%Io===0){let c=be[Rt];c&&Qe(c)}}else ge=0;nn=n;let a=i[sn]&&i[sn].pressed;a&&!rn&&un(!0),rn=a}function ze(){let t=document.getElementById("craft-list");if(!t)return;t.querySelectorAll(".craft-item").forEach((i,r)=>{r===Rt?(i.classList.add("gamepad-selected"),i.scrollIntoView({block:"nearest",behavior:"smooth"})):i.classList.remove("gamepad-selected")})}function kr(t,o){let i=t.x,r=t.y,e=t.width,n=t.height,a=Math.floor(i/p),l=Math.floor((i+e)/p),c=Math.floor(r/p),f=Math.floor((r+n)/p),d=!1;for(let h=c;h<=f;h++)for(let u=a;u<=l;u++)if(o.getBlock(u,h)===s.WORKBENCH){d=!0;break}return d}function hn(t,o,i){kr(t,o)?!_t&&!$e&&Pr(i):(_t&&un(!1),$e=!1)}function Pr(t){_t=!0,Rt=0;let o=document.getElementById("crafting-modal"),i=document.getElementById("craft-list"),r=document.getElementById("crafting-status");r&&(r.innerText=""),i.innerHTML="",be.forEach(e=>{let n=document.createElement("div");n.className="craft-item",n.onclick=()=>Qe(e);let a=document.createElement("div");a.className="craft-inputs";let l=document.createElement("div");l.className="craft-cost-icons";for(let[h,u]of Object.entries(e.cost)){let m=document.createElement("div");m.className="craft-cost-item";let _=fn(h,32,t);_.classList.add("craft-icon");let E=document.createElement("span");E.className="craft-cost-count",E.innerText=`\xD7${u}`,m.appendChild(_),m.appendChild(E),l.appendChild(m)}a.appendChild(l);let c=document.createElement("div");c.className="craft-outputs";let f=document.createElement("div");f.className="craft-arrow",f.innerText="\u279C";let d=fn(e.id,48,t);d.classList.add("craft-icon-output"),c.appendChild(f),c.appendChild(d),n.appendChild(a),n.appendChild(c),i.appendChild(n)}),o.style.display="block",ze()}function un(t=!1){_t=!1,document.getElementById("crafting-modal").style.display="none",t&&($e=!0)}function Qe(t){for(let[i,r]of Object.entries(t.cost))if((it[i]||0)<r){let e=document.getElementById("crafting-status");e&&(e.innerText=ht.craft_missing);return}for(let[i,r]of Object.entries(t.cost))it[i]-=r;it[t.id]||(it[t.id]=0),it[t.id]+=t.count,vt(),J.playPop();let o=document.getElementById("crafting-status");o&&(o.innerText=ht.craft_done)}function fn(t,o,i){let r=document.createElement("canvas");r.width=o,r.height=o;let e=r.getContext("2d");return i&&i[t]&&e.drawImage(i[t],0,0,o,o),r}var Lt=8e3,P={x:new Float32Array(Lt),y:new Float32Array(Lt),vx:new Float32Array(Lt),vy:new Float32Array(Lt),life:new Float32Array(Lt),hue:new Uint16Array(Lt),count:0},to=361,eo=362,vr=35e-5,Lr=-.33,xr=-.15,mn=0,pn=0,_n=0,gn=0,Ae=50;function bn(t){let o=P.count-1;t!==o&&(P.x[t]=P.x[o],P.y[t]=P.y[o],P.vx[t]=P.vx[o],P.vy[t]=P.vy[o],P.life[t]=P.life[o],P.hue[t]=P.hue[o]),P.count--}function Te(t,o,i,r,e,n){if(P.count>=Lt)return;let a=P.count;P.x[a]=t,P.y[a]=o,P.vx[a]=i,P.vy[a]=r,P.life[a]=e,P.hue[a]=n,P.count++}function Br(t,o){let i=o-10*p;Te(t,o,0,Lr,-i,to)}function Dr(t,o){let i=Math.floor(Math.random()*360);oo(t,o,i)}function An(t,o,i=p*2){let r=(Math.random()-.5)*.05,e=xr*(.8+Math.random()*.4),n=Math.abs(e),a=20+Math.random()*40,l=Math.max(50,i/n+a);Te(t,o,r,e,l,eo)}function Tn(t,o){for(let r=0;r<20;r++){let e=-Math.PI/2+(Math.random()-.5)*1.5,n=Math.random()*.15+.05,a=Math.cos(e)*n,l=Math.sin(e)*n,c=300+Math.random()*200;Te(t,o,a,l,c,195)}}function oo(t,o,i){let r;if(typeof i=="string"){let e=i.match(/hsl\((\d+)/);r=e?parseInt(e[1],10):Math.floor(Math.random()*360)}else typeof i=="number"?r=i:r=35;for(let e=0;e<100;e++){let n=Math.random()*Math.PI*2,a=Math.random()*.17+.08,l=720+Math.random()*720;Te(t,o,Math.cos(n)*a,Math.sin(n)*a,l,r)}}function Mn(t,o,i,r){if(t.fireworkTimer||(t.fireworkTimer=0),t.fireworkTimer++,t.fireworkTimer>3600){t.fireworkTimer=0;let n=de(o,i,r.width,r.height,p);for(let a=n.startY-10;a<n.endY+10;a++)for(let l=n.startX-10;l<n.endX+10;l++)t.getBlock(l,a)===s.FIREWORK&&Br(l*p+p/2,a*p+p/2)}let e=0;for(;e<P.count;){let n=P.life[e],a=P.hue[e];if(a===to){P.y[e]+=P.vy[e];let l=-n;if(P.y[e]<=l){let c=P.x[e],f=P.y[e];bn(e),Dr(c,f);continue}}else if(P.x[e]+=P.vx[e],P.y[e]+=P.vy[e],a!==eo&&(P.vy[e]+=vr),P.life[e]--,P.life[e]<=0){bn(e);continue}e++}}function En(t,o,i,r,e){if(P.count===0)return;mn=o-Ae,pn=o+r+Ae,_n=i-Ae,gn=i+e+Ae;let n=new Map;for(let a=0;a<P.count;a++){let l=P.x[a],c=P.y[a];if(l<mn||l>pn||c<_n||c>gn)continue;let f=P.hue[a];n.has(f)||n.set(f,[]),n.get(f).push(a)}for(let[a,l]of n)if(a===to){t.fillStyle="#ffffff";for(let c of l)t.fillRect(P.x[c]-2,P.y[c]-2,4,8)}else if(a===eo){t.fillStyle="rgba(200, 240, 255, 0.6)";for(let c of l)t.fillRect(P.x[c],P.y[c],3,3)}else{t.fillStyle=`hsl(${a}, 100%, 50%)`;for(let c of l)t.fillRect(P.x[c],P.y[c],4,4)}}var bt=500,v={x:new Float32Array(bt),y:new Float32Array(bt),vx:new Float32Array(bt),vy:new Float32Array(bt),life:new Uint16Array(bt),r:new Uint8Array(bt),g:new Uint8Array(bt),b:new Uint8Array(bt),count:0},Nr=.008,Sn=.995,wn=360,Fr=8,Rn=0,yn=0,In=0,Cn=0,Me=50,Ee=null,no=new Map;function On(t){Ee=t}function Gr(t){if(no.has(t))return no.get(t);if(!Ee||!Ee[t])return null;let r=Ee[t].getContext("2d").getImageData(0,0,p,p);return no.set(t,r),r}function Wr(t){let o=Gr(t);if(!o)return{r:128,g:128,b:128};let i=Math.floor(Math.random()*p),e=(Math.floor(Math.random()*p)*p+i)*4;return{r:o.data[e],g:o.data[e+1],b:o.data[e+2]}}function Kr(t){let o=v.count-1;t!==o&&(v.x[t]=v.x[o],v.y[t]=v.y[o],v.vx[t]=v.vx[o],v.vy[t]=v.vy[o],v.life[t]=v.life[o],v.r[t]=v.r[o],v.g[t]=v.g[o],v.b[t]=v.b[o]),v.count--}function Vr(t,o,i,r,e,n,a,l){if(v.count>=bt)return;let c=v.count;v.x[c]=t,v.y[c]=o,v.vx[c]=i,v.vy[c]=r,v.life[c]=e,v.r[c]=n,v.g[c]=a,v.b[c]=l,v.count++}function Se(t,o,i){let r=t*p+p/2,e=o*p+p/2;for(let n=0;n<Fr;n++){let a=Wr(i),l=Math.random()*Math.PI*2,c=.4+Math.random()*.4,f=Math.cos(l)*c,d=Math.sin(l)*c,h=(Math.random()-.5)*p*.5,u=(Math.random()-.5)*p*.5,m=wn+Math.floor(Math.random()*120)-60;Vr(r+h,e+u,f,d,m,a.r,a.g,a.b)}}function kn(){let t=0;for(;t<v.count;){if(v.x[t]+=v.vx[t],v.y[t]+=v.vy[t],v.vy[t]+=Nr,v.vx[t]*=Sn,v.vy[t]*=Sn,v.life[t]--,v.life[t]<=0){Kr(t);continue}t++}}function Pn(t,o,i,r,e){if(v.count===0)return;Rn=o-Me,yn=o+r+Me,In=i-Me,Cn=i+e+Me;let n=new Map;for(let a=0;a<v.count;a++){let l=v.x[a],c=v.y[a];if(l<Rn||l>yn||c<In||c>Cn)continue;let f=v.r[a]<<16|v.g[a]<<8|v.b[a];n.has(f)||n.set(f,[]),n.get(f).push(a)}for(let[a,l]of n){let c=a>>16&255,f=a>>8&255,d=a&255;t.fillStyle=`rgb(${c}, ${f}, ${d})`;for(let h of l){let u=v.life[h]/wn;t.globalAlpha=u*.9+.1,t.fillRect(Math.floor(v.x[h])-2,Math.floor(v.y[h])-2,4,4)}}t.globalAlpha=1}function vn({world:t,player:o,inventory:i,camera:r,sounds:e,constants:n,utils:a,onBlockPlaced:l}){let{TILE_SIZE:c,BLOCKS:f,BLOCK_PROPS:d,REACH:h}=n,{screenToWorld:u,worldToTile:m,isWithinReach:_,isBlockBreakable:E,isBlockTransparent:A,isBlockSolid:T,getBlockMaterialType:b,rectsIntersect:S}=a;function C(L,x,K){let W=[{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];for(let{dx:F,dy:w}of W){let B=t.getBlock(L+F,x+w);if(B!==f.AIR&&(B!==f.WATER||K===f.WATER))return!0}return!1}function k(){let L=o.getCenterX(),x=Math.floor(L/c),K=Math.floor((o.y+o.height-.01)/c),W=Math.floor((o.y+o.height+.1)/c),F=Math.floor(o.x/c),w=Math.floor((o.x+o.width-.01)/c),B=x,M=t.getBlock(x,W);if(!T(M,d)){let g=t.getBlock(F,W),R=t.getBlock(w,W);T(g,d)?B=F:T(R,d)&&(B=w)}let y=t.getBlock(B,K),D=A(y,d)&&(y===f.AIR||E(y,d)),G=K*c-o.height,Z=t.checkAreaFree(o.x,G,o.width,o.height);if(D&&Z){let g=i.getSelectedBlockId();if(y===g)return!1;if(g===f.CLOUD||C(B,K,g)){if(i.consumeFromInventory(g))return y!==f.AIR&&i.addToInventory(y),t.setBlock(B,K,g),e.playDig("dirt"),l&&l(B,K,g),A(g,d)||(o.y=G-.1,o.vy=0,o.grounded=!0),!0;e.playPop()}}return!1}function V(){k()}function O(L,x,K){let W=u(L,x,r.x,r.y,r.zoom),{tx:F,ty:w}=m(W.x,W.y,c);if(!_(W.x,W.y,o.getCenterX(),o.getCenterY(),h))return;let B=o.getCenterX(),M=Math.floor(B/c),y=Math.floor(o.y/c),D=F===M&&w===y,G=F===M&&w===y+1,Z=W.y%c<c/2,g=G&&Z,R=B-16,U=o.y-4,Q=W.x>=R&&W.x<R+32&&W.y>=U&&W.y<U+48;if((D||g||Q)&&!K){k();return}let j=t.getBlock(F,w);if(K!=="place"&&j!==f.AIR&&E(j,d))return i.addToInventory(j),e.playDig(b(j,d)),Se(F,w,j),t.setBlock(F,w,f.AIR),!0;if(K!=="break"&&(j===f.AIR||A(j,d))&&j!==f.WORKBENCH){let ut=o.getRect(),ct={x:F*c,y:w*c,w:c,h:c};if(!S(ut,ct)){let gt=i.getSelectedBlockId();if(j===gt)return;(gt===f.CLOUD||C(F,w,gt))&&(i.consumeFromInventory(gt)?(j!==f.AIR&&i.addToInventory(j),t.setBlock(F,w,gt),e.playDig("dirt"),l&&l(F,w,gt)):K!=="place"&&e.playPop())}}}return{handlePointer:O,triggerClimb:V}}var I={PLAINS:"plains",DESERT:"desert",SNOWFIELD:"snowfield",MOUNTAIN:"mountain",FOREST:"forest",WASTELAND:"wasteland",DEEP_FOREST:"deep_forest",SAVANNA:"savanna",PLATEAU:"plateau",OCEAN:"ocean",SWAMP:"swamp"};function Ln(t){let o=t/2;return{[I.PLAINS]:{weight:20,baseHeight:o,terrain:{largeAmplitude:10,smallAmplitude:3,largeFrequency:32,smallFrequency:9}},[I.FOREST]:{weight:20,baseHeight:o+2,terrain:{largeAmplitude:12,smallAmplitude:2,largeFrequency:30,smallFrequency:10}},[I.DESERT]:{weight:15,baseHeight:o+8,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:36,smallFrequency:12}},[I.SNOWFIELD]:{weight:15,baseHeight:o-4,terrain:{largeAmplitude:10,smallAmplitude:4,largeFrequency:28,smallFrequency:10}},[I.MOUNTAIN]:{weight:10,baseHeight:o-18,terrain:{largeAmplitude:20,smallAmplitude:6,largeFrequency:35,smallFrequency:9}},[I.WASTELAND]:{weight:5,baseHeight:o-5,terrain:{largeAmplitude:8,smallAmplitude:5,largeFrequency:40,smallFrequency:5}},[I.DEEP_FOREST]:{weight:10,baseHeight:o+5,terrain:{largeAmplitude:15,smallAmplitude:4,largeFrequency:25,smallFrequency:8}},[I.SAVANNA]:{weight:15,baseHeight:o,terrain:{largeAmplitude:5,smallAmplitude:1,largeFrequency:50,smallFrequency:15}},[I.PLATEAU]:{weight:10,baseHeight:o-10,terrain:{largeAmplitude:25,smallAmplitude:2,largeFrequency:60,smallFrequency:5}},[I.OCEAN]:{weight:12,baseHeight:o+25,terrain:{largeAmplitude:15,smallAmplitude:5,largeFrequency:45,smallFrequency:10}},[I.SWAMP]:{weight:5,baseHeight:o+2,terrain:{largeAmplitude:6,smallAmplitude:2,largeFrequency:40,smallFrequency:8}}}}function xn(t,o,i,r){let e=r/2-14;return t===I.DESERT?s.SAND:t===I.SNOWFIELD?s.SNOW:t===I.WASTELAND?s.STONE:t===I.OCEAN?s.SAND:t===I.MOUNTAIN?o<e?s.SNOW:o>r/2-6?s.GRASS:s.STONE:t===I.SAVANNA?i%7<3||Math.random()<.2?s.DIRT:s.GRASS:t===I.PLATEAU?o%4===0?s.SAND:s.STONE:t===I.SWAMP?Math.random()<.3?s.DIRT:s.GRASS:s.GRASS}function Bn(t,o,i){let r=o<=i+4;return t===I.DESERT?r?s.SAND:s.STONE:t===I.OCEAN?s.SAND:t===I.MOUNTAIN||t===I.WASTELAND||t===I.PLATEAU?s.STONE:s.DIRT}function Dn(t,o,i){let e=-80;for(let n=20;n<o-20;n++){if(n-e<80)continue;let a=Math.random(),l=t[n];if(a<.003){let c=25+Math.floor(Math.random()*20);Ur(t,n,c,o,i),e=n+c}else if(a<.0045){let c=30+Math.floor(Math.random()*20);l>50&&(Yr(t,n,c,o),e=n+c)}else if(a>.995){let c=20+Math.floor(Math.random()*25);Hr(t,n,c,o),e=n+c}else if(a>.985){let c=40+Math.floor(Math.random()*30);Xr(t,n,c,o),e=n+c}}}function Ur(t,o,i,r,e){let n=25+Math.floor(Math.random()*20),a=Math.floor(i/2);for(let l=-a;l<=a;l++){let c=o+l,f=(c%r+r)%r,d=Math.abs(l)/a,h=Math.pow(Math.cos(d*Math.PI/2),.5),u=Math.floor(h*4)/4,m=h*.3+u*.7,_=Math.sin(c*.5)*2,E=Math.floor(n*m)+_,A=t[f];t[f]=Math.min(e-5,A+E)}jr(t,o-a,o+a,r)}function Yr(t,o,i,r){let e=30+Math.floor(Math.random()*15),n=Math.floor(i/2),a=i*.25;for(let l=-n;l<=n;l++){let f=((o+l)%r+r)%r,d=Math.abs(l),h=Math.exp(-Math.pow(d/(i*.35),2));if(d<a){let m=Math.pow((a-d)/a,2);h-=m*1.5}let u=Math.floor(e*h);t[f]=Math.max(10,t[f]-u)}}function Hr(t,o,i,r){let e=15+Math.floor(Math.random()*15),n=Math.floor(i/2);for(let a=-n;a<=n;a++){let c=((o+a)%r+r)%r,f=Math.abs(a)/n,d=0;if(f<.6)d=1+Math.random()*.1;else{let h=(1-f)/.4;d=h*h}t[c]=Math.max(10,t[c]-Math.floor(e*d))}}function Xr(t,o,i,r){let e=Math.floor(i/2);for(let n=-e;n<=e;n++){let l=((o+n)%r+r)%r,c=n/i*Math.PI*4,f=Math.sin(c)*6,d=Math.abs(n)/e,h=1-Math.pow(d,3);t[l]-=Math.floor(f*h)}}function jr(t,o,i,r){for(let e=o;e<=i;e++){let n=((e-1)%r+r)%r,a=(e%r+r)%r,l=((e+1)%r+r)%r,c=t[n],f=t[a],d=t[l];Math.abs(c-f)>3&&Math.abs(d-f)>3&&(t[a]=Math.floor((c+f+d)/3))}}function Nn(t,o){for(let i=0;i<t.width;i++){let r=(i-1+t.width)%t.width,e=(i+1)%t.width,n=o[i],a=o[r],l=o[e];if(n>a+2)for(let c=a+1;c<=n;c++)t.getBlock(r,c)===s.DIRT&&t.setBlock(r,c,s.STONE);if(n>l+2)for(let c=l+1;c<=n;c++)t.getBlock(e,c)===s.DIRT&&t.setBlock(e,c,s.STONE)}}function Fn(t){for(let i=0;i<12;i++){let r=0,e=i%2===0,n=e?0:t.width-1,a=e?t.width:-1,l=e?1:-1;for(let c=0;c<t.height-1;c++)for(let f=n;f!==a;f+=l)if(t.getBlock(f,c)===s.WATER){if(t.getBlock(f,c+1)===s.AIR){t.setBlock(f,c+1,s.WATER),t.setBlock(f,c,s.AIR),r++;continue}let d=(f-1+t.width)%t.width,h=(f+1)%t.width,u=c+1,m=t.getBlock(d,c)===s.AIR&&t.getBlock(d,u)===s.AIR,_=t.getBlock(h,c)===s.AIR&&t.getBlock(h,u)===s.AIR;if(m||_){let T=(m&&_?Math.random()<.5:m)?d:h;t.setBlock(T,u,s.WATER),t.setBlock(f,c,s.AIR),r++;continue}let E=t.getBlock(f,c+1);if(E===s.WATER||lt(E,$)){let A=t.getBlock(d,c)===s.AIR,T=t.getBlock(h,c)===s.AIR;if(A||T){let b;if(A&&T){let C=(f-2+t.width)%t.width,k=(f+2)%t.width,V=t.getBlock(C,c),O=t.getBlock(k,c),L=V===s.WATER||lt(V,$),x=O===s.WATER||lt(O,$);L&&!x?b=!0:!L&&x?b=!1:b=Math.random()<.5}else b=A;let S=b?d:h;t.setBlock(S,c,s.WATER),t.setBlock(f,c,s.AIR),r++}}}if(r===0)break}}function Gn(t,o,i){for(let e=0;e<t.width;e++)if(o[e]===I.OCEAN){let n=!1;for(let l=-5;l<=5;l++){let c=(e+l+t.width)%t.width;if(o[c]!==I.OCEAN){n=!0;break}}if(n)continue;let a=i+1;for(let l=a;l<t.height;l++){let c=t.getBlock(e,l);if(c===s.AIR)t.setBlock(e,l,s.WATER);else if(lt(c,$)||c===s.WATER)break}}}function Re(t,o,i,r,e){let n=e*e,a=Math.ceil(e);for(let l=-a;l<=a;l++)for(let c=-a;c<=a;c++)if(l*l+c*c<=n){let f=o+l,d=i+c,h=t.get(f,d);(h===s.STONE||h===s.DIRT)&&t.set(f,d,r)}}function qt(t,o,i,r){for(let e=-r;e<=r;e++)for(let n=0;n<=r/2;n++)e*e+n*n*4<=r*r&&t.set(o+e,i+n,s.WATER)}function Wn(t,o,i){let r=2+Math.floor(Math.random()*3);for(let e=-r;e<=r;e++)for(let n=-r;n<=r;n++)if(e*e+n*n<=r*r){let a=o+e,l=i+n;l<t.height-1&&t.set(a,l,s.AIR)}}function xt(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<r;e++)t.set(o,i-e,s.WOOD);for(let e=o-2;e<=o+2;e++)for(let n=i-r-2;n<=i-r;n++)Math.abs(e-o)===2&&Math.abs(n-(i-r))===2||t.get(e,n)===s.AIR&&t.set(e,n,s.LEAVES)}function Kn(t,o,i){let r=5+Math.floor(Math.random()*4);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD);let e=1;for(let n=r;n>1;n--){let a=i-n;(r-n)%2===0&&(e=Math.min(3,e+1)),n===r&&(e=1);for(let l=o-e;l<=o+e;l++)l===o&&n!==r||t.get(l,a)===s.AIR&&t.set(l,a,s.LEAVES)}t.set(o,i-r,s.LEAVES)}function Vn(t,o,i){let r=2+Math.floor(Math.random()*3);for(let e=0;e<r;e++)t.set(o,i-e,s.LEAVES);if(r>=3&&Math.random()<.5){let e=Math.random()<.5?-1:1,n=1+Math.floor(Math.random()*(r-2));t.get(o+e,i-n)===s.AIR&&(t.set(o+e,i-n,s.LEAVES),t.get(o+e,i-n-1)===s.AIR&&t.set(o+e,i-n-1,s.LEAVES))}}function ye(t,o,i){let r=3+Math.floor(Math.random()*3),e=o;for(let n=0;n<r;n++)t.set(e,i-n,s.WOOD),n>1&&Math.random()<.3&&(e+=Math.random()<.5?-1:1);if(Math.random()<.5){let n=i-Math.floor(r/2),a=Math.random()<.5?-1:1;t.get(e+a,n)===s.AIR&&t.set(e+a,n,s.WOOD)}}function Ie(t,o,i){let r=8+Math.floor(Math.random()*5);for(let n=0;n<r;n++)if(t.set(o,i-n,s.WOOD),Math.random()<.3){let a=Math.random()<.5?-1:1;t.get(o+a,i-n)===s.AIR&&t.set(o+a,i-n,s.LEAVES)}let e=3;for(let n=0;n<3;n++)for(let a=-e;a<=e;a++)Math.abs(a)+n<4&&t.set(o+a,i-r+1-n,s.LEAVES)}function Un(t,o,i){let r=4+Math.floor(Math.random()*2),e=o;for(let a=0;a<Math.floor(r/2);a++)t.set(e,i-a,s.WOOD);let n=Math.random()<.5?1:-1;for(let a=Math.floor(r/2);a<r;a++)e+=n,t.set(e,i-a,s.WOOD);for(let a=-2;a<=2;a++)t.set(e+a,i-r,s.LEAVES);for(let a=-1;a<=1;a++)t.set(e+a,i-r-1,s.LEAVES)}function Yn(t,o,i){let r=6+Math.floor(Math.random()*4);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD);let e=3;for(let n=0;n<=2;n++)for(let a=-e;a<=e;a++)if(Math.abs(a)+n<5){let l=i-r+1-n;if(t.get(o+a,l)===s.AIR&&t.set(o+a,l,s.LEAVES),Math.abs(a)>=2&&Math.random()<.6){let c=1+Math.floor(Math.random()*3);for(let f=1;f<=c;f++)t.get(o+a,l+f)===s.AIR&&t.set(o+a,l+f,s.LEAVES)}}}function yt(t,o,i){t.set(o,i,s.LEAVES),Math.random()<.5&&t.get(o+1,i)===s.AIR&&t.set(o+1,i,s.LEAVES),Math.random()<.3&&t.get(o,i-1)===s.AIR&&t.set(o,i-1,s.LEAVES)}function io(t,o,i){t.set(o,i,s.STONE),Math.random()<.7&&t.set(o+1,i,s.STONE),Math.random()<.5&&t.set(o,i-1,s.STONE)}function Hn(t,o,i){let r=3+Math.floor(Math.random()*2),e=r+2;for(let a=-e;a<=e;a++){let l=Math.abs(a);for(let c=-1;c<=3;c++){let f=o+a,d=i+c;l<=r?c>0&&t.set(f,d,s.SAND):c===0?t.set(f,d,s.GRASS):c>0&&t.set(f,d,s.DIRT)}}for(let a=-r;a<=r;a++){let l=Math.abs(a)<r-1?1:0;for(let c=0;c<=l;c++)t.set(o+a,i+c,s.WATER);t.set(o+a,i-1,s.AIR),t.set(o+a,i-2,s.AIR)}let n=1+Math.floor(Math.random()*2);for(let a=0;a<n;a++){let l=Math.random()<.5?-1:1,c=o+l*(r+1);t.get(c,i)===s.GRASS&&Ie(t,c,i-1)}if(Math.random()<.5){let a=Math.random()<.5?-1:1,l=o+a*(e-1);t.get(l,i)===s.GRASS&&yt(t,l,i-1)}}function Xn(t,o,i){let r=6+Math.floor(Math.random()*5);for(let e=0;e<r;e++)t.set(o,i-e,s.BEDROCK),t.set(o+1,i-e,s.BEDROCK);t.set(o,i-r,s.GOLD),t.set(o+1,i-r,s.GOLD),t.set(o-1,i,s.STONE),t.set(o+2,i,s.STONE)}function jn(t,o,i){let n=o-Math.floor(3),a=i;for(let l=-1;l<=6;l++)for(let c=-1;c<=5;c++){let f=n+l,d=a+c;l===-1||l===6||c===-1||c===5?t.set(f,d,s.STONE):t.set(f,d,s.AIR)}t.set(n+1,a+5-1,s.JACKPOT),t.set(n+6-2,a+5-1,s.TNT),t.set(n+Math.floor(6/2),a+5-1,s.WORKBENCH)}function Jn(t,o,i){let r=15+Math.floor(Math.random()*10);for(let n=0;n<r;n++)t.set(o,i-n,s.WOOD),t.set(o+1,i-n,s.WOOD),n<3&&(t.set(o-1,i-n+1,s.WOOD),t.set(o+2,i-n+1,s.WOOD));let e=6;for(let n=-e;n<=e;n++)for(let a=-e;a<=e+1;a++)if(a*a+n*n<=e*e+Math.random()*5){let l=i-r+n;t.get(o+a,l)===s.AIR&&t.set(o+a,l,s.LEAVES)}t.set(o,i-r-2,s.GOLD)}function qn(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<=r*1.5;e++){let n=Math.max(0,r-e*.7);for(let a=-Math.ceil(n);a<=Math.ceil(n);a++){let l=o+a,c=i+e;e===0?(t.set(l,c,s.GRASS),a===0&&Math.random()<.3&&xt(t,l,c-1)):e<2?t.set(l,c,s.DIRT):Math.random()<.4||a===0&&e>2?t.set(l,c,s.GOLD):t.set(l,c,s.STONE)}}}function Zn(t,o,i){let r=4+Math.floor(Math.random()*5),e=4+Math.floor(Math.random()*3);for(let n=-r;n<=r;n++){let a=Math.abs(n)/r,l=Math.floor(e*(1-a*a)),c=i-l,f=i+4+Math.floor(Math.random()*3);for(let d=c;d<=f;d++)d<i?(t.set(o+n,d,s.SAND),d===c&&Math.random()>.2&&t.set(o+n,d,s.GRASS)):t.set(o+n,d,s.SAND)}Math.random()>.3&&xt(t,o,i-e-1)}function $n(t,o,i){let r=Math.floor(Math.random()*4);if(r===0){let e=3+Math.floor(Math.random()*4);for(let n=0;n<e;n++)t.set(o,i-1-n,s.STONE);Math.random()<.5&&t.set(o,i-1-e,s.STONE),Math.random()<.4&&t.set(o+1,i-1,s.STONE)}else if(r===1){let e=3+Math.floor(Math.random()*2);for(let n=0;n<e;n++){let a=e-n-1;for(let l=-a;l<=a;l++)Math.random()>.1&&t.set(o+l,i-1-n,s.STONE)}}else if(r===2){for(let a=-1;a<=1;a++)t.set(o+a,i-4,s.STONE);for(let a=1;a<4;a++)t.set(o-1,i-a,s.STONE),t.set(o+1,i-a,s.STONE)}else if(r===3){let e=4+Math.floor(Math.random()*3);for(let n=0;n<e;n++){let a=1+Math.floor(Math.random()*2);for(let l=0;l<a;l++)t.set(o+n,i-1-l,s.STONE)}}}function zn(t,o,i){let r=10+Math.floor(Math.random()*15),e=o,n=i;for(let a=0;a<r&&!(e>=t.width-2);a++)t.set(e,n,s.AIR),t.set(e,n-1,s.AIR),t.set(e,n-2,s.AIR),t.set(e,n+1,s.WOOD),a%4===0&&(t.get(e,n+1)!==s.AIR&&t.set(e,n,s.WOOD),t.get(e,n-2)!==s.AIR&&t.set(e,n-1,s.WOOD),t.set(e,n-2,s.WOOD)),e++,Math.random()<.1&&(n+=Math.random()<.5?-1:1),n>t.height-5&&(n=t.height-5),n<50&&(n=50)}function Qn(t,o,i){let r=25+Math.floor(Math.random()*10),e=20+Math.floor(Math.random()*5);for(let c=0;c<=e;c++){let f=r*(1-Math.pow(c/e,.8)),d=Math.ceil(f);for(let h=-d;h<=d;h++)if(h*h/(f*f)<=1){let u=o+h,m=i+c;if(c===0)t.set(u,m,s.GRASS);else if(c<3)t.set(u,m,s.DIRT);else{let _=Math.random();_>.98?t.set(u,m,s.GOLD):_>.95?t.set(u,m,s.COAL):t.set(u,m,s.STONE)}}}for(let c=-r+2;c<=r-2;c++){let f=o+c,d=i;if(Math.abs(c)%5===0&&Math.random()<.6){let h=4+Math.floor(Math.random()*5);for(let u=1;u<=h;u++)t.set(f,d-u,s.STONE);Math.random()<.5&&(t.set(f+1,d-h,s.STONE),t.set(f-1,d-h,s.STONE))}Math.random()<.05&&t.get(f,d)===s.GRASS&&xt(t,f,d-1),Math.abs(c)<5&&Math.random()<.3&&(t.set(f,d,s.WATER),t.set(f,d+1,s.STONE))}let n=8,a=8;for(let c=-n;c<=n;c++)for(let f=0;f<a;f++){let d=o+c,h=i-1-f;(Math.abs(c)===n||Math.abs(c)===n-2)&&Math.random()>.2&&t.set(d,h,s.STONE)}let l=i-a+2;t.set(o,l,s.JACKPOT),t.set(o,l-1,s.GOLD),t.set(o,l+1,s.GOLD),t.set(o-1,l,s.GOLD),t.set(o+1,l,s.GOLD)}function ti(t,o,i){let r=20+Math.floor(Math.random()*10),e=16+Math.floor(Math.random()*5);for(let d=-e;d<=2;d++)for(let h=-r;h<=r;h++)if(h*h/(r*r)+d*d/(e*e)<=1){let u=o+h,m=i+d-Math.floor(e*.6);m>0&&m<t.height-1&&t.set(u,m,s.AIR)}let n=o,a=i-e-2,l=3;for(let d=-l;d<=l;d++)for(let h=-l;h<=l;h++)d*d+h*h<=l*l&&t.set(n+d,a+h,s.GOLD);t.set(n,a,s.JACKPOT);let c=16+Math.floor(Math.random()*8),f=Math.ceil(c/2);for(let d=0;d<f;d++){let h=c-d*2,u=i-d,m=o-Math.floor(h/2);for(let _=0;_<h;_++)t.set(m+_,u,s.SAND)}t.set(o,i-f,s.SAND),t.set(o,i-1,s.JACKPOT),t.set(o-1,i-1,s.GOLD),t.set(o+1,i-1,s.GOLD)}function ei(t,o,i,r,e){for(let a=0;a<r;a++)for(let l=0;l<e;l++){let c=r/2,f=e/2,d=Math.abs(a-c)/c,h=Math.abs(l-f)/f,u=.7+Math.random()*.3;d+h<u&&t.set(o+a,i+l,s.CLOUD)}let n=Math.floor(r/3);for(let a=0;a<n;a++){let l=o+1+Math.floor(Math.random()*(r-2));Math.random()>.4&&t.set(l,i-1,s.CLOUD)}}function Jr(t,o,i,r,e){for(let n=0;n<r;n++){for(let a=0;a<e;a++)(n<2||n>=r-2)&&a>0&&Math.random()>.5||t.set(o+n,i+a,s.CLOUD);Math.random()>.7&&n>0&&n<r-1&&t.set(o+n,i-1,s.CLOUD)}}function qr(t,o,i){for(let r=2;r<8;r++)Math.random()>.3&&t.set(o+r,i,s.CLOUD);for(let r=0;r<12;r++)t.set(o+r,i+1,s.CLOUD);for(let r=1;r<10;r++)Math.random()>.2&&t.set(o+r,i+2,s.CLOUD)}function Zr(t,o,i){let r=3+Math.floor(Math.random()*3);for(let e=0;e<r;e++){let n=Math.floor(Math.random()*15),a=Math.floor(Math.random()*4),l=2+Math.floor(Math.random()*3);for(let c=0;c<l;c++)for(let f=0;f<Math.ceil(l/2);f++)Math.random()>.3&&t.set(o+n+c,i+a+f,s.CLOUD)}}function oi(t,o,i,r){switch(r){case 0:ei(t,o,i,4,2);break;case 1:Jr(t,o,i,12,1);break;case 2:ei(t,o,i,8,3);break;case 3:qr(t,o,i);break;case 4:Zr(t,o,i);break}}function ni(t,o,i,r){let e=Math.random();switch(r){case I.PLAINS:e<.05?xt(t,o,i):e<.08&&yt(t,o,i);break;case I.FOREST:e<.15?xt(t,o,i):e<.3&&yt(t,o,i);break;case I.SNOWFIELD:e<.06&&Kn(t,o,i);break;case I.DESERT:e<.02&&Vn(t,o,i);break;case I.MOUNTAIN:e<.015?ye(t,o,i):e<.025&&io(t,o,i);break;case I.WASTELAND:e<.04?ye(t,o,i):e<.1&&io(t,o,i);break;case I.DEEP_FOREST:e<.25?Ie(t,o,i):e<.6&&yt(t,o,i);break;case I.SAVANNA:e<.04?Un(t,o,i):e<.1&&yt(t,o,i);break;case I.PLATEAU:e<.02&&ye(t,o,i);break;case I.SWAMP:e<.1?Yn(t,o,i):e<.2?qt(t,o,i,2):e<.4&&Math.random()<.5&&yt(t,o,i);break}}function ii(t,o,i,r){let e=t.getAccessor(),n=Math.floor(t.width/80);for(let l=0;l<n;l++){let c=Math.floor(Math.random()*t.width),f=o[c],h=Math.min(f,r)-35,u=15;if(h>u){let m=u+Math.floor(Math.random()*(h-u));qn(e,c,m)}}for(let l=0;l<t.width;l+=1)i[l]===I.OCEAN&&Math.random()<.03&&(Zn(e,l,r),l+=40);for(let l=0;l<t.width;l+=1)if(i[l]===I.DESERT){if(Math.random()<.002)Hn(e,l,o[l]),l+=25;else if(Math.random()<.015){let c=o[(l+2)%t.width];Math.abs(c-o[l])<2&&($n(e,l,o[l]),l+=15)}}let a=Math.floor(t.width/50);for(let l=0;l<a;l++){let c=Math.floor(Math.random()*t.width),f=o[c];zn(e,c,f+15+Math.floor(Math.random()*(t.height-f-20)))}}function ri(t,o,i){let r=t.getAccessor();for(let c=0;c<t.width;c++){let f=i[c],d=o[c];if((f===I.PLAINS||f===I.WASTELAND)&&Math.random()<.003){Xn(r,c,d),c+=10;continue}if((f===I.FOREST||f===I.SAVANNA)&&Math.random()<.004&&d<t.height-20){jn(r,c,d+8),c+=15;continue}if(f===I.DEEP_FOREST&&Math.random()<.005){Jn(r,c,d),c+=15;continue}}let e=100+Math.floor(Math.random()*(t.width-200)),n=t.height-10-Math.floor(Math.random()*10);ti(r,e,n);let a=150+Math.floor(Math.random()*(t.width-300)),l=30+Math.floor(Math.random()*10);Qn(r,a,l)}function ai(t,o,i,r){let e=t.getAccessor(),n=Math.floor(t.width/60),a=t.height/2-14;for(let l=0;l<n;l++){let c=Math.floor(Math.random()*(t.width-10))+5,f=i[c],d=o[c];if(f===I.SNOWFIELD||f===I.DESERT||f===I.MOUNTAIN&&d<a)continue;let h=o[(c-2+t.width)%t.width],u=o[(c+2)%t.width];d<=r&&Math.abs(h-u)<3&&qt(e,c,d,2+Math.floor(Math.random()*3))}}function si(t,o,i,r){let e=t.getAccessor(),n=2+Math.floor(Math.random()*2),a=0,l=0;for(;a<n&&l<t.width*4;){l++;let c=Math.floor(Math.random()*t.width),f=i[c];if(f===I.DESERT||f===I.SNOWFIELD||f===I.WASTELAND)continue;let d=o[c];if(d>=r)continue;let h=5,u=10,m=o[(c-h+t.width)%t.width],_=o[(c+h)%t.width],E=m-d,A=_-d;if(E>u||A>u){qt(e,c,d,3);for(let T=-4;T<=4;T++){let b=(c+T+t.width)%t.width;if(t.getBlock(b,d)===s.WATER){let S=d+1;for(;S<t.height;){let C=t.getBlock(b,S);if(C===s.AIR)t.setBlock(b,S,s.WATER);else if(C!==s.WATER)break;S++}}}a++}}}function li(t,o){let i=t.getAccessor(),r=Math.max(3,Math.floor(t.width/35));for(let e=0;e<r;e++){let n=Math.floor(Math.random()*t.width),l=o[n]+8,c=t.height-6;if(l>=c)continue;let f=n,d=l+Math.floor(Math.random()*(c-l)),h=30+Math.floor(Math.random()*40);for(let u=0;u<h;u++){Wn(i,f,d),f+=Math.floor(Math.random()*3)-1,d+=Math.floor(Math.random()*3)-1,f=(f%t.width+t.width)%t.width;let m=o[f];d=Math.max(m+6,Math.min(t.height-5,d))}}}function ci(t,o){let i=t.getAccessor(),r=Math.floor(t.width*t.height/1500);for(let a=0;a<r;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+8&&Re(i,l,c,s.DIRT,2+Math.random()*2.5)}let e=Math.floor(t.width*t.height/2500);for(let a=0;a<e;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+10&&Re(i,l,c,s.SAND,1.5+Math.random()*2)}let n=Math.floor(t.width*t.height/2e3);for(let a=0;a<n;a++){let l=Math.floor(Math.random()*t.width),c=Math.floor(Math.random()*t.height);c>o[l]+15&&c<t.height-10&&Re(i,l,c,s.WATER,2+Math.random()*2.5)}}function fi(t,o){let r=Math.floor(t.width/25),e=t.getAccessor(),n=Math.floor(t.height/2)+2;for(let a=0;a<r;a++){let l=Math.floor(Math.random()*t.width),c=o[l],d=Math.min(c,n)-20,h=5;if(d<=h)continue;let u=h+Math.floor(Math.random()*(d-h)),m=Math.floor(Math.random()*5);oi(e,l,u,m)}}function di(t){for(let c=0;c<t.width;c++){let f=Math.sin(c*.02)*8+Math.cos(c*.1)*4+Math.sin(c*.5)*2+Math.random()*2,d=Math.max(0,2+f),h=Math.floor(t.height-d),u=Math.max(t.height-40,Math.min(t.height,h));for(let m=t.height-1;m>=u;m--)t.setBlock(c,m,s.AIR)}}function hi(t){let o=Ln(t.height),{heights:i,biomeByColumn:r}=To(t.width,o,96,192),e=Math.floor(t.height/2)+2;Dn(i,t.width,t.height);for(let n=0;n<t.width;n++){let a=i[n],l=r[n],c=xn(l,a,n,t.height);for(let f=0;f<t.height;f++)if(f>a)if(f>a+5){let d=Math.random();d>.995&&f>a+15?t.setBlock(n,f,s.GOLD):d>.96?t.setBlock(n,f,s.COAL):Math.random()>.95?t.setBlock(n,f,s.DIRT):t.setBlock(n,f,s.STONE)}else t.setBlock(n,f,Bn(l,f,a));else f===a?f>e?t.setBlock(n,f,s.SAND):(t.setBlock(n,f,c),(c===s.GRASS||l===I.SNOWFIELD&&c===s.SNOW||l===I.DESERT&&c===s.SAND||l===I.WASTELAND&&c===s.STONE||l===I.SAVANNA&&(c===s.GRASS||c===s.DIRT)||l===I.PLATEAU&&c===s.STONE)&&n>5&&n<t.width-5&&ni(t.getAccessor(),n,f-1,l)):f>e&&l===I.OCEAN&&t.setBlock(n,f,s.WATER)}Nn(t,i),ci(t,i),li(t,i),ai(t,i,r,e),si(t,i,r,e),ii(t,i,r,e),ri(t,i,r),di(t);for(let n=10;n<t.width-10;n+=50+Math.floor(Math.random()*20)){let a=i[n];a<=e&&t.getBlock(n,a-1)===s.AIR&&t.setBlock(n,a-1,s.WORKBENCH)}Fn(t),Gn(t,r,e),fi(t,i)}var Nt=class{constructor(o,i){this.width=o,this.height=i,this.map=new Uint8Array(o*i),this.map.fill(s.AIR),hi(this)}getIndex(o,i){return go(o,i,this.width,this.height)}getBlock(o,i){let r=this.getIndex(o,i);return r===-1?s.BEDROCK:this.map[r]}setBlock(o,i,r){let e=this.getIndex(o,i);e!==-1&&(this.map[e]=r)}getAccessor(){return{get:(o,i)=>this.getBlock(o,i),set:(o,i,r)=>this.setBlock(o,i,r),width:this.width,height:this.height}}checkAreaFree(o,i,r,e){let n=Math.floor(o/p),a=Math.floor((o+r)/p),l=Math.floor(i/p),c=Math.floor((i+e)/p);for(let f=l;f<=c;f++)for(let d=n;d<=a;d++)if(lt(this.getBlock(d,f),$))return!1;return!0}};var Zt=12,et=1<<Zt,Y=t=>Math.floor(t*et),It=t=>t/et,ui=Math.floor(Math.pow(.8,dt)*et),mi=Y(Co),ro=Y(15/720),pi=Y(dt),$t=Y(5),_i=Y(me),Vs=Y(Ve),gi=Y(Po),bi=Y(vo),Ai=Y(ko),Ti=Y(Oo),Mi=Y(Lo),Ei=Y(2),zt=41,H=Y(p),ao=Y(.1),Si=Y(.2*p),so=Y(.1),Ft=Y(pe),Ri=Y(Wo),yi=Y(No),Ii=Y(Fo*p),Ci=p*p,wi=$t*2,Oi=1097,ki=2458,Pi=wo,Gt=[];for(let t=0;t<=128;t++)Gt[t]=Y(Ve*Math.sqrt(t));function vi(t){return Math.trunc(t*ui/et)}function Li(t,o){if(t===0)return{boardVx:0,lowFrictionActive:!1};let i=o?ro>>1:ro,r;t>0?r=Math.max(0,t-i):r=Math.min(0,t+i);let e=o;return o&&Math.abs(r)<Ri&&(e=!1),{boardVx:r,lowFrictionActive:e}}function xi(t,o,i,r,e){if(t>=Ti)return{vy:t,fastballActive:r};let n=mi,a=r;if(o)n=Math.floor(n*Ai/et);else if(i&&(n=Math.floor(n*Pi)),r){let l=Math.abs(e);if(l<Ft>>2)a=!1;else{let c=Math.floor(n*l/Ft);n-=c}}return{vy:t+n,fastballActive:a}}function Bi(t,o,i,r,e,n,a,l){let c=t-e,f=o-n,d=c*c+f*f,u=a*a*Ci;if(d>=u||d<=0)return{vx:i,vy:r,affected:!1};let m=Math.floor(Math.sqrt(d)),_=Math.floor(c*et/m),E=Math.floor(f*et/m),A=Math.max(m,H),T=Math.floor(yi*l/et),b=Math.floor(a*H/et),C=Math.floor(T*T/et)*b,k=A+Ii,V=Math.floor(C/k),O=Math.floor((i*_+r*E)/et),L=Math.floor(O*O/et),x=V*2,K=L+x,W=Math.floor(Math.sqrt(Math.max(0,K)*et)),F=-O+W;return{vx:i+Math.floor(_*F/et),vy:r+Math.floor(E*F/et),affected:!0}}function lo(t,o,i){let r=0,e=i;for(;t.getBlock(o,e)===s.JUMP_PAD;)r++,e--;for(e=i+1;t.getBlock(o,e)===s.JUMP_PAD;)r++,e++;return r}function co(t,o,i,r,e){let{_x:n,_y:a,_vx:l,_vy:c,_width:f,_height:d,_boardVx:h,lowGravityActive:u}=t,m=!1,_=!1,E=Math.floor(n/H),A=Math.floor((n+f)/H),T=Math.floor(a/H),b=Math.floor((a+d)/H);for(let S=T;S<=b;S++)for(let C=E;C<=A;C++){let k=o.getBlock(C,S);if(lt(k,$))if(i)r>0?n=C*H-f-zt:r<0&&(n=(C+1)*H+zt),l=0,h=0;else{if(c>0)a=S*H-d-zt,m=!0,c=0,u=!1;else if(c<0){if(a=(S+1)*H+zt,c<Mi&&Et(k,$)&&Ao(k,xo))return e&&e(k),J.playDig(fe(k,$)),Se(C,S,k),o.setBlock(C,S,s.AIR),c+=Ei,_=!0,{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:!1,lowGravityActive:u,blockBroken:_};if(k===s.JUMP_PAD){let V=lo(o,C,S),O=Math.min(V,128);c=Gt[O],J.playBigJump()}else c=0}return{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}}return i||(m=!1),{_x:n,_y:a,_vx:l,_vy:c,_boardVx:h,grounded:m,lowGravityActive:u,blockBroken:_}}function Di(t,o,i,r,e){let n=o-r,a=Math.floor(n/H),l=Math.floor(t/H),c=Math.floor((t+i)/H);for(let f=l;f<=c;f++)if(lt(e.getBlock(f,a),$))return!1;return!0}function Ni(t,o,i,r){let e=t.gamepad&&t.gamepad.connected?t.gamepad.axisLeftX:0;if(Math.abs(e)>0){let n=Math.abs(e),a=Math.floor($t*n);return e<0?{vx:-a,facingRight:!1}:{vx:a,facingRight:!0}}return t.keys.left?{vx:-$t,facingRight:!1}:t.keys.right?{vx:$t,facingRight:!0}:{vx:r(o),facingRight:i}}function Fi(t,o,i,r,e,n,a,l){if(n<=0)return null;let c=t+(i>>1),f=o+r+ao,d=Math.floor(c/H),h=Math.floor(f/H);if(l.getBlock(d,h)!==s.WATER||l.getBlock(d,h-1)===s.WATER)return null;let m=e+a,_=m>0?m:-m,E=n;return _<wi?null:E*et<_*Oi?(J.playJump(),Y(me*-.5)):null}function zr(t,o,i){let r=[],e=i;for(;t.getBlock(o,e)===s.TNT;)r.push(e),e++;return r}function Gi(t,o,i,r,e,n){let a=t+(i>>1),l=o+r+ao,c=Math.floor(a/H),f=Math.floor(l/H);if(e.getBlock(c,f)!==s.JUMP_PAD)return null;let h=f;for(;e.getBlock(c,h+1)===s.JUMP_PAD;)h++;let m=e.getBlock(c,h+1)===s.CLOUD,_=zr(e,c,f+1);if(_.length>0&&n){let E=_.length*16,A=Math.min(E,128);return{vy:-Gt[A],lowGravityActive:m,tntTriggered:!0,feetX:c,tntPositions:_}}else{let E=lo(e,c,f),A=Math.min(E,128);return J.playBigJump(),{vy:-Gt[A],lowGravityActive:m,tntTriggered:!1,feetX:c,tntPositions:[]}}}function Wi(t,o,i,r,e,n,a,l,c,f){return t.keys.jump?o?(J.playJump(),{vy:-_i,grounded:!1,jumped:!0}):i&&r>bi&&f(e,n,a,l,c)?(J.playJump(),{vy:-gi,grounded:!1,jumped:!0}):null:null}function Ki(t,o,i,r,e,n){t.save(),t.translate(Math.floor(o),Math.floor(i));let a=Math.sin(n*.01)*5,l=Math.abs(r)>.1;t.fillStyle="#f8b090",t.fillRect(4,0,12,12),t.fillStyle="#00bcd4",t.fillRect(4,12,12,18),t.fillStyle="#3f51b5",t.fillRect(4,30,5,18+(l?a:0)),t.fillRect(11,30,5,18-(l?a:0)),t.fillStyle="#f8b090",e?t.fillRect(10,12,6,18+a):t.fillRect(4,12,-6,18+a),t.restore()}var we=class{constructor(o,i=null,r=null,e=null){this.world=o,this.addToInventory=i,this.onTNTJumpPad=r,this.onSplash=e,this._x=0,this._y=0,this._vx=0,this._vy=0,this._boardVx=0,this._width=Y(.6*p),this._height=Y(1.8*p),this._x=Y(o.width/2*p),this._y=0,this.grounded=!1,this.facingRight=!0,this.animTimer=0,this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1,this.bubbleTimer=0,this.wasInWater=!1,this.findSpawnPoint()}get x(){return It(this._x)}set x(o){this._x=Y(o)}get y(){return It(this._y)}set y(o){this._y=Y(o)}get vx(){return It(this._vx)}set vx(o){this._vx=Y(o)}get vy(){return It(this._vy)}set vy(o){this._vy=Y(o)}get boardVx(){return It(this._boardVx)}set boardVx(o){this._boardVx=Y(o)}get width(){return It(this._width)}get height(){return It(this._height)}getGridRect(){let o=Math.floor(this._x/H),i=Math.floor(this._y/H),r=Math.floor((this._x+this._width)/H),e=Math.floor((this._y+this._height)/H);return{startX:o,endX:r,startY:i,endY:e}}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getRect(){return{x:this.x,y:this.y,w:this.width,h:this.height}}applyAcceleratorForce(o){let i=this._boardVx*this._boardVx,r=Ft*Ft,e=Math.floor(Math.sqrt(i+r));this._boardVx=o>0?e:-e,this.facingRight=o>0}activateFastballMode(){this.fastballActive=!0}activateLowFrictionMode(){this.lowFrictionActive=!0}applyExplosionImpulse(o,i,r,e){let n=this._x+(this._width>>1),a=this._y+(this._height>>1),l=Bi(n,a,this._vx,this._vy,o,i,r,e);l.affected&&(this._vx=l.vx,this._vy=l.vy,this.grounded=!1)}findSpawnPoint(){let o=Math.floor(this._x/H),i=Math.floor(this.world.height*.4),r=this.world.getBlock(o,i);if(r!==s.AIR&&r!==s.CLOUD)for(let e=i;e>=0;e--){let n=this.world.getBlock(o,e);if(n===s.AIR||n===s.CLOUD){this._y=(e-1)*H;return}}else for(let e=i;e<this.world.height;e++){let n=this.world.getBlock(o,e);if(n!==s.AIR&&n!==s.CLOUD){this._y=(e-2)*H;return}}for(let e=0;e<this.world.height;e++){let n=this.world.getBlock(o,e);if(n!==s.AIR&&n!==s.CLOUD){this._y=(e-2)*H;break}}}respawn(){this._y=0,this._vy=0,this._vx=0,this._boardVx=0,this._x=Y(this.world.width/2*p),this.findSpawnPoint(),this.fastballActive=!1,this.lowGravityActive=!1,this.lowFrictionActive=!1}tick(o){let i=this._x+(this._width>>1),r=this._y+(this._height>>1),e=Math.floor(i/H),n=Math.floor(r/H),a=this.world.getBlock(e,n)===s.WATER;a&&!this.wasInWater&&this.onSplash&&this.onSplash(this.getCenterX(),this.getCenterY()),this.wasInWater=a;let l=Ni(o,this._vx,this.facingRight,vi);this._vx=l.vx,this.facingRight=l.facingRight;let c=Fi(this._x,this._y,this._width,this._height,this._vx,this._vy,this._boardVx,this.world);c!==null&&(this._vy=c);let f=Gi(this._x,this._y,this._width,this._height,this.world,this.onTNTJumpPad);if(f)this._vy=f.vy,this.grounded=!1,f.lowGravityActive&&(this.lowGravityActive=!0),f.tntTriggered&&this.onTNTJumpPad&&this.onTNTJumpPad(f.feetX,f.tntPositions);else{let C=Wi(o,this.grounded,a,this._vy,this._x,this._y,this._width,Si,this.world,Di);C&&(this._vy=C.vy,this.grounded=C.grounded)}let d=Li(this._boardVx,this.lowFrictionActive);this._boardVx=d.boardVx,this.lowFrictionActive=d.lowFrictionActive;let h=xi(this._vy,a,this.lowGravityActive,this.fastballActive,this._boardVx);this._vy=h.vy,this.fastballActive=h.fastballActive;let u=pi;a&&(u=u*ki>>Zt);let m=this._vx+this._boardVx;this._x+=m*u>>Zt;let _=co({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!0,m,this.addToInventory);this._x=_._x,this._vx=_._vx,this._boardVx=_._boardVx,this._y+=this._vy*u>>Zt;let E=co({_x:this._x,_y:this._y,_vx:this._vx,_vy:this._vy,_width:this._width,_height:this._height,_boardVx:this._boardVx,lowGravityActive:this.lowGravityActive},this.world,!1,this._vy,this.addToInventory);this._y=E._y,this._vy=E._vy,this.grounded=E.grounded,this.lowGravityActive=E.lowGravityActive,this.wrapHorizontally(),this.wrapVertically(),(this._vx>so||this._vx<-so)&&(this.animTimer+=Ht);let A=this.getCenterX(),T=this.y+4,b=Math.floor(A/p),S=Math.floor(T/p);if(this.world.getBlock(b,S)===s.WATER){if(this.bubbleTimer++,this.bubbleTimer>40){let C=p;for(let k=S-1;k>=0;k--)if(this.world.getBlock(b,k)!==s.WATER){C=T-(k+1)*p;break}An(A,T,Math.max(p,C)),this.bubbleTimer=Math.floor(Math.random()*-30)}}else this.bubbleTimer=0}wrapHorizontally(){let o=this.world.width*H;for(;this._x>=o;)this._x-=o;for(;this._x+this._width<=0;)this._x+=o}wrapVertically(){let o=this.world.height*H;for(;this._y>=o;)this._y-=o;for(;this._y+this._height<=0;)this._y+=o}draw(o){Ki(o,this.x,this.y,this.vx,this.facingRight,this.animTimer)}};var Bt=4e3,N={x:new Float32Array(Bt),y:new Float32Array(Bt),vx:new Float32Array(Bt),vy:new Float32Array(Bt),life:new Uint16Array(Bt),colorIdx:new Uint8Array(Bt),count:0},Vi=["#ffd54f","#fbc02d"],Qr=.15*dt*dt,ta=Math.pow(.99,dt),Qt=new Map,Ui=0,Yi=0,Hi=0,Xi=0,Oe=50;function ea(t){let o=N.count-1;t!==o&&(N.x[t]=N.x[o],N.y[t]=N.y[o],N.vx[t]=N.vx[o],N.vy[t]=N.vy[o],N.life[t]=N.life[o],N.colorIdx[t]=N.colorIdx[o]),N.count--}function ji(t,o,i,r,e,n){if(N.count>=Bt)return;let a=N.count;N.x[a]=t,N.y[a]=o,N.vx[a]=i,N.vy[a]=r,N.life[a]=e,N.colorIdx[a]=n,N.count++}function Ji(t,o,i){let r=Math.floor(t.x/p),e=Math.floor((t.x+t.width)/p),n=Math.floor(t.y/p),a=Math.floor((t.y+t.height)/p);for(let l=n;l<=a;l++)for(let c=r;c<=e;c++)if(o.getBlock(c,l)===s.JACKPOT){let f=`${c},${l}`;Qt.has(f)||(oa(c,l),Qt.set(f,Uo),i.playCoin())}}function qi(t,o){let i=t*p+p/2,r=o*p+p/2;for(let e=0;e<100;e++){let n=Ue+Math.floor(Math.random()*Ye);ji(i+(Math.random()-.5)*p,r+(Math.random()-.5)*p,(Math.random()-.5)*25*dt,-(4+Math.random()*14)*dt,n,e%2)}}function oa(t,o){let i=t*p+p/2,r=o*p+p/2;for(let e=0;e<24;e++){let n=Ue+Math.floor(Math.random()*Ye);ji(i+(Math.random()-.5)*p*.6,r+(Math.random()-.5)*p*.2,(Math.random()-.5)*3.2*dt,-(1.2+Math.random()*4.5)*dt,n,e%2)}}function Zi(){Qt.forEach((o,i)=>{let r=o-1;r<=0?Qt.delete(i):Qt.set(i,r)});let t=0;for(;t<N.count;){if(N.vx[t]*=ta,N.vy[t]+=Qr,N.x[t]+=N.vx[t],N.y[t]+=N.vy[t],N.life[t]--,N.life[t]<=0){ea(t);continue}t++}}function $i(t,o,i,r,e){if(N.count===0)return;Ui=o-Oe,Yi=o+r+Oe,Hi=i-Oe,Xi=i+e+Oe;let n=[],a=[];for(let l=0;l<N.count;l++){let c=N.x[l],f=N.y[l];c<Ui||c>Yi||f<Hi||f>Xi||(N.colorIdx[l]===0?n.push(l):a.push(l))}if(n.length>0){t.fillStyle=Vi[0];for(let l of n)t.fillRect(N.x[l]-3,N.y[l]-3,6,6)}if(a.length>0){t.fillStyle=Vi[1];for(let l of a)t.fillRect(N.x[l]-3,N.y[l]-3,6,6)}}var te=new Map,fo=null;function zi(t){t.onTNTAccelerator&&(fo=t.onTNTAccelerator)}function na(t,o,i){let r=Math.min(i*16,128),e=pe*Math.sqrt(r);t.boardVx=o*e,t.facingRight=o>0}function ia(t,o,i,r){let e=[],n=o;for(;t.getBlock(n,i)===s.TNT;)e.push(n),n-=r;return e}function Qi(t,o){let{startX:i,endX:r,startY:e,endY:n}=t.getGridRect();for(let a=e;a<=n;a++)for(let l=i;l<=r;l++){let c=o.getBlock(l,a),f=`${l},${a}`;if((c===s.ACCELERATOR_LEFT||c===s.ACCELERATOR_RIGHT)&&!te.has(f)){let d=c===s.ACCELERATOR_RIGHT?1:-1,h=l-d,u=ia(o,h,a,d);u.length>0&&fo?(na(t,d,u.length),fo(u,a)):t.applyAcceleratorForce(d);let m=o.getBlock(l,a+1);m===s.CLOUD&&t.activateFastballMode(),m===s.SNOW&&t.activateLowFrictionMode(),te.set(f,Go);return}}}function tr(){te.forEach((t,o)=>{let i=t-1;i<=0?te.delete(o):te.set(o,i)})}var ho="blockCraftSave",ra=1e3,aa=`
const SAVE_SCHEMA_VERSION = 2;

function rleEncode(data) {
    if (data.length === 0) return new Uint8Array(0);
    const result = [];
    let i = 0;
    while (i < data.length) {
        const value = data[i];
        let count = 1;
        while (i + count < data.length && data[i + count] === value && count < 65535) {
            count++;
        }
        result.push(value);
        if (count <= 255) {
            result.push(count);
        } else {
            result.push(0);
            result.push((count >> 8) & 0xff);
            result.push(count & 0xff);
        }
        i += count;
    }
    return new Uint8Array(result);
}

function uint8ToBase64(bytes) {
    const chunkSize = 0x8000;
    const chunks = [];
    for (let i = 0; i < bytes.length; i += chunkSize) {
        const slice = bytes.subarray(i, i + chunkSize);
        chunks.push(String.fromCharCode(...slice));
    }
    return btoa(chunks.join(''));
}

self.onmessage = function(e) {
    const { type, payload } = e.data;
    if (type === 'SAVE') {
        try {
            const { map, width, height, player, inventory, timers } = payload;
            const compressedMap = rleEncode(map);
            const base64Map = uint8ToBase64(compressedMap);
            const state = {
                schema: SAVE_SCHEMA_VERSION,
                world: { width, height, map: base64Map },
                player,
                inventory,
                timers
            };
            const jsonString = JSON.stringify(state);
            self.postMessage({ type: 'SAVE_COMPLETE', data: jsonString });
        } catch (err) {
            self.postMessage({ type: 'SAVE_ERROR', error: err.message });
        }
    }
};
`;function sa(t){let o=atob(t),i=o.length,r=new Uint8Array(i);for(let e=0;e<i;e++)r[e]=o.charCodeAt(e);return r}function Ct(){let t=localStorage.getItem(ho);if(!t)return null;try{return JSON.parse(t)}catch(o){return console.warn("Failed to parse saved state",o),localStorage.removeItem(ho),null}}function er({world:t,player:o,timers:i,inventory:r,utils:e,constants:n}){let a=null,l=!1,c=null;try{let u=new Blob([aa],{type:"application/javascript"}),m=URL.createObjectURL(u);c=new Worker(m),c.onmessage=_=>{let{type:E,data:A,error:T}=_.data;if(E==="SAVE_COMPLETE")try{localStorage.setItem(ho,A)}catch(b){console.warn("LocalStorage write failed:",b)}finally{l=!1}else E==="SAVE_ERROR"&&(console.warn("Worker save failed:",T),l=!1)},c.onerror=_=>{console.error("Save Worker Error:",_),l=!1}}catch(u){console.warn("Failed to initialize Save Worker, autosave disabled.",u)}function f(){if(!t||!o||!c||l)return;l=!0;let u={map:t.map,width:t.width,height:t.height,player:{x:o.x,y:o.y,vx:o.vx,vy:o.vy,grounded:o.grounded,facingRight:o.facingRight},inventory:r.getInventoryState(),timers:{tnt:i.tnt.map(m=>({x:m.x,y:m.y,timer:m.timer})),saplings:i.saplings.map(m=>({x:m.x,y:m.y,timer:m.timer}))}};c.postMessage({type:"SAVE",payload:u})}function d(u){if(u){if(u.world&&u.world.map&&u.world.width===t.width&&u.world.height===t.height){let m=sa(u.world.map),_=u.schema>=2?he(m):m;_.length===t.map.length&&(t.map=_)}u.player&&(o.x=u.player.x??o.x,o.y=u.player.y??o.y,o.vx=u.player.vx??o.vx,o.vy=u.player.vy??o.vy,o.grounded=u.player.grounded??o.grounded,o.facingRight=u.player.facingRight??o.facingRight,o.wrapVertically()),u.inventory&&r.loadInventoryState(u.inventory),u.timers&&(i.tnt.length=0,(u.timers.tnt||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&i.tnt.push({x:m.x,y:m.y,timer:m.timer})}),i.saplings.length=0,(u.timers.saplings||[]).forEach(m=>{typeof m.x=="number"&&typeof m.y=="number"&&typeof m.timer=="number"&&i.saplings.push({x:m.x,y:m.y,timer:m.timer})}))}}function h(){a&&clearInterval(a),a=setInterval(f,ra)}return{saveGameState:f,applySavedState:d,startAutosave:h}}var la=12,ft=1<<la,ee=t=>Math.floor(t*ft),wt=(t,o)=>(t%o+o)%o;function ca(t,o,i){let r=[],e=new Set,n=[{x:t,y:o}],a=(l,c)=>`${wt(l,i.width)},${wt(c,i.height)}`;for(e.add(a(t,o));n.length>0;){let l=n.pop();r.push(l);let c=[{x:l.x+1,y:l.y},{x:l.x-1,y:l.y},{x:l.x,y:l.y+1},{x:l.x,y:l.y-1}];for(let f of c){let d=wt(f.x,i.width),h=wt(f.y,i.height),u=a(f.x,f.y);e.has(u)||i.getBlock(d,h)===s.TNT&&(e.add(u),n.push(f))}}return r}function fa(t,o){let{world:i,player:r,sounds:e,addToInventory:n,createExplosionParticles:a}=o;e.playExplosion();let l=0,c=0;for(let w of t)l+=w.x,c+=w.y,i.setBlock(wt(w.x,i.width),wt(w.y,i.height),s.AIR);let f=t.length,d=Math.floor(l*ft/f),h=Math.floor(c*ft/f),u=d*p+ee(p/2),m=h*p+ee(p/2),_=u/ft,E=m/ft,A=Math.floor(Math.sqrt(f)*ft),T=ee(Do),b=Math.floor(T*A/ft),S=Math.min(10,Math.ceil(f*1.5)),C=A/ft;for(let w=0;w<S;w++){let B=p*C*.5,M=(Math.random()-.5)*B,y=(Math.random()-.5)*B;a(_+M,E+y)}r.applyExplosionImpulse(u,m,b,A);let k=Math.ceil(b/ft),V=Math.floor(_/p),O=Math.floor(E/p),L=V-k,x=V+k,K=O-k,W=O+k,F=Math.floor(b*p*(b*p));for(let w=K;w<=W;w++)for(let B=L;B<=x;B++){let M=B*p*ft+ee(p/2),y=w*p*ft+ee(p/2),D=M-u,G=y-m;if(D*D+G*G<=F){let Z=wt(B,i.width),g=wt(w,i.height),R=i.getBlock(Z,g);if(R===s.AIR)continue;if(R===s.FIREWORK){let U=M/ft,X=y/ft;for(let z=0;z<10;z++){let Q=`hsl(${Math.random()*360}, 100%, 50%)`,j=p*.75,ut=(Math.random()-.5)*2*j,ct=(Math.random()-.5)*2*j;a(U+ut,X+ct,Q)}i.setBlock(Z,g,s.AIR);continue}if(R===s.JACKPOT){qi(Z,g),n(R),i.setBlock(Z,g,s.AIR);continue}Et(R,$)&&(n(R),i.setBlock(Z,g,s.AIR))}}}function or(t){let{world:o}=t,i=[];return{tick(){for(let r=i.length-1;r>=0;r--){let e=i[r];if(o.getBlock(e.x,e.y)!==s.TNT){i.splice(r,1);continue}if(e.timer--,e.timer<=0){let n=ca(e.x,e.y,o);fa(n,t),i.splice(r,1)}}},onBlockPlaced(r,e){i.push({x:r,y:e,timer:Bo})},getTimers(){return i},loadTimers(r){i.length=0,i.push(...r)},cancelTimerAt(r,e){let n=i.findIndex(a=>a.x===r&&a.y===e);return n!==-1?(i.splice(n,1),!0):!1},hasTimerAt(r,e){return i.some(n=>n.x===r&&n.y===e)},detonateTNT(r,e){if(this.cancelTimerAt(r,e),o.getBlock(r,e)===s.TNT){o.setBlock(r,e,s.AIR);let n=r*p+p/2,a=e*p+p/2;t.createExplosionParticles(n,a)}}}}var da={[s.AIR]:"#87CEEB",[s.DIRT]:"#5d4037",[s.GRASS]:"#388e3c",[s.STONE]:"#757575",[s.WOOD]:"#6d4c41",[s.LEAVES]:"#2e7d32",[s.BEDROCK]:"#000000",[s.COAL]:"#212121",[s.GOLD]:"#ffb300",[s.WORKBENCH]:"#8d6e63",[s.SAND]:"#d7c27a",[s.SNOW]:"#e0f7fa",[s.CLOUD]:"#ffffff",[s.FIREWORK]:"#ef5350",[s.JUMP_PAD]:"#ab47bc",[s.TNT]:"#d32f2f",[s.SAPLING]:"#6fa85b",[s.JACKPOT]:"#ffd54f",[s.ACCELERATOR_LEFT]:"#42a5f5",[s.ACCELERATOR_RIGHT]:"#66bb6a",[s.WATER]:"#2196f3"},ha=30;function ua(t){let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:{r:0,g:0,b:0}}var Wt={};for(let[t,o]of Object.entries(da))Wt[t]=ua(o);function ma(t,o,i,r,e,n){let a=(t+r)/2,l=t-r,c=o-e,f=i-n,d=2+a/256,h=4,u=2+(255-a)/256;return Math.sqrt(d*l*l+h*c*c+u*f*f)}function pa(t,o,i){let r=1/0,e=s.DIRT;for(let[n,a]of Object.entries(Wt)){let l=parseInt(n),c=ma(t,o,i,a.r,a.g,a.b);(l===s.AIR||l===s.WORKBENCH)&&c>ha||c<r&&(r=c,e=l)}return e}function nr(t,o,i){let r=he(t);return new Promise(e=>{let n=document.createElement("canvas");n.width=o,n.height=i;let a=n.getContext("2d"),l=a.createImageData(o,i),c=l.data;for(let f=0;f<i;f++)for(let d=0;d<o;d++){let h=f*o+d,u=r[h],m=Wt[u]||Wt[s.AIR],_=h*4;c[_]=m.r,c[_+1]=m.g,c[_+2]=m.b,c[_+3]=255}a.putImageData(l,0,0),n.toBlob(e,"image/png")})}function ir(t){return new Promise((o,i)=>{let r=new FileReader;r.onload=e=>{let n=new Image;n.onload=()=>{let l=new Nt(ot,nt).map,c=document.createElement("canvas");c.width=ot,c.height=nt;let f=c.getContext("2d");f.clearRect(0,0,ot,nt),f.imageSmoothingEnabled=!1;let d=ot/nt,h=n.width/n.height,u,m,_,E;if(h>d)m=nt,u=n.width*(nt/n.height),_=(ot-u)/2,E=0;else{let O=Math.min(ot/n.width,nt/n.height);u=n.width*O,m=n.height*O,_=(ot-u)/2,E=(nt-m)/2}f.drawImage(n,_,E,u,m);let T=f.getImageData(0,0,ot,nt).data,b=new Float32Array(T.length);for(let O=0;O<T.length;O++)b[O]=T[O];let S=Math.floor(_),C=Math.floor(_+u),k=Math.floor(E),V=Math.floor(E+m);for(let O=0;O<nt;O++)for(let L=0;L<ot;L++){let x=O*ot+L,K=x*4,W=b[K+3];if(L>=S&&L<C&&O>=k&&O<V&&W>=128){let w=b[K],B=b[K+1],M=b[K+2],y=pa(w,B,M);l[x]=y;let D=Wt[y]||Wt[s.DIRT],G=w-D.r,Z=B-D.g,g=M-D.b,R=(U,X,z)=>{let Q=L+U,j=O+X;if(Q>=0&&Q<ot&&j>=0&&j<nt){let ut=(j*ot+Q)*4;b[ut]+=G*z/16,b[ut+1]+=Z*z/16,b[ut+2]+=g*z/16}};R(1,0,7),R(-1,1,3),R(0,1,5),R(1,1,1)}}o(l)},n.onerror=()=>i(new Error("Failed to load image")),n.src=e.target.result},r.onerror=()=>i(new Error("Failed to read file")),r.readAsDataURL(t)})}function rr(t,o){let i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}function ar(t,o,i){let r=Math.floor(o/2);for(let e=0;e<i-1;e++){let n=e*o+r,a=t[(e+1)*o+r];if(t[n]===s.AIR&&a!==s.AIR)return{x:r,y:e}}return{x:r,y:10}}var Ot=[{time:0,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.35,top:"#4CA1AF",bottom:"#C4E0E5"},{time:.4,top:"#ff758c",bottom:"#ff7eb3"},{time:.42,top:"#2C3E50",bottom:"#FD746C"},{time:.45,top:"#0f2027",bottom:"#203a43"},{time:.5,top:"#000000",bottom:"#1a1a2e"},{time:.55,top:"#0f2027",bottom:"#203a43"},{time:.58,top:"#2C3E50",bottom:"#FD746C"},{time:.6,top:"#ff758c",bottom:"#ff7eb3"},{time:.65,top:"#4CA1AF",bottom:"#C4E0E5"},{time:1,top:"#4CA1AF",bottom:"#C4E0E5"}],ke="#020205",Pe="#050505",oe=.2;var ve=.5,_a=60,sr=[];for(let t=0;t<_a;t++)sr.push({x:Math.random(),y:Math.random()*.6,size:Math.random()*2+1,twinkleSpeed:Math.random()*.05+.01});function kt(t,o,i){let r=parseInt(t.slice(1,3),16),e=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),a=parseInt(o.slice(1,3),16),l=parseInt(o.slice(3,5),16),c=parseInt(o.slice(5,7),16),f=Math.round(r+(a-r)*i),d=Math.round(e+(l-e)*i),h=Math.round(n+(c-n)*i),u=m=>m.toString(16).padStart(2,"0");return`#${u(f)}${u(d)}${u(h)}`}function Le(t){if(t>ve){let o=(t-ve)*5;return Mt(1-o,0,1)}return 1}function lr(t,o){t=t%1,t<0&&(t+=1);let i=Ot[0],r=Ot[Ot.length-1];for(let c=0;c<Ot.length-1;c++)if(t>=Ot[c].time&&t<Ot[c+1].time){i=Ot[c],r=Ot[c+1];break}let e=r.time-i.time,n=(t-i.time)/e,a=kt(i.top,r.top,n),l=kt(i.bottom,r.bottom,n);if(o<oe){let c=Mt((oe-o)*4,0,1);a=kt(a,ke,c),l=kt(l,ke,c)}if(o>ve&&o<=.8){let c=Mt((o-ve)*3.33,0,1);a=kt(a,Pe,c),l=kt(l,Pe,c)}if(o>.8){let c=(o-.8)/.2;a=kt(Pe,ke,c),l=kt(Pe,ke,c)}return{top:a,bottom:l}}function cr(t,o,i,r){let e=t*Math.PI*2-Math.PI/2,n=r*.9,a=i/2,l=r*.9,c=a+Math.cos(e)*n,f=l+Math.sin(e)*n,d=50,h=f<r+d*4,u=Le(o);u<=0&&(h=!1);let m="#FFFFA0",_="#FFFFFF",E="rgba(255, 255, 200, 0.4)";return t>.35&&t<.65&&(m="#FF7E5F",_="#FD746C",E="rgba(255, 100, 50, 0.4)"),{type:"sun",isVisible:h,x:c,y:f,radius:d,color:m,shadow:{color:_,blur:40},glowColor:E,opacity:u}}function fr(t,o,i,r,e=0){let n=t*Math.PI*2+Math.PI/2,a=r*.8,l=i/2,c=r*.9,f=l+Math.cos(n)*a,d=c+Math.sin(n)*a,h=30,u=d<r+h*4,m=Le(o);m<=0&&(u=!1);let _=28,E=e%_/_;return{type:"moon",isVisible:u,x:f,y:d,radius:h,color:"#F4F6F0",shadow:{color:"#ffffff",blur:10},glowColor:"rgba(200, 220, 255, 0.2)",opacity:m,phase:E}}function dr(t,o,i,r){let e=0;t>.4&&t<.6&&(t<.5?e=(t-.4)*10:e=(.6-t)*10);let n=Le(o);e*=n;let a=0;o<oe&&(a=Mt((oe-o)*5,0,1));let l=1-oe;o>l&&(a=Mt((o-l)*5,0,1));let c=Math.max(e,a);return c<=.01?[]:sr.map(f=>({x:f.x*i,y:f.y*r,size:f.size,opacity:c*(.7+Math.sin(Date.now()*f.twinkleSpeed)*.3)}))}function hr(t,o,i,r,e,n=0){if(n%28!==0)return;let a=0;if(o>.4&&o<.6)o<.45?a=(o-.4)*20:o>.55?a=(.6-o)*20:a=1;else return;let l=Le(i);if(a*=l,a<=.01)return;t.save(),t.globalCompositeOperation="lighter";let c=Date.now()/4e3,f=[{color:[160,100,50],yBase:e*.2,amp:e*.1,speed:1,widthScale:1},{color:[260,100,60],yBase:e*.15,amp:e*.15,speed:.7,widthScale:1.5},{color:[190,100,50],yBase:e*.25,amp:e*.08,speed:1.3,widthScale:.8}];for(let d=0;d<f.length;d++){let h=f[d];t.beginPath();let u=40;for(let T=0;T<=r+u;T+=u){let b=Math.sin(T*.002*h.widthScale+c*h.speed+d),S=Math.sin(T*.005*h.widthScale-c*h.speed*.5),C=h.yBase+b*h.amp+S*h.amp*.5;T===0?t.moveTo(T,C):t.lineTo(T,C)}t.lineTo(r,0),t.lineTo(0,0),t.closePath();let m=t.createLinearGradient(0,0,0,e*.6),[_,E,A]=h.color;m.addColorStop(0,`hsla(${_}, ${E}%, ${A}%, 0)`),m.addColorStop(.2,`hsla(${_}, ${E}%, ${A}%, ${.15*a})`),m.addColorStop(1,`hsla(${_}, ${E}%, ${A}%, 0)`),t.fillStyle=m,t.fill()}t.restore()}function ur(t,{world:o,player:i,cameraX:r,cameraY:e,zoom:n=1,logicalWidth:a,logicalHeight:l,textures:c,input:f,tntManager:d}){if(!o)return;let h=Date.now(),u=h%ue/ue,m=Math.floor(h/ue),_=o.height*p,A=((e+l/2)%_+_)%_/_,{top:T,bottom:b}=lr(u,A),S=t.createLinearGradient(0,0,0,l);S.addColorStop(0,T),S.addColorStop(1,b),t.fillStyle=S,t.fillRect(0,0,a,l);let C=dr(u,A,a,l);t.fillStyle="#FFFFFF",C.forEach(M=>{t.globalAlpha=M.opacity,t.beginPath(),t.arc(M.x,M.y,M.size,0,Math.PI*2),t.fill()}),t.globalAlpha=1,hr(t,u,A,a,l,m);let k=cr(u,A,a,l),V=fr(u,A,a,l,m),O=[k,V];O.forEach(M=>{if(!M.isVisible)return;t.globalAlpha=M.opacity!==void 0?M.opacity:1;let y=M.radius*6,D=t.createRadialGradient(M.x,M.y,M.radius,M.x,M.y,y),G=M.glowColor||"rgba(255, 255, 255, 0.2)";D.addColorStop(0,G),D.addColorStop(.3,G.replace(/[\d.]+\)$/,"0.1)")),D.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=D,t.beginPath(),t.arc(M.x,M.y,y,0,Math.PI*2),t.fill(),t.globalAlpha=1}),O.forEach(M=>{if(M.isVisible){if(t.globalAlpha=M.opacity!==void 0?M.opacity:1,M.type==="sun")t.beginPath(),t.arc(M.x,M.y,M.radius,0,Math.PI*2),t.fillStyle=M.color,t.shadowColor=M.shadow.color,t.shadowBlur=M.shadow.blur,t.fill(),t.shadowBlur=0;else if(M.type==="moon"){let y=M.radius,D=M.phase;t.save(),t.translate(M.x,M.y);let G=Math.PI/4;if(t.rotate(G),t.shadowColor=M.shadow.color,t.shadowBlur=M.shadow.blur,t.fillStyle=M.color,t.beginPath(),D<=.5){t.arc(0,0,y,-Math.PI/2,Math.PI/2,!1);let g=y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,Math.PI/2,3*Math.PI/2,g>0)}else{t.arc(0,0,y,Math.PI/2,-Math.PI/2,!1);let g=-y*Math.cos(D*2*Math.PI),R=Math.abs(g);t.ellipse(0,0,R,y,0,-Math.PI/2,Math.PI/2,g<0)}t.closePath(),t.fill(),t.shadowBlur=0,t.save(),t.clip(),t.fillStyle="rgba(0,0,0,0.1)",[{dx:-8,dy:-5,r:6},{dx:10,dy:8,r:4},{dx:-5,dy:10,r:3}].forEach(g=>{t.beginPath(),t.arc(g.dx,g.dy,g.r,0,Math.PI*2),t.fill()}),t.restore(),t.restore()}t.globalAlpha=1}});let{startX:L,endX:x,startY:K,endY:W}=de(r,e,a,l,p,n);t.fillStyle=S;let F=Math.ceil(p*n),w=Math.ceil(p*n);for(let M=K;M<W;M++)for(let y=L;y<x;y++){let D=(M%o.height+o.height)%o.height;if(o.getBlock(y,D)===s.WATER){let Z=Math.floor((y*p-r)*n),g=Math.floor((M*p-e)*n);t.fillRect(Z,g,F,w)}}let B=new Set([s.CLOUD,s.JUMP_PAD,s.JACKPOT,s.ACCELERATOR_LEFT,s.ACCELERATOR_RIGHT]);for(let M=K;M<W;M++)for(let y=L;y<x;y++){let D=(M%o.height+o.height)%o.height,G=o.getBlock(y,D);if(G!==s.AIR&&c[G]){let Z=Math.floor((y*p-r)*n),g=Math.floor((M*p-e)*n);if(G===s.TNT&&d&&d.hasTimerAt(y,D)){let R=h*.01,U=Math.sin(R*15+y*7)*1.2,X=Math.cos(R*18+M*5)*1.2,z=Math.floor((y*p+U-r)*n),Q=Math.floor((M*p+X-e)*n);t.drawImage(c[G],z,Q,F,w);let j=(Math.sin(R*8)+1)/2;if(t.fillStyle=`rgba(255, ${Math.floor(100-j*100)}, 0, ${.2+j*.3})`,t.fillRect(z,Q,F,w),Math.sin(R*20)>.3){let ct=z+F/2+(Math.random()-.5)*8*n,De=Q+2*n,gt=(3+Math.random()*3)*n;t.fillStyle="#ffff00",t.beginPath(),t.arc(ct,De,gt,0,Math.PI*2),t.fill(),t.fillStyle="rgba(255, 200, 0, 0.5)",t.beginPath(),t.arc(ct,De,gt+2*n,0,Math.PI*2),t.fill()}}else t.drawImage(c[G],Z,g,F,w);if(!B.has(G)){let R=(D-1+o.height)%o.height,U=o.getBlock(y,R);U!==s.AIR&&!ce(U,$)&&(t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(Z,g,F,w))}}}if(t.save(),t.scale(n,n),t.translate(-r,-e),i&&i.draw(t),$i(t,r,e,a,l),En(t,r,e,a,l),Pn(t,r,e,a,l),f&&f.mouse&&f.mouse.active){let M=Yt(f.mouse.x,f.mouse.y,r,e,n),{tx:y,ty:D}=Ut(M.x,M.y,p);le(M.x,M.y,i.getCenterX(),i.getCenterY(),Xt)&&(t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=2,t.strokeRect(y*p,D*p,p,p))}if(f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let M=f.gamepad.cursorX,y=f.gamepad.cursorY,D=Yt(M,y,r,e,n),{tx:G,ty:Z}=Ut(D.x,D.y,p);t.strokeStyle="rgba(255, 235, 59, 0.7)",t.lineWidth=3,t.strokeRect(G*p,Z*p,p,p)}if(t.restore(),f&&f.gamepad&&f.gamepad.cursorActive&&f.gamepad.connected){let M=f.gamepad.cursorX,y=f.gamepad.cursorY,D=12,G=4;t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.moveTo(M-D,y),t.lineTo(M-G,y),t.moveTo(M+G,y),t.lineTo(M+D,y),t.moveTo(M,y-D),t.lineTo(M,y-G),t.moveTo(M,y+G),t.lineTo(M,y+D),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath(),t.arc(M,y,2,0,Math.PI*2),t.fill()}}function mr({world:t,player:o}){let i=[];function r(f,d,h){let u=h||Ko+Math.floor(Math.random()*Vo);i.push({x:f,y:d,timer:u})}function e(f){let d=f.y-o.height-.1;o.y=d;let h=t.height*p;o.y=(o.y%h+h)%h,o.vy=0,o.grounded=!0;let u=Math.floor(o.x/p),m=Math.floor((o.x+o.width)/p),_=Math.floor(o.y/p),E=Math.floor((o.y+o.height)/p),A=null;for(let T=_;T<=E;T++)for(let b=u;b<=m;b++){let S=(T%t.height+t.height)%t.height,C=(b%t.width+t.width)%t.width,k=t.getBlock(C,S);if(lt(k,$))if(Et(k,$))t.setBlock(C,S,s.AIR);else{let V=T*p;A=A===null?V:Math.min(A,V)}}A!==null&&(o.y=A-o.height-.1,o.y=(o.y%h+h)%h)}function n(f,d,h){if(f<0||f>=t.width)return;let u=(d%t.height+t.height)%t.height,m=t.getBlock(f,u);if($[m]&&$[m].unbreakable)return;m!==s.AIR&&m!==s.SAPLING&&t.setBlock(f,u,s.AIR);let _={x:f*p,y:u*p,w:p,h:p};se(o.getRect(),_)&&e(_),t.setBlock(f,u,h)}function a(f,d){let h=[],u=[{x:f,y:d}],m=new Set,_=(E,A)=>`${E},${A}`;for(m.add(_(f,d));u.length>0;){let E=u.shift();if(t.getBlock(E.x,E.y)===s.SAPLING){h.push(E);let A=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(let T of A){let b=E.x+T.dx,C=((E.y+T.dy)%t.height+t.height)%t.height;if(b>=0&&b<t.width){let k=_(b,C);!m.has(k)&&t.getBlock(b,C)===s.SAPLING&&(m.add(k),u.push({x:b,y:C}))}}}}return h}function l(f){let d=f.length;if(d===0)return;let h=1/0,u=-1/0,m=1/0,_=-1/0;f.forEach(g=>{g.x<h&&(h=g.x),g.x>u&&(u=g.x),g.y<m&&(m=g.y),g.y>_&&(_=g.y)});let E=u-h+1,A=_-m+1,T=A/E,b=Math.floor((h+u)/2),S=_;f.forEach(g=>{t.setBlock(g.x,g.y,s.AIR)});let C=5,k=1,V=0,O=0,L=1,x=A>t.height/2;!x&&T>=2?(k=1,L=1.5,V=.02):!x&&T<=.5?(k=E,L=.8,V=.05):(k=Math.ceil(Math.sqrt(d)),V=.3,O=.3);let K=Math.floor(d*C*L),W=[],F=0,w=S,B=b;for(;F<K;){let g=k;if(O>0&&Math.random()<O&&(g+=Math.random()<.5?-1:1),g<1&&(g=1),!(S-w<2)){if(Math.random()<V){let X=Math.random()<.5?-1:1;B+=X}B<b-3&&Math.random()<.2&&B++,B>b+3&&Math.random()<.2&&B--}let U=B-Math.floor((g-1)/2);for(let X=0;X<g;X++)W.push({x:U+X,y:w,type:s.WOOD}),F++;if(w--,S-w>100)break}let M=w+1,y=B,D=2+k*.8;D>6&&(D=6);let G=Math.ceil(D),Z=Math.ceil(D*.8);for(let g=M-Z;g<=M+Z;g++)for(let R=y-G;R<=y+G;R++){let U=(R-y)/G,X=(g-M)/Z;Math.sqrt(U*U+X*X)<1-Math.random()*.25&&(W.some(j=>j.x===R&&j.y===g&&j.type===s.WOOD)||W.push({x:R,y:g,type:s.LEAVES}))}W.forEach(({x:g,y:R,type:U})=>n(g,R,U))}function c(){for(let f=i.length-1;f>=0;f--){let d=i[f];if(t.getBlock(d.x,d.y)!==s.SAPLING){i.splice(f,1);continue}if(d.timer--,d.timer<=0){let h=a(d.x,d.y);l(h)}}for(let f=i.length-1;f>=0;f--)t.getBlock(i[f].x,i[f].y)!==s.SAPLING&&i.splice(f,1)}return{addSapling:r,tick:c,getTimers:()=>i,restoreTimers:f=>{i.length=0,f&&i.push(...f)}}}Jt();var pr=0;var _r=12,gr=13;function br(t){let{onStartGame:o,onLoadGame:i,onImportWorld:r}=t;function e(){let g=document.getElementById("start-screen");g&&(g.style.display="none")}function n(){let g=Ct(),R=document.querySelector(".start-buttons");R&&(g?R.classList.add("has-save"):R.classList.remove("has-save"))}n();let a=document.getElementById("vol-bgm"),l=document.getElementById("vol-sfx"),c=document.getElementById("volume-toggle-btn"),f=document.getElementById("volume-popup");function d(){let g=localStorage.getItem("pictoco_vol_bgm"),R=localStorage.getItem("pictoco_vol_sfx"),U=g!==null?parseFloat(g):1,X=R!==null?parseFloat(R):1;a&&(a.value=U),l&&(l.value=X),J.setMusicVolume(U),J.setSfxVolume(X)}a&&a.addEventListener("input",g=>{let R=parseFloat(g.target.value);J.setMusicVolume(R),localStorage.setItem("pictoco_vol_bgm",R)}),l&&l.addEventListener("input",g=>{let R=parseFloat(g.target.value);J.setSfxVolume(R),localStorage.setItem("pictoco_vol_sfx",R)}),c&&f&&c.addEventListener("click",g=>{g.stopPropagation(),f.classList.contains("open")?f.classList.remove("open"):f.classList.add("open")}),d();let h=document.getElementById("start-btn");h&&h.addEventListener("click",()=>{e(),o()});let u=document.getElementById("reset-btn");u&&u.addEventListener("click",()=>{e(),o()});let m=document.getElementById("continue-btn");m&&m.addEventListener("click",()=>{let g=Ct();g&&(e(),i(g))});let _=document.getElementById("world-modal"),E=document.getElementById("world-btn"),A=document.getElementById("world-close-btn"),T=document.getElementById("export-btn"),b=document.getElementById("import-btn"),S=document.getElementById("import-file");function C(){if(T){let g=Ct();T.disabled=!g||!g.world||!g.world.map}b&&S&&(b.disabled=!S.files[0])}function k(){_&&(_.classList.add("visible"),C())}function V(){_&&_.classList.remove("visible")}E&&E.addEventListener("click",k),A&&A.addEventListener("click",V),_&&_.addEventListener("click",g=>{g.target===_&&V()}),S&&S.addEventListener("change",C),T&&T.addEventListener("click",async()=>{let g=Ct();if(!g||!g.world||!g.world.map)return;let R=atob(g.world.map),U=new Uint8Array(R.length);for(let Q=0;Q<R.length;Q++)U[Q]=R.charCodeAt(Q);let X=await nr(U,g.world.width,g.world.height),z=new Date().toISOString().slice(0,19).replace(/[:-]/g,"");rr(X,`world_${z}.png`)}),b&&S&&b.addEventListener("click",async()=>{let g=S.files[0];if(g)try{let R=await ir(g);V(),e(),r(R)}catch{alert(ht.msg_import_err)}});let O=document.getElementById("lang-current"),L=document.getElementById("lang-popup"),x=document.querySelectorAll(".lang-option");function K(){Promise.resolve().then(()=>(Jt(),tn)).then(({currentLanguage:g})=>{if(O){O.innerHTML="";let R=document.createElement("div");R.className=`flag-icon flag-${g}`,O.appendChild(R)}x.forEach(R=>{R.dataset.lang===g?R.classList.add("active"):R.classList.remove("active")})})}function W(){L&&L.classList.add("open")}function F(){L&&L.classList.remove("open")}K(),O&&O.addEventListener("click",g=>{g.stopPropagation(),L&&L.classList.contains("open")?F():W()}),x.forEach(g=>{g.addEventListener("click",R=>{R.stopPropagation();let U=g.dataset.lang;qe(U),K(),F()})}),document.addEventListener("click",g=>{L&&L.classList.contains("open")&&!L.contains(g.target)&&g.target!==O&&F(),f&&f.classList.contains("open")&&!f.contains(g.target)&&g.target!==c&&f.classList.remove("open")});let w=0,B=!1,M=!1,y=!1;function D(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none")return[];let R=[];if(Ct()){let z=document.getElementById("continue-btn");z&&R.push(z);let Q=document.getElementById("reset-btn");Q&&R.push(Q)}else{let z=document.getElementById("start-btn");z&&R.push(z)}let X=document.getElementById("world-btn");return X&&R.push(X),R}function G(){D().forEach((R,U)=>{U===w?(R.classList.add("gamepad-selected"),R.focus()):R.classList.remove("gamepad-selected")})}function Z(){let g=document.getElementById("start-screen");if(!g||g.style.display==="none"||_&&_.classList.contains("visible"))return;let R=navigator.getGamepads(),U=null;for(let ct of R)if(ct&&ct.connected){U=ct;break}if(!U)return;let{buttons:X}=U,z=D(),Q=X[_r]&&X[_r].pressed;Q&&!B&&(w=Math.max(0,w-1),G()),B=Q;let j=X[gr]&&X[gr].pressed;j&&!M&&(w=Math.min(z.length-1,w+1),G()),M=j;let ut=X[pr]&&X[pr].pressed;if(ut&&!y){let ct=z[w];ct&&ct.click()}y=ut}setInterval(Z,50),window.addEventListener("gamepadconnected",()=>{w=0,G()})}function Ar(){let t=0,o=0,i=1;return{get x(){return t},get y(){return o},get zoom(){return i},setPosition(r,e){t=r,o=e},update(r,e,n,a){let l=Math.hypot(r.vx,r.vy),c=1;l>We&&(c=Math.max(Ro,1-(l-We)*So));let f=1e-4,d=.002,h=.06,u=.05,m=c-i,_=Math.abs(m);_<f?i=c:_>u?(i+=Math.sign(m)*d,(c-i)*m<0&&(i=c)):(i+=m*h,Math.abs(c-i)<f&&(i=c));let E=n/i,A=a/i,T=r.getCenterX()-E/2,b=r.getCenterY()-A/2,S=e.width*p,C=T-t;Math.abs(C)>S/2&&(C>0?t+=S:t-=S);let k=e.height*p,V=b-o;Math.abs(V)>k/2&&(V>0?o+=k:o-=k),t=Ne(t,T,Ge),o=Ne(o,b,Ge)}}}Jt();Ze();var re={},Kt=document.getElementById("gameCanvas"),po=Kt.getContext("2d"),q,tt,ne=0,st,rt,Vt,at=null,ie=null,xe=null,Be=0,ga=.25,uo=0,At=window.innerWidth,Tt=window.innerHeight;function Tr(){let t=window.devicePixelRatio||1;At=window.innerWidth,Tt=window.innerHeight,Kt.width=At*t,Kt.height=Tt*t,Kt.style.width=At+"px",Kt.style.height=Tt+"px",po.scale(t,t),po.imageSmoothingEnabled=!1}window.addEventListener("resize",Tr);function mo(t=null){q=new Nt(ot,nt);let o=(i,r)=>{J.playExplosion();for(let e of r)q.setBlock(i,e,s.AIR),at&&at.cancelTimerAt(i,e)};tt=new we(q,_e,o,(i,r)=>{Tn(i,r)}),re=Yo(),On(re),st=Ar(),at=or({world:q,player:tt,sounds:J,addToInventory:_e,createExplosionParticles:oo}),ie=mr({world:q,player:tt}),zi({onTNTAccelerator:(i,r)=>{J.playExplosion();for(let e of i)q.setBlock(e,r,s.AIR),at&&at.cancelTimerAt(e,r)}}),Vt=vn({world:q,player:tt,inventory:{addToInventory:_e,consumeFromInventory:qo,getSelectedBlockId:jo},camera:st,sounds:J,constants:{TILE_SIZE:p,BLOCKS:s,BLOCK_PROPS:$,REACH:Xt},utils:{screenToWorld:Yt,worldToTile:Ut,isWithinReach:le,isBlockBreakable:Et,isBlockTransparent:ce,isBlockSolid:lt,getBlockMaterialType:fe,rectsIntersect:se,hasAdjacentBlock:Mo},onBlockPlaced:(i,r,e)=>{if(e===s.TNT){let n=r-1;for(;q.getBlock(i,n)===s.TNT;)n--;let l=q.getBlock(i,n)===s.JUMP_PAD,c=i-1;for(;q.getBlock(c,r)===s.TNT;)c--;let f=q.getBlock(c,r)===s.ACCELERATOR_LEFT,d=i+1;for(;q.getBlock(d,r)===s.TNT;)d++;let h=q.getBlock(d,r)===s.ACCELERATOR_RIGHT;if(!(l||f||h))at.onBlockPlaced(i,r);else{if(l){let m=r+1;for(;q.getBlock(i,m)===s.TNT;)at.cancelTimerAt(i,m),m++}if(f){let m=i+1;for(;q.getBlock(m,r)===s.TNT;)at.cancelTimerAt(m,r),m++}if(h){let m=i-1;for(;q.getBlock(m,r)===s.TNT;)at.cancelTimerAt(m,r),m--}}}else if(e===s.JUMP_PAD){let n=r+1;for(;q.getBlock(i,n)===s.TNT;)at.cancelTimerAt(i,n),n++}else if(e===s.ACCELERATOR_LEFT){let n=i+1;for(;q.getBlock(n,r)===s.TNT;)at.cancelTimerAt(n,r),n++}else if(e===s.ACCELERATOR_RIGHT){let n=i-1;for(;q.getBlock(n,r)===s.TNT;)at.cancelTimerAt(n,r),n--}else e===s.SAPLING&&ie.addSapling(i,r)}}),rt=Xo(Kt,{onHotbarSelect:jt,onTouch:(i,r)=>Vt.handlePointer(i,r),onClimb:()=>Vt.triggerClimb()}),Zo(re),xe=er({world:q,player:tt,timers:{tnt:at.getTimers(),saplings:ie.getTimers()},inventory:{getInventoryState:Jo,loadInventoryState:Je},utils:{clamp:Mt},constants:{TILE_SIZE:p}}),t?(xe.applySavedState(t),t.timers&&t.timers.saplings&&ie.restoreTimers(t.timers.saplings)):vt(),Tr(),st.setPosition(tt.getCenterX()-At/2,tt.getCenterY()-Tt/2),xe.startAutosave(),xe.saveGameState(),ne===0&&requestAnimationFrame(_o)}function ba(){if(tt){if(Be>0&&Be--,rt.pollGamepads){let t=(tt.getCenterX()-st.x)*st.zoom,o=(tt.getCenterY()-st.y)*st.zoom;rt.pollGamepads({screenWidth:At,screenHeight:Tt,playerScreenX:t,playerScreenY:o,reach:(Xt-Eo)*st.zoom,skipJump:_t})}if(tt.tick(rt),rt.mouse.leftDown&&(_t||Vt.handlePointer(rt.mouse.x,rt.mouse.y),rt.mouse.leftDown=!1),rt.gamepad&&rt.gamepad.connected&&!_t){let t=rt.gamepad.cursorX,o=rt.gamepad.cursorY;rt.gamepad.breakAction&&Be===0&&Vt.handlePointer(t,o,"break")&&(Be=yo),rt.gamepad.placeAction&&Vt.handlePointer(t,o,"place")}hn(tt,q,re),_t&&dn(),Ji(tt,q,J),Zi(),Qi(tt,q),tr(),Mn(q,st.x,st.y,{width:At,height:Tt}),kn(),at.tick(),ie.tick()}}function Aa(){tt&&st.update(tt,q,At,Tt)}function Ta(){ur(po,{world:q,player:tt,cameraX:st.x,cameraY:st.y,zoom:st.zoom,logicalWidth:At,logicalHeight:Tt,textures:re,input:rt,tntManager:at})}function _o(t){if(ne===0){ne=t,requestAnimationFrame(_o);return}let o=t-ne;for(ne=t,o>50&&(o=50),uo+=o;uo>=Ht-ga;)ba(),uo-=Ht;Aa(),Ta(),requestAnimationFrame(_o)}var Pt=()=>{J.resume()};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Pt()});window.addEventListener("pageshow",t=>{t.persisted&&Pt(),Pt()});window.addEventListener("focus",Pt);window.addEventListener("click",Pt);window.addEventListener("keydown",Pt);window.addEventListener("touchstart",Pt);window.addEventListener("touchend",Pt);br({onStartGame:()=>{J.init(),mo()},onLoadGame:t=>{J.init(),mo(t)},onImportWorld:t=>{J.init();let i=Ct()?.inventory||null;mo(),q.map=t,i&&Je(i);let r=ar(t,ot,nt);tt.x=r.x*p,tt.y=r.y*p,tt.vx=0,tt.vy=0,st.setPosition(tt.getCenterX()-At/2,tt.getCenterY()-Tt/2)}});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./service-worker.js").then(t=>{console.log("ServiceWorker registered:",t.scope)}).catch(t=>{console.log("ServiceWorker registration failed:",t)})});})();
